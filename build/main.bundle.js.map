{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/external \"d3\"","webpack://[name]/external \"_\"","webpack://[name]/external \"lodash\"","webpack://[name]/./src/util.js","webpack://[name]/external \"jQuery\"","webpack://[name]/./src/watch.js","webpack://[name]/./src/sharing/format.js","webpack://[name]/./src/TMViz.js","webpack://[name]/./src/TuringMachine.js","webpack://[name]/./src/tape/TapeViz.js","webpack://[name]/./src/tape/Tape.js","webpack://[name]/./src/tape/tape.css","webpack://[name]/./src/state-diagram/StateGraph.js","webpack://[name]/./src/state-diagram/StateViz.js","webpack://[name]/./src/state-diagram/StateViz.css","webpack://[name]/./src/examples.js","webpack://[name]/./src/storage.js","webpack://[name]/external \"Promise\"","webpack://[name]/./src/parser.js","webpack://[name]/external \"jsyaml\"","webpack://[name]/./src/errors.js","webpack://[name]/external \"ace\"","webpack://[name]/./src/TMDocument.js","webpack://[name]/./src/sharing/import.js","webpack://[name]/./src/sharing/gist.js","webpack://[name]/./src/main.js","webpack://[name]/./src/TMDocumentController.js","webpack://[name]/./src/TMSimulator.js","webpack://[name]/./src/transformations.js","webpack://[name]/./src/examples sync ./node_modules/raw-loader ^\\.\\/.*\\.yaml$","webpack://[name]/./src/examples/_template.yaml","webpack://[name]/./src/examples/binaryAdd.yaml","webpack://[name]/./src/examples/binaryIncrement.yaml","webpack://[name]/./src/examples/binaryMult.yaml","webpack://[name]/./src/examples/busyBeaver3.yaml","webpack://[name]/./src/examples/busyBeaver4.yaml","webpack://[name]/./src/examples/copy1s.yaml","webpack://[name]/./src/examples/divisibleBy3.yaml","webpack://[name]/./src/examples/divisibleBy3Base10.yaml","webpack://[name]/./src/examples/lengthMult.yaml","webpack://[name]/./src/examples/matchBinaryStrings.yaml","webpack://[name]/./src/examples/matchThreeLengths.yaml","webpack://[name]/./src/examples/multitape.yaml","webpack://[name]/./src/examples/palindrome.yaml","webpack://[name]/./src/examples/powersOfTwo.yaml","webpack://[name]/./src/examples/repeat01.yaml","webpack://[name]/./src/examples/unaryMult.yaml","webpack://[name]/./src/examples/universal.yaml","webpack://[name]/./src/DocumentMenu.js","webpack://[name]/./src/sharing/CheckboxTable.js","webpack://[name]/./src/sharing/FileReaderPromise.js","webpack://[name]/./src/sharing/import-panel.js","webpack://[name]/./src/sharing/export-panel.js","webpack://[name]/external \"Clipboard\"","webpack://[name]/./src/kbdshortcuts.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","d3","_","lodash","isBrowserIEorEdge","Boolean","document","documentMode","window","StyleMedia","nonNull","Error","String","coalesce","a","b","applyMaybe","f","x","getFirst","xs","length","val","toDocFragment","array","result","createDocumentFragment","forEach","appendChild","jQuery","watch","thisArg","prop","handler","desc","getOwnPropertyDescriptor","undefined","TypeError","configurable","writable","set","accessors","newval","watchInit","jsyaml","docToYaml","sourceCode","positionTable","editorSourceCode","yamlToDoc","invert","mapKeys","mapping","input","output","keys","fromKey","toKey","stringifyDocument","flow","omitBy","update","mapValues","pos","fixed","y","partialRight","safeDump","flowLevel","lineWidth","noRefs","noCompatMode","parseDocument","safeLoad","defaults","px","py","obj","InvalidDocumentError","isString","message","this","stack","constructor","YAMLException","TuringMachine","TapeViz","StateGraph","StateViz","pulseEdge","edge","duration","select","domNode","classed","transition","style","each","addTapes","div","spec","tapes","number","push","addTape","append","attr","blank","split","vis","TMViz","posTable","graph","table","colors","stateviz","getVertexMap","getEdges","titles","info","edgeAnimation","stepInterval","animationDuration","self","machine","animationCallback","state","symbol","tuple","getInstructionAndEdge","instruction","animatedTransition","isRunning","step","startState","oldstate","newstate","getVertex","isHalted","__parentDiv","__spec","reset","tape","remove","move","direction","headRight","headLeft","toString","map","join","instruct","nextInstruction","write","visualize","defineProperties","reduce","acc","read","Tape","initTapeCells","selection","datum","text","cellWidth","cellHeight","positionCells","offset","repositionWrapper","wrapper","svg","lookaround","width","height","selectAll","data","readRange","enter","moveHead","exit","wOffset","cOffset","smooth","rule","all","cur","dir","skip","querySelector","textContent","chars","includes","classList","add","color","childNodes","readOffset","insert","before","after","slice","reverse","last","pop","isEmpty","start","end","range","deriveGraph","color_table","transitions","label","allEdges","vertex","stateTransitions","cache","symbolKey","symbols","target","tap","source","labels","edgeTo","action","rightSide","visibleSpace","labelFor","normalize","edges","derived","__graph","__edges","assign","addV","array1","array2","subtractV","normV","Math","sqrt","normSqV","vectorFromLengthAngle","angle","cos","sin","EdgeCounter","e","index","numEdgesFromTo","src","EdgeShape","freeze","loop","arc","straight","edgePathFor","nodeRadius","shape","loopEndOffset","loopArc","PI","p1","p2","radius","atan2","sep","scalar","multiplyV","identity","noop","limitRange","min","max","shapeForEdge","appendSVGTo","hwRatio","position","top","left","container","nodes","linkArray","w","h","scale","category10","nodeArray","Array","values","__stateMap","force","layout","links","size","linkDistance","charge","theta","gravity","drag","on","row","round","edgeCounter","edgegroups","labelAbove","labelBelow","edgeD","edgeIndex","group","edgepath","getPath","refreshLabels","svgrect","getBBox","isFlipped","shouldFlip","edgepaths","nodeSelection","nodecircles","resume","nodelabels","lastIndexOf","svgCSS","styleSheet","cssText","cx","cy","every","stop","getPositionTable","pick","stateMap","node","setPositionTable","fromPairs","requireExample","examplePairs","id","doc","examples","isExampleID","docID","list","pair","hasID","firsttimeDocID","blankTemplate","fromOwnWindow","canUseLocalStorage","mod","localStorage","setItem","removeItem","RAMStorage","getItem","clear","KeyValueStorage","hasFocus","addStorageListener","listener","addEventListener","storageArea","removeStorageListener","removeEventListener","Promise","TMSpecError","transformations","makeInstruction","parseInstruction","synonyms","problemValue","suggestion","checkTarget","match","fill","trim","tape_numbers","trimLeft","tape_number","parseInt","parseInstructionString","badKey","L","R","H","writeStr","parseInstructionObject","assert_in","arr","JSON","stringify","parseSpec","str","allowTapes","detailsForBlank","Number","isInteger","checkTableType","actionVal","details","synonym","reason","parseSynonyms","stateObj","parseTable","tapes_count","res","rules","entries","isNaN","parseVis","pos_table","transformed_code","transform","header","code","location","sentences","filter","splice","ace","util","TMDocument","preset","prefix","isExample","useFallbackGet","proto","getPrototypeOf","path","store","stringProp","propDescriptors","parsePositionTable","stringifyPositionTable","dataKeys","copyFrom","other","delete","IDFromNameStorageKey","string","exec","addOutsideChangeListener","re","matches","parse","decimalPlaces","multiplier","pow","truncate","truncateCoords","CheckboxTable","FileReaderPromise","format","getGist","$","queryParams","queryString","decode","decodeURIComponent","replace","decodeFormURLComponent","ImportDialog","dialogNode","titleNode","bodyNode","footerNode","cancelButtonNode","type","class","$dialog","one","__onClose","appendPanel","titleHTML","panel","html","onClose","empty","show","modal","backdrop","keyboard","close","setBodyChildNodes","joinNodes","emptySelection","appendListPanel","title","appendTablePanel","headers","td","isEmptyNonDocs","listNondocuments","dialogBody","nondocs","disclosureTitle","href","role","otherError","filename","errorString","error","badDoc","badYAML","tooLarge","wrongType","parseFiles","sizelimit","files","docfiles","file","search","truncated","resolve","content","readAsText","then","catch","return","documentFiles","nonDocumentFiles","createTextNode","gistDescriptionLink","args","tagName","tag","link","externalLink","gistID","description","createElement","importCommon","citeLink","citeNode","importDocument","dialog","filesPromise","toArray","promise","parsed","body","pickNone","importDocuments","ctable","ceil","toFixed","importButton","names","getCheckedValues","has","onChange","disabled","isCheckedEmpty","pickMultiple","docs","concat","messageForError","waitForDialog","cancel","importGist","importLocalFiles","createElementHTML","innerHTML","element","xhr","status","statusText","pre","runImport","substring","finally","history","replaceState","pathname","promisifyAjax","reject","onCancel","jqXHR","textStatus","errorThrown","abort","config","cancellation","ajax","url","dataType","accepts","createGist","payload","TMDocumentController","DocumentMenu","getId","getElementById","addAlertPane","insertAdjacentHTML","menu","duplicate","loadModule","Function","test","navigator","userAgent","MSStream","importArgs","$importPanel","init","gistIDForm","exportPanel","getCurrentDocument","controller","save","currentDocument","getIsSynced","gistContainer","downloadContainer","copyContentsButton","textarea","docGroup","exampleGroup","optionFromDocument","storagePrefix","opts","setBackingDocument","forceLoadDocument","openDocument","refreshEditMenu","wasExample","renameLink","deleteLink","renameExample","duplicateDocument","removeAttribute","setAttribute","$renameDialog","callback","newDocument","editor","insertSnippet","loadEditorSource","item","preventDefault","focus","renameBox","discardReset","currentOption","newName","rename","isReloading","getButton","sim","ed","parentNode","simulator","editorAlerts","run","speed","load","revert","setTheme","commands","addCommand","bindKey","mac","win","session","setUseWrapMode","main","ev","saveCurrentDocID","event","returnValue","getDocument","setTimeout","TMSimulator","parser","UndoManager","require","containers","buttons","edit","setOptions","tabSize","useSoftTabs","minLines","maxLines","$blockScrolling","Infinity","setReadOnly","editorButtons","revertEditorSource","__document","aceAnnotationFromYAMLException","mark","line","column","keepUndoHistory","diagramSource","editorSource","setEditorValue","setUndoManager","isSynced","showCorruptDiagramAlert","hasValidDiagram","getValue","setValue","setAlertErrors","errors","alerts","annot","lineNum","gotoLine","setAnnotations","setLoadButtonSuccess","didSucceed","__isSynced","removeListener","revertName","isNewDiagram","speeds","indexOf","lastChild","rebindStepRun","stepButton","runButton","runHTML","pauseHTML","oldval","onHaltedChange","onRunningChange","__sourceCode","overridePosTable","__machine","rebindButtons","htmlForRunButton","htmlForPauseButton","enable","unique_symbols_states","states","from_state","comma_symbols","parseSymbolKey","unary","first","elem","shennon2_transform","sort","unshift","log2","codes","padStart","instructions","to_state","raw_symbol","flatten_spec","raw_write","shennon","0","sym","max_state_len","padEnd","universal_source","uni","final_states","data_tape","null","state_tape","unary_cmp","input_index","findIndex","startsWith","webpackContext","req","webpackContextResolve","makeOption","__storagePrefix","doclist","DocumentList","render","selectDocID","getSavedCurrentDocID","option","newOption","storageKey","readList","findOptionByDocID","replaceChild","selected","options","selectedIndex","opt","currentDocID","entry","__prepend","insertBefore","firstChild","didDeleteEntry","deleteIndex","newID","Date","now","__list","writeList","deleted","head","headerRow","tbody","headerCheckbox","getCheckboxes","checked","box","refresh","setHeaders","setData","th","tr","order","headerBox","indeterminate","boxes","total","arguments","reader","FileReader","apply","docimport","createCloseIcon","hideDialog","nextDialog","contains","panelBody","fileInput","importContentsButton","statusContainer","detailsContainer","statusSummary","showErrorDetails","delay","showImportContentOutcome","Clipboard","canUseDownloadAttribute","externalHost","canUseCopyCommand","queryCommandSupported","addSelectOnFocus","generateGist","button","contents","oldButtonText","public","response","urlInput","showGeneratedGist","responseJSON","alert","setupDialog","gistPromise","$alert","prependTo","find","encodeURIComponent","download","className","createDownloadLink","clipboard","$element","trigger","placement","tooltip","clearSelection","destroy","addClass","cleanup","setSelectionRange","abbreviateKey","getKeylist","platform","altToOption","createGetKeylist","renderTable"],"mappings":"qBACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,UAIjBlC,EAAoBA,EAAoBmC,EAAI,I,gBClFrDhC,EAAOD,QAAUkC,I,cCAjBjC,EAAOD,QAAUmC,G,cCAjBlC,EAAOD,QAAUoC,Q,6BC8DjB,IAAIC,cACCC,QAAQC,SAASC,eAAiBF,QAAQG,OAAOC,YAGtD1C,EAAQ2C,QAzDR,SAAiBxB,GACf,GAAa,MAATA,EACF,MAAM,IAAIyB,MAAM,+CAAiDC,OAAO1B,IAE1E,OAAOA,GAsDTnB,EAAQ8C,SAlDR,SAAkBC,EAAGC,GACnB,OAAa,MAALD,EAAaA,EAAIC,GAkD3BhD,EAAQiD,WA5CR,SAAoBC,EAAGC,GACrB,OAAa,MAALA,EAAaD,EAAEC,GAAKA,GA4C9BnD,EAAQoD,SAtCR,SAAkBF,EAAGG,GACnB,IAAK,IAAInD,EAAI,EAAGA,EAAImD,EAAGC,SAAUpD,EAAG,CAClC,IAAIqD,EAAML,EAAEG,EAAGnD,IACf,GAAW,MAAPqD,EACF,OAAOA,IAoCbvD,EAAQwD,cApBR,SAAuBC,GACrB,IAAIC,EAASnB,SAASoB,yBAEtB,OADAF,EAAMG,QAAQF,EAAOG,YAAYnC,KAAKgC,IAC/BA,GAmBT1D,EAAQqC,kBAAoBA,G,cCzE5BpC,EAAOD,QAAU8D,Q,6BC6BjB,SAASC,EAAMC,EAASC,EAAMC,GAC5B,IAAIC,EAAOvD,OAAOwD,yBAAyBJ,EAASC,GAEpD,QAAaI,IAATF,EACF,MAAM,IAAIG,UAAU,sCAAuCL,EAAK,KAC3D,IAAKE,EAAKI,aACf,MAAM,IAAID,UAAU,2CAA4CL,EAAK,KAChE,GAAKE,EAAKK,eAAyBH,IAAbF,EAAKM,IAA3B,CAIP,IAAIC,EAAY,WACd,GAAIP,EAAKM,IAEP,MAAO,CACL1D,IAAKoD,EAAKpD,IACV0D,IAAK,SAAUE,GACb,OAAOR,EAAKM,IAAIpE,KAAK2D,EAASE,EAAQ7D,KAAK2D,EAASC,EAAMD,EAAQC,GAAOU,MAK7E,IAAIpB,EAAMY,EAAKhD,MACf,MAAO,CACLJ,IAAK,WACH,OAAOwC,GAETkB,IAAK,SAAUE,GACb,OAAOpB,EAAMW,EAAQ7D,KAAK2D,EAASC,EAAMV,EAAKoB,KAjBtC,GAwBhB,OAFA/D,OAAOC,eAAemD,EAASC,EAAMS,GAE9BP,GAgBPnE,EAAQ+D,MAAQA,EAChB/D,EAAQ4E,UATV,SAAmBZ,EAASC,EAAMC,GAChC,IAAI/C,EAAQ6C,EAAQC,GAChBE,EAAOJ,EAAMC,EAASC,EAAMC,GAEhC,OADIC,IAAQH,EAAQC,GAAQ9C,GACrBgD,I,6BC1ET,IAAIU,EAAS,EAAQ,IACjB1C,EAAI,EAAQ,GAIZ2C,EAAY,CACdrE,KAAM,OACNsE,WAAY,cACZC,cAAe,YACfC,iBAAkB,mBAEhBC,EAAY/C,EAAEgD,OAAOL,GAIzB,SAASM,EAAQC,GACf,OAAO,SAAUC,GACf,IAAIC,EAAS,GAOb,OANa,MAATD,GACF1E,OAAO4E,KAAKH,GAASzB,SAAQ,SAAU6B,GACrC,IAAIC,EAAQL,EAAQI,GACpBF,EAAOG,GAASJ,EAAMG,MAGnBF,GAaX,IAAII,EAAoBxD,EAAEyD,KACxBR,EAAQN,GACR3C,EAAE0D,QAAO,SAAU1C,GAAK,OAAY,MAALA,KAC/BhB,EAAE2D,OAAO,YAAa3D,EAAE4D,WAAU,SAAUC,GAC1C,OAAOA,EAAIC,MACP,CAAC9C,EAAG6C,EAAI7C,EAAG+C,EAAGF,EAAIE,GAClB,CAAC/C,EAAG6C,EAAI7C,EAAG+C,EAAGF,EAAIE,EAAGD,OAAO,OAGlC9D,EAAEgE,aAAatB,EAAOuB,SAAU,CAAC,CAC/BC,UAAW,EACXC,WAAY,EACZC,QAAQ,EACRC,cAAc,MAadC,EAAgBtE,EAAEyD,KACpBf,EAAO6B,SACPvE,EAAE2D,OAAO,YAAa3D,EAAE4D,WAAU,SAAUC,GAE1C,OAAO7D,EAAEwE,SAAS,CAACC,GAAIZ,EAAI7C,EAAG0D,GAAIb,EAAIE,EAAGD,OAAO,GAAOD,OAEzDZ,EAAQF,IAKV,SAAmB4B,GACjB,GAAW,MAAPA,GAAiC,MAAlBA,EAAI/B,WACrB,MAAM,IAAIgC,EAAqB,uCAC1B,IAAK5E,EAAE6E,SAASF,EAAI/B,YACzB,MAAM,IAAIgC,EAAqB,uDAEjC,OAAOD,KAIT,SAASC,EAAqBE,GAC5BC,KAAKzG,KAAO,uBACZyG,KAAKD,QAAUA,GAAW,mBAC1BC,KAAKC,OAAQ,IAAKvE,OAASuE,MAE7BJ,EAAqBjF,UAAYlB,OAAOY,OAAOoB,MAAMd,WACrDiF,EAAqBjF,UAAUsF,YAAcL,EAE7C/G,EAAQ2F,kBAAoBA,EAC5B3F,EAAQyG,cAAgBA,EACxBzG,EAAQ+G,qBAAuBA,EAG/B/G,EAAQqH,cAAgBxC,EAAOwC,e,6BCxF/B,MAAMC,EAAgB,EAAQ,GAAmBA,cAC3CC,EAAU,EAAQ,GAClBC,EAAa,EAAQ,IACrBC,EAAW,EAAQ,IACnB7C,EAAY,EAAQ,GAAWA,UAC/B1C,EAAK,EAAQ,GA0BnB,SAASwF,EAAUC,EAAMC,EAAS,KAE9B,OADe1F,EAAG2F,OAAOF,EAAKG,SAEzBC,QAAQ,eAAe,GACvBC,aACAJ,SAASA,EAAW,GACpBK,MAAM,eAAgB,OACtBD,aACAJ,SAASA,EAAW,GACpBK,MAAM,eAAgB,OACtBD,aACAJ,SAAS,GACTM,KAAK,SAA0B,WAC5BhG,EAAG2F,OAAOX,MAAMa,QAAQ,eAAe,MAE1CE,MAAM,SAAU,MAChBA,MAAM,eAAgB,MAG/B,SAASE,EAASC,EAAKC,GACA,IAAfA,EAAKC,OAAqC,iBAAfD,EAAK/C,QAChC+C,EAAK/C,MAAQ,CAAC+C,EAAK/C,QAEvB,IAAIiD,EAAwB,IAAfF,EAAKC,MAAc,EAAID,EAAKC,MACrCA,EAAQ,GACZ,IAAK,IAAIpI,EAAI,EAAGA,EAAIqI,EAAQrI,IACxBoI,EAAME,KAAKC,EAAQL,EAAKC,EAAMnI,IAElC,OAAOoI,EAGX,SAASG,EAAQL,EAAKC,EAAMnI,GACxB,OAAO,IAAIqH,EACPa,EAAIM,OAAO,OAAOC,KAAK,QAAS,WAChC,EACAN,EAAKO,MACLP,EAAK/C,OAAS+C,EAAK/C,MAAMpF,GAAK2C,OAAOwF,EAAK/C,MAAMpF,IAAI2I,MAAM,IAAM,GAChER,EAAKS,IAAI5I,IAWjB,SAAS6I,EAAMX,EAAKC,EAAMW,GACtBZ,EAAMlG,EAAG2F,OAAOO,GAChB,IAAIa,EAAQ,IAAIzB,EAAWa,EAAKa,MAAOb,EAAKS,IAAIK,QAChDjC,KAAKkC,SAAW,IAAI3B,EAChBW,EACAa,EAAMI,eACNJ,EAAMK,YAENN,UACA9B,KAAKlC,cAAgBgE,GAGzB9B,KAAKqC,OAASlB,EAAKkB,OACnBrC,KAAKsC,KAAOnB,EAAKmB,KACjBtC,KAAKuC,cAAgB/B,EACrBR,KAAKwC,aAAe,GACpBxC,KAAKyC,kBAAoB,IAEzB,MAAMC,EAAO1C,KAebA,KAAK2C,QAAU,IAAIvC,EAnGvB,SAA4B2B,EAAOa,GAC/B,OAAO,SAAUC,EAAOC,GACpB,IAAIC,EAAQhB,EAAMiB,sBAAsBH,EAAOC,GAC/C,OAAa,MAATC,EACO,MAGXH,EAAkBG,EAAMtC,MACjBsC,EAAME,cA4FbC,CAAmBnB,GAbvB,SAA4BtB,GACxB,IAAIK,EAAa4B,EAAKH,cAAc9B,EAAMiC,EAAKD,mBAC3CC,EAAKS,WACLrC,EAAWA,aAAaJ,SAASgC,EAAKF,cAAcxB,KAAK,OAAO,WAExD0B,EAAKS,WACLT,EAAKU,KAAKV,EAAKD,yBAQ3BtB,EAAKkC,WACLpC,EAASC,EAAKC,IAGlBzD,EAAUsC,KAAK2C,QAAS,SAAS,SAAU5F,EAAMuG,EAAUC,GAGvD,OAFAvI,EAAG2F,OAAOoB,EAAMyB,UAAUF,GAAU1C,SAASC,QAAQ,iBAAiB,GACtE7F,EAAG2F,OAAOoB,EAAMyB,UAAUD,GAAU3C,SAASC,QAAQ,iBAAiB,GAC/D0C,KAKXvD,KAAKyD,UAAW,EAEhB,IAAIN,GAAY,EAIhBzJ,OAAOC,eAAeqG,KAAM,YAAa,CACrC3C,cAAc,EACdxD,IAAK,WACD,OAAOsJ,GAEX5F,IAAK,SAAUtD,GACPkJ,IAAclJ,IACdkJ,EAAYlJ,EACRkJ,GACAnD,KAAKoD,WAMrBpD,KAAK0D,YAAcxC,EACnBlB,KAAK2D,OAASxC,EAMlBU,EAAMjH,UAAUwI,KAAO,SAAU1C,GACxBV,KAAK2C,QAAQS,KAAK1C,KACnBV,KAAKmD,WAAY,EACjBnD,KAAKyD,UAAW,IAOxB5B,EAAMjH,UAAUgJ,MAAQ,WACpB5D,KAAKmD,WAAY,EACjBnD,KAAKyD,UAAW,EAChBzD,KAAK2C,QAAQE,MAAQ7C,KAAK2D,OAAON,WACjC,IAAK,MAAMQ,KAAQ7D,KAAK2C,QAAQvB,MAC5ByC,EAAKjD,QAAQkD,SAEjB9D,KAAK2C,QAAQvB,MAAQH,EAASjB,KAAK0D,YAAa1D,KAAK2D,SAGzDjK,OAAOC,eAAekI,EAAMjH,UAAW,gBAAiB,CACpDf,IAAK,WACD,OAAOmG,KAAKkC,SAASpE,eAEzBP,IAAK,SAAUuE,GACX9B,KAAKkC,SAASpE,cAAgBgE,KAItC/I,EAAOD,QAAU+I,G,6BCvLjB,SAASzB,EAAcU,EAAYuC,EAAYjC,GAC3CpB,KAAKc,WAAaA,EAClBd,KAAK6C,MAAQQ,EACbrD,KAAKoB,MAAQA,EA+CjB,SAAS2C,EAAKF,EAAMG,EAAWtD,GAC3B,OAAQsD,GACJ,IAAK,IACDH,EAAKI,UAAUvD,GACf,MACJ,IAAK,IACDmD,EAAKK,SAASxD,GACd,MACJ,IAAK,IACD,MACJ,QACI,MAAM,IAAItD,UAAU,8BAAgCzB,OAAOqI,KAvDvE5D,EAAcxF,UAAUuJ,SAAW,WAC/B,OAAOxI,OAAOqE,KAAK6C,OAAS,KAAO7C,KAAKoB,MAAMgD,IAAIzI,QAAQ0I,KAAK,OAQnEjE,EAAcxF,UAAUwI,KAAO,SAAU1C,GACrC,IAAI4D,EAAWtE,KAAKuE,gBACpB,GAAgB,MAAZD,EACA,OAAO,EAGX,IAAK,IAAItL,EAAI,EAAGA,EAAIgH,KAAKoB,MAAMhF,OAAQpD,IACnCgH,KAAKoB,MAAMpI,GAAGwL,MAAMF,EAASxB,OAAO9J,GAAI0H,GACxCqD,EAAK/D,KAAKoB,MAAMpI,GAAIsL,EAASP,KAAK/K,GAAI0H,GAE1C,IAAK,IAAI1H,EAAI,EAAGA,EAAIgH,KAAKoB,MAAMhF,OAAQpD,IACnCgH,KAAKoB,MAAMpI,GAAGyL,UAAUH,EAASzB,MAAO7C,KAAK6C,QAAUyB,EAASzB,OAIpE,OAFA7C,KAAK6C,MAAQyB,EAASzB,OAEf,GAGXnJ,OAAOgL,iBAAiBtE,EAAcxF,UAAW,CAC7C2J,gBAAiB,CACb1K,IAAK,WACD,OAAOmG,KAAKc,WAAWd,KAAK6C,MACxB7C,KAAKoB,MAAMuD,OAAO,CAACC,EAAKf,IAASe,EAAMf,EAAKgB,OAAQ,MAE5DjL,YAAY,GAEhB6J,SAAU,CACN5J,IAAK,WACD,OAA+B,MAAxBmG,KAAKuE,iBAEhB3K,YAAY,KAoBpBd,EAAQsH,cAAgBA,G,6BC3ExB,MAAM0E,EAAO,EAAQ,IACf9J,EAAK,EAAQ,GACnB,EAAQ,IAKR,SAAS+J,EAAcC,GAcnB,OAbAA,EAAUvD,KAAK,QAAS,aACxBuD,EAAUxD,OAAO,QAEZyD,MAAM,MACNxD,KAAK,CACF,MATM,GAUN,OATO,KAWfuD,EAAUxD,OAAO,QACZ0D,MAAK,SAAU5L,GACZ,OAAOA,KAEVmI,KAAK,CAAC,EAAK0D,GAAe,EAAKC,KAC7BJ,EAGX,SAASK,EAAcL,EAAWM,GAK9B,OAJAA,EAAoB,MAAVA,EAAkB,EAAIA,EAChCN,EAAUvD,KAAK,aAAa,SAAUnI,EAAGN,GACrC,MAAO,cAvBG,IAuB4CA,EAAIsM,GAAnC,IAA8C,OAElEN,EAGX,SAASO,EAAkBC,GACvBA,EAAQ/D,KAAK,YAAa,mBACrBX,aACAJ,SAAS,GACTC,OAAO,YACPmD,SAIT,SAASzD,EAAQoF,EAAKC,EAAYhE,EAAOtD,EAAOwD,GAC5CkD,EAAK3L,KAAK6G,KAAM0B,EAAOtD,GAEvB4B,KAAK4B,IAAMA,EAEXlI,OAAOC,eAAeqG,KAAM,aAAc,CACtC/F,MAAOyL,EACPpI,UAAU,EACV1D,YAAY,IAEhBF,OAAOC,eAAeqG,KAAM,UAAW,CACnC/F,MAAOwL,EACPnI,UAAU,EACV1D,YAAY,IAIhB,IAAI+L,EAtDU,IAsDWD,EAAa,EAAIA,EAAa,GAAK,GACxDE,EAASR,GACbK,EAAIhE,KAAK,CACL,MAAS,MACT,QAAW,CAAC,EAAG,EAAGkE,EAAOC,GAAQvB,KAAK,OAG1CrE,KAAKwF,QAAUC,EAAIjE,OAAO,KACrBC,KAAK,QAAS,WACdtI,KAAKoM,GAEVE,EAAIjE,OAAO,QACNC,KAAK,CACF,GAAM,YACN,MAAS,GACT,OAAU,GACV,EAtEM,GAsEiCiE,EAAlC,GACL,EAAK,IAGb1F,KAAKwF,QAAQK,UAAU,cAClBC,KAAK9F,KAAK+F,WAAWL,EAAYA,IACjCM,QACAxE,OAAO,KACPrI,KAAK4L,GACL5L,KAAKkM,GA8Ed,SAASY,EAAST,EAASQ,EAAOE,EAAMC,EAASC,EAAS1F,EAAS,KAE/DsF,EAAM7M,KAAK4L,GAEXmB,EAAKrF,QAAQ,WAAW,GAExB2E,EAAQK,UAAU,cACb1M,KAAKkM,EAAee,GACzBZ,EACK/D,KAAK,YAAa,cAtKT,GAsKyB0E,GAAqBhC,WAAa,QAEpErD,aACAJ,SAASA,GACTvH,KAAKoM,GAvFdlF,EAAQzF,UAAYlB,OAAOY,OAAOwK,EAAKlK,WACvCyF,EAAQzF,UAAUsF,YAAcG,EAEhCA,EAAQzF,UAAU6J,UAAY,SAAU5B,EAAOwD,GAC3C,IAAIC,EAAOtG,KAAK4B,IAAIiB,GAChB0D,EAAMvG,KAAKwF,QAAQK,UAAU,gBAMjC,GAJAU,EAAI1F,QAAQ,gBAAgB,GAC5B0F,EAAI1F,QAAQ,SAAS,GAChBA,QAAQ,QAAQ,GAChBA,QAAQ,OAAO,IACfyF,EACD,OACJ,IAAIE,EAAMxG,KAAKwF,QAAQK,UAAU,8BAA8B,GAAG7F,KAAK0F,YACnEe,EAAmB,OAAbH,EAAKG,IAAe,qBAAuB,yBACjDC,EAAOJ,EAAKI,KAAOJ,EAAKI,KAAO,EACnC,GAAkB,QAAdJ,EAAKnM,KACL,KAAOqM,GAAK,CACR,IAAI1D,EAAS0D,EAAIG,cAAc,QAAQC,YACvC,IAAIN,EAAKO,MAAMC,SAAShE,GAGpB,MAFA0D,EAAIO,UAAUC,IAAIV,EAAKW,OAG3BT,EAAMA,EAAIC,QAEX,GAAkB,SAAdH,EAAKnM,KACZ,KAAOqM,GAAK,CACR,IAAI1D,EAAS0D,EAAIG,cAAc,QAAQC,YAEvC,GADAJ,EAAIO,UAAUC,IAAIV,EAAKW,OACnBX,EAAKO,MAAMC,SAAShE,GAAS,CAC7B,KAAI4D,EAAO,GAGP,MAFAA,GAAQ,EAIhBF,EAAMA,EAAIC,KAMtBpG,EAAQzF,UAAU4J,MAAQ,SAAU1B,EAAQpC,EAAS,KAE7CoE,EAAKlK,UAAUiK,KAAK1L,KAAK6G,QAAU8C,IAGvCgC,EAAKlK,UAAU4J,MAAMrL,KAAK6G,KAAM8C,GAGhC9C,KAAKwF,QAAQK,UAAU,YAAY/B,SAEnC9I,EAAG2F,OAAOX,KAAKwF,QAAQ,GAAG,GAAG0B,WAAWlH,KAAK0F,aACxCT,MAAMnC,GACNnC,OAAO,QACPc,KAAK,eAAgB,KACrBA,KAAK,iBAAkB,KACvBX,aACAJ,SAASA,EAAW,GACpBe,KAAK,eAAgB,OACrBA,KAAK,iBAAkB,OACvBX,aACAJ,SAASA,EAAW,GACpBwE,MAAK,SAAU5L,GACZ,OAAOA,KAEVmI,KAAK,eAAgB,KACrBA,KAAK,iBAAkB,KACvBX,aACAJ,SAAS,GACTe,KAAK,eAAgB,MACrBA,KAAK,iBAAkB,QAoBhCpB,EAAQzF,UAAUqJ,UAAY,SAAUvD,EAAS,KAC7CoE,EAAKlK,UAAUqJ,UAAU9K,KAAK6G,MAI9BA,KAAKwF,QAAQK,UAAU,YAAY/B,SACnCmC,EAASjG,KAAKwF,QAEVxF,KAAKwF,QAAQhE,OAAO,KACfyD,MAAMjF,KAAKmH,WAAWnH,KAAK0F,aAEhC1F,KAAKwF,QAAQ7E,OAAO,cACpB,GAAI,EACJD,IAIRL,EAAQzF,UAAUsJ,SAAW,SAAUxD,EAAS,KAC5CoE,EAAKlK,UAAUsJ,SAAS/K,KAAK6G,MAC7BA,KAAKwF,QAAQK,UAAU,YAAY/B,SACnCmC,EAASjG,KAAKwF,QACVxF,KAAKwF,QAAQ4B,OAAO,IAAK,gBACpBnC,MAAMjF,KAAKmH,YAAYnH,KAAK0F,aACjC1F,KAAKwF,QAAQ7E,OAAO,uCACnB,EAAG,EACJD,IAIR3H,EAAOD,QAAUuH,G,6BC9MjB,IAAIpF,EAAI,EAAQ,GAGhB,SAAS6J,EAAKpD,EAAOtD,GACjB1E,OAAOC,eAAeqG,KAAM,QAAS,CACjC/F,MAAOyH,EACPpE,UAAU,EACV1D,YAAY,IAMhBoG,KAAK6D,KAAO,CACRwD,OAAQ,GACRC,MAAiB,MAATlJ,GAAiC,GAAhBA,EAAMhC,OAAe,CAACsF,GAAStD,EAAMmJ,QAAQC,UACtErD,SAAU,WACN,OAAOnE,KAAKqH,OAAOhD,KAAK,IAAM,KAAOrE,KAAKsH,MAAMC,QAAQC,UAAUnD,KAAK,MAMnFS,EAAKlK,UAAUiK,KAAO,WAClB,OAAO5J,EAAEwM,KAAKzH,KAAK6D,KAAKyD,QAE5BxC,EAAKlK,UAAU4J,MAAQ,SAAU1B,GAC7B9C,KAAK6D,KAAKyD,MAAMtH,KAAK6D,KAAKyD,MAAMlL,OAAS,GAAK0G,GAGlDgC,EAAKlK,UAAUqJ,UAAY,WACvB,IAAIoD,EAASrH,KAAK6D,KAAKwD,OACnBC,EAAQtH,KAAK6D,KAAKyD,MACtBD,EAAO/F,KAAKgG,EAAMI,OACdzM,EAAE0M,QAAQL,IACVA,EAAMhG,KAAKtB,KAAK0B,QAGxBoD,EAAKlK,UAAUsJ,SAAW,WACtB,IAAImD,EAASrH,KAAK6D,KAAKwD,OACnBC,EAAQtH,KAAK6D,KAAKyD,MAClBrM,EAAE0M,QAAQN,IACVA,EAAO/F,KAAKtB,KAAK0B,OAErB4F,EAAMhG,KAAK+F,EAAOK,QAGtB5C,EAAKlK,UAAUuJ,SAAW,WACtB,OAAOnE,KAAK6D,KAAKM,YAMrBW,EAAKlK,UAAUuM,WAAa,SAAUnO,GAClC,IAAI6K,EAAO7D,KAAK6D,KAChB,OAAI7K,GAAK,EAEGA,GAAK6K,EAAKyD,MAAMlL,OAAS,EAAKyH,EAAKyD,MAAMzD,EAAKyD,MAAMlL,OAAS,EAAIpD,GAAKgH,KAAK0B,MAG3E1I,IAAM6K,EAAKwD,OAAOjL,OAAUyH,EAAKwD,OAAOxD,EAAKwD,OAAOjL,OAASpD,GAAKgH,KAAK0B,OAMvFoD,EAAKlK,UAAUmL,UAAY,SAAU6B,EAAOC,GACxC,OAAO5M,EAAE6M,MAAMF,EAAOC,EAAM,GAAGzD,KAAI,SAAUpL,GACzC,OAAOgH,KAAKmH,WAAWnO,KACxBgH,OAGPjH,EAAOD,QAAUgM,G,gBC1EjB/L,EAAOD,QAAU,IAA0B,iB,6BCE3C,IAAImC,EAAI,EAAQ,GAgChB,SAAS8M,EAAY/F,EAAOgG,GAGxB,IAAIjG,EAAQ9G,EAAE4D,UAAUmD,GAAO,SAAUiG,EAAapF,GAClD,MAAO,CACHqF,MAAOrF,EACPoF,YAAaA,EACbhB,MAAOe,EAAYnF,OAIvBsF,EAAW,GAkDf,OAjDAlN,EAAEyB,QAAQqF,GAAO,SAAUqG,EAAQvF,GAE/BuF,EAAOH,YAAcG,EAAOH,aAAgB,WACxC,IAAII,EAAmB,GAGnBC,EAAQ,GAsCZ,OAvBArN,EAAEyB,QAAQ0L,EAAOH,aAAa,SAAU3D,EAAUiE,GAG9C,IAAIC,EAAUD,EAAU5G,MAAM,KAAKgD,QAAO,SAAUC,EAAK3I,GAMrD,MALU,KAANA,GAAoC,KAAxB2I,EAAIA,EAAIxI,OAAS,GAC7BwI,EAAIA,EAAIxI,OAAS,GAAK,IAEtBwI,EAAItD,KAAKrF,GAEN2I,IACR,IAECnE,EAzBR,SAAgBgI,EAAQP,GACpB,IAAIzH,EAAO6H,EAAMG,IACbxN,EAAEyN,IAAIJ,EAAMG,GAAU,CAClBE,OAAQP,EACRK,OAAQ1G,EAAM0G,GACdG,OAAQ,IACTT,EAAS7G,KAAK9G,KAAK2N,IAG1B,OAFInG,EAAMZ,MAAQ,GACdX,EAAKmI,OAAOtH,KAAK4G,GACdzH,EAgBIoI,CADoB,MAAlBvE,EAASzB,MAAgByB,EAASzB,MAAQA,EAiCvE,SAAkB2F,EAASM,GACvB,IAAIC,GAA+B,MAAjBD,EAAOhG,OAAkB,GAAMkG,EAAarN,OAAOmN,EAAOhG,SAAW,KACjFnH,OAAOmN,EAAO/E,MACpB,OAAOyE,EAAQpE,IAAI4E,GAAc3E,KAAK,KAAO,IAAM0E,EAnCbE,CAAST,EAASlE,IAE5CkE,EAAQ9L,SAAQ,SAAUoG,GACtBuF,EAAiBvF,GAAU,CAEvBG,YAAaiG,EAAUrG,EAAOC,EAAQwB,GACtC7D,KAAMA,SAKX4H,EA1CgC,MA+CxC,CAACtG,MAAOA,EAAOoH,MAAOhB,GAKjC,SAASe,EAAUrG,EAAOC,EAAQG,GAE9B,GADAH,EAASA,EAAOnB,MAAM,IAClBsB,EAAYH,OACZ,IAAK,IAAI9J,EAAI,EAAGA,EAAI8J,EAAO1G,OAAQpD,IAC3BiK,EAAYH,OAAO9J,KACnB8J,EAAO9J,GAAKiK,EAAYH,OAAO9J,IAG3C,OAAOiC,EAAEwE,SAAS,CAACqD,OAAQA,EAAOuB,KAAK,KAAMpB,EAAa,CAACJ,MAAOA,IAUtE,SAASmG,EAAa3P,GAClB,MAAc,MAANA,EAAa,IAAMA,EAW/B,SAASiH,EAAW0B,EAAOgG,GACvB,IAAIoB,EAAUrB,EAAY/F,EAAOgG,GACjCtO,OAAOgL,iBAAiB1E,KAAM,CAC1BqJ,QAAS,CAACpP,MAAOmP,EAAQrH,OACzBuH,QAAS,CAACrP,MAAOmP,EAAQD,SAejC7I,EAAW1F,UAAUuH,aAAe,WAChC,OAAOnC,KAAKqJ,SAMhB/I,EAAW1F,UAAUwH,SAAW,WAC5B,OAAOpC,KAAKsJ,SAMhBhJ,EAAW1F,UAAU4I,UAAY,SAAUX,GACvC,OAAO7C,KAAKqJ,QAAQxG,IAGxBvC,EAAW1F,UAAUoI,sBAAwB,SAAUH,EAAOC,GAC1D,IAAIsF,EAASpI,KAAKqJ,QAAQxG,GAC1B,QAAe1F,IAAXiL,EACA,MAAM,IAAI1M,MAAM,sBAAwBC,OAAOkH,IAGnD,OAAOuF,EAAOH,aAAeG,EAAOH,YAAYnF,IAIpD/J,EAAOD,QAAUwH,G,6BC/KjB,IAAInF,EAAoB,EAAQ,GAAWA,kBACvCH,EAAK,EAAQ,GACbC,EAAI,EAAQ,GACZsO,EAAS,EAAQ,GAAUA,OAM/B,SAASC,EAAKC,EAAQC,GAClB,OAAOD,EAAOrF,KAAI,SAAUnI,EAAGjD,GAC3B,OAAOiD,EAAIyN,EAAO1Q,MAU1B,SAAS2Q,EAAUF,EAAQC,GACvB,OAAOF,EAAKC,EAAgBC,EANftF,KAAI,SAAUnI,GACvB,OAAQA,MA6BhB,SAAS2N,EAAMrN,GACX,OAAOsN,KAAKC,KAdhB,SAAiBvN,GASb,OAAOA,EAAM6H,KARb,SAAYnI,GACR,OAAOA,EAAIA,KAOM0I,QAJrB,SAAa1I,EAAG+C,GACZ,OAAO/C,EAAI+C,IAGkB,GAKhB+K,CAAQxN,IAiB7B,SAASyN,EAAsB5N,EAAQ6N,GACnC,MAAO,CAACJ,KAAKK,IAAID,GAAS7N,EAAQyN,KAAKM,IAAIF,GAAS7N,GAWxD,SAASgO,EAAYjB,GACjBA,EAAMzM,SAAQ,SAAU2N,GACpB,IAAI9P,EAAM8P,EAAE1B,OAAO2B,MAAQ,IAAMD,EAAE5B,OAAO6B,MAC1CtK,KAAKzF,IAAQyF,KAAKzF,IAAQ,GAAK,IAChCyF,MAGPoK,EAAYxP,UAAU2P,eAAiB,SAAUC,EAAK/B,GAClD,OAAOzI,KAAKrE,OAAO6O,GAAO,IAAM7O,OAAO8M,KAAY,GAGvD,IAAIgC,EAAY/Q,OAAOgR,OAAO,CAC1BC,KAAM,GACNC,IAAK,GACLC,SAAU,KAed,SAASC,EAAYC,EAAYC,EAAO1R,GAEpC,IAAI2R,EAAeC,EACnB,OAAIF,IAAUP,EAAUE,MAEpBM,EAAgBjB,EAAsBe,GAAa,GAAKlB,KAAKsB,GAAK,KAClED,EAAU,mBAAqBD,EAAc,GAAK,KAAOA,EAAc,GAAKF,GACrE,WAGH,MAAO,KAFEzR,EAAEqP,OAAO1M,EAEC,KADV3C,EAAEqP,OAAO3J,EACa+L,GAAcG,IAIjDF,IAAUP,EAAUG,IAEb,WAEH,IAhEIrO,EACRN,EAAc+C,EA+DNoM,EAAK,CAAC9R,EAAEqP,OAAO1M,EAAG3C,EAAEqP,OAAO3J,GAC3BqM,EAAK,CAAC/R,EAAEmP,OAAOxM,EAAG3C,EAAEmP,OAAOzJ,GAC3BsG,EAASqE,EAAU0B,EAAID,GACvBE,EAAS,IAAQ1B,EAAMtE,GAIvB2E,GAtERhO,GADQM,EAuEe+I,GAtEb,GAAItG,EAAIzC,EAAM,GACrBsN,KAAK0B,MAAMvM,EAAG/C,IAsETuP,GAAO3B,KAAKsB,GAAK,EAAI,EACrBxC,EAASa,EAAK4B,EAAIpB,EAAsBe,EAAYd,EAAQuB,IAC5D/C,EAASe,EAAK6B,EAAIrB,EAAsBe,EAAYd,EAAQJ,KAAKsB,GAAKK,IAE1E,OAAQJ,EAAG,IAAMC,EAAG,GACd,KAAO1C,EAAO,GAAK,IAAMA,EAAO,GAAK,MAAQ2C,EAAS,IAAMA,EAAS,UAAY7C,EAAO,GAAK,IAAMA,EAAO,GAC1G,KAAOA,EAAO,GAAK,IAAMA,EAAO,GAAK,MAAQ6C,EAAS,IAAMA,EAAS,UAAY3C,EAAO,GAAK,IAAMA,EAAO,IAE7GqC,IAAUP,EAAUI,SACpB,WAEH,IAAIO,EAAK,CAAC9R,EAAEqP,OAAO1M,EAAG3C,EAAEqP,OAAO3J,GAC3BqM,EAAK,CAAC/R,EAAEmP,OAAOxM,EAAG3C,EAAEmP,OAAOzJ,GAC3BsG,EAASqE,EAAU0B,EAAID,GAE3B,GAAkB,IAAd9F,EAAO,IAA0B,IAAdA,EAAO,GAC1B,OAAO,KAGX,IAnGG/I,EACP9B,EAkGQgO,EAASkB,EAAU0B,EA5HnC,SAAmB9O,EAAOkP,GACtB,OAAOlP,EAAM6H,KAAI,SAAUnI,GACvB,OAAOwP,EAASxP,KA0HeyP,EAlG/BjR,EAAImP,EADGrN,EAmGwC+I,GAjG5C/I,EAAM6H,KAAI,SAAUnI,GACvB,OAAOA,EAAIxB,MAgG6CsQ,IACpD,MAAO,KAAOK,EAAG,GAAK,IAAMA,EAAG,GAAK,MAAQ3C,EAAO,GAAK,IAAMA,EAAO,SAZtE,EAwBX,SAASkD,EAAS1P,GACd,OAAOA,EAGX,SAAS2P,KAGT,SAASC,EAAWC,EAAKC,EAAK9R,GAC1B,OAAO4P,KAAKkC,IAAID,EAAKjC,KAAKiC,IAAI7R,EAAO8R,IA9EzC3B,EAAYxP,UAAUoR,aAAe,SAAU3B,GAC3C,OAAIA,EAAE5B,OAAO6B,QAAUD,EAAE1B,OAAO2B,MACrBG,EAAUE,KACV3K,KAAKuK,eAAeF,EAAE5B,OAAO6B,MAAOD,EAAE1B,OAAO2B,OAE7CG,EAAUG,IAEVH,EAAUI,UA4EzB,IAAIoB,EAAe9Q,EAIb,SAAU+F,EAAKgL,GACb,OAAOhL,EACFM,OAAO,OACPT,MAAM,CACH4E,MAAO,OACPC,OAAQ,IACR,iBAAmB,IAAMsG,EAAW,IACpCC,SAAU,aAEb3K,OAAO,OACPT,MAAM,CACHoL,SAAU,WACVC,IAAK,IACLC,KAAM,OAhBhB,SAAUnL,GACR,OAAOA,EAAIM,OAAO,QAsC1B,SAASjB,EAAS+L,EAAWC,EAAOC,GAUhC,IAAIC,EAAI,IACJC,EAAI,IAIJzK,EAASjH,EAAG2R,MAAMC,aAElBnH,EAAMwG,EAAYK,EAAWI,EAAID,GACrChH,EAAIhE,KAAK,CACL,QAAW,CAAC,EAAG,EAAGgL,EAAGC,GAAGrI,KAAK,KAC7B,QAAW,MACX,SAAU,6BACV,eAAgB,iCAsCpB,IAAIwI,EAAYN,aAAiBO,MAAQP,EAAQtR,EAAE8R,OAAOR,GAC1DvM,KAAKgN,WAAaT,EAElB,IAAIU,EAAQjS,EAAGkS,OAAOD,QACjBV,MAAMM,GACNM,MAAMX,GACNY,KAAK,CAACX,EAAGC,IACTW,aAAa,CAvDC,KAwDdC,OAAO,EAAE,MACTC,MAAM,IACNC,QAAQ,IACR5F,QAED6F,EAAOR,EAAMQ,OACZC,GAAG,aA9CR,SAAmBpU,GACfA,EAAEyF,OAAQ,EACV0G,EAAI3E,aACCC,MAAM,aAAc,yBA4CxB2M,GAAG,QAzCR,SAAuBpU,GAEnB,IAAIqU,EAAM9D,KAAK+D,MAAMtU,EAAEqG,GADZ,QAEXrG,EAAEqG,GAFS,OAEJgO,EACHA,EAAM,GAAM,GACZrU,EAAEoG,IAAM,GACRpG,EAAEoG,GAA6B,GAAxBmK,KAAK+D,MAAMtU,EAAEoG,GAAK,IACzBpG,EAAEoG,IAAM,IAERpG,EAAEoG,GAA6B,GAAxBmK,KAAK+D,MAAMtU,EAAEoG,GAAK,IAE7BpG,EAAE2C,EAAI3C,EAAEoG,GACRpG,EAAE0F,EAAI1F,EAAEqG,MA8BP+N,GAAG,WA3BR,WACIjI,EAAI3E,aACCC,MAAM,aAAc,SA4BzB8M,EAAc,IAAIzD,EAAYoC,GAM9BsB,EAJgBrI,EAAII,UAAU,aAC7BC,KAAK0G,GACLxG,QAE0BxE,OAAO,KAElCuM,EAAa,SAAUzU,EAAGN,GAC1B,OAAO2C,QAAQ,KAAO3C,EAAI,IAAM,MAEhCgV,EAAa,SAAU1U,EAAGN,GAC1B,OAAO2C,OAAO,GAAM,KAAO3C,EAAI,IAAM,MAGzC8U,EAAW9M,MAAK,SAAUiN,EAAOC,GAC7B,IAAIC,EAAQnT,EAAG2F,OAAOX,MAClBoO,EAAWD,EACV3M,OAAO,QACPC,KAAK,CACF,MAAS,WACT,GAAM,WAAayM,IAEtBlN,MAAK,SAAU1H,GACZA,EAAEsH,QAAUZ,QAGhB4I,EAASuF,EAAMtI,UAAU,cACxBC,KAAKmI,EAAMrF,QAAQ5C,QACnBxE,OAAO,QACPC,KAAK,QAAS,aACnBmH,EAAOpH,OAAO,YACTC,KAAK,cAAc,WAChB,MAAO,YAAcyM,KAExBzM,KAAK,cAAe,OACpByD,KAAKyG,GAWV,IAAIX,EAAQ6C,EAAY7B,aAAaiC,GAErC,OADAA,EAAMI,QAAUvD,EAlHH,GAkH2BE,EAAOiD,GACvCjD,GACJ,KAAKP,EAAUI,SACXjC,EAAOnH,KAAK,KAAMsM,GAClBE,EAAMK,cAAgB,WAElB1F,EAAOnH,KAAK,aAAa,WACrB,GAAIwM,EAAMxF,OAAOxM,EAAIgS,EAAMtF,OAAO1M,EAAG,CACjC,IAAI5C,EAlMrB,CACH4C,GAFYsS,EAmM2BvO,KAAKwO,WAjMjCvS,EAAIsS,EAAQ5I,MAAQ,EAC/B3G,EAAGuP,EAAQvP,EAAIuP,EAAQ3I,OAAS,GAiMZ,MAAO,cAAgBvM,EAAE4C,EAAI,IAAM5C,EAAE2F,EAAI,IAEzC,OAAO,KAtMnC,IAAoBuP,MA0MJ,MACJ,KAAK9D,EAAUG,IACX,IAAI6D,EACJR,EAAMK,cAAgB,WAClB,IAAII,EAAaT,EAAMxF,OAAOxM,EAAIgS,EAAMtF,OAAO1M,EAC3CyS,IAAeD,IACfL,EAASvN,QAAQ,eAAgB6N,GACjC9F,EAAOnH,KAAK,KAAMiN,EAAaV,EAAaD,GAC5CU,EAAYC,IAGpB,MACJ,KAAKjE,EAAUE,KACX/B,EAAOnH,KAAK,aAAa,SAAUnI,EAAGN,GAClC,MAAO,aAAe2C,OAAO,GAAK3C,EAAI,IAAM,IAAM2C,QAAQ,GAAK3C,EAAI,IAAM,OAE7EiV,EAAMK,cAAgB1C,MAIlC,IAAI+C,EAAYb,EAAWjI,UAAU,aAIjC+I,EAAgBnJ,EAAII,UAAU,SAC7BC,KAAK+G,GACL7G,QAED6I,EAAcD,EACbpN,OAAO,UACPC,KAAK,QAAS,QACdA,KAAK,IAhKO,IAiKZV,MAAM,QAAQ,SAAUzH,EAAGN,GACxB,YAAgBmE,IAAZ7D,EAAE2N,MACK,IAAM3N,EAAE2N,MACZhF,EAAOjJ,MAEjBgI,MAAK,SAAU1H,GACZA,EAAEsH,QAAUZ,QAEf0N,GAAG,YAhIR,SAAqBpU,GACjBA,EAAEyF,OAAQ,EACVkO,EAAM6B,YA+HL3V,KAAKsU,GAENsB,EAAaH,EACZpN,OAAO,QACPC,KAAK,QAAS,aACdA,KAAK,KAAM,UACXyD,MAAK,SAAU5L,GACZ,OAAOA,EAAE4O,SAIHzC,EAAIjE,OAAO,QACjBqE,UAAU,UACbC,KAAK,CAAC,YAAa,mBAAoB,qBAAsB,8BAC7DE,QAAQxE,OAAO,UACfC,KAAK,CACF,GAAM,SAAUnI,GACZ,OAAOA,GAEX,QAAW,aACX,KAAQ,SAAUA,GACd,OAA0C,IAAlCA,EAAE0V,YAAY,YAAa,GAAY,EAAI,IAEvD,OAAU,OACV,YAAe,GACf,aAAgB,KAEnBxN,OAAO,QACPC,KAAK,IAAK,yBACVA,KAAK,aAAa,SAAUnI,GACzB,OAA0C,IAAlCA,EAAE0V,YAAY,YAAa,GAAY,kBAAoB,QAG3E,IAAIC,EACA,uSAcJxJ,EAAIjE,OAAO,SAASR,MAAK,WACjBhB,KAAKkP,WACLlP,KAAKkP,WAAWC,QAAUF,EAE1BjP,KAAK4G,YAAcqI,KAK3BhC,EAAMS,GAAG,QAAQ,WAGbmB,EAAYpN,KAAK,CACb2N,GAAI,SAAU9V,GACV,OAAOA,EAAE2C,EAAI4P,EAxOR,GAwO+BY,EAxO/B,GAwO+CnT,EAAE2C,IAE1DoT,GAAI,SAAU/V,GACV,OAAOA,EAAE0F,EAAI6M,EA3OR,GA2O+Ba,EA3O/B,GA2O+CpT,EAAE0F,MAI9D+P,EAAWtN,KAAK,KAAK,SAAUnI,GAC3B,OAAOA,EAAE2C,KAERwF,KAAK,KAAK,SAAUnI,GACjB,OAAOA,EAAE0F,KAGjB2P,EAAUlN,KAAK,KAAK,SAAUnI,GAC1B,OAAOA,EAAE+U,aAGbP,EAAW9M,MAAK,SAAU1H,GACtBA,EAAEgV,mBAIFzB,EAAUyC,OAAM,SAAUhW,GAC1B,OAAOA,EAAEyF,UAETkO,EAAMsC,UAGdvP,KAAKiN,MAAQA,EApSjB,EAAQ,IA2SR,IAAIuC,EAAmBvU,EAAE4D,UAAU5D,EAAEwU,KAAK,CAAC,IAAK,IAAK,KAAM,KAAM,WAajE/V,OAAOC,eAAe4G,EAAS3F,UAAW,gBAAiB,CACvDf,IAAK,WACD,OAAO2V,EAAiBxP,KAAKgN,aAEjCzP,IAAK,SAAUuE,IAbnB,SAA0BA,EAAU4N,GAChCzU,EAAEyB,SAAQ,SAAUiT,EAAM9M,GACtB,IAAIsJ,EAAWrK,EAASe,QACP1F,IAAbgP,GACA5C,EAAOoG,EAAMxD,KAElBuD,GAQCE,CAAiB9N,EAAU9B,KAAKgN,YAEhChN,KAAKiN,MAAM6B,YAKnB/V,EAAOD,QAAUyH,G,gBC5gBjBxH,EAAOD,QAAU,IAA0B,8B,6BCE3C,IAAIyG,EAAgB,EAAQ,GAAoBA,cAC5CsQ,EAAY,EAAQ,GAAaA,UAGrC,SAASC,EAAevW,GACpB,OAAO,MAAQ,KAA2BA,EAAO,SAGrD,IAAIwW,EAAe,CACf,YACA,YACA,WACA,kBACA,eACA,SACA,qBACA,oBACA,qBACA,aACA,cACA,cACA,cACA,aACA,YACA,YACA,cACF3L,KAAI,SAAU4L,GAEZ,IAAIC,EAAM1Q,EAAcuQ,EAAeE,IAGvC,OAFAC,EAAID,GAAKA,EAEF,CAACA,EAAIC,MAEZC,EAAWxW,OAAOgR,OAAOmF,EAAUE,IAGvC,SAASI,EAAYC,GACjB,MAAO,GAAGvV,eAAe1B,KAAK+W,EAAUE,GAO5C,IAAIC,EAAON,EAAa3L,KAAI,SAAUkM,GAClC,OAAOA,EAAK,MAIhBxX,EAAQyX,MAAQJ,EAChBrX,EAAQe,IAVR,SAAauW,GACT,OAAOD,EAAYC,GAASF,EAASE,GAAS,MAUlDtX,EAAQuX,KAAOA,EACfvX,EAAQ0X,eAAiB,YACzB1X,EAAQ2X,cAAgBX,EAAe,c,6BCrDvC,IAqBMlQ,EAYA7E,EAGA2V,EApCFvV,EAAoB,EAAQ,GAAUA,kBAOtCwV,EAAqB,WAEvB,IAAIC,EAAM,YACV,IAGE,OAFAC,aAAaC,QAAQF,EAAKA,GAC1BC,aAAaE,WAAWH,IACjB,EACP,MAAOvG,GACP,OAAO,GARc,GAarB2G,GACEpR,EAAM,GACHlG,OAAOgR,OAAO,CACnB,aAAe,OAAOhR,OAAO4E,KAAKsB,GAAKxD,QACvC7B,IAAK,SAAUE,GAAK,OAAQA,KAAKf,OAAO4E,KAAKsB,GAAQlG,OAAO4E,KAAKsB,GAAKnF,GAAK,MAC3EwW,QAAS,SAAU1W,GAAO,MAAO,GAAGM,eAAe1B,KAAKyG,EAAKrF,GAAOqF,EAAIrF,GAAO,MAC/EuW,QAAS,SAAUvW,EAAK8B,GAAOuD,EAAIrF,GAAOoB,OAAOU,IACjD0U,WAAY,SAAUxW,UAAcqF,EAAIrF,IACxC2W,MAAO,WAActR,EAAM,OAI3BuR,GACEpW,EAAI4V,EAAqBE,aAAeG,EAGxCN,EAAgBvV,EAChB,WAAc,OAAOI,OAAOF,SAAS+V,YACrC,WAAc,OAAO,GAElB,CACLvM,KAAQ9J,EAAEkW,QAAQzW,KAAKO,GACvByJ,MAAQzJ,EAAE+V,QAAQtW,KAAKO,GACvB+I,OAAQ/I,EAAEgW,WAAWvW,KAAKO,GAE1BsW,mBAAoBV,EAChB,SAAUW,GACV/V,OAAOgW,iBAAiB,WAAW,SAAUlH,GACvCqG,KAGArG,EAAEmH,cAAgBX,cACpBS,EAASjH,OAIb,aACJoH,sBAAuBd,EACnBpV,OAAOmW,oBAAoBlX,KAAKe,OAAQ,WACxC,eAKRzC,EAAQ6X,mBAAqBA,EAC7B7X,EAAQqY,gBAAkBA,G,cCnE1BpY,EAAOD,QAAU6Y,S,6BCEjB,MAAMhU,EAAS,EAAQ,IACjB1C,EAAI,EAAQ,IACZ,YAAC2W,GAAe,EAAQ,KACxB,gBAACC,GAAmB,EAAQ,IAkNlC,SAASC,EAAgBhP,EAAQiB,EAAMlB,GACnC,OAAO5H,EAAE0D,OACL,CAACmE,OAAQA,EAAQiB,KAAMA,EAAMlB,MAAOA,IACpC,SAAU5G,GACN,OAAY,MAALA,KA4CnB,SAAS8V,EAAiBC,EAAUhQ,EAAO3F,EAAK+E,GAC5C,OAxCJ,SAAqBY,EAAOsC,GACxB,GAAsB,MAAlBA,EAASzB,SAAmByB,EAASzB,SAASb,GAC9C,MAAM,IAAI4P,EAAY,mBAAoB,CACtCK,aAAc3N,EAASzB,MACvBqP,WAAY,+FAGpB,OAAO5N,EAiCA6N,CAAYnQ,EAAO,WACtB,cAAe3F,GACX,IAAK,SACD,OA6BhB,SAAgC2V,EAAU3V,EAAK+E,GAC3C,GAAIA,EAAO,CACP,GAAI4Q,GAAYA,EAAS3V,GACrB,OAAO2V,EAAS3V,GAEpB,IAAIwG,EAAQxG,EAAI+V,MAAM,qBAClBrO,EAAO+I,MAAM1L,GAAOiR,KAAK,KACzB7N,EAAQsI,MAAM1L,GACL,MAATyB,IACAxG,EAAMA,EAAIkL,MAAM1E,EAAM,GAAGzG,QAAQkW,OACjCzP,EAAQA,EAAM,IAElB,IAAI0P,EAAe,GACnB,KAAe,KAARlW,GAAY,CACf,IAAIwH,EAAOxH,EAAI+V,MAAM,4BACrB,GAAa,OAATvO,EACA,MAAM,IAAI+N,EACN,sBACA,CACIK,aAAc5V,EACdiG,KAAM,sIAKlBjG,EAAMA,EAAIkL,MAAM1D,EAAK,GAAGzH,QAAQoW,WAChC,IAAIC,EAAcC,SAAS7O,EAAK,IAChC,GAAoB,IAAhB4O,EACA,MAAM,IAAIb,EAAY,4BAA6B,CAACK,aAAc5V,IAEtE,GAAIoW,EAAcrR,EACd,MAAM,IAAIwQ,EACN,iDACA,CACIK,aAAc5V,EACdiG,KAAM,yBAAyBlB,YAK3C,GADAqR,GAAe,EACXF,EAAazL,SAAS2L,GACtB,MAAM,IAAIb,EACN,8BAAgCa,EAChC,CAACR,aAAc5V,IAGvBkW,EAAajR,KAAKmR,GACF,KAAZ5O,EAAK,KACLE,EAAK0O,GAAe5O,EAAK,IACb,KAAZA,EAAK,KACLW,EAAMiO,GAA2B,MAAZ5O,EAAK,GAAa,IAAMA,EAAK,IAE1D,OAAOiO,EAAgBtN,EAAOT,EAAKM,KAAK,IAAKxB,GAE7C,GAAY,MAARxG,EACA,MAAO,CAAC0H,KAAM,KACX,GAAY,MAAR1H,EACP,MAAO,CAAC0H,KAAM,KAIlB,GAAIiO,GAAYA,EAAS3V,GACrB,OAAO2V,EAAS3V,GAEpB,MAAM,IAAIuV,EACN,sBACA,CACIK,aAAc5V,EACdiG,KAAM,oEAjGCqQ,CAAuBX,EAAU3V,EAAK+E,GACjD,IAAK,SACD,GAAIA,EACA,MAAM,IAAIwQ,EAAY,kDAE1B,OAoGhB,SAAgCvV,GAC5B,IAAIyG,EAAQiB,EAAMlB,EAClB,GAAW,MAAPxG,EACA,MAAM,IAAIuV,EAAY,uBAG1B,CACI,IAAIgB,EACJ,IAAKlZ,OAAO4E,KAAKjC,GAAKiT,OAAM,SAAU/U,GAElC,OADAqY,EAASrY,EACM,MAARA,GAAuB,MAARA,GAAuB,MAARA,GAAuB,UAARA,KAEpD,MAAM,IAAIqX,EACN,mBACA,CACIK,aAAcW,EACdtQ,KAAM,+HAOtB,GAAI,MAAOjG,GAAO,MAAOA,EACrB,MAAM,IAAIuV,EACN,6BACA,CAACtP,KAAM,8EAGf,GAAI,MAAOjG,EACP0H,EAAO,IACPlB,EAAQxG,EAAIwW,OACT,GAAI,MAAOxW,EACd0H,EAAO,IACPlB,EAAQxG,EAAIyW,MACT,MAAI,MAAOzW,GAId,MAAM,IAAIuV,EAAY,8BAHtB7N,EAAO,IACPlB,EAAQxG,EAAI0W,EAKhB,GAAI,UAAW1W,EAAK,CAChB,IAAI2W,EAAWrX,OAAOU,EAAImI,OAC1B,GAAwB,IAApBwO,EAAS5W,OAGT,MAAM,IAAIwV,EAAY,uCAFtB9O,EAAS,CAACkQ,GAKlB,OAAOlB,EAAgBhP,EAAQiB,EAAMlB,GAtJlBoQ,CAAuB5W,GAClC,QACI,MAAM,IAAIuV,EACN,2BACA,CACIK,oBAAqB5V,EACrBiG,KAAM,oLAdA,IAmO9B,SAAS4Q,EAAU7W,EAAK9C,EAAM4Z,EAAKtQ,EAAOzB,GACtC,IAAK+R,EAAIrM,SAASzK,GACd,MAAM,IAAIuV,EACHrY,EAAH,uBACA,CACI0Y,aAAc5V,EACdwG,QACAC,OAAQ1B,EACRkB,KAAM,wBAA0B8Q,KAAKC,UAAUF,KAM/Dra,EAAQ8Y,YAAcA,EACtB9Y,EAAQwa,UAjdR,SAASA,EAAUC,EAAKC,GAAa,GAEjC,IAAI5T,EAAMjC,EAAO6B,SAAS+T,GAG1B,GAAW,MAAP3T,EACA,MAAM,IAAIgS,EACN,wBACA,CACItP,KAAM,oIAKlB,IAAImR,EAAkB,CAClBvB,WAAY,8DAEhB,GAAiB,MAAbtS,EAAI8B,MACJ,MAAM,IAAIkQ,EAAY,gCAAiC6B,GAG3D,GADA7T,EAAI8B,MAAQ/F,OAAOiE,EAAI8B,OACE,IAArB9B,EAAI8B,MAAMtF,OACV,MAAM,IAAIwV,EAAY,gDAAiD6B,GAG3E,GAAID,QAA4BrW,IAAdyC,EAAIwB,MAAqB,CACvC,IAAKsS,OAAOC,UAAU/T,EAAIwB,OACtB,MAAM,IAAIwQ,EACN,yCACA,CAACK,oBAAqBrS,EAAIwB,QAGlC,GAAIxB,EAAIwB,MAAQ,EACZ,MAAM,IAAIwQ,EAAY,6CAEvB,CACH,QAAoBzU,IAAdyC,EAAIwB,OAAqC,IAAdxB,EAAIwB,MACjC,MAAM,IAAIwQ,EAAY,uCAE1BhS,EAAIwB,MAAQ,EAKhB,GAFAxB,EAAIyD,WAAazD,EAAI,sBACdA,EAAI,eACW,MAAlBA,EAAIyD,WACJ,MAAM,IAAIuO,EACN,+BACA,CAACM,WAAY,gDAIrBtS,EAAIyD,WAAa1H,OAAOiE,EAAIyD,YA2BhC,SAAwBhH,GACpB,GAAW,MAAPA,EACA,MAAM,IAAIuV,EACN,2BACA,CAACM,WAAY,0CAGrB,GAAmB,iBAAR7V,EACP,MAAM,IAAIuV,EACN,uCACA,CACIK,oBAAqB5V,EACrBiG,KAAM,2FArClBsR,CAAehU,EAAIoC,OACnB,IAAIgQ,EAiDR,SAAuB3V,EAAK2F,EAAOZ,GAC/B,GAAW,MAAP/E,EACA,OAAO,KAEX,GAAmB,iBAARA,EACP,MAAM,IAAIuV,EACN,qCACA,CACIK,oBAAqB5V,EACrBiG,KAAM,mHAKlB,OAAOrH,EAAE4D,UAAUxC,GAAK,SAAUwX,EAAWtZ,GACzC,IACI,OAAOwX,EAAiB,KAAM/P,EAAO6R,EAAWzS,GAClD,MAAOiJ,GAOL,MANIA,aAAauH,IACbvH,EAAEyJ,QAAQC,QAAUxZ,EACH,wBAAb8P,EAAE2J,SACF3J,EAAEyJ,QAAQxR,KAAO,gEAGnB+H,MAzEC4J,CAAcrU,EAAIoS,SAAUpS,EAAIoC,MAAOpC,EAAIwB,OAI1D,GAHAxB,EAAIoC,MAmFR,SAAoBgQ,EAAU3V,EAAK+E,GAC/B,OAAOnG,EAAE4D,UAAUxC,GAAK,SAAU6X,EAAUrR,GACxC,GAAgB,MAAZqR,EAEA,OAAO,KAEX,GAAwB,iBAAbA,EACP,MAAM,IAAItC,EACN,kCACA,CACIK,oBAAqBiC,EAAUrR,MAAOA,EACtCP,KAAM,2FAIlB,OAAOrH,EAAE4D,UAAUqV,GAAU,SAAUL,EAAW/Q,GAC9C,IACI,OAAOiP,EAAiBC,EAAU3V,EAAKwX,EAAWzS,GACpD,MAAOiJ,GAKL,MAJIA,aAAauH,IACbvH,EAAEyJ,QAAQjR,MAAQA,EAClBwH,EAAEyJ,QAAQhR,OAASA,GAEjBuH,SA1GN8J,CAAWnC,EAAUpS,EAAIoC,MAAOpC,EAAIwB,OAChDxB,EAAIgC,IA+UR,SAAkBA,EAAKI,EAAOoS,GACN,IAAhBA,IACAA,EAAc,GAClB,IAAIC,EAAM,CAAChS,OAAQ,GAAIC,KAAM,GAAIL,OAAQ,IACzC,IAAK,IAAIjJ,EAAI,EAAGA,EAAIob,EAAapb,IAC7Bqb,EAAIrb,GAAK,GACb,IAAK4I,EACD,OAAOyS,EAEX,IAAK,MAAOxR,EAAOyR,KAAU5a,OAAO6a,QAAQ3S,GAAM,CAC9C,KAAMiB,KAASb,GACX,MAAM,IAAI4P,EAAY,iDAAkD,CAACK,aAAcpP,IAE3F,IAAK,MAAOzB,EAAOkF,KAAS5M,OAAO6a,QAAQD,GACvC,GAAc,UAAVlT,EAIJ,GAAc,SAAVA,EAIJ,GAAc,UAAVA,EAKJ,IAAK,IAAIyC,KAAQzC,EAAMO,MAAM,KAAM,CAE/B,GADAkC,EAAO6O,SAAS7O,GAAQ,EACpB2Q,MAAM3Q,GACN,MAAM,IAAI+N,EAAY,4DACJ,CAACK,aAAc7Q,EAAOyB,UAE5C,GAAIgB,EAAO,EACP,MAAM,IAAI+N,EAAY,4BAA6B,CAACK,aAAc7Q,EAAOyB,UAE7E,GAAIgB,GAAQuQ,EACR,MAAM,IAAIxC,EACN,iDACA,CACIK,aAAc7Q,EACdkB,KAAM,yBAAyBlB,YAI3C,GAAIkF,EAAKI,OAA6B,iBAAbJ,EAAKI,OAAqBgN,OAAOC,UAAUrN,EAAKI,OACrE,MAAM,IAAIkL,EAAY,4BAA6B,CAACK,aAAc3L,EAAKI,KAAM7D,UAEjFqQ,EAAU5M,EAAKnM,KAAM,OAAQ,CAAC,MAAO,QAAS0I,EAAOzB,GACrD8R,EAAU5M,EAAKG,IAAK,MAAO,CAAC,KAAM,MAAO5D,EAAOzB,GAChD8R,EAAU5M,EAAKW,MAAO,QAAS,CAAC,QAAS,OAAQ,OAAQpE,EAAOzB,GAChEkF,EAAKO,MAAQlL,OAAO2K,EAAKO,OACzBwN,EAAIxQ,GAAMhB,GAASnJ,OAAO6P,OAAO,GAAIjD,QA7BrC+N,EAAIpS,OAAOY,GAASlH,OAAO2K,QAJ3B+N,EAAI/R,KAAKO,GAASyD,OAJlB+N,EAAIhS,OAAOQ,GAASyD,EAyChC,OAAO+N,EAvYGI,CAAS7U,EAAIgC,IAAKhC,EAAIoC,MAAOpC,EAAIwB,SAErCxB,EAAIyD,cAAczD,EAAIoC,OACxB,MAAM,IAAI4P,EAAY,8DAE1B,IAAI8C,EAAY,KACZC,EAAmB,KACvB,GAAI/U,EAAIgV,UAAW,CACf,IAAIA,EAAYjZ,OAAOiE,EAAIgV,WAC3B,QAAmCzX,IAA/B0U,EAAgB+C,GAChB,MAAM,IAAIhD,EACN,oBACA,CACIK,aAAc2C,EACdtS,KAAM,6BAA+B5I,OAAO4E,KAAKuT,GAAiBxN,KAAK,SAGlFzE,EAAK8U,EAAWC,GAAoB9C,EAAgB+C,GAAWhV,EAAK0T,GAEzE,MAAO,CAAC1T,EAAK8U,EAAWC,IAwY5B7b,EAAQqH,cAAgBxC,EAAOwC,e,cC5f/BpH,EAAOD,QAAU6E,Q,6BCejB,SAASiU,EAAYoC,EAAQF,EAAU,IACnC9T,KAAKzG,KAAO,cACZyG,KAAKC,OAAQ,IAAKvE,OAASuE,MAE3BD,KAAKgU,OAASA,EACdhU,KAAK8T,QAAUA,GAAW,GAG9BlC,EAAYhX,UAAYlB,OAAOY,OAAOoB,MAAMd,WAC5CgX,EAAYhX,UAAUsF,YAAc0R,EAGpClY,OAAOC,eAAeiY,EAAYhX,UAAW,UAAW,CACpDf,IAAK,WACD,IAAIgb,EAAS7U,KAAKgU,OACdF,EAAU9T,KAAK8T,QAEnB,SAASgB,EAAKvB,GACV,MAAO,SAAWA,EAAM,UAiB5B,IAAItB,EAAe6B,EAAQ7B,aAAe,IAAM6C,EAAKhB,EAAQ7B,cAAgB,GACzE8C,GAfalS,EAeMiR,EAAQjR,MAfPC,EAecgR,EAAQhR,OAfdiR,EAesBD,EAAQC,QAd7C,MAATlR,EACc,MAAVC,EACO,iCAAmCgS,EAAKjS,GAAS,eAAiBiS,EACrEhS,GAEG,cAAgBgS,EAAKjS,GAEd,MAAXkR,EACA,iCAAmCe,EAAKf,GAE5C,IAXX,IAAiBlR,EAAOC,EAAQiR,EAgBhC,IAAIiB,EAAY,CACZ,WAAaH,EAAS5C,EAAe,YAAc8C,EACjDjB,EAAQxR,KAAMwR,EAAQ5B,YAEvB+C,OAAOha,EAAE0Q,UACTvH,KAAI,SAAUrJ,GACX,OAAOA,EAAI,OAKnB,OAHIga,GACAC,EAAUE,OAAO,EAAG,EAAG,QAEpBF,EAAU3Q,KAAK,MAE1BzK,YAAY,IAGhBd,EAAQ8Y,YAAcA,G,cCpEtB7Y,EAAOD,QAAUqc,K,6BCEjB,IAAIhE,EAAkB,EAAQ,IAAaA,gBACvCjB,EAAW,EAAQ,IACnBkF,EAAO,EAAQ,GACfna,EAAI,EAAQ,GAOhB,SAASoa,EAAWjF,GAClB,IAAIkF,EAASpF,EAASrW,IAAIuW,GAC1B1W,OAAOgL,iBAAiB1E,KAAM,CAC5BgQ,GAAQ,CAAE/V,MAAOmW,GACjBmF,OAAQ,CAAEtb,MAAO,OAASmW,GAC1BoF,UAAW,CAAEvb,QAAOqb,KAGlBA,GACF5b,OAAOgL,iBAAiB1E,KAAM,CAC5BnC,WAAY4X,EAAeH,EAAQtV,KAAM,cAEzClC,cAAe2X,EAAeH,EAAQtV,KAAM,iBAC5CzG,KAAM,CACJM,IAAK,WAAc,OAAOyb,EAAO/b,MACjCgE,IAAK,aACL3D,YAAY,KAMpB,SAAS6b,EAAeH,EAAQ1V,EAAK7C,GACnC,IAAI2Y,EAAQhc,OAAOic,eAAe/V,GAC9B3C,EAAOvD,OAAOwD,yBAAyBwY,EAAO3Y,GAC9ClD,EAAMoD,EAAKpD,IAIf,OAHAoD,EAAKpD,IAAM,WACT,OAAOub,EAAKxZ,SAAS/B,EAAIV,KAAKyG,GAAM0V,EAAOvY,KAEtCE,EAIToY,EAAWza,UAAUgb,KAAO,SAAUA,GACpC,MAAO,CAAC5V,KAAKuV,OAAQK,GAAMvR,KAAK,MAGlC,WACE,IAAIwR,EAAQ1E,EACRtM,EAAOgR,EAAMhR,KAAKrK,KAAKqb,GACvBrR,EAAQ,SAAUjK,EAAK8B,GACd,MAAPA,EACFwZ,EAAMrR,MAAMjK,EAAK8B,GAEjBwZ,EAAM/R,OAAOvJ,IAIjB,SAASub,EAAWF,GAClB,MAAO,CACL/b,IAAK,WAAc,OAAOgL,EAAK7E,KAAK4V,KAAKA,KACzCrY,IAAK,SAAUlB,GAAOmI,EAAMxE,KAAK4V,KAAKA,GAAOvZ,IAC7CzC,YAAY,GAIhB,IAAImc,EAAkB,CACpBlY,WAAYiY,EAAW,sBACvBhY,cAAe,CACbjE,IAAK,WACH,OAAOub,EAAKrZ,WAAWia,EACrBnR,EAAK7E,KAAK4V,KAAK,wBAEnBrY,IAAK,SAAUlB,GACbmI,EAAMxE,KAAK4V,KAAK,qBACdR,EAAKrZ,WAAWka,EAAwB5Z,KAE5CzC,YAAY,GAEdmE,iBAAkB+X,EAAW,qBAC7Bvc,KAAMuc,EAAW,SAEnBpc,OAAOgL,iBAAiB2Q,EAAWza,UAAWmb,GAC9CV,EAAWza,UAAUsb,SAAWxc,OAAO4E,KAAKyX,GApC9C,GAwCAV,EAAWza,UAAUub,SAAW,SAAUC,GAIxC,OAHApW,KAAKkW,SAASxZ,SAAQ,SAAUnC,GAC9ByF,KAAKzF,GAAO6b,EAAM7b,KACjByF,MACIA,MAGTqV,EAAWza,UAAUyb,OAAS,WAC5BrW,KAAKmW,SAAS,KAShBd,EAAWiB,qBAAuB,SAAUC,GAC1C,IAAI/Z,EAAS,uBAAuBga,KAAKD,GACzC,OAAO/Z,GAAUA,EAAO,IAQ1B6Y,EAAWoB,yBAA2B,SAAUnF,GAC9C,IAAIoF,EAAK,uBAETvF,EAAgBE,oBAAmB,SAAUhH,GAC3C,IAAIsM,EAAUD,EAAGF,KAAKnM,EAAE9P,KACpBoc,GACFrF,EAASqF,EAAQ,GAAIA,EAAQ,QAUnC,IAAIX,EAAqB5C,KAAKwD,MAG1BX,EAAyBhb,EAAEyD,KAC7BzD,EAAE4D,UAKJ,SAAwBgY,GACtB,IAAIC,EAAajN,KAAKkN,IAAI,GAAIF,GAC9B,SAASG,EAAS/c,GAChB,OAAO4P,KAAK+D,MAAM3T,EAAQ6c,GAAYA,EAGxC,OAAO,SAAUza,GACf,IAAIG,EAAUvB,EAAEoB,GAAKoT,KAAK,CAAC,IAAI,IAAI,KAAK,OAAO5Q,UAAUmY,GAAU/c,QAEnE,OADAuC,EAAOuC,MAAQ1C,EAAI0C,MACZvC,GAdGya,CAAe,IAC3B7D,KAAKC,WAiBPta,EAAOD,QAAUuc,G,6BCvJjB,IAAI6B,EAAgB,EAAQ,IACxBC,EAAoB,EAAQ,IAC5BC,EAAS,EAAQ,GACjBC,EAAU,EAAQ,IAAUA,QAE5BC,EAAI,EAAQ,GACZrc,EAAI,EAAQ,GACZD,EAAK,EAAQ,GACb2W,EAAU,EAAQ,IAUtB,SAAS4F,EAAYC,GACnB,SAASC,EAAOlE,GACd,OAAOA,EATX,SAAgCA,GAC9B,OAAOmE,mBAAmBnE,EAAIoE,QAAQ,IAAK,MAQ5BC,CAAuBrE,GAAO,GAE7C,IAAI/W,EAAS,GAKb,OAJAgb,EAAY7V,MAAM,KAAKjF,SAAQ,SAAU6W,GACvC,IAAIjD,EAAOiD,EAAI5R,MAAM,KACrBnF,EAAOib,EAAOnH,EAAK,KAAOmH,EAAOnH,EAAK,OAEjC9T,EAQT,SAASqb,EAAaC,GACpB9X,KAAK2P,KAAOmI,EACZ9X,KAAK+X,UAAYD,EAAWnR,cAAc,8BAC1C3G,KAAKgY,SAAWF,EAAWnR,cAAc,eACzC3G,KAAKiY,WAAaH,EAAWnR,cAAc,iBAC3C3G,KAAKkY,iBAAmBld,EAAG2F,OAAOX,KAAKiY,YAAY/S,KAAK,IACrD1D,OAAO,UACLC,KAAK,CAAC0W,KAAM,SAAUC,MAAO,kBAAmB,eAAgB,UAChElT,KAAK,UACPyK,OACH3P,KAAKqY,QAAUf,EAAEQ,GACdQ,IAAI,gBAAiBtY,KAAKuY,UAAU/d,KAAKwF,OA4B9C,SAASwY,EAAYtX,EAAKuX,GACxB,IAAIC,EAAQxX,EAAIM,OAAO,OAClBC,KAAK,QAAS,uBAMnB,OALAiX,EAAMlX,OAAO,OACRC,KAAK,QAAS,iBAChBD,OAAO,MACLC,KAAK,QAAS,eACdkX,KAAKF,GACHC,EAhCTb,EAAajd,UAAU2d,UAAY,WACjCvY,KAAK4Y,UAELtB,EAAEtX,KAAKgY,UAAUa,QACjBvB,EAAEtX,KAAKiY,YAAYY,SAIrBhB,EAAajd,UAAUge,QAAU,aAGjCf,EAAajd,UAAUke,KAAO,WAC5B9Y,KAAKqY,QAAQU,MAAM,CAACC,SAAU,SAAUC,UAAU,KAGpDpB,EAAajd,UAAUse,MAAQ,WAC7BlZ,KAAKqY,QAAQU,MAAM,SAGrBlB,EAAajd,UAAUue,kBAAoB,SAAU5M,GACnDvM,KAAKgY,SAASpR,YAAc,GAC5B5G,KAAKgY,SAASrb,YAAYyc,EAAU7M,KActC,IAAI8M,EAAiB3f,OAAOgR,OAAO1P,EAAG6K,UAAU,KAGhD,SAASyT,EAAgBhN,EAAWxG,GAClC,IAAI4S,EAAQW,EAYZ,OAXIvT,EAAKA,MAAQA,EAAKA,KAAK1J,SACzBsc,EAAQF,EAAYlM,EAAWxG,EAAKyT,QAC9B/X,OAAO,OACRC,KAAK,QAAS,cAChBD,OAAO,MACLC,KAAK,QAAS,eAChBoE,UAAU,MACRC,KAAKA,EAAKA,MACZE,QAAQxE,OAAO,MACb0D,KAAKjK,EAAE0Q,UAEP+M,EAKT,SAASc,EAAiBlN,EAAWxG,GACnC,IAAI4S,EAAQW,EAyBZ,OAxBIvT,EAAKA,MAAQA,EAAKA,KAAK1J,SACzBsc,EAAQF,EAAYlM,EAAWxG,EAAKyT,QAC9B/X,OAAO,SACRC,KAAK,QAAS,SACdtI,MAAK,SAAU6I,GAEdA,EAAMR,OAAO,SACVA,OAAO,MAAMqE,UAAU,MAAMC,KAAKA,EAAK2T,SACvCzT,QAAQxE,OAAO,MAAM0D,KAAKjK,EAAE0Q,UAE/B3J,EAAMR,OAAO,SAASqE,UAAU,MAC3BC,KAAKA,EAAKA,MACZE,QAAQxE,OAAO,MAAMqE,UAAU,MAC7BC,KAAK7K,EAAE0Q,UACT3F,QAAQxE,OAAO,MAAMR,MAAoB,SAAU1H,GAClD,IAAIogB,EAAK1e,EAAG2F,OAAOX,MACF,mBAAN1G,EACTA,EAAEogB,GAEFA,EAAGxU,KAAK5L,SAKfof,EAIT,IAAIiB,EAAiB1e,EAAEqU,MAAMrU,EAAE0M,SAG/B,SAASiS,EAAiBC,EAAYC,EAASC,GAC7C,IAAIJ,EAAeG,GAAnB,CAKAD,EAAWrY,OAAO,KACbC,KAAK,CACJuY,KAAM,qBACN5B,MAAO,gCACP6B,KAAM,SACN,cAAe,aAEhB/U,KAAK6U,GAAoC,oBAC9C,IAAIzN,EAAYuN,EAAWrY,OAAO,OAC7BC,KAAK,CACJuO,GAXW,oBAYXoI,MAAO,aAGboB,EAAiBlN,EAAW,CAC1BiN,MAAO,mBACPE,QAAS,CAAC,WAAY,SACtB3T,KAAMgU,EAAQI,WAAW9V,KAAI,SAAsB9K,GACjD,MAAO,CAACA,EAAE6gB,SAAUC,EAAY9gB,EAAE+gB,aAEnCxZ,QAAQ,gBAAgB,GAC3B2Y,EAAiBlN,EAAW,CAC1BiN,MAAO,0BACPE,QAAS,CAAC,WAAY,UACtB3T,KAAMgU,EAAQQ,OAAOlW,KAAI,SAAU9K,GACjC,MAAO,CAACA,EAAE6gB,SAAU7gB,EAAE+gB,MAAMta,cAGhCyZ,EAAiBlN,EAAW,CAC1BiN,MAAO,oBACPE,QAAS,CAAC,WAAY,gBACtB3T,KAAMgU,EAAQS,QAAQnW,KAAI,SAAU9K,GAClC,MAAO,CAACA,EAAE6gB,SACR,SAAUT,GAAMA,EAAGlY,OAAO,OAAO0D,KAAK5L,EAAE+gB,MAAMta,gBAIpDuZ,EAAgBhN,EAAW,CACzBiN,MAAO,oBACPzT,KAAMgU,EAAQU,WAEhBlB,EAAgBhN,EAAW,CACzBiN,MAAO,sEACPzT,KAAMgU,EAAQW,aAKlB,SAASL,EAAYpG,GACnB,OAAOA,aAAkBtY,MACrBC,OAAOqY,GACPA,EAAOjU,SAAWiU,EAAOza,MAAQoC,OAAOqY,GAkC9C,SAAS0G,EAAWC,EAAWC,GAC7B,IAAIC,EAAW,GACXf,EAAU,CAACW,UAAW,GAAID,SAAU,GAAID,QAAS,GAAID,OAAQ,GAAIJ,WAAY,IAEjF,OAAOvI,EAAQ3Q,KAAK4Z,GAAO,SAAUE,GACnC,IAAIvhB,EAAOuhB,EAAKX,UAAYW,EAAKvhB,KACjC,IAAiC,IAA7BA,EAAKwhB,OAAO,YACdjB,EAAQW,UAAUnZ,KAAK/H,OAClB,MAAIuhB,EAAKE,WAAaF,EAAK1N,KAAOuN,GAGvC,OAAOhJ,EAAQsJ,QAAwB,MAAhBH,EAAKI,QAAkBJ,EAAKI,QAC/C/D,EAAkBgE,WAAWL,IAChCM,MAAK,SAAUF,GACdL,EAASvZ,KAAK,CACZ6Y,SAAU5gB,EACV6T,KAAM0N,EAAK1N,KACX/R,SAAU+b,EAAO7X,cAAc2b,QAEhCG,OAAM,SAAUhR,GACjB,IAAItH,EAAQ,CAACoX,SAAU5gB,EAAM8gB,MAAOhQ,GAChCA,aAAa+M,EAAOjX,cACtB2Z,EAAQS,QAAQjZ,KAAKyB,GACZsH,aAAa+M,EAAOvX,qBAC7Bia,EAAQQ,OAAOhZ,KAAKyB,GAEpB+W,EAAQI,WAAW5Y,KAAKyB,MAjB5B+W,EAAQU,SAASlZ,KAAK/H,OAqBvB+hB,OAAO,CAACC,cAAeV,EAAUW,iBAAkB1B,IA6ExD,SAASV,EAAU7M,GACjB,IAAI/P,EAASnB,SAASoB,yBAQtB,OAPA8P,EAAM7P,SAAQ,SAAUiT,GACF,iBAATA,EACTnT,EAAOG,YAAYtB,SAASogB,eAAe9L,IAE3CnT,EAAOG,YAAYgT,MAGhBnT,EAWT,SAASkf,EAAoBC,GAC3B,IATeC,EAASjM,EACpBkM,EAQAC,EAAOC,EAAa,CACtB/B,KAAM,2BAA6B2B,EAAKK,OACxCpV,YAAa+U,EAAKM,aAAgB,QAAUN,EAAKK,SAEnD,OAAOL,EAAKM,aAbGL,EAamB,IAbVjM,EAaemM,GAZnCD,EAAMxgB,SAAS6gB,cAAcN,IAC7Bjf,YAAYgT,GACTkM,GAUwCC,EAIjD,SAASC,EAAaJ,GACpB,IAAIG,EAAOzgB,SAAS6gB,cAAc,KAIlC,OAHAJ,EAAK9B,KAAO2B,EAAK3B,KACjB8B,EAAKrT,OAAS,SACdqT,EAAKlV,YAAc+U,EAAK/U,aAAe+U,EAAK3B,KACrC8B,EAQT,SAASK,EAAaR,GACpB,IAKIS,EACAC,EANAL,EAASL,EAAKK,OACdlE,EAAa6D,EAAK7D,WAClBwE,EAAiBX,EAAKW,eAEtBC,EAAS,IAAI1E,EAAaC,GAM1B0E,EACY,MAAVR,GACFO,EAAOxE,UAAUnR,YAAc,0BAC/BwV,EAAWL,EAAa,CAAC/B,KAAM,2BAA6BgC,IAC5DO,EAAOpD,kBAAkB,CAAC,cAAeiD,EAAU,MAC5C/E,EAAQ2E,GAAQZ,MAAK,SAAUtV,GAMpC,OALAuW,EAAWX,EAAoB,CAC7BM,OAAQA,EACRC,YAAanW,EAAKmW,cAEpBM,EAAOpD,kBAAkB,CAAC,cAAeiD,EAAU,MAC5CnhB,EAAE8R,OAAOjH,EAAK8U,YAGvB2B,EAAOxE,UAAUnR,YAAc,oBAC/B2V,EAAOpD,kBAAkB,CAAC,sBACnBxH,EAAQsJ,QAAQhgB,EAAEwhB,QAAQd,EAAKf,SAG1C2B,EAAOzD,OAEP,IAAI4D,EAAUF,EACbpB,KAAKV,EAAWlgB,UAAK2C,EAxBH,SAyBlBie,MAAK,SAAUuB,GACd,IAAI9B,EAAW8B,EAAOpB,cACtB,OAAQV,EAASze,QACf,KAAK,EAMH,YAxGR,SAAkBuf,GAChB,IAAI7B,EAAU6B,EAAKH,iBACfe,EAASZ,EAAKY,OACdH,EAAWT,EAAKS,SAEpBphB,EAAG2F,OAAO4b,EAAOvE,UAAU9S,KAAK,IAAI/L,MAAK,SAAUyjB,GACjDA,EAAKpb,OAAO,KAAKA,OAAO,UAAU0D,KAAMyU,EAAeG,GAEjD,0BADA,8CAEFsC,GACFQ,EAAKpb,OAAO,KAAK0D,KAAK,mBAAmByK,OAAOhT,YAAYyf,GAE9DxC,EAAiBgD,EAAM9C,EAAS,mBAElCyC,EAAOrE,iBAAiBtR,YAAc,QAqFhCiW,CAAS,CACPrB,iBAAkBmB,EAAOnB,iBACzBe,OAAQA,EACRH,SAAUA,IAGd,KAAK,EAGH,OAFAE,EAAezB,EAAS,GAAGxf,eAC3BkhB,EAAOrD,QAET,SAzJN,SAAsByC,GACpB,IAAId,EAAWc,EAAKJ,cAChBzB,EAAU6B,EAAKH,iBACfa,EAAWV,EAAKU,SAChBE,EAASZ,EAAKY,OACdO,EAAkBnB,EAAKmB,gBAEvBjD,EAAa7e,EAAG2F,OAAO4b,EAAOvE,UAAU9S,KAAK,IACjD2U,EAAWrY,OAAO,KAAKrI,MAAK,SAAU2B,GACpCA,EAAE0G,OAAO,UAAU0D,KAAK,8BACpBmX,IACFvhB,EAAE6U,OAAOhT,YAAYtB,SAASogB,eAAe,WAC7C3gB,EAAE6U,OAAOhT,YAAY0f,OAGzB,IAAIU,EAAS,IAAI7F,EAAc,CAC7BlV,MAAO6X,EAAWrY,OAAO,SACtBC,KAAK,CAAC2W,MAAO,qCAChBqB,QAAS,CAAC,WAAY,QACtB3T,KAAM+U,EAASzW,KAAI,SAAU6L,GAC3B,MAAO,CAACA,EAAIkK,UA3BE1f,EA2BmBwV,EAAI7C,MAzBjCvD,KAAKmT,KAAK,GAAGviB,EAAE,MAAM,IAAIwiB,QAAQ,GAAK,QAFhD,IAAoBxiB,OA8BlBmf,EAAiBC,EAAYC,GAE7B,IAAIoD,EAAeliB,EAAG2F,OAAO4b,EAAOtE,YAAYzW,OAAO,UAClDC,KAAK,CAAC0W,KAAM,SAAUC,MAAO,kBAAmB,eAAgB,UAChEzd,SAAS,YAAY,GACrBuK,KAAK,UACLwI,GAAG,SAA4B,WAC9B1S,EAAG2F,OAAOX,MAAM0N,GAAG,QAAS,MAC5B,IAAIyP,EAAQniB,EAAGuC,IAAIwf,EAAOK,oBAC1BN,EAAgBjC,EACb5F,QAAO,SAAU6F,GAAQ,OAAOqC,EAAME,IAAIvC,EAAKX,aAC/C/V,IAAInJ,EAAEN,SAAS,iBAGrBgV,OACHoN,EAAOO,SAAW,WAChBJ,EAAaK,SAAWR,EAAOS,kBAmH3BC,CAAa,CACXlC,cAAeV,EACfW,iBAAkBmB,EAAOnB,iBACzBe,OAAQA,EACRF,SAAUA,EACVS,gBAAiB,SAAyBY,GACxCA,EAAKC,SAASnW,UAAUpD,IAAIkY,UAKrCjB,OAAM,SAAUrH,GACfuI,EAAOpD,kBAAkB,CAACyE,EAAgB5J,IACvC2J,OAAOvB,EAAW,CAAC,kBAAmBA,GAAY,KAErDG,EAAOrE,iBAAiBtR,YAAc,WAEpCiX,EAAgB,IAAIlM,GAAQ,SAAUsJ,GACxCsB,EAAO3D,QAAU,WACf8D,EAAQoB,SACR7C,QAGJ,OAAOyB,EAAQpB,OAAOuC,GAIxB,IAAIE,EAAa5B,EAGb6B,EAAmB7B,EAEvB,SAAS8B,EAAkBrC,EAASsC,GAClC,IAAIC,EAAU9iB,SAAS6gB,cAAcN,GAErC,OADAuC,EAAQD,UAAYA,EACbC,EAIT,SAASP,EAAgB5J,GACvB,IAAIoK,EAAMpK,EAAOoK,IACjB,GAAIA,EAEF,OAAOH,EAAkB,IAAM,WAC7B,OAAQjK,EAAOqK,QACb,IAAK,QACH,MAAO,CAAC,IACV,IAAK,UACH,MAAO,CACL,0CACA,gDAEJ,QAEE,OAAmB,MAAfD,EAAIC,OACC,CACL,uDACA,+DAEsB,IAAfD,EAAIC,OACN,CAAC,yEAED,CACL,oEACA,qBAAuBD,EAAIC,OAAS,IAAMD,EAAIE,aArB1B,GAyBzBja,KAAK,SAGV,IAAIka,EAAMljB,SAAS6gB,cAAc,OAEjC,OADAqC,EAAI3X,YAAcwT,EAAYpG,GACvBoF,EAAU,CACf6E,EAAkB,IAAK,iCAAkCM,IAwB/DzlB,EAAQilB,WAAaA,EACrBjlB,EAAQklB,iBAAmBA,EAC3BllB,EAAQ0lB,UAnBR,SAAmB7C,GASjB,IACIK,EADSzE,EAAYxC,SAASgG,OAAO0D,UAAU,IAC/B,eAChBzC,GACF+B,EAAW9iB,EAAEsO,OAAO,CAACyS,OAAQA,GAASL,IACrC+C,SAZH,WACE,IACEC,QAAQC,aAAa,KAAM,KAAM7J,SAAS8J,UAC1C,MAAOxU,U,6BClgBb,IAAIiN,EAAI,EAAQ,GACZ3F,EAAU,EAAQ,IAUtB,SAASmN,EAAcV,GACrB,OAAO,IAAIzM,GAAQ,SAAUsJ,EAAS8D,EAAQC,GAC5CZ,EAAIhD,KAAKH,GAAS,SAAUgE,EAAOC,EAAYC,GAC7CJ,EAAO,CAACX,IAAKa,EAAOZ,OAAQa,EAAY7E,MAAO8E,OAEjDH,GAAYA,GAAS,WACnB,IAAMZ,EAAIgB,QAAW,MAAO/U,WAdlCsH,EAAQ0N,OAAO,CACbC,cAAc,IA6ChBxmB,EAAQue,QAzBR,SAAiB2E,GACf,OAAO8C,EAAcxH,EAAEiI,KAAK,CAC1BC,IAAK,gCAAkCxD,EACvC7D,KAAM,MACNsH,SAAU,OACVC,QAAS,qCAqBb5mB,EAAQ6mB,WAbR,SAAoBC,GAElB,OAAOd,EAAcxH,EAAEiI,KAAK,CAC1BC,IAAK,+BACLrH,KAAM,OACNrS,KAAMsN,KAAKC,UAAUuM,GAErBH,SAAU,OACVC,QAAS,sC,8BC1Cb,IAAIG,EAAuB,EAAQ,IAC/BC,EAAe,EAAQ,IACvB5P,EAAW,EAAQ,IACnB5T,EAAgB,EAAQ,GAAUA,cAClC6Y,EAAM,EAAQ,IACdmC,EAAI,EAAQ,GAMhB,SAASyI,EAAM/P,GACX,OAAO3U,SAAS2kB,eAAehQ,GAGnC,SAASiQ,EAAa9H,EAAMQ,GACxBoH,EAAM,kBAAkBG,mBACpB,aACA,2BAA6B/H,EAA7B,0JAEAQ,EACA,UA0DR,SAAS2D,EAAe1c,GAEpBugB,EAAKC,UAAUxgB,EAAK,CAACe,QAAQ,EAAMwX,KAAM,SAxE7ChD,EAAIkK,OAAOgB,WAAW,0BAwBb,EAAQ,IAAa1P,oBACtBsP,EAAa,OAAQ,4QAcP,IAAIK,SAAS,yCAAb,GAA2D,IAEzEL,EACI,UACA,ibAOR3I,GAAE,WAEc,mBAAmBiJ,KAAKC,UAAUC,aAAellB,OAAOmlB,UAEhEX,EAAM,kBAAkBG,mBACpB,aACA,wZAmBhB5I,GAAE,WAEEA,EAAE,kBAAkBva,KAAK,YAAY,GAGrC,IAAI4jB,EAAa,CACb7I,WAAYiI,EAAM,gBAClBzD,eAAgBA,GAEpB,EAAQ,IAAoBkC,UAAUmC,GAEtC,IAAIC,EAAetJ,EAAE,gBACrBsJ,EAAatI,IAAI,iBAAiB,WAC9B,EAAQ,IAA0BuI,KAAK,CACnCxI,QAASuI,EACTE,WAAYf,EAAM,cAClBY,WAAYA,OAIpB,IAAII,EAAchB,EAAM,eACxB,EAAQ,IAA0Bc,KAAK,CACnCxI,QAASf,EAAEyJ,GACXC,mBAAoB,WAEhB,OADAC,EAAWC,OACJf,EAAKgB,iBAEhBC,YAAaH,EAAWG,YAAY5mB,KAAKymB,GACzCI,cAAetB,EAAM,sBACrBuB,kBAAmBvB,EAAM,2BACzBwB,mBAAoBxB,EAAM,sBAC1ByB,SAAUT,EAAYpa,cAAc,iBAS5C,IAAIwZ,EAAO,WACP,IAAIxf,EAAStF,SAAS2kB,eAAe,eAEjCyB,EAAWpmB,SAAS6gB,cAAc,YACtCuF,EAASvZ,MAAQ,YACjBvH,EAAOhE,YAAY8kB,GAEnB,IAAIC,EAAermB,SAAS6gB,cAAc,YAM1C,OALAwF,EAAaxZ,MAAQ,WACrBwZ,EAAa/kB,YAAYL,EAAc4T,EAASG,KAAKjM,IACjD0b,EAAallB,UAAU+mB,sBAC3BhhB,EAAOhE,YAAY+kB,GAEZ,IAAI5B,EAAa,CACpBK,KAAMxf,EACNwN,MAAOsT,EACPG,cAAe,UACfpR,eAAgBN,EAASM,iBAjBtB,IA0BV,WACG2P,EAAK7C,SAAW,SAAUrN,EAAK4R,GAC3B,OAAQA,GAAQA,EAAK1J,MACjB,IAAK,YACD8I,EAAWa,mBAAmB7R,GAC9B,MACJ,IAAK,SACDgR,EAAWc,kBAAkB9R,GAC7B,MACJ,QACIgR,EAAWe,aAAa/R,GAEhCgS,KAIJ,IAAIA,EAAmB,WACnB,IAEIC,EAFAC,EAAa9mB,SAASsL,cAAc,iCACpCyb,EAAa/mB,SAASsL,cAAc,iCAGxC,SAAS0b,IAKLC,IAGJ,OAAO,WACH,IAAI9M,EAAY2K,EAAKgB,gBAAgB3L,UACjC0M,IAAe1M,IACVA,GAOD2M,EAAWvb,YAAc,iBACzBub,EAAW5Q,iBAAiB,QAAS8Q,GACrCF,EAAWI,gBAAgB,eAC3BH,EAAWxb,YAAc,sBACzBwb,EAAWI,aAAa,cAAe,yBAVvCL,EAAWvb,YAAc,UACzBub,EAAWzQ,oBAAoB,QAAS2Q,GACxCF,EAAWK,aAAa,cAAe,SACvCJ,EAAWxb,YAAc,UACzBwb,EAAWI,aAAa,cAAe,kBAQ3CN,EAAa1M,IA7BH,GAoCtB,SAAS8M,IACLrB,EAAWC,OACXf,EAAKC,UAAUD,EAAKgB,gBAAiB,CAACxgB,QAAQ,IALlDshB,IAiBA,IAAIQ,EAAgBnL,EAAEyI,EAAM,iBAC5B,CACI,CAAC/P,GAAI,0BAA2B0S,SAAUJ,GAC1C,CAACtS,GAAI,yBAA0B0S,SAZnC,WACIvC,EAAKwC,YAAY,CAAChiB,QAAQ,IAEtBsgB,EAAW2B,OAAOC,gBAClB5B,EAAW2B,OAAOC,cAAc3S,EAASO,eACzCwQ,EAAW6B,uBAQjBpmB,SAAQ,SAAUqmB,GAChB1nB,SAAS2kB,eAAe+C,EAAK/S,IAAIuB,iBAAiB,SAAS,SAAUlH,GACjEA,EAAE2Y,iBACFD,EAAKL,SAASrY,GAEdoY,EAAc1J,MAAM,CAACE,UAAU,IAC1BX,IAAI,mBAAmB,WACpB2I,EAAW2B,OAAOK,iBA7EtC,GAwFC,WAEG,IAAIR,EAAgBnL,EAAEyI,EAAM,iBACxBmD,EAAYnD,EAAM,qBAgCtB,SAASoD,IACLhD,EAAK9J,SAEL4K,EAAWc,kBAAkB5B,EAAKgB,iBAlCtCsB,EACK/U,GAAG,iBAAiB,WACjBwV,EAAUjpB,MAAQkmB,EAAKiD,cAAcle,QAExCwI,GAAG,kBAAkB,WAClBwV,EAAUviB,YAMb+M,GAAG,mBAAmB,WACnB,IAAI2V,EAAUH,EAAUjpB,MACpBkmB,EAAKiD,cAAcle,OAASme,GAC5BlD,EAAKmD,OAAOD,GAEhBH,EAAUjpB,MAAQ,MAE1BoB,SAAS2kB,eAAe,oBAAoBzO,iBAAiB,UAAU,SAAUlH,GAC7EA,EAAE2Y,iBACFP,EAAc1J,MAAM,WAQxB1d,SAAS2kB,eAAe,wBAAwBzO,iBAAiB,SAJjE,WACI4O,EAAK9J,YAiBThb,SAAS2kB,eAAe,8BAA8BzO,iBAAiB,QAAS4R,GAChF9nB,SAAS2kB,eAAe,2BAA2BzO,iBAAiB,SANpE,WACI4O,EAAKC,UAAUD,EAAKgB,gBAAiB,CAACxgB,QAAQ,IAC9CwiB,OA3CR,GAsDA,IAwEQI,EAxEJtC,EAAc,WACd,SAASuC,EAAUlX,EAAW6L,GAC1B,OAAO7L,EAAU3F,cAAc,aAAewR,GAGlD,IAAIyK,EAASvnB,SAAS2kB,eAAe,oBAEjCyD,EAAMpoB,SAAS2kB,eAAe,sBAC9B0D,EAAKd,EAAOe,WAEhB,OAAO,IAAI9D,EAAqB,CAC5B+D,UAAWvoB,SAAS2kB,eAAe,qBACnC6D,aAAcxoB,SAAS2kB,eAAe,2BACtC4C,OAAQA,EACRjO,iBAAkBtZ,SAAS2kB,eAAe,+BAC3C,CACC4D,UAAW,CACPE,IAAKN,EAAUC,EAAK,OACpBrgB,KAAMogB,EAAUC,EAAK,QACrBM,MAAOP,EAAUC,EAAK,SACtB7f,MAAO4f,EAAUC,EAAK,UAE1Bb,OAAQ,CACJoB,KAAMR,EAAUE,EAAI,eACpBO,OAAQT,EAAUE,EAAI,mBAE3BvD,EAAKgB,iBA1BK,GA6BjBF,EAAW2B,OAAOsB,SAAS,oBAC3BjD,EAAW2B,OAAOuB,SAASC,WAAW,CAClC7qB,KAAM,OACN8qB,QAAS,CAACC,IAAK,QAASC,IAAK,UAC7B/N,KAAM,WACFyK,EAAW6B,sBAGnB7B,EAAW2B,OAAO4B,QAAQC,gBAAe,GACzCnN,GAAE,WACE,IACI,EAAQ,IAAkBoN,KACtBzD,EAAW2B,OAAOuB,SAClBpE,EAAM,qBAEZ,MAAO1V,QAKb9O,OAAOgW,iBAAiB,gBAAgB,SAAUoT,GAC9C,IACI1D,EAAWC,OACXf,EAAKyE,mBACP,MAAOvK,GAOL,OANA4F,EACI,UACA,8RAII0E,GAAMppB,OAAOspB,OAAOC,YACxB,mEAKZvpB,OAAOgW,iBAAiB,QAAQ,WAE5B0P,EAAWC,UAIPqC,GAAc,EAClB,EAAQ,IAAgB9M,0BAAyB,SAAUrG,EAAOrT,GAC1DqT,IAAU6Q,EAAW8D,cAAc/U,IAAe,SAATjT,GAAoBwmB,IAE7DA,GAAc,EACdyB,YAAW,WACPzB,GAAc,EAEdtC,EAAWc,kBAAkBd,EAAW8D,eAAe,KAExD,SAMfjsB,EAAQmoB,WAAaA,G,6BChYrB,IAAIgE,EAAc,EAAQ,IACtBC,EAAS,EAAQ,IACjB9P,EAAO,EAAQ,GACfD,EAAM,EAAQ,IACdna,EAAK,EAAQ,GACb4W,EAAcsT,EAAOtT,YACrBzR,EAAgB+kB,EAAO/kB,cACvBglB,EAAchQ,EAAIiQ,QAAQ,mBAAmBD,YAwBjD,SAAStF,EAAqBwF,EAAYC,EAASjqB,GAC/C2E,KAAK4jB,UAAY,IAAIqB,EAAYI,EAAWzB,UAAW0B,EAAQ1B,WAG/D,IAAIhB,EAASzN,EAAIoQ,KAAKF,EAAWzC,QACjCA,EAAO4B,QAAQgB,WAAW,CACtBrrB,KAAM,gBACNsrB,QAAS,EACTC,aAAa,IAEjB9C,EAAO4C,WAAW,CACdG,SAAU,GACVC,SAAU,KAIdhD,EAAOiD,gBAAkBC,IAEzB,IAAInR,EAAmBQ,EAAIoQ,KAAKF,EAAW1Q,kBAC3CA,EAAiB6P,QAAQgB,WAAW,CAChCrrB,KAAM,gBACNsrB,QAAS,EACTC,aAAa,IAEjB/Q,EAAiB6Q,WAAW,CACxBG,SAAU,GACVC,SAAU,KAIdjR,EAAiBkR,gBAAkBC,IACnCnR,EAAiBoR,aAAY,GAE7B,IAAIC,EAAgBV,EAAQ1C,OACxBlgB,EAAO1C,KACXgmB,EAAchC,KACTzS,iBAAiB,SAAS,WACvB7O,EAAKogB,mBAELpgB,EAAKwe,OACLxe,EAAKkgB,OAAOK,WAEpB+C,EAAc/B,OACT1S,iBAAiB,SAAS,WACvB7O,EAAKujB,qBACLvjB,EAAKkgB,OAAOK,WAGpBvpB,OAAOgL,iBAAiB1E,KAAM,CAC1BkmB,WAAY,CACRjsB,MAAO,CAAC2oB,OAAQ,IAChBtlB,UAAU,GAEdgoB,QAAS,CAACrrB,MAAOqrB,GACjBD,WAAY,CAACprB,MAAOorB,GACpBzC,OAAQ,CAAC3oB,MAAO2oB,EAAQhpB,YAAY,GACpC+a,iBAAkB,CAAC1a,MAAO0a,EAAkB/a,YAAY,KAE5DoG,KAAKgiB,aAAa3mB,GAuFtB,SAAS8qB,EAA+B9b,GACpC,MAAO,CACHsD,IAAKtD,EAAE+b,KAAKC,KACZC,OAAQjc,EAAE+b,KAAKE,OACfphB,KAAM,gDAAkDmF,EAAEtK,QAC1DoY,KAAM,SAzFd0H,EAAqBjlB,UAAUmqB,YAAc,WACzC,OAAO/kB,KAAKkmB,YAIhBrG,EAAqBjlB,UAAUknB,mBAAqB,SAAU7R,GAC1DjQ,KAAKkmB,WAAajW,GAKtB4P,EAAqBjlB,UAAUonB,aAAe,SAAU/R,GACpD,GAAIjQ,KAAK+kB,cAAc/U,KAAOC,EAAID,GAIlC,OADAhQ,KAAKkhB,OACElhB,KAAK+hB,kBAAkB9R,IAKlC4P,EAAqBjlB,UAAUmnB,kBAAoB,SAAU9R,EAAKsW,GAC9DvmB,KAAK8hB,mBAAmB7R,GACxB,IAAIuW,EAAgBvW,EAAIpS,WACpB4oB,EAAexW,EAAIlS,iBASvB,GAPAiC,KAAK4jB,UAAU1S,QACflR,KAAK0mB,eAA+B,MAAhBD,EAAuBD,EAAgBC,GAEtDF,GACDvmB,KAAK4iB,OAAO4B,QAAQmC,eAAe,IAAIxB,GAGvB,MAAhBsB,EAEAzmB,KAAK8iB,uBACF,CAEH9iB,KAAK4mB,UAAW,EAChB,IACI5mB,KAAK4jB,UAAU/lB,WAAa2oB,EAC5BxmB,KAAK4jB,UAAU9lB,cAAgBmS,EAAInS,cACrC,MAAOuM,GACLrK,KAAK6mB,yBAAwB,MAKzChH,EAAqBjlB,UAAUsmB,KAAO,WAClC,IAAIjR,EAAMjQ,KAAK+kB,cACX/kB,KAAK8mB,iBAEL7W,EAAIlS,iBAAmBiC,KAAK4mB,cAAWzpB,EAAY6C,KAAK4iB,OAAOmE,WAC/D9W,EAAIpS,WAAamC,KAAK4jB,UAAU/lB,WAChCoS,EAAInS,cAAgBkC,KAAK4jB,UAAU9lB,eAEP,MAAxBmS,EAAIlS,iBAIJkS,EAAIpS,WAAamC,KAAK4iB,OAAOmE,WAI7B9W,EAAIlS,iBAAmBiC,KAAK4iB,OAAOmE,YAW/ClH,EAAqBjlB,UAAU8rB,eAAiB,SAAUnT,GACtDvT,KAAK4iB,OAAOoE,SAAS5R,EAAKxZ,SAAS2X,EAAK,KAAM,GAC9CvT,KAAKinB,eAAe,KAgBxBpH,EAAqBjlB,UAAUqsB,eAAiB,SAAUC,GACtD,IAAIxkB,EAAO1C,KACPmnB,EAASnsB,EAAG2F,OAAO+B,EAAK2iB,WAAWxB,cAAche,UAAU,UAC1DC,KAAKohB,GAAQ,SAAU7c,GACpB,OAAO1O,OAAO0O,MAGtB8c,EAAOjhB,OAAOpC,SAEdqjB,EAAOnhB,QACFxE,OAAO,OACPC,KAAK,QAAS,sBACdA,KAAK,OAAQ,SACbT,MAAsB,SAAUqJ,GAC7B,IAAInJ,EAAMlG,EAAG2F,OAAOX,MACpB,GAAIqK,aAAalK,EAAe,CAC5B,IAAIinB,EAAQjB,EAA+B9b,GACvCgd,EAAUD,EAAMzZ,IAAM,EACtB2Y,EAASc,EAAMd,OACnBplB,EAAIM,OAAO,UACN0D,KAAK,oBACL1D,OAAO,KACP0D,KAAK,QAAUmiB,GACf3Z,GAAG,SAAS,WACThL,EAAKkgB,OAAO0E,SAASD,EAASf,GAAQ,GACtC5jB,EAAKkgB,OAAOK,QAEZjoB,EAAG6pB,MAAM7B,oBAEZvhB,KAAK,OAAQ,IAAMiB,EAAK2iB,WAAWzC,OAAO5S,IAC/C9O,EAAIM,OAAO,MAGXN,EAAIM,OAAO,QAAQ0D,KAAK,oBAAsBmF,EAAE2J,aACzC3J,aAAauH,EACpB1Q,EAAIyX,KAAKtO,EAAEtK,SAEXmB,EAAIyX,KAAK,sCAAwCtO,MAG7D3H,EAAKkgB,OAAO4B,QAAQ+C,eAChBL,EACK9iB,KAAI,SAAUiG,GACX,OAAQA,aAAalK,EAAiBgmB,EAA+B9b,GAAK,QAE7E4K,QAAO,SAAUhZ,GACd,OAAOA,OAcvB4jB,EAAqBjlB,UAAU4sB,qBAAuB,SAAUC,GAC5DzsB,EAAG2F,OAAOX,KAAKslB,QAAQ1C,OAAOoB,MACzBnjB,QAAQ,CACL,cAAe4mB,EACf,eAAgBA,KAQ5B/tB,OAAOC,eAAekmB,EAAqBjlB,UAAW,WAAY,CAC9D2C,IAAK,SAAUqpB,GAEX,GADAA,EAAWxrB,QAAQwrB,GACf5mB,KAAK0nB,aAAed,IACpB5mB,KAAK0nB,WAAad,EAClB5mB,KAAKwnB,qBAAqBZ,GACtBA,GAAU,CAEV,IAAItJ,EAAW,WACXtd,KAAK4mB,UAAW,EAChB5mB,KAAK4iB,OAAO+E,eAAe,SAAUrK,IACvC9iB,KAAKwF,MACPA,KAAK4iB,OAAOlV,GAAG,SAAU4P,KAIrCzjB,IAAK,WACD,OAAOmG,KAAK0nB,cAKpB7H,EAAqBjlB,UAAUwmB,YAAc,WACzC,OAAOhmB,QAAQ4E,KAAK4mB,WAMxBltB,OAAOC,eAAekmB,EAAqBjlB,UAAW,kBAAmB,CACrEf,IAAK,WACD,OAAOuB,QAAQ4E,KAAK4jB,UAAU/lB,eAYtCgiB,EAAqBjlB,UAAUisB,wBAA0B,SAAU/N,GAK/D,IAJiB/d,EAIbmG,EAAMlG,EAAG2F,OAAOX,KAAK4jB,UAAUtX,WACnC,GAAIwM,EAAM,CACN,IAAI8O,EAAa5nB,KAAKslB,QAAQ1C,OAAOqB,OAAOrd,YAAY0L,OACxDpR,EAAIyX,KAAK,IACJnX,OAAO,OACPC,KAAK,QAAS,sBACdkX,KAAK,+CACF,CACI,wDAEA,oFAEA,UAhBC5d,EAgBkB6sB,EAfxB,MAAQ7sB,EAeH,2DACFsJ,KAAK,cAGfnD,EAAI2E,UAAU,UAAU/B,UAKhC+b,EAAqBjlB,UAAUkoB,iBAAmB,WAE9C,IAAIoE,EAAS,GAEb,IACI,IAAIW,GAAgB7nB,KAAK8mB,gBACzB9mB,KAAK4jB,UAAU/lB,WAAamC,KAAK4iB,OAAOmE,WACpCc,IAEA7nB,KAAK6mB,yBAAwB,GAC7B7mB,KAAK4jB,UAAU9lB,cAAgBkC,KAAK+kB,cAAcjnB,eAGd,OAApCkC,KAAK4jB,UAAUjP,iBACf3U,KAAK2U,iBAAiBrI,UAAUvF,UAAUC,IAAI,WAE9ChH,KAAK2U,iBAAiBrI,UAAUvF,UAAUjD,OAAO,UACjD9D,KAAK2U,iBAAiBqS,SAAShnB,KAAK4jB,UAAUjP,kBAAmB,IAIvE,MAAOtK,GACL6c,EAAS,CAAC7c,GAEdrK,KAAK4mB,SAA8B,IAAlBM,EAAO9qB,OACxB4D,KAAKinB,eAAeC,IAIxBrH,EAAqBjlB,UAAUqrB,mBAAqB,WAChDjmB,KAAK0mB,eAAe1mB,KAAK8mB,gBACnB9mB,KAAK4jB,UAAU/lB,WACfmC,KAAK+kB,cAAclnB,YAErBmC,KAAK8mB,gBACL9mB,KAAK4mB,UAAW,EAGhB5mB,KAAK8iB,oBAOb/pB,EAAOD,QAAU+mB,G,6BClXjB,MAAM,UAACvM,GAAa,EAAQ,IACtBzR,EAAQ,EAAQ,IAChB,UAACnE,GAAa,EAAQ,GACtBqP,EAAS,EAAQ,GAAUA,OASjC,SAASkY,EAAY3Y,EAAWgZ,GAC5BtlB,KAAKsM,UAAYA,EACjBtM,KAAKslB,QAAUA,EACftlB,KAAK2U,iBAAmB,KAExB,MAAMjS,EAAO1C,KACbslB,EAAQliB,KACHmO,iBAAiB,SAAS,WACvB7O,EAAKC,QAAQQ,WAAY,EACzBT,EAAKC,QAAQS,UAErBkiB,EAAQxB,IACHvS,iBAAiB,SAAS,WACvB7O,EAAKC,QAAQQ,WAAaT,EAAKC,QAAQQ,aAE/CmiB,EAAQvB,MACHxS,iBAAiB,SAAS,WACvB,IAAK7O,EAAKC,QACN,OACJ,MAAMmlB,EAAS,CAAC,IAAM,IAAK,IAAI,IAAK,IAAO,IAAI,GAC/C,IAAI9uB,EAAI8uB,EAAOC,QAAQrlB,EAAKC,QAAQF,mBACpCzJ,GAAKA,EAAI,GAAK8uB,EAAO1rB,OACrB,IAAI2nB,EAAQrhB,EAAKC,QAAQF,kBAAoBqlB,EAAO9uB,GACpDssB,EAAQvB,MAAMiE,UAAUphB,YAAc,IAAI,IAAImd,KAEtDuB,EAAQ1hB,MACH2N,iBAAiB,SAAS,WACvB7O,EAAKC,QAAQiB,WAErB0hB,EAAQ/e,IAAMwG,EAAOuY,GAErBtlB,KAAKkR,QAmFT,SAAS+W,EAAcC,EAAYC,EAAWC,EAASC,EAAW1lB,GAU9DjF,EAAUiF,EAAS,YAAY,SAAU5F,EAAMurB,EAAQ7kB,GAEnD,OAXJ,SAAwBA,GACpBykB,EAAW3K,SAAW9Z,EACtB0kB,EAAU5K,SAAW9Z,EAQrB8kB,CAAe9kB,GACRA,KAEX/F,EAAUiF,EAAS,aAAa,SAAU5F,EAAMurB,EAAQnlB,GAEpD,OAVJ,SAAyBA,GACrBglB,EAAUjK,UAAY/a,EAAYklB,EAAYD,EAQ9CI,CAAgBrlB,GACTA,KAhGf8hB,EAAYrqB,UAAUsW,MAAQ,WAC1BlR,KAAKnC,WAAa,MAGtBnE,OAAOgL,iBAAiBugB,EAAYrqB,UAAW,CAM3CiD,WAAY,CACRhE,IAAK,WACD,OAAOmG,KAAKyoB,cAGhBlrB,IAAK,SAAUM,GAKX,GAJImC,KAAK2C,UACL3C,KAAK2C,QAAQQ,WAAY,EACzBnD,KAAK2C,QAAQT,SAAS+K,MAAMsC,QAEd,MAAd1R,EAEAmC,KAAK2C,QAAU,KACf3C,KAAKsM,UAAU4R,UAAY,OACxB,CAEH,IAAK/c,EAAMunB,EAAkB/T,GAAoBrB,EAAUzV,GAAY,GAEvE,GADAmC,KAAK2U,iBAAmBA,EACpB3U,KAAK2C,QAAS,CAGd,IAAIb,EAAW9B,KAAK2C,QAAQ7E,cAC5BkC,KAAKkR,QACLlR,KAAK2C,QAAU,IAAId,EAAM7B,KAAKsM,UAAWnL,EAAMunB,GAAoB5mB,QAGnE9B,KAAK2C,QAAU,IAAId,EAAM7B,KAAKsM,UAAWnL,EAAMunB,GAGvD1oB,KAAKyoB,aAAe5qB,GAExBjE,YAAY,GAEhBkE,cAAe,CACXjE,IAAK,WACD,OAAOmG,KAAK2C,SAAW3C,KAAK2C,QAAQ7E,eAExCP,IAAK,SAAUuE,GACP9B,KAAK2C,SAAWb,IAChB9B,KAAK2C,QAAQ7E,cAAgBgE,IAGrClI,YAAY,GAEhB+I,QAAS,CACL9I,IAAK,WACD,OAAOmG,KAAK2oB,WAEhBprB,IAAK,SAAUoF,GACX3C,KAAK2oB,UAAYhmB,EACjB3C,KAAK4oB,oBAcjB3D,EAAYrqB,UAAUiuB,iBAClB,2EACJ5D,EAAYrqB,UAAUkuB,mBAClB,8EAwBJ7D,EAAYrqB,UAAUguB,cAAgB,WAClC,IAAItD,EAAUtlB,KAAKslB,QACfyD,EAA0B,MAAhB/oB,KAAK2C,QACfomB,GACAd,EAAc3C,EAAQliB,KAAMkiB,EAAQxB,IAChC9jB,KAAK6oB,iBAAkB7oB,KAAK8oB,mBAAoB9oB,KAAK2C,SAG7D2iB,EAAQ/e,IAAI7J,SAAQ,SAAUZ,GAC1BA,EAAEyhB,UAAYwL,MAItBhwB,EAAOD,QAAUmsB,G,6BChKjB,MAAM,YAACrT,GAAe,EAAQ,IACxB1B,EAAW,EAAQ,IAGzB,SAAS8Y,EAAsB7nB,GAE3B,IAAIqH,EAAU,GACVygB,EAAS,GACb,IAAK,MAAMC,KAAc/nB,EAAKa,MAAO,CAC5BinB,EAAOniB,SAASoiB,IACjBD,EAAO3nB,KAAK4nB,GAGhB,IAAK,MAAOC,EAAergB,KAAWpP,OAAO6a,QAAQpT,EAAKa,MAAMknB,IAAe,IAC3E,IAAK,MAAMpmB,KAAUsmB,EAAeD,GAC3B3gB,EAAQ1B,SAAShE,IAClB0F,EAAQlH,KAAKwB,GAEbgG,EAAOjG,QAAUomB,EAAOniB,SAASgC,EAAOjG,QACxComB,EAAO3nB,KAAKwH,EAAOjG,OACnBiG,EAAOhG,SAAW0F,EAAQ1B,SAASgC,EAAOhG,OAAO,KACjD0F,EAAQlH,KAAKwH,EAAOhG,OAAO,IAI3C,MAAO,CAAC0F,EAASygB,GAkFrB,SAASG,EAAe7uB,GACpB,OAAOA,EAAIoH,MAAM,KAAKgD,QAAO,SAAUC,EAAK3I,GAMxC,MALU,KAANA,GAAoC,KAAxB2I,EAAIA,EAAIxI,OAAS,GAC7BwI,EAAIA,EAAIxI,OAAS,GAAK,IAEtBwI,EAAItD,KAAKrF,GAEN2I,IACR,IAGP,SAASykB,EAAMlW,EAAKmW,EAAOxU,GACvB,IAAIT,EAAM,CAAC,CAACiV,GAAQxU,GACpB3B,EAAI+B,OAAO/B,EAAI4U,QAAQuB,GAAQ,GAC/B,IAAK,MAAMC,KAAQpW,EACf2B,GAAQA,EAAK,GACbT,EAAIkV,GAAQzU,EAEhB,OAAOT,EAQX,SAASmV,EAAmBroB,EAAMmS,GAK9B,IAAK9K,EAASygB,GAAUD,EAAsB7nB,GAE9C,GAAIqH,EAAQpM,QAAU,EAClB,MAAM,IAAIwV,EAAY,4EAG1BpJ,EAAQihB,OACJjhB,EAAQ1B,SAAS,OACjB0B,EAAQ0M,OAAO1M,EAAQuf,QAAQ,KAAM,GACrCvf,EAAQkhB,QAAQ,MAEhBlhB,EAAQ1B,SAAS3F,EAAKO,SACtB8G,EAAQ0M,OAAO1M,EAAQuf,QAAQ5mB,EAAKO,OAAQ,GAC5C8G,EAAQkhB,QAAQvoB,EAAKO,QAEzB,IAAIjH,EAAI,EACJ2S,EAAOvD,KAAKmT,KAAKnT,KAAK8f,KAAKnhB,EAAQpM,SACnCwtB,EAAQ,GACZ,IAAK,MAAM9mB,KAAU0F,EACjBohB,EAAM9mB,GAAUrI,EAAE0J,SAAS,GAAG0lB,SAASzc,EAAM,KAC7C3S,GAAK,EAET+N,EAAUohB,EAEV,IAAIxrB,EAAQ0O,MAAMlS,UAAUwJ,IAAIjL,KAAKgI,EAAK/C,MAAOrD,GAAKyN,EAAQzN,IAAIsJ,KAAK,IAEnEylB,EAAe,GACfzV,EAAM,GAEV,SAASrN,EAAIkiB,EAAYpmB,EAAQinB,EAAUvlB,EAAOT,QACtB5G,IAApBkX,EAAI6U,KACJ7U,EAAI6U,GAAc,SACU/rB,IAA5BkX,EAAI6U,GAAYpmB,KAChBuR,EAAI6U,GAAYpmB,GAAU,CAACA,OAAQ0B,EAAOT,KAAMA,EAAMlB,MAAOknB,GAC7DD,EAAaxoB,KAAK,CAAC4nB,EAAYpmB,EAAQ0B,EAAOT,EAAMgmB,KAK5D,IAAK,MAAMb,KAAc/nB,EAAKa,MACK,OAA3Bb,EAAKa,MAAMknB,KACX7U,EAAI6U,GAAc,MAG1B,IAAK,MAAOA,EAAYc,EAAYlhB,KArFxC,UAAuB3H,GACnB,IAAK,MAAM+nB,KAAc/nB,EAAKa,MAC1B,IAAK,MAAOmnB,EAAergB,KAAWpP,OAAO6a,QAAQpT,EAAKa,MAAMknB,IAAe,IAC3E,IAAK,MAAMpmB,KAAUsmB,EAAeD,QAC1B,CAACD,EAAYpmB,EAAQgG,GAiFQmhB,CAAa9oB,GAAO,CAE/D,IAAI2B,EAAS0F,EAAQwhB,IAChBlnB,OAAQonB,EAAWrnB,MAAOknB,EAAQ,KAAEhmB,GAAQ+E,EACjDihB,EAAWA,GAAYb,EACvBgB,EAAYA,GAAaF,EACzB,IAAIxlB,EAAQgE,EAAQ0hB,GAEpBljB,EAAIkiB,EAAYpmB,EAAO,GAAI,GAAGomB,KAAcpmB,EAAO,KAAMA,EAAO,GAAI,KAEpE,IAAK,IAAI9J,EAAI,EAAGA,EAAIoU,EAAO,IAAKpU,EAC5BgO,EACI,GAAGkiB,KAAcpmB,EAAOyE,MAAM,EAAGvO,KAAM8J,EAAO9J,GAC9C,GAAGkwB,KAAcpmB,EAAOyE,MAAM,EAAGvO,EAAE,KAAM8J,EAAO9J,GAChD,KAGRgO,EACI,GAAGkiB,KAAcpmB,EAAOyE,MAAM,GAAI,KAAMzE,EAAOA,EAAO1G,OAAO,GAC7D,GAAG8sB,KAAcpmB,IAAUA,EAAOA,EAAO1G,OAAO,GAChD,KAEJ4K,EACI,GAAGkiB,KAAcpmB,IAAUA,EAAOA,EAAO1G,OAAO,GAChD,GAAG2tB,KAAYhmB,KAAQS,IAAS1B,EAAOA,EAAO1G,OAAO,GACrD,KAGJ,IAAK,IAAIpD,EAAIoU,EAAO,EAAGpU,EAAI,IAAKA,EAC5BgO,EACI,GAAG+iB,KAAYhmB,KAAQS,EAAM+C,MAAM,EAAGvO,EAAI,KAAM8J,EAAO9J,GACvD,GAAG+wB,KAAYhmB,KAAQS,EAAM+C,MAAM,EAAGvO,KAAMwL,EAAMxL,GAClD,KASR,GANAgO,EACI,GAAG+iB,KAAYhmB,KAAQS,EAAM,KAAM1B,EAAO,GAC1C,GAAGinB,KAAYhmB,IAAQS,EAAM,GAC7B,KAGS,MAATT,EAAc,CACdiD,EACI,GAAG+iB,KAAYhmB,IAAQS,EAAM,GAC7B,GAAGulB,KAAYhmB,UAAaqJ,IAAQ5I,EAAM,GAC1C,KAEJ,IAAK,IAAIxL,EAAIoU,EAAMpU,EAAI,IAAKA,EACxBgO,EACI,GAAG+iB,KAAYhmB,UAAa/K,IAAKwL,EAAM4I,EAAOpU,GAC9C,GAAG+wB,KAAYhmB,UAAa/K,EAAI,IAAKwL,EAAM4I,EAAOpU,GAClD,KAGRgO,EACI,GAAG+iB,KAAYhmB,WAAkBS,EAAM4I,EAAO,GAC9C,GAAG2c,EAAYvlB,EAAM4I,EAAO,GAC5B,UAED,GAAa,MAATrJ,EACPiD,EACI,GAAG+iB,KAAYhmB,IAAQS,EAAM,GAC7B,GAAGulB,EAAYvlB,EAAM,GACrB,UAED,GAAa,MAATT,EAAc,CACrBiD,EACI,GAAG+iB,KAAYhmB,IAAQS,EAAM,GAC7B,GAAGulB,KAAYhmB,UAAaqJ,IAAQ5I,EAAM,GAC1C,KAEJwC,EACI,GAAG+iB,KAAYhmB,UAAaqJ,IAAQ5I,EAAM,GAC1C,GAAGulB,KAAYhmB,UAAaqJ,EAAK,IAAK5I,EAAM,GAC5C,KAEJ,IAAK,IAAIxL,EAAIoU,EAAO,EAAGpU,EAAI,IAAKA,EAC5BgO,EACI,GAAG+iB,KAAYhmB,UAAa/K,IAAK,EACjC,GAAG+wB,KAAYhmB,UAAa/K,EAAE,IAAK,EACnC,KAEJgO,EACI,GAAG+iB,KAAYhmB,UAAa/K,IAAK,EACjC,GAAG+wB,KAAYhmB,UAAa/K,EAAE,IAAK,EACnC,KAGRgO,EAAI,GAAG+iB,KAAYhmB,WAAe,EAAG,GAAGgmB,EAAY,EAAG,KACvD/iB,EAAI,GAAG+iB,KAAYhmB,WAAe,EAAG,GAAGgmB,EAAY,EAAG,KAEb,OAA1CD,EAAaA,EAAa1tB,OAAS,IACnC0tB,EAAaxoB,KAAK,MAG1B,IAAI6oB,EAAU,CACV/rB,MAAOA,EACPgD,MAAO,EACPM,MAAO,IACP2B,WAAYlC,EAAKkC,WACjBrB,MAAOqS,EACPzS,IAAK,CAACS,OAAQ,GAAIC,KAAM,GAAIL,OAAQ,GAAImoB,EAAG,KAI/C,IAAItV,EAAOpb,OAAO6a,QAAQ/L,GAASihB,KADhB,CAAC5tB,EAAGC,IAAM4W,SAAS7W,EAAE,GAAGO,OAAQ,GAAKsW,SAAS5W,EAAE,GAAGM,OAAQ,IAC1BgI,IAAI,EAAEimB,EAAKhxB,KAAO,KAAKgxB,EAAI1S,QAAQ,IAAK,UAAUte,OAAOgL,KAAK,MAC5G,OACFimB,EAAgBzgB,KAAKkC,OAAO+d,EAAa1lB,IAAInI,GAAKA,EAAIA,EAAE,GAAGG,OAAS,IAGxE,OAFA0Y,GAAQgV,EAAa1lB,IAAInI,GAAMA,EAAQ,GAAGA,EAAE,GAAGsuB,OAAOD,MAAkBruB,EAAE,SAASA,EAAE,MAAMA,EAAE,MAAMA,EAAE,KAAlE,IAAwEoI,KAAK,MAEzG,CAAC8lB,EAAS,KAAMrV,GAW3Bhc,EAAQ+Y,gBAAkB,CACtB,UA/QJ,SAA6B1Q,EAAMmS,GAC/B,GAAmB,IAAfnS,EAAKC,MACL,MAAM,IAAIwQ,EAAY,2CAE1B,IAAK/T,WAAY2sB,EAAgB,cAAE1sB,GAAiBoS,EAASrW,IAAI,cAE5D4wB,GAAOnX,EAAUkX,GAAkB,IAEnChiB,EAASygB,GAAUD,EAAsB7nB,GAC1CupB,EAAe,GACnB,IAAK,MAAMxB,KAAc/nB,EAAKa,MACK,OAA3Bb,EAAKa,MAAMknB,IACXwB,EAAappB,KAAK4nB,GAE1B1gB,EAAQihB,OAERjhB,EAAU6gB,EAAM7gB,EAASrH,EAAKO,MAAO,KACrCunB,EAASI,EAAMJ,EAAQ9nB,EAAKkC,WAAY,KACxC,IAIIsnB,EAJA5mB,EAAO,CAAC,EAAK,IAAK,EAAK,KAAM,EAAK,MAAO6mB,KAAM,MAAOztB,UAAW,OAEjE2sB,EAAe,IACfe,EAAa,IAAM5B,EAAO9nB,EAAKkC,YAGnC,IAAK,MAAM6lB,KAAc/nB,EAAKa,MAC1B,IAAK,MAAOmnB,EAAergB,KAAWpP,OAAO6a,QAAQpT,EAAKa,MAAMknB,IAAe,IAC3E,IAAK,MAAMpmB,KAAUsmB,EAAeD,GAChCW,GAAgBthB,EAAQ1F,GACxBgnB,GAAgBb,EAAOC,GACvBY,GAAgBthB,EAAQM,EAAOhG,QAAUgG,EAAOhG,OAAO,IAAMA,GAC7DgnB,GAAgBb,EAAOngB,EAAOjG,OAASqmB,GACnCwB,EAAa5jB,SAASgC,EAAOjG,OAC7BinB,GAAgB,OAEhBA,GAAgB/lB,EAAK+E,EAAO/E,MAI5C4mB,EAAY7d,MAAMlS,UAAUwJ,IAAIjL,KAAKgI,EAAK/C,MAAO0E,GAAU0F,EAAQ1F,IAASuB,KAAK,KACjFsmB,EAAY,KAAOA,EAAY,IAE/BF,EAAIrsB,MAAQ,CACR0rB,EACAe,EACAF,GAGJ,MAAMG,EAAY,CAACjvB,EAAGC,IAAMD,EAAE,GAAGO,OAASN,EAAE,GAAGM,OAC/C,IAAIkuB,EAAgBzgB,KAAKkC,OAAOrS,OAAO4E,KAAK2qB,GAAQ7kB,IAAInI,GAAKA,EAAEG,SAC/DouB,EAAmBA,EAAiB7oB,MAAM,MAC1C,IAAIopB,EAAcP,EAAiBQ,UAAUjwB,GAAKA,EAAEkwB,WAAW,WAW/D,OAVAT,EAAiBtV,OACb6V,EAAc,EACd,KACGN,EAAIrsB,MAAMgG,IAAInI,GAAK,QAAQA,SAC3BvC,OAAO6a,QAAQ/L,GAASihB,KAAKqB,GAAW1mB,IAAI,EAAEimB,EAAKvV,KAAU,SAASuV,EAAI1S,QAAQ,IAAK,UAAU7C,OACpG,aACGpb,OAAO6a,QAAQ0U,GAAQQ,KAAKqB,GAAW1mB,IAAI,EAAEvB,EAAOiS,KAAU,SAASjS,EAAMgnB,SAASS,QAAoBxV,QAEjH0V,EAAmBA,EAAiBnmB,KAAK,MAElC,CAAComB,EAAK3sB,EAAe0sB,IAmN5B,SAAYhB,EACZ,WAVJ,SAA8BroB,EAAMmS,GAChC,IAAKe,EAAKvV,EAAKgW,GAAQ0U,EAAmBroB,GAE1C,OADAkT,EAAI3S,MAAQ,IACL,CAAC2S,EAAKvV,EAAKgW,M,gBC7StB,IAAI1Q,EAAM,CACT,mBAAoB,GACpB,mBAAoB,GACpB,yBAA0B,GAC1B,oBAAqB,GACrB,qBAAsB,GACtB,qBAAsB,GACtB,gBAAiB,GACjB,sBAAuB,GACvB,4BAA6B,GAC7B,oBAAqB,GACrB,4BAA6B,GAC7B,2BAA4B,GAC5B,mBAAoB,GACpB,oBAAqB,GACrB,qBAAsB,GACtB,kBAAmB,GACnB,mBAAoB,GACpB,mBAAoB,IAIrB,SAAS8mB,EAAeC,GACvB,IAAInb,EAAKob,EAAsBD,GAC/B,OAAOvyB,EAAoBoX,GAE5B,SAASob,EAAsBD,GAC9B,IAAIvyB,EAAoBa,EAAE2K,EAAK+mB,GAAM,CACpC,IAAI9gB,EAAI,IAAI3O,MAAM,uBAAyByvB,EAAM,KAEjD,MADA9gB,EAAEyK,KAAO,mBACHzK,EAEP,OAAOjG,EAAI+mB,GAEZD,EAAe5sB,KAAO,WACrB,OAAO5E,OAAO4E,KAAK8F,IAEpB8mB,EAAejQ,QAAUmQ,EACzBryB,EAAOD,QAAUoyB,EACjBA,EAAelb,GAAK,I,cCvCpBjX,EAAOD,QAAU,wF,cCAjBC,EAAOD,QAAU,mkE,cCAjBC,EAAOD,QAAU,+8B,cCAjBC,EAAOD,QAAU,26G,cCAjBC,EAAOD,QAAU,uqD,cCAjBC,EAAOD,QAAU,8tD,cCAjBC,EAAOD,QAAU,mjC,cCAjBC,EAAOD,QAAU,ghD,cCAjBC,EAAOD,QAAU,+3C,cCAjBC,EAAOD,QAAU,0gD,cCAjBC,EAAOD,QAAU,4hD,cCAjBC,EAAOD,QAAU,yxC,cCAjBC,EAAOD,QAAU,mf,cCAjBC,EAAOD,QAAU,+wC,cCAjBC,EAAOD,QAAU,oqD,cCAjBC,EAAOD,QAAU,q0B,cCAjBC,EAAOD,QAAU,+2C,cCAjBC,EAAOD,QAAU,2+X,6BCGjB,IAAIqY,EAAkB,EAAQ,IAAaA,gBACvCkE,EAAa,EAAQ,IACrBra,EAAK,EAAQ,GACbyE,EAAW,EAAQ,GAAaA,SAgBpC,SAASqgB,EAAanE,GACpB,IAAIwE,EAAOxE,EAAKwE,KACZhS,EAAQwN,EAAKxN,OAASgS,EACtByB,EAAgBjG,EAAKiG,cACrBpR,EAAiBmL,EAAKnL,eAE1B,IAAK2P,EACH,MAAM,IAAI/iB,UAAU,iDACf,IAAKwkB,EACV,MAAM,IAAIxkB,UAAU,mDAElBue,EAAK0P,aACPrrB,KAAK2hB,mBAAqBhG,EAAK0P,YAEjCrrB,KAAKmgB,KAAOA,EACZngB,KAAKmO,MAAQA,EACbnO,KAAKmO,MAAM+P,UAAY,GACvBle,KAAKsrB,gBAAkB1J,EAGvB5hB,KAAKurB,QAAU,IAAIC,EAAa5J,EAAgB,SAChD5hB,KAAKyrB,SAELzrB,KAAK0rB,YAAY1rB,KAAK2rB,wBAA0Bnb,GAGhD,IAAI9N,EAAO1C,KACXA,KAAKmgB,KAAK5O,iBAAiB,UAAU,WACnC7O,EAAK4a,SAAS5a,EAAKye,gBAAiB,CAAChJ,KAAM,YAI7ChH,EAAgBE,oBAAmB,SAAUhH,GAC3C,IAAI+F,EACAwb,EAAQC,EAERxhB,EAAE9P,MAAQmI,EAAK6oB,QAAQO,YAEzBppB,EAAK6oB,QAAQQ,WACbrpB,EAAK+oB,WACMrb,EAAQiF,EAAWiB,qBAAqBjM,EAAE9P,QAErDqxB,EAASlpB,EAAKspB,kBAAkB5b,MAG9Bwb,EAAOjI,WAAWsI,aAChBJ,EAAYnpB,EAAKif,mBAAmB,IAAItM,EAAWjF,IACnDwb,GAEFC,EAAUK,SAAWN,EAAOM,SAC5BlxB,EAAG2F,OAAOkrB,GAAW5mB,MAAOjK,EAAG2F,OAAOirB,GAAQ3mB,aA8ItD,SAASumB,EAAaM,GACpB9rB,KAAK8rB,WAAaA,EAClB9rB,KAAK+rB,WA1IPryB,OAAOgL,iBAAiBob,EAAallB,UAAW,CAC9CwoB,cAAe,CACbvpB,IAAK,WACH,OAAOmG,KAAKmgB,KAAKgM,QAAQnsB,KAAKmgB,KAAKiM,gBAErCxyB,YAAY,GAEdunB,gBAAiB,CACftnB,IAAK,WACH,IAAIwyB,EAAMrsB,KAAKojB,cACf,OAAOiJ,EAAM,IAAIhX,EAAWgX,EAAIpyB,OAAS,MAE3CL,YAAY,KAIhBkmB,EAAallB,UAAU6wB,OAAS,WAC9B,IAAIa,EAAetsB,KAAKojB,cAAgBpjB,KAAKojB,cAAcnpB,MAAQ,KAE/D2xB,EAAS5wB,EAAG2F,OAAOX,KAAKmO,OAAOtI,UAAU,UAC1CC,KAAK9F,KAAKurB,QAAQlb,MAAM,SAAUkc,GAAS,OAAOA,EAAMvc,MAE3D4b,EAAO1lB,OAAOpC,SAEd,IAAIpB,EAAO1C,KACX4rB,EAAO5lB,QAAQoB,QAAO,SAAUmlB,GAC9B,OAAO7pB,EAAKif,mBAAmB,IAAItM,EAAWkX,EAAMvc,QAIlDhQ,KAAKojB,cAAcnpB,QAAUqyB,IAE1BtsB,KAAK0rB,YAAY1rB,KAAK2rB,uBAAwB,CAACxT,KAAM,YAExDnY,KAAKsd,SAAStd,KAAKmhB,gBAAiB,CAAChJ,KAAM,aAMjD2H,EAAallB,UAAUoxB,kBAAoB,SAAU5b,GACnD,OAAOpQ,KAAKmgB,KAAKxZ,cAAc,iBAAmByJ,EAAMuH,QAAQ,KAAM,OAAS,OAIjFmI,EAAallB,UAAU8wB,YAAc,SAAUtb,EAAOyR,GACpD,IACE7hB,KAAKgsB,kBAAkB5b,GAAO8b,UAAW,EACzC,MAAO7hB,GACP,OAAO,EAGT,OADArK,KAAKsd,SAAStd,KAAKmhB,gBAAiBU,IAC7B,GAIT/B,EAAallB,UAAUgqB,iBAAmB,WACxC,IAAIxU,EAAQpQ,KAAKojB,eAAiBpjB,KAAKojB,cAAcnpB,MACjDmW,GACFe,EAAgB3M,MAAMxE,KAAKsrB,gBAAkB,gBAAiBlb,IAKlE0P,EAAallB,UAAU+wB,qBAAuB,WAC5C,OAAOxa,EAAgBtM,KAAK7E,KAAKsrB,gBAAkB,kBAKrDxL,EAAallB,UAAU+mB,mBAAqB,SAAU1R,GACpD,IAAI2b,EAASvwB,SAAS6gB,cAAc,UAGpC,OAFA0P,EAAO3xB,MAAQgW,EAAID,GACnB4b,EAAO1mB,KAAO+K,EAAI1W,MAAQ,WACnBqyB,GAQT9L,EAAallB,UAAU0iB,SAAW,aAMlCwC,EAAallB,UAAU4xB,UAAY,SAAUvc,EAAK4R,GAChD,IAAI+J,EAAS5rB,KAAK2hB,mBAAmB1R,GAMrC,OALAjQ,KAAKmO,MAAMse,aAAab,EAAQ5rB,KAAKmO,MAAMue,YACvC7K,GAAQA,EAAKlhB,SACfX,KAAKmgB,KAAKiM,cAAgBR,EAAOthB,MACjCtK,KAAKsd,SAASrN,EAAK4R,IAEd5R,GAKT6P,EAAallB,UAAU+nB,YAAc,SAAUd,GAC7C,OAAO7hB,KAAKwsB,UAAUxsB,KAAKurB,QAAQ5I,cAAeljB,EAAS,CAAC0Y,KAAM,QAAS0J,KAK7E/B,EAAallB,UAAUwlB,UAAY,SAAUnQ,EAAK4R,GAChD,OAAO7hB,KAAKwsB,UAAUxsB,KAAKurB,QAAQnL,UAAUnQ,GAAMxQ,EAAS,CAAC0Y,KAAM,aAAc0J,KAGnF/B,EAAallB,UAAU0oB,OAAS,SAAU/pB,GACxCyG,KAAKmhB,gBAAgB5nB,KAAOA,EAC5ByG,KAAKojB,cAAcle,KAAO3L,GAK5BumB,EAAallB,UAAUyb,OAAS,SAAUwL,GACxC7hB,KAAKmhB,gBAAgB9K,SACrB,IAAI/L,EAAQtK,KAAKmgB,KAAKiM,cAClBO,EAAiB3sB,KAAKurB,QAAQqB,YAAYtiB,GAM9C,OALIqiB,IACF3sB,KAAKojB,cAActf,SACnB9D,KAAKmgB,KAAKiM,cAAgB9hB,EAC1BtK,KAAKsd,SAAStd,KAAKmhB,gBAAiB1hB,EAAS,CAAC0Y,KAAM,UAAW0J,KAE1D8K,GAgBTnB,EAAaqB,MAAQ,WACnB,OAAOlxB,OAAOmxB,KAAKC,QAIrBvB,EAAa5wB,UAAUoM,IAAM,SAAUoJ,GACrCpQ,KAAKgtB,OAAOtD,QAAQ,CAAC1Z,GAAII,IACzBpQ,KAAKitB,aAEPzB,EAAa5wB,UAAUmxB,SAAW,WAChC/rB,KAAKgtB,OAAS5Z,KAAKwD,MAAMzF,EAAgBtM,KAAK7E,KAAK8rB,cAAgB,IAErEN,EAAa5wB,UAAUqyB,UAAY,WACjC9b,EAAgB3M,MAAMxE,KAAK8rB,WAAY1Y,KAAKC,UAAUrT,KAAKgtB,UAG7DxB,EAAa5wB,UAAU+nB,YAAc,WACnC,IAAIkK,EAAQrB,EAAaqB,QAEzB,OADA7sB,KAAKgH,IAAI6lB,GACF,IAAIxX,EAAWwX,IAGxBrB,EAAa5wB,UAAUwlB,UAAY,SAAUnQ,GAC3C,OAAOjQ,KAAK2iB,cAAcxM,SAASlG,IAQrCub,EAAa5wB,UAAUgyB,YAAc,SAAUtiB,GAC7C,IAAI4iB,EAAUltB,KAAKgtB,OAAO9X,OAAO5K,EAAO,GAExC,OADAtK,KAAKitB,YACGC,EAAQ9wB,OAAS,GAG3B1C,OAAOgL,iBAAiB8mB,EAAa5wB,UAAW,CAC9CyV,KAAM,CACJxW,IAAK,WAAc,OAAOmG,KAAKgtB,QAC/BpzB,YAAY,KAIhBb,EAAOD,QAAUgnB,G,6BCrQjB,IAAIxI,EAAI,EAAQ,GAEhB,SAAS3L,EAAS1P,GAAK,OAAOA,EAC9B,SAASkxB,EAAK5wB,GAAS,OAAOA,EAAM,GASpC,SAAS2a,EAAcyE,GACrB3b,KAAKgC,MAAQ2Z,EAAK3Z,MAClBhC,KAAKotB,UAAYptB,KAAKgC,MAAMR,OAAO,SAASA,OAAO,MACnDxB,KAAKqtB,MAAQrtB,KAAKgC,MAAMR,OAAO,SAE/B,IAAIkB,EAAO1C,KACXA,KAAKstB,eAAiBttB,KAAKotB,UACxB5rB,OAAO,MACLC,KAAK,QAAS,iBAChBD,OAAO,SACLC,KAAK,OAAQ,YACbiM,GAAG,SAA8B,WAChChL,EAAK6qB,gBAAgB5yB,SAAS,UAAWqF,KAAKwtB,SAC9C9qB,EAAK4a,cAEXhG,EAAEtX,KAAKqtB,MAAM1d,QAAQjC,GAAG,QAAS,MAAqB,SAAUrD,GAE9D,GAAyB,UAArBA,EAAE5B,OAAOmT,QAAqB,CAChC,IAAI6R,EAAMztB,KAAK2G,cAAc,0BAC7B8mB,EAAID,SAAWC,EAAID,QAGrB9qB,EAAKgrB,UACLhrB,EAAK4a,cAGP3B,EAAKlC,SAAWzZ,KAAK2tB,WAAWhS,EAAKlC,SACrCkC,EAAK7V,MAAQ9F,KAAK4tB,QAAQjS,EAAK7V,MAOjCoR,EAActc,UAAU+yB,WAAa,SAAUlU,GAC7C,IAAIoU,EAAK7tB,KAAKotB,UACXvnB,UAAU,0BACRC,KAAK2T,GACVoU,EAAG3nB,OAAOpC,SACV+pB,EAAG7nB,QAAQxE,OAAO,MAClBqsB,EAAG3oB,KAAKyG,IAWVuL,EAActc,UAAUgzB,QAAU,SAAU9nB,GAC1C,IAAIgoB,EAAK9tB,KAAKqtB,MAAMxnB,UAAU,MACzBC,KAAKA,EAAMqnB,GAChBW,EAAG5nB,OAAOpC,SACVgqB,EAAG9nB,QACAxE,OAAO,MAEPA,OAAO,MACLC,KAAK,QAAS,iBAChBD,OAAO,SACLC,KAAK,CACJ0W,KAAM,WACNle,MAAOkzB,IAEbW,EAAGC,QAEH,IAAIrU,EAAKoU,EAAGjoB,UAAU,0BACjBC,KAAK6F,GAKV,OAJA+N,EAAGxT,OAAOpC,SACV4V,EAAG1T,QAAQxE,OAAO,MAClBkY,EAAGxU,KAAKyG,GAED3L,MAGTkX,EAActc,UAAU2yB,cAAgB,WACtC,OAAOvtB,KAAKqtB,MAAMxnB,UAAU,2BAG9BqR,EAActc,UAAUwiB,iBAAmB,WACzC,OAAOpd,KAAKqtB,MAAMxnB,UAAU,kCAAkC,GAC3DzB,KAAI,SAAUnI,GAAK,OAAOA,EAAEhC,UAGjCid,EAActc,UAAU4iB,eAAiB,WACvC,IAAIwQ,EAAYhuB,KAAKstB,eAAe3d,OACpC,QAASqe,EAAUR,SAAWQ,EAAUC,gBAM1C/W,EAActc,UAAU8yB,QAAU,WAChC,IAAIM,EAAYhuB,KAAKstB,eAAe3d,OAChCue,EAAQluB,KAAKutB,gBAEbY,EAAQD,EAAM9gB,OACdogB,EAAUU,EAAMjZ,OAAO,YAAY7H,OACvB,IAAZogB,EACFQ,EAAUR,SAAU,EACXA,IAAYW,IACrBH,EAAUR,SAAU,GAEtBQ,EAAUC,cAAiB,EAAIT,GAAWA,EAAUW,GAItDjX,EAActc,UAAU0iB,SAAW,aAGnCvkB,EAAOD,QAAUoe,G,6BC3HjB,IAAIvF,EAAU,EAAQ,IAsBtB7Y,EAAQqiB,WAlBR,WACE,IAAIQ,EAAOyS,UACX,OAAO,IAAIzc,GAAQ,SAAUsJ,EAAS8D,EAAQC,GAC5C,IAAIqP,EAAS,IAAIC,WACjBD,EAAO9c,iBAAiB,QAAQ,WAC9B0J,EAAQoT,EAAO7xB,WAEjB6xB,EAAO9c,iBAAiB,SAAS,WAC/BwN,EAAOsP,EAAOhU,UAEhB2E,GAAYA,GAAS,WACnB,IAAMqP,EAAOjP,QAAW,MAAO/U,QAGjCgkB,EAAOlT,WAAWoT,MAAMF,EAAQ1S,Q,6BClBpC,IAAI6S,EAAY,EAAQ,IACpBpX,EAAS,EAAQ,GACjBnc,EAAI,EAAQ,GACZD,EAAK,EAAQ,GAgEjB,SAASyzB,IACP,OAAOzzB,EAAG2F,OAAOtF,SAAS6gB,cAAc,WACnCza,KAAK,CAAC2W,MAAO,QAAS,aAAc,UACpCO,KAAK,2CACPhJ,OA0EL7W,EAAQ+nB,KA1IR,SAAclF,GACZ,IAAItD,EAAUsD,EAAKtD,QACfyI,EAAanF,EAAKmF,WAClBH,EAAahF,EAAKgF,WAEtB,SAAS+N,IACPrW,EAAQU,MAAM,QAKd,IAAI4V,EAAahO,EAAW7I,WAC5BO,EAAQC,IAAI,mBAAmB,WACzBqW,EAAW5nB,UAAU6nB,SAAS,OAChCvzB,SAASuhB,KAAK7V,UAAUC,IAAI,iBAMlC8Z,EAAWvP,iBAAiB,UAAU,SAAUlH,GAC9CA,EAAE2Y,iBACF0L,IAEA,IAAI1S,EAAS8E,EAAWna,cAAc,sBAAsB1M,MAC5Du0B,EAAUzQ,WAAW9iB,EAAEsO,OAAO,CAACyS,OAAQA,GAAS2E,OAIjD,WAEC,IAAIkO,EAAYxzB,SAASsL,cAAc,mCAEnCmoB,EAAYD,EAAUloB,cAAc,sBAChBtL,SAAS2kB,eAAe,qBAC9BzO,iBAAiB,SAAS,WAC1Cmd,IACAF,EAAUxQ,iBAAiB/iB,EAAEsO,OAAO,CAACqR,MAAOkU,EAAUlU,OAAQ+F,OAGhE,IAAIa,EAAWqN,EAAUloB,cAAc,YACnCooB,EAAuB1zB,SAAS2kB,eAAe,wBACnD+O,EAAqBpL,WAAW5iB,MAAMoL,SAAW,WACjD4iB,EAAqBxd,iBAAiB,SAAS,SAAUlH,GAgF7D,IAAgCwX,EAAM3G,EAChCmK,EACA/I,EAEAjC,EAJ0BwH,EA9ExB,CAAEwD,WAAY,CAAChH,OAAQhU,EAAE5B,OAAOkb,WAAY7P,QAAS+a,GACnDvS,eAAgBqE,EAAWrE,gBA6ECpB,EA5E9BsG,EAASvnB,MA6EXorB,EAAaxD,EAAKwD,WAClB/I,EAAiBuF,EAAKvF,eAEtBjC,EAAS,WACX,IACEiC,EAAelF,EAAO7X,cAAc2b,IACpC,MAAO7Q,GACP,OAAOA,GAJC,GA1Dd,SAAkCgb,EAAYhL,GAC5C,IAAI2U,EAAkBh0B,EAAG2F,OAAO0kB,EAAWhH,QACvC4Q,EAAmBj0B,EAAG2F,OAAO0kB,EAAWvR,SAC5Ckb,EAAgBnpB,UAAU,kBAAkB/B,SAC5CmrB,EAAiBppB,UAAU,UAAU/B,SACrC,IAAIua,EAAS2Q,EAAgBxtB,OAAO,QAC/BC,KAAK,CAACwY,KAAM,UACZlZ,MAAM,CACLoL,SAAU,WAAYE,KAAM,EAAG1G,MAAO,MACtCyG,IAAK,MAAOwI,UAAW,qBA2B7B,GAAIyF,EAAO,CACT,IAAI6U,EAxBN,WACE,IAAIpb,EAAUmb,EAAiBztB,OAAO,OACjCC,KAAK,CAACwY,KAAM,QAAS7B,MAAO,uBAC5BrX,MAAM,aAAc,OAMzB,GALA+S,EAAQtS,OAAOitB,GACVhtB,KAAK,eAAgB,SACrBiM,GAAG,SAAS,WACX2Q,EAAOva,YAETuW,aAAiBjD,EAAOjX,cAC1B2T,EAAQtS,OAAO,MAAM0D,KAAK,kBAC1B4O,EAAQtS,OAAO,OAAO0D,KAAKmV,EAAMta,aAC5B,MAAIsa,aAAiBjD,EAAOvX,sBAMjC,OAFAiU,EAAQtS,OAAO,MAAM0D,KAAK,oBAC1B4O,EAAQtS,OAAO,OAAO0D,KAAKvJ,OAAO0e,IAC3B,gBALPvG,EAAQtS,OAAO,QACV0D,KAAKmV,EAAMta,QAAQ4X,QAAQ,OAAQ,MAM1C,MAAO,uBAIawX,GACpB9Q,EAAO5c,KAAK,CAAC2W,MAAO,gBACfO,KAAK,iFACIuW,QAEd7Q,EAAO5c,KAAK,CAAC2W,MAAO,iBACfO,KAAK,oFAEP7X,aACEsuB,MAAM,MACN1uB,SAAS,KACTK,MAAM,UAAW,GACjB+C,SAgBPurB,CAAyBhK,EAAYhL,GACpB,MAATA,GAtFFmH,EAAS7gB,YApBf,K,6BCpCF,IAAIyW,EAAS,EAAQ,GACjBuI,EAAa,EAAQ,IAAUA,WAC/B2P,EAAY,EAAQ,IACpBhY,EAAI,EAAQ,GAGZiY,GACDh0B,OAAOi0B,cAAgB,aAAcn0B,SAAS6gB,cAAc,KAG3DuT,EAAqB,WACvB,IACE,OAAOp0B,SAASq0B,sBAAsB,QACtC,MAAOrlB,GACP,OAAO,GAJa,GASxB,SAASslB,EAAiBxR,GACxBA,EAAQ5M,iBAAiB,SAAS,SAAmBlH,GACnDA,EAAE5B,OAAO9H,YAGXwd,EAAQ5M,iBAAiB,WAAW,SAAUlH,GAC5CA,EAAE2Y,oBA+BN,SAAS4M,EAAatjB,EAAWujB,EAAQ1V,EAAU2V,GACjD,IAAIC,EAAgBF,EAAOjpB,YAC3BipB,EAAOjpB,YAAc,WACrBipB,EAAOtS,UAAW,EAElB,IAAIqC,EAAU,CACZhF,MAAO,GACPqB,YAAa,6CACb+T,QAAQ,GAIV,OAFApQ,EAAQhF,MAAMT,GAAY,CAACe,QAAS4U,GAE7BnQ,EAAWC,GAASxE,MAAK,SAAU6U,GAExC,IAAIjgB,EAAKigB,EAASjgB,IAuBtB,SAA2B1D,EAAWkT,GACpClT,EAAU4R,UACR,yOAIF,IAAIgS,EAAW5jB,EAAU3F,cAAc,SACvCupB,EAASj2B,MAAQulB,EACjB0Q,EAAS9iB,KAAOoS,EAAIpjB,OAAS,EAC7BuzB,EAAiBO,GACjBA,EAASjN,QAhCPkN,CAAkB7jB,EAAW,wCAA0C0D,MACtEqL,OAAM,SAAUrH,GAEjB,IAAIjU,EAAW,WACb,IAAIqe,EAAMpK,EAAOoK,IACjB,IACE,MAAO,0BAA4BA,EAAIgS,aAAarwB,QAAU,IAC9D,MAAOsK,GACP,OAAI+T,EAAIC,OAAS,EACR,qBAAuBD,EAAIC,OAAS,IAAMD,EAAIE,WAE9C,0EARC,GAYd+R,MAAM,iCAAmCtwB,GAEzC8vB,EAAOtS,UAAW,EAClBsS,EAAOjpB,YAAcmpB,KAkIzBj3B,EAAQ+nB,KAzER,SAAclF,GACZ,IAAItD,EAAUsD,EAAKtD,QACf2I,EAAqBrF,EAAKqF,mBAC1BI,EAAczF,EAAKyF,YACnBC,EAAgB1F,EAAK0F,cACrBC,EAAoB3F,EAAK2F,kBACzBE,EAAW7F,EAAK6F,SAWpB,SAAS8O,IACP,IAGIC,EAGAC,EAhE0BlkB,EA0D1B2D,EAAM+Q,IACN7G,EAAWlK,EAAI1W,KAAO,QACtBu2B,EAAW1Y,EAAO3Y,kBAAkBwR,GAKnCmR,MACHoP,EAASlZ,EACP,wPAIAmZ,UAAUpY,EAAQqY,KAAK,kBAvEGpkB,EA0EL+U,EAzE3B/U,EAAU4R,UACV,uQAKO5R,EAAU3F,cAAc,WAmEW4K,iBAAiB,SAAS,SAAUlH,GAC1EkmB,EAAcX,EAAavO,EAAehX,EAAE5B,OAAQ0R,EAAU2V,MAIhExO,EAAkB3kB,YA/DtB,SAA4Bwd,EAAU2V,GACpC,IAAIhU,EAAOzgB,SAAS6gB,cAAc,KAKlC,GAJAJ,EAAK9B,KAAO,kCAAoC2W,mBAAmBb,GACnEhU,EAAKrT,OAAS,SACdqT,EAAK8U,SAAWzW,EAEZoV,EAGF,OAFAzT,EAAKlV,YAAc,oBACnBkV,EAAK+U,UAAY,kBACV/U,EAEPA,EAAKlV,YAAc,8EACnB,IAAI9L,EAAIO,SAAS6gB,cAAc,KAG/B,OAFAphB,EAAEojB,UAAY,0DACdpjB,EAAE2xB,aAAa3Q,EAAMhhB,EAAE4xB,YAChB5xB,EAgDuBg2B,CAAmB3W,EAAU2V,IAE3DtO,EAASvnB,MAAQ61B,EAEjB,IAAIiB,EAAY,IAAIzB,EAAU,2BAO9B,OANAyB,EAAUrjB,GAAG,WAAW,SAAUrD,GAvJtC,IAA2B8T,EARG6S,EAAU7E,EAQbhO,EAwJH9T,EAAE4mB,QAhKID,EASP1Z,EAAE6G,GATegO,EASL,CAAC5S,MAAO,UAAW2X,UAAW,UAR/DF,EAASG,QAAQhF,GACdgF,QAAQ,QACR7Y,IAAI,qBAAqB,WACxB0Y,EAASG,QAAQ,cA6JjB9mB,EAAE+mB,oBAIG,WACL,GAAIb,EACF,IAAMA,EAAYzS,SAAY,MAAOzT,IAEnCmmB,GAAUA,EAAO1sB,SACrBud,EAAcza,YAAc,GAC5B0a,EAAkB1a,YAAc,GAChC4a,EAASvnB,MAAQ,GACjB82B,EAAUM,WAlDV9B,GACFlX,EAAQiZ,SAAS,iBAEd7B,GACHpX,EAAQiZ,SAAS,kBAEnBjQ,EAAcwP,UAAY,yBAC1BlB,EAAiBnO,GA+CjBnJ,EAAQ3K,GAAG,iBAAiB,WAC1B,IAAI6jB,EAAUjB,IACdjY,EAAQC,IAAI,kBAAmBiZ,MAEjClZ,EAAQ3K,GAAG,kBAAkB,WAG3B8T,EAASgQ,kBAAkB,EAAE,Q,cC1NjCz4B,EAAOD,QAAUw2B,W,6BCKjB,IAAIt0B,EAAK,EAAQ,GAEjB,SAAS2Q,EAAS1P,GAAK,OAAOA,EA8B9B,SAASw1B,EAAcl3B,GACrB,OAAQA,GACN,IAAK,UAAW,MAAO,MACvB,IAAK,SAAW,MAAO,MACvB,IAAK,KAAW,MAAO,IACvB,IAAK,OAAW,MAAO,IACvB,IAAK,OAAW,MAAO,IACvB,IAAK,QAAW,MAAO,IACvB,QAAgB,OAAOA,GAuC3B,IAAIga,EAAU,CACZ,CACE,CAAEhb,KAAM,OAAQ0D,KAAM,uEACrB,CACD,CAAE1D,KAAM,gBAAiB0D,KAAM,kBAC/B,CAAE1D,KAAM,SAAU0D,KAAM,oBACxB,CAAE1D,KAAM,UAAW0D,KAAM,uBACxB,CACD,CAAE1D,KAAM,cAAe0D,KAAM,gBAC7B,CAAE1D,KAAM,gBAAiB0D,KAAM,kBAC/B,CAAE1D,KAAM,qBAAsB0D,KAAM,6BACnC,CACD,CAAE1D,KAAM,kBAAmB0D,KAAM,wGACjC,CAAE1D,KAAM,OAAQ0D,KAAM,QACtB,CAAE1D,KAAM,UAAW0D,KAAM,sBAK7BnE,EAAQ4rB,KAhCR,SAAcP,EAAUniB,GACtB,IAAI0vB,EAfN,SAA0BvN,GACxB,IAAIwN,EAAWxN,EAASwN,SAEpBC,EAA2B,QAAbD,EAAqBhmB,EAAW,SAAUpR,GAC1D,MAAgB,QAARA,EAAiB,SAAWA,GAGtC,OAAO,SAAoBhB,GACzB,OAAO4qB,EAASA,SAAS5qB,GAAM8qB,QAAQsN,GAAUhwB,MAAM,KAAKyC,IAAIwtB,IAOjDC,CAAiB1N,GAElC,OA3DF,SAAqBre,EAAM9D,GACzB,IAAIqrB,EAAQryB,EAAG2F,OAAOqB,GAAO6D,UAAU,SAClCC,KAAKA,GACPE,QAAQxE,OAAO,SAWlB,OATS6rB,EAAMxnB,UAAU,MACpBC,KAAK6F,GACP3F,QAAQxE,OAAO,MAEfqE,UAAU,MACRC,KAAK6F,GACP3F,QAAQxE,OAAO,MACbmX,KAAKhN,GAEH0hB,EA6CAyE,CAAYvd,EAAQnQ,KAAI,SAAU+J,GACvC,OAAOA,EAAM/J,KAAI,SAAU9K,GACzB,MAAO,EA1BUgF,EA2BDozB,EAAWp4B,EAAEC,MAAM6K,IAAIqtB,GA1BpCnzB,EAAK8F,KAAI,SAAU7J,GACxB,MAAO,QAAUA,EAAM,YACtB8J,KAAK,MAyBF/K,EAAE2D,MA5BV,IAAuBqB,QA+BjB0D","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/build/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 26);\n","module.exports = d3;","module.exports = _;","module.exports = lodash;","'use strict';\n// misc. utilities\n\n//////////////////////////////////\n// Utilities for null/undefined //\n//////////////////////////////////\n\n// Assert non-null.\n// Return the value if it is not null or undefined; otherwise, throw an error.\nfunction nonNull(value) {\n  if (value == null) {\n    throw new Error('expected a non-null defined value, but got: ' + String(value));\n  }\n  return value;\n}\n\n// Null coalescing: iff the first argument is null or undefined, return the second.\nfunction coalesce(a, b) {\n  return (a != null) ? a : b;\n}\n\n// Apply a function to a value if non-null, otherwise return the value.\n// (Monadic bind for maybe (option) type.)\n// ((a -> b), ?a) -> ?b\nfunction applyMaybe(f, x) {\n  return (x != null) ? f(x) : x;\n}\n\n// Returns the first function result that is not null or undefined.\n// Otherwise, returns undefined.\n// ((a -> ?b), [a]) -> ?b\nfunction getFirst(f, xs) {\n  for (var i = 0; i < xs.length; ++i) {\n    var val = f(xs[i]);\n    if (val != null) {\n      return val;\n    }\n  }\n}\n\n/////////\n// DOM //\n/////////\n\n/* global document */\n\n/**\n * Concat an array of DOM Nodes into a DocumentFragment.\n * @param  {[Node]} array\n * @return {DocumentFragment}\n */\nfunction toDocFragment(array) {\n  var result = document.createDocumentFragment();\n  array.forEach(result.appendChild.bind(result));\n  return result;\n}\n\n///////////////////////\n// IE/Edge detection //\n///////////////////////\n\n// http://stackoverflow.com/a/9851769\nvar isBrowserIEorEdge = /*@cc_on!@*/false\n  || Boolean(document.documentMode) || Boolean(window.StyleMedia); // eslint-disable-line\n\n\nexports.nonNull = nonNull;\nexports.coalesce = coalesce;\nexports.applyMaybe = applyMaybe;\nexports.getFirst = getFirst;\n\nexports.toDocFragment = toDocFragment;\n\nexports.isBrowserIEorEdge = isBrowserIEorEdge;\n","module.exports = jQuery;","'use strict';\n/**\n * Lightweight property assignment watching by overriding getters/setters.\n * Intended as a bridge between plain JS properties and other libraries.\n *\n * Inspired by https://gist.github.com/eligrey/384583, which works for\n * data properties only, this works for both data and accessor properties.\n *\n * 2015-11-21\n * @author Andy Li\n */\n\n/**\n * Watches a property for assignment by overriding it with a getter & setter\n * on top of the previous value or accessors.\n *\n * The handler can intercept assignments by returning a different value.\n * Watching an unwritable/unsettable property does nothing, but trying to watch\n * a non-existent or non-configurable property fails fast with TypeError.\n * @param  {!Object} thisArg The object that contains the property.\n * @param  {String}  prop    The name of the property to watch.\n * @param            handler The function to call when the property is\n *   assigned to. Important: this function intercepts assignment;\n *   its return value is set as the new value.\n * @throws {TypeError} if object is null or does not have the property\n * @throws {TypeError} if thisArg.prop is non-configurable\n * @return {?Object}         The previous property descriptor, or null if the\n *   property is not writable/settable.\n */\nfunction watch(thisArg, prop, handler) {\n  var desc = Object.getOwnPropertyDescriptor(thisArg, prop);\n  // check pre-conditions: existent, configurable, writable/settable\n  if (desc === undefined) {\n    throw new TypeError('Cannot watch nonexistent property \\''+prop+'\\'');\n  } else if (!desc.configurable) {\n    throw new TypeError('Cannot watch non-configurable property \\''+prop+'\\'');\n  } else if (!desc.writable && desc.set === undefined) {\n    return; // no-op since property can't change without reconfiguration\n  }\n\n  var accessors = (function () {\n    if (desc.set) {\n      // case: .get/.set\n      return {\n        get: desc.get,\n        set: function (newval) {\n          return desc.set.call(thisArg, handler.call(thisArg, prop, thisArg[prop], newval));\n        }\n      };\n    } else {\n      // case: .value\n      var val = desc.value;\n      return {\n        get: function () {\n          return val;\n        },\n        set: function (newval) {\n          return val = handler.call(thisArg, prop, val, newval);\n        }\n      };\n    }\n  })();\n  Object.defineProperty(thisArg, prop, accessors);\n\n  return desc;\n}\n\n/**\n * {@link watch} that, if successful, also calls the handler once with\n *   the current value (by setting it).\n * @see watch\n */\nfunction watchInit(thisArg, prop, handler) {\n  var value = thisArg[prop];\n  var desc = watch(thisArg, prop, handler);\n  if (desc) { thisArg[prop] = value; }\n  return desc;\n}\n\nif (typeof exports === 'object') {\n  exports.watch = watch;\n  exports.watchInit = watchInit;\n}\n","'use strict';\n\nvar jsyaml = require('js-yaml'),\n    _ = require('lodash/fp');\n\n// Document Serialization\n\nvar docToYaml = {\n  name: 'name',\n  sourceCode: 'source code',\n  positionTable: 'positions',\n  editorSourceCode: 'editor contents'\n};\nvar yamlToDoc = _.invert(docToYaml);\n\n// like _.mapKeys, but only using the keys specified in a mapping object.\n// {[key: string] -> string} -> ?Object -> Object\nfunction mapKeys(mapping) {\n  return function (input) {\n    var output = {};\n    if (input != null) {\n      Object.keys(mapping).forEach(function (fromKey) {\n        var toKey = mapping[fromKey];\n        output[toKey] = input[fromKey];\n      });\n    }\n    return output;\n  };\n}\n\n// we want parseDocument . stringifyDocument = identity, up to null == undefined.\n\n/**\n * Serialize a document.\n * For each state node position, only .x, .y, and .fixed are saved.\n * .fixed is omitted if true (its default value).\n * @param  {TMDocument} doc document to serialize\n * @return {string}\n */\nvar stringifyDocument = _.flow(\n  mapKeys(docToYaml),\n  _.omitBy(function (x) { return x == null; }),\n  _.update('positions', _.mapValues(function (pos) {\n    return pos.fixed\n      ? {x: pos.x, y: pos.y}\n      : {x: pos.x, y: pos.y, fixed: false};\n  })),\n  // NB. lodash/fp/partialRight takes an array of arguments.\n  _.partialRight(jsyaml.safeDump, [{\n    flowLevel: 2,       // positions: one state per line\n    lineWidth: -1,      // don't wrap lines\n    noRefs: true,       // no aliases/references are used\n    noCompatMode: true  // use y: instead of 'y':\n  }])\n);\n\n/**\n * Deserialize a document.\n * State positions' .px and .py are optional and default to .x and .y.\n * .fixed defaults to true.\n * @param  {string} str    serialized document\n * @return {Object}        data usable in TMDocument.copyFrom()\n * @throws {YAMLException} on YAML syntax error\n * @throws {TypeError}     when missing \"source code\" string property\n */\nvar parseDocument = _.flow(\n  jsyaml.safeLoad,\n  _.update('positions', _.mapValues(function (pos) {\n    // NB. lodash/fp/defaults is swapped: 2nd takes precedence\n    return _.defaults({px: pos.x, py: pos.y, fixed: true}, pos);\n  })),\n  mapKeys(yamlToDoc),\n  checkData\n);\n\n// throw if \"source code\" attribute is missing or not a string\nfunction checkData(obj) {\n  if (obj == null || obj.sourceCode == null) {\n    throw new InvalidDocumentError('The source code: value is missing');\n  } else if (!_.isString(obj.sourceCode)) {\n    throw new InvalidDocumentError('The source code: value needs to be of type string');\n  }\n  return obj;\n}\n\n// for valid YAML that is not valid as a document\nfunction InvalidDocumentError(message) {\n  this.name = 'InvalidDocumentError';\n  this.message = message || 'Invalid document';\n  this.stack = (new Error()).stack;\n}\nInvalidDocumentError.prototype = Object.create(Error.prototype);\nInvalidDocumentError.prototype.constructor = InvalidDocumentError;\n\nexports.stringifyDocument = stringifyDocument;\nexports.parseDocument = parseDocument;\nexports.InvalidDocumentError = InvalidDocumentError;\n\n// Re-exports\nexports.YAMLException = jsyaml.YAMLException;\n","'use strict'\n/**\n * Turing machine visualization component.\n *\n *  Adds running and reset on top of the base Turing machine.\n *  Displays an animated state diagram and tape diagram.\n * Does not include UI elements for controlling the machine.\n *\n * @module\n */\n\nconst TuringMachine = require('./TuringMachine').TuringMachine\nconst TapeViz = require('./tape/TapeViz')\nconst StateGraph = require('./state-diagram/StateGraph')\nconst StateViz = require('./state-diagram/StateViz')\nconst watchInit = require('./watch').watchInit\nconst d3 = require('d3')\n\n/**\n * Create an animated transition function.\n * @param  {StateGraph} graph\n * @param  {LayoutEdge -> any} animationCallback\n * @return {(string, string) -> Instruction} Created transition function.\n */\nfunction animatedTransition(graph, animationCallback) {\n    return function (state, symbol) {\n        let tuple = graph.getInstructionAndEdge(state, symbol)\n        if (tuple == null) {\n            return null\n        }\n\n        animationCallback(tuple.edge)\n        return tuple.instruction\n    }\n}\n\n/**\n * Default edge animation callback.\n * @param  {{domNode: Node}} edge\n * @param  {number} duration of animation\n * @return {D3Transition} The animation. Use this for transition chaining.\n */\nfunction pulseEdge(edge, duration=250) {\n    let edgepath = d3.select(edge.domNode)\n    return edgepath\n        .classed('active-edge', true)\n        .transition()\n        .duration(duration / 2)\n        .style('stroke-width', '3px')\n        .transition()\n        .duration(duration / 2)\n        .style('stroke-width', '1px')\n        .transition()\n        .duration(0)\n        .each('start', /* @this edge */ function () {\n            d3.select(this).classed('active-edge', false)\n        })\n        .style('stroke', null)\n        .style('stroke-width', null)\n}\n\nfunction addTapes(div, spec) {\n    if (spec.tapes === 0 && typeof spec.input === 'string') {\n        spec.input = [spec.input]\n    }\n    let number = spec.tapes === 0 ? 1 : spec.tapes\n    let tapes = []\n    for (let i = 0; i < number; i++) {\n        tapes.push(addTape(div, spec, i))\n    }\n    return tapes\n}\n\nfunction addTape(div, spec, i) {\n    return new TapeViz(\n        div.append('svg').attr('class', 'tm-tape'),\n        9,\n        spec.blank,\n        spec.input && spec.input[i] ? String(spec.input[i]).split('') : [],\n        spec.vis[i],\n    )\n}\n\n/**\n * Construct a new state and tape visualization inside a &lt;div&gt;.\n * @constructor\n * @param {HTMLDivElement} div        div to take over and use.\n * @param                  spec       machine specification\n * @param {?PositionTable} [posTable]  position table for the state nodes\n */\nfunction TMViz(div, spec, posTable) {\n    div = d3.select(div)\n    let graph = new StateGraph(spec.table, spec.vis.colors)\n    this.stateviz = new StateViz(\n        div,\n        graph.getVertexMap(),\n        graph.getEdges(),\n    )\n    if (posTable !== undefined && posTable !== null) {\n        this.positionTable = posTable\n    }\n\n    this.titles = spec.titles\n    this.info = spec.info\n    this.edgeAnimation = pulseEdge\n    this.stepInterval = 50\n    this.animationDuration = 500\n\n    const self = this\n\n    // We hook into the animation callback to know when to start the next step (when running).\n    function animateAndContinue(edge) {\n        let transition = self.edgeAnimation(edge, self.animationDuration)\n        if (self.isRunning) {\n            transition.transition().duration(self.stepInterval).each('end', function () {\n                // stop if machine was paused during the animation\n                if (self.isRunning) {\n                    self.step(self.animationDuration)\n                }\n            })\n        }\n    }\n\n    this.machine = new TuringMachine(\n        animatedTransition(graph, animateAndContinue),\n        spec.startState,\n        addTapes(div, spec),\n    )\n    // intercept and animate when the state is set\n    watchInit(this.machine, 'state', function (prop, oldstate, newstate) {\n        d3.select(graph.getVertex(oldstate).domNode).classed('current-state', false)\n        d3.select(graph.getVertex(newstate).domNode).classed('current-state', true)\n        return newstate\n    })\n\n    // Sidenote: each \"Step\" click evaluates the transition function once.\n    // Therefore, detecting halting always requires its own step (for consistency).\n    this.isHalted = false\n\n    let isRunning = false\n    /**\n     * Set isRunning to true to run the machine, and false to stop it.\n     */\n    Object.defineProperty(this, 'isRunning', {\n        configurable: true,\n        get: function () {\n            return isRunning\n        },\n        set: function (value) {\n            if (isRunning !== value) {\n                isRunning = value\n                if (isRunning) {\n                    this.step()\n                }\n            }\n        },\n    })\n\n    this.__parentDiv = div\n    this.__spec = spec\n}\n\n/**\n * Step the machine immediately and interrupt any animations.\n */\nTMViz.prototype.step = function (duration) {\n    if (!this.machine.step(duration)) {\n        this.isRunning = false\n        this.isHalted = true\n    }\n}\n\n/**\n * Reset the Turing machine to its starting configuration.\n */\nTMViz.prototype.reset = function () {\n    this.isRunning = false\n    this.isHalted = false\n    this.machine.state = this.__spec.startState\n    for (const tape of this.machine.tapes) {\n        tape.domNode.remove()\n    }\n    this.machine.tapes = addTapes(this.__parentDiv, this.__spec)\n}\n\nObject.defineProperty(TMViz.prototype, 'positionTable', {\n    get: function () {\n        return this.stateviz.positionTable\n    },\n    set: function (posTable) {\n        this.stateviz.positionTable = posTable\n    },\n})\n\nmodule.exports = TMViz\n","'use strict'\n\n/**\n * Construct a Turing machine.\n * @param {(state, symbol) -> ?{state: state, symbol: symbol, move: direction}} transition\n *   A transition function that, given *only* the current state and symbol,\n *   returns an object with the following properties: symbol, move, and state.\n *   Returning null/undefined halts the machine (no transition defined).\n * @param {state} startState  The state to start in.\n * @param         tapes        The tape to use.\n */\nfunction TuringMachine(transition, startState, tapes) {\n    this.transition = transition\n    this.state = startState\n    this.tapes = tapes\n}\n\nTuringMachine.prototype.toString = function () {\n    return String(this.state) + '\\n' + this.tapes.map(String).join('\\n')\n}\n\n/**\n * Step to the next configuration according to the transition function.\n * @return {boolean} true if successful (the transition is defined),\n *   false otherwise (machine halted)\n */\nTuringMachine.prototype.step = function (duration) {\n    let instruct = this.nextInstruction\n    if (instruct == null) {\n        return false\n    }\n\n    for (let i = 0; i < this.tapes.length; i++) {\n        this.tapes[i].write(instruct.symbol[i], duration)\n        move(this.tapes[i], instruct.move[i], duration)\n    }\n    for (let i = 0; i < this.tapes.length; i++) {\n        this.tapes[i].visualize(instruct.state, this.state === instruct.state)\n    }\n    this.state = instruct.state\n\n    return true\n}\n\nObject.defineProperties(TuringMachine.prototype, {\n    nextInstruction: {\n        get: function () {\n            return this.transition(this.state,\n                this.tapes.reduce((acc, tape) => acc + tape.read(), ''))\n        },\n        enumerable: true,\n    },\n    isHalted: {\n        get: function () {\n            return this.nextInstruction == null\n        },\n        enumerable: true,\n    },\n})\n\n// Allows for both notational conventions of moving the head or moving the tape\nfunction move(tape, direction, duration) {\n    switch (direction) {\n        case 'R':\n            tape.headRight(duration)\n            break\n        case 'L':\n            tape.headLeft(duration)\n            break\n        case 'H':\n            break\n        default:\n            throw new TypeError('not a valid tape movement: ' + String(direction))\n    }\n}\n\nexports.TuringMachine = TuringMachine\n","'use strict'\nconst Tape = require('./Tape.js')\nconst d3 = require('d3')\nrequire('./tape.css')\n\nconst cellWidth = 50\nconst cellHeight = 50\n\nfunction initTapeCells(selection) {\n    selection.attr('class', 'tape-cell')\n    selection.append('rect')\n        // the box outline is purely visual, so remove its data binding\n        .datum(null)\n        .attr({\n            'width': cellWidth,\n            'height': cellHeight,\n        })\n    selection.append('text')\n        .text(function (d) {\n            return d\n        })\n        .attr({'x': cellWidth / 2, 'y': cellHeight / 2 + 8})\n    return selection\n}\n\nfunction positionCells(selection, offset) {\n    offset = (offset == null) ? 0 : offset\n    selection.attr('transform', function (d, i) {\n        return 'translate(' + (-cellWidth + 10 + cellWidth * (i + offset)) + ')'\n    })\n    return selection\n}\n\nfunction repositionWrapper(wrapper) {\n    wrapper.attr('transform', 'translate(0 10)')\n        .transition()\n        .duration(0)\n        .select('.exiting')\n        .remove()\n}\n\n// Tape visualization centered around the tape head.\nfunction TapeViz(svg, lookaround, blank, input, vis) {\n    Tape.call(this, blank, input)\n\n    this.vis = vis\n\n    Object.defineProperty(this, 'lookaround', {\n        value: lookaround,\n        writable: false,\n        enumerable: true,\n    })\n    Object.defineProperty(this, 'domNode', {\n        value: svg,\n        writable: false,\n        enumerable: true,\n    })\n\n    // width is before + head + after, trimming 2 off to show cut-off tape ends\n    var width = cellWidth * (lookaround + 1 + lookaround - 2) + 2 * 10\n    var height = cellHeight + 2 * 10\n    svg.attr({\n        'width': '95%',\n        'viewBox': [0, 0, width, height].join(' '),\n    })\n\n    this.wrapper = svg.append('g')\n        .attr('class', 'wrapper')\n        .call(repositionWrapper)\n\n    svg.append('rect')\n        .attr({\n            'id': 'tape-head',\n            'width': (1 + 1 / 5) * cellWidth,\n            'height': (1 + 1 / 5) * cellHeight,\n            'x': -cellWidth + 10 / 2 + cellWidth * lookaround,\n            'y': 10 / 2,\n        })\n\n    this.wrapper.selectAll('.tape-cell')\n        .data(this.readRange(-lookaround, lookaround))\n        .enter()\n        .append('g')\n        .call(initTapeCells)\n        .call(positionCells)\n\n}\n\nTapeViz.prototype = Object.create(Tape.prototype)\nTapeViz.prototype.constructor = TapeViz\n\nTapeViz.prototype.visualize = function (state, smooth) {\n    let rule = this.vis[state]\n    let all = this.wrapper.selectAll('.wrapper > g')\n    // all.classed('smooth-color', rule && smooth)\n    all.classed('smooth-color', true)\n    all.classed('green', false)\n        .classed('blue', false)\n        .classed('red', false)\n    if (!rule)\n        return\n    let cur = this.wrapper.selectAll('.wrapper > g:not(.exiting)')[0][this.lookaround]\n    let dir = rule.dir === '->' ? 'nextElementSibling' : 'previousElementSibling'\n    let skip = rule.skip ? rule.skip : 0\n    if (rule.mode === 'row') {\n        while (cur) {\n            let symbol = cur.querySelector('text').textContent\n            if (rule.chars.includes(symbol))\n                cur.classList.add(rule.color)\n            else\n                break\n            cur = cur[dir]\n        }\n    } else if (rule.mode === 'find') {\n        while (cur) {\n            let symbol = cur.querySelector('text').textContent\n            cur.classList.add(rule.color)\n            if (rule.chars.includes(symbol)) {\n                if (skip > 0)\n                    skip -= 1\n                else\n                    break\n            }\n            cur = cur[dir]\n        }\n    }\n}\n\n// IDEA: chain headLeft/Right to wait for write()?\nTapeViz.prototype.write = function (symbol, duration=250) {\n    // don't animate if symbol stays the same\n    if (Tape.prototype.read.call(this) === symbol) {\n        return\n    }\n    Tape.prototype.write.call(this, symbol)\n\n    // remove leftover .exiting in case animation was interrupted\n    this.wrapper.selectAll('.exiting').remove()\n\n    d3.select(this.wrapper[0][0].childNodes[this.lookaround])\n        .datum(symbol)\n        .select('text')\n        .attr('fill-opacity', '1')\n        .attr('stroke-opacity', '1')\n        .transition()\n        .duration(duration / 2)\n        .attr('fill-opacity', '0.4')\n        .attr('stroke-opacity', '0.1')\n        .transition()\n        .duration(duration / 2)\n        .text(function (d) {\n            return d\n        })\n        .attr('fill-opacity', '1')\n        .attr('stroke-opacity', '1')\n        .transition()\n        .duration(0)\n        .attr('fill-opacity', null)\n        .attr('stroke-opacity', null)\n\n}\n\nfunction moveHead(wrapper, enter, exit, wOffset, cOffset, duration=250) {\n    // add to one end\n    enter.call(initTapeCells)\n    // remove from the other end\n    exit.classed('exiting', true)\n    // translate cells forward, and the wrapper backwards\n    wrapper.selectAll('.tape-cell')\n        .call(positionCells, cOffset)\n    wrapper\n        .attr('transform', 'translate(' + (wOffset * cellWidth).toString() + ' 10)')\n        // animate wrapper returning to neutral position\n        .transition()\n        .duration(duration)\n        .call(repositionWrapper)\n}\n\nTapeViz.prototype.headRight = function (duration=250) {\n    Tape.prototype.headRight.call(this)\n    // remove leftover .exiting in case animation was interrupted.\n    // Important: call-by-value evaluates the selection argument(s) of 'moveHead' before\n    // before entering the function, so exiting nodes have to be removed beforehand.\n    this.wrapper.selectAll('.exiting').remove()\n    moveHead(this.wrapper,\n        // add to right end\n        this.wrapper.append('g')\n            .datum(this.readOffset(this.lookaround)),\n        // remove from left end\n        this.wrapper.select('.tape-cell'),\n        1, -1,\n        duration,\n    )\n}\n\nTapeViz.prototype.headLeft = function (duration=250) {\n    Tape.prototype.headLeft.call(this)\n    this.wrapper.selectAll('.exiting').remove()\n    moveHead(this.wrapper,\n        this.wrapper.insert('g', ':first-child')\n            .datum(this.readOffset(-this.lookaround)),\n        this.wrapper.select('.wrapper > .tape-cell:last-of-type'),\n        -1, 0,\n        duration,\n    )\n}\n\nmodule.exports = TapeViz\n","'use strict'\nvar _ = require('lodash/fp')\n\n// Bidirectional infinite tape\nfunction Tape(blank, input) {\n    Object.defineProperty(this, 'blank', {\n        value: blank,\n        writable: false,\n        enumerable: true,\n    })\n    // zipper data structure\n    // INVARIANTS: tape.before can be empty, tape.after must be nonempty.\n    // before: cells before the head (in order; left to right).\n    // after:  cells after and including the head (in reverse; right to left).\n    this.tape = {\n        before: [],\n        after: (input == null || input.length == 0) ? [blank] : input.slice().reverse(),\n        toString: function () {\n            return this.before.join('') + '' + this.after.slice().reverse().join('')\n        },\n    }\n}\n\n// Read the value at the tape head.\nTape.prototype.read = function () {\n    return _.last(this.tape.after)\n}\nTape.prototype.write = function (symbol) {\n    this.tape.after[this.tape.after.length - 1] = symbol\n}\n\nTape.prototype.headRight = function () {\n    var before = this.tape.before,\n        after = this.tape.after\n    before.push(after.pop())\n    if (_.isEmpty(after)) {\n        after.push(this.blank)\n    }\n}\nTape.prototype.headLeft = function () {\n    var before = this.tape.before,\n        after = this.tape.after\n    if (_.isEmpty(before)) {\n        before.push(this.blank)\n    }\n    after.push(before.pop())\n}\n\nTape.prototype.toString = function () {\n    return this.tape.toString()\n}\n\n// for tape visualization. not part of TM definition.\n// Read the value at an offset from the tape head.\n// 0 is the tape head. + is to the right, - to the left.\nTape.prototype.readOffset = function (i) {\n    var tape = this.tape\n    if (i >= 0) {\n        // right side: offset [0..length-1]  array index [length-1..0]\n        return (i <= tape.after.length - 1) ? tape.after[tape.after.length - 1 - i] : this.blank\n    } else {\n        // left side: offset [-1..-length]  array index [length-1..0]\n        return (i >= -tape.before.length) ? tape.before[tape.before.length + i] : this.blank\n    }\n}\n\n// for tape visualization.\n// Read the values from an offset range (inclusive of start and end).\nTape.prototype.readRange = function (start, end) {\n    return _.range(start, end + 1).map(function (i) {\n        return this.readOffset(i)\n    }, this)\n}\n\nmodule.exports = Tape\n","module.exports = __webpack_public_path__ + \"tape/tape.css\";","'use strict'\n\nvar _ = require('lodash')\n\n\n/* Interface\n  type TransitionTable = {\n    [state: string]: ?{\n      [symbol: string]: Instruction\n    }\n  };\n  type Instruction = { state?: string, symbol?: string };\n\n  type DiagramGraph = {\n    [state: string]: {\n      label: string,\n      transitions: ?{\n        [symbol: string]: {\n          instruction: Instruction,\n          edge: LayoutEdge\n        }\n      }\n    }\n  };\n  type LayoutEdge = { source: Object, target: Object, labels: [string] }\n */\n\n/**\n * Use a transition table to derive the graph (vertices & edges) for a D3 diagram.\n * Edges with the same source and target are combined.\n * NB. In addition to single symbols, comma-separated symbols are supported.\n * e.g. symbol string '0,1,,,I' -> symbols [0,1,',','I'].\n */\n// TransitionTable -> DiagramGraph\nfunction deriveGraph(table, color_table) {\n    // We need two passes, since edges may point at vertices yet to be created.\n    // 1. Create all the vertices.\n    var graph = _.mapValues(table, function (transitions, state) {\n        return {\n            label: state,\n            transitions: transitions,\n            color: color_table[state],\n        }\n    })\n    // 2. Create the edges, which can now point at any vertex object.\n    var allEdges = []\n    _.forEach(graph, function (vertex, state) {\n\n        vertex.transitions = vertex.transitions && (function () {\n            let stateTransitions = {}\n\n            // Combine edges with the same source and target\n            let cache = {}\n\n            function edgeTo(target, label) {\n                let edge = cache[target] ||\n                    _.tap(cache[target] = { // WHAT THE FUCK?\n                        source: vertex,\n                        target: graph[target],\n                        labels: [],\n                    }, allEdges.push.bind(allEdges))\n                if (table.tapes < 3)\n                    edge.labels.push(label)\n                return edge\n            }\n\n            // Create symbol -> instruction object map\n            _.forEach(vertex.transitions, function (instruct, symbolKey) {\n                // Handle comma-separated symbols.\n                // Recreate array by splitting on ','. Treat 2 consecutive ',' as , ','.\n                let symbols = symbolKey.split(',').reduce(function (acc, x) {\n                    if (x === '' && acc[acc.length - 1] === '') {\n                        acc[acc.length - 1] = ','\n                    } else {\n                        acc.push(x)\n                    }\n                    return acc\n                }, [])\n                let target = instruct.state != null ? instruct.state : state\n                let edge = edgeTo(target, labelFor(symbols, instruct))\n\n                symbols.forEach(function (symbol) {\n                    stateTransitions[symbol] = {\n                        // Normalize for execution, but display the less-cluttered original.\n                        instruction: normalize(state, symbol, instruct),\n                        edge: edge,\n                    }\n                })\n            })\n\n            return stateTransitions\n        }())\n\n    })\n\n    return {graph: graph, edges: allEdges}\n}\n\n// Normalize an instruction to include an explicit state and symbol.\n// e.g. {symbol: '1'} normalizes to {state: 'q0', symbol: '1'} when in state q0.\nfunction normalize(state, symbol, instruction) {\n    symbol = symbol.split('')\n    if (instruction.symbol) {\n        for (let i = 0; i < symbol.length; i++) {\n            if (instruction.symbol[i])\n                symbol[i] = instruction.symbol[i]\n        }\n    }\n    return _.defaults({symbol: symbol.join('')}, instruction, {state: state})\n}\n\nfunction labelFor(symbols, action) {\n    var rightSide = ((action.symbol == null) ? '' : (visibleSpace(String(action.symbol)) + ','))\n        + String(action.move)\n    return symbols.map(visibleSpace).join(',') + '' + rightSide\n}\n\n// replace ' ' with ''.\nfunction visibleSpace(c) {\n    return (c === ' ') ? '' : c\n}\n\n\n/**\n * Aids rendering and animating a transition table in D3.\n *\n *  Generates the vertices and edges (\"nodes\" and \"links\") for a D3 diagram.\n *  Provides mapping of each state to its vertex and each transition to its edge.\n * @param {TransitionTable} table\n */\nfunction StateGraph(table, color_table) {\n    var derived = deriveGraph(table, color_table)\n    Object.defineProperties(this, {\n        __graph: {value: derived.graph},\n        __edges: {value: derived.edges},\n    })\n}\n\n/**\n * D3 layout \"nodes\".\n */\n// StateGraph.prototype.getVertices = function () {\n//   return _.values(this.__graph);\n// };\n\n/**\n * Returns the mapping from states to vertices (D3 layout \"nodes\").\n * @return { {[state: string]: Object} }\n */\nStateGraph.prototype.getVertexMap = function () {\n    return this.__graph\n}\n\n/**\n * D3 layout \"links\".\n */\nStateGraph.prototype.getEdges = function () {\n    return this.__edges\n}\n\n/**\n * Look up a state's corresponding D3 \"node\".\n */\nStateGraph.prototype.getVertex = function (state) {\n    return this.__graph[state]\n}\n\nStateGraph.prototype.getInstructionAndEdge = function (state, symbol) {\n    var vertex = this.__graph[state]\n    if (vertex === undefined) {\n        throw new Error('not a valid state: ' + String(state))\n    }\n\n    return vertex.transitions && vertex.transitions[symbol]\n}\n\n\nmodule.exports = StateGraph\n","'use strict'\n\nvar isBrowserIEorEdge = require('../util').isBrowserIEorEdge\nvar d3 = require('d3')\nvar _ = require('lodash/fp')\nvar assign = require('lodash').assign // need mutable assign()\n\n// *** Arrays as vectors ***\n\n// Add vectors.\n// Note: dimensions are not checked. Missing dimensions become NaN.\nfunction addV(array1, array2) {\n    return array1.map(function (x, i) {\n        return x + array2[i]\n    })\n}\n\nfunction negateV(array) {\n    return array.map(function (x) {\n        return -x\n    })\n}\n\nfunction subtractV(array1, array2) {\n    return addV(array1, negateV(array2))\n}\n\n// Scale the vector by a scalar.\nfunction multiplyV(array, scalar) {\n    return array.map(function (x) {\n        return scalar * x\n    })\n}\n\n// Vector norm, squared\nfunction normSqV(array) {\n    function sq(x) {\n        return x * x\n    }\n\n    function add(x, y) {\n        return x + y\n    }\n\n    return array.map(sq).reduce(add, 0)\n}\n\n// Vector norm\nfunction normV(array) {\n    return Math.sqrt(normSqV(array))\n}\n\n// Return a copy of the vector rescaled as a unit vector (norm = 1).\nfunction unitV(array) {\n    var n = normV(array)\n    return array.map(function (x) {\n        return x / n\n    })\n}\n\n// *** 2D Vectors ***\nfunction angleV(array) {\n    var x = array[0], y = array[1]\n    return Math.atan2(y, x)\n}\n\nfunction vectorFromLengthAngle(length, angle) {\n    return [Math.cos(angle) * length, Math.sin(angle) * length]\n}\n\n// *** Utilities ***\n\n// Count the directed edges that start at a given node and end at another.\n// Important: each node must have a unique .index property.\n// Example usage:\n// var counts = new EdgeCounter(edges);\n// var edgesFrom2To5 = counts.numEdgesFromTo(2,5);\n// var edgesFrom5to2 = counts.numEdgesFromTo(5,2);\nfunction EdgeCounter(edges) {\n    edges.forEach(function (e) {\n        var key = e.source.index + ',' + e.target.index\n        this[key] = (this[key] || 0) + 1\n    }, this)\n}\n\nEdgeCounter.prototype.numEdgesFromTo = function (src, target) {\n    return this[String(src) + ',' + String(target)] || 0\n}\n\nvar EdgeShape = Object.freeze({\n    loop: {},     // self-loop: a->a\n    arc: {},      // curved arc: a->b when b->a exists\n    straight: {},  // straight edge: a->b when b->a does not exist\n})\n\nEdgeCounter.prototype.shapeForEdge = function (e) {\n    if (e.target.index === e.source.index) {\n        return EdgeShape.loop\n    } else if (this.numEdgesFromTo(e.target.index, e.source.index)) {\n        // has returning edge => arc\n        return EdgeShape.arc\n    } else {\n        return EdgeShape.straight\n    }\n}\n\n// create a function that will compute an edge's SVG 'd' attribute.\nfunction edgePathFor(nodeRadius, shape, d) {\n    // case: self-loop\n    var loopEndOffset, loopArc\n    if (shape === EdgeShape.loop) {\n        // start at the top (90), end slightly above the right (15)\n        loopEndOffset = vectorFromLengthAngle(nodeRadius, -15 * Math.PI / 180)\n        loopArc = ' a 19,27 45 1,1 ' + loopEndOffset[0] + ',' + (loopEndOffset[1] + nodeRadius)\n        return function () {\n            var x1 = d.source.x,\n                y1 = d.source.y\n            return 'M ' + x1 + ',' + (y1 - nodeRadius) + loopArc\n        }\n    }\n    // case: between nodes\n    if (shape === EdgeShape.arc) {\n        // sub-case: arc\n        return function () {\n            // note: p1 & p2 have to be delayed, to access x/y at the time of the call\n            var p1 = [d.source.x, d.source.y]\n            var p2 = [d.target.x, d.target.y]\n            var offset = subtractV(p2, p1)\n            var radius = 6 / 5 * normV(offset)\n            // Note: SVG's y-axis is flipped, so vector angles are negative\n            // relative to standard coordinates (as used in Math.atan2).\n            // Proof: angle(r <cos , -sin >) = angle(r <cos -, sin ->) = -.\n            var angle = angleV(offset)\n            var sep = -Math.PI / 2 / 2 // 90 separation, half on each side\n            var source = addV(p1, vectorFromLengthAngle(nodeRadius, angle + sep))\n            var target = addV(p2, vectorFromLengthAngle(nodeRadius, angle + Math.PI - sep))\n            // IDEA: consider http://www.w3.org/TR/SVG/paths.html#PathDataCubicBezierCommands\n            return (p1[0] <= p2[0])\n                ? 'M ' + source[0] + ' ' + source[1] + ' A ' + radius + ' ' + radius + ' 0 0,1 ' + target[0] + ' ' + target[1]\n                : 'M ' + target[0] + ' ' + target[1] + ' A ' + radius + ' ' + radius + ' 0 0,0 ' + source[0] + ' ' + source[1]\n        }\n    } else if (shape === EdgeShape.straight) {\n        return function () {\n            // sub-case: straight line\n            var p1 = [d.source.x, d.source.y]\n            var p2 = [d.target.x, d.target.y]\n            var offset = subtractV(p2, p1)\n            // avoid spurious errors when bounding causes node centers to coincide\n            if (offset[0] === 0 && offset[1] === 0) {\n                return null\n            }\n\n            var target = subtractV(p2, multiplyV(unitV(offset), nodeRadius))\n            return 'M ' + p1[0] + ' ' + p1[1] + ' L ' + target[0] + ' ' + target[1]\n        }\n    }\n}\n\nfunction rectCenter(svgrect) {\n    return {\n        x: svgrect.x + svgrect.width / 2,\n        y: svgrect.y + svgrect.height / 2,\n    }\n}\n\nfunction identity(x) {\n    return x\n}\n\nfunction noop() {\n}\n\nfunction limitRange(min, max, value) {\n    return Math.max(min, Math.min(value, max))\n}\n\n// IE padding hack so that SVG resizes properly.\n// This works across browsers but we only need it for IE.\nvar appendSVGTo = !isBrowserIEorEdge\n    ? function (div) {\n        return div.append('svg')\n    }\n    : function (div, hwRatio) {\n        return div\n            .append('div')\n            .style({\n                width: '100%',\n                height: '0',\n                'padding-bottom': (100 * hwRatio) + '%',\n                position: 'relative',\n            })\n            .append('svg')\n            .style({\n                position: 'absolute',\n                top: '0',\n                left: '0',\n            })\n    }\n\n// *** D3 diagram ***\nrequire('./StateViz.css')\n\n// type LayoutNode = {label: string};\n// type StateMap = {[state: string]: LayoutNode};\n\n/**\n * Create a state diagram inside an SVG.\n * Each vertex/edge (node/link) object is also annotated with @.domNode@\n * corresponding to its SVG element.\n *\n * Note: currently, element IDs (e.g. for textPath) will collide if multiple\n * diagrams are on the same document (HTML page).\n * @param  {D3Selection}      container     Container to add the SVG to.\n * @param  {[LayoutNode] | StateMap} nodes  Parameter to D3's force.nodes.\n *   Important: passing a StateMap is recommended when using setPositionTable.\n *   Passing an array will key the state nodes by array index.\n * @param  {[LayoutEdge]}     linkArray     Parameter to D3's force.links.\n */\nfunction StateViz(container, nodes, linkArray) {\n    /* References:\n      [Sticky Force Layout](http://bl.ocks.org/mbostock/3750558) demonstrates\n      drag to position and double-click to release.\n\n      [Graph with labeled edges](http://bl.ocks.org/jhb/5955887) demonstrates\n      arrow edges with auto-rotated labels.\n    */\n\n    /* eslint-disable no-invalid-this */ // eslint is not familiar with D3\n    var w = 800\n    var h = 500\n    var linkDistance = 50\n    var nodeRadius = 20\n\n    var colors = d3.scale.category10()\n\n    var svg = appendSVGTo(container, h / w)\n    svg.attr({\n        'viewBox': [0, 0, w, h].join(' '),\n        'version': '1.1',\n        ':xmlns': 'http://www.w3.org/2000/svg',\n        ':xmlns:xlink': 'http://www.w3.org/1999/xlink',\n    })\n\n    // Force Layout\n\n    // drag event handlers\n    function dragstart(d) {\n        d.fixed = true\n        svg.transition()\n            .style('box-shadow', 'inset 0 0 1px gold')\n    }\n\n    function grid_snapping(d) {\n        const dh = 34.641\n        let row = Math.round(d.py / dh)\n        d.py = row * dh\n        if (row % 2 === 1) {\n            d.px += 20\n            d.px = Math.round(d.px / 40) * 40\n            d.px -= 20\n        } else {\n            d.px = Math.round(d.px / 40) * 40\n        }\n        d.x = d.px\n        d.y = d.py\n    }\n\n    function dragend() {\n        svg.transition()\n            .style('box-shadow', null)\n    }\n\n    function releasenode(d) {\n        d.fixed = false\n        force.resume()\n    }\n\n    // set up force layout\n    var nodeArray = nodes instanceof Array ? nodes : _.values(nodes)\n    this.__stateMap = nodes\n\n    var force = d3.layout.force()\n        .nodes(nodeArray)\n        .links(linkArray)\n        .size([w, h])\n        .linkDistance([linkDistance])\n        .charge([-300])\n        .theta(0.1)\n        .gravity(0.1)\n        .start()\n\n    var drag = force.drag()\n        .on('dragstart', dragstart)\n        .on('drag', grid_snapping)\n        .on('dragend', dragend)\n\n    // Edges\n    var edgeCounter = new EdgeCounter(linkArray)\n\n    var edgeselection = svg.selectAll('.edgepath')\n        .data(linkArray)\n        .enter()\n\n    var edgegroups = edgeselection.append('g')\n\n    var labelAbove = function (d, i) {\n        return String(-1.1 * (i + 1)) + 'em'\n    }\n    var labelBelow = function (d, i) {\n        return String(0.6 + 1.1 * (i + 1)) + 'em'\n    }\n\n    edgegroups.each(function (edgeD, edgeIndex) {\n        var group = d3.select(this)\n        var edgepath = group\n            .append('path')\n            .attr({\n                'class': 'edgepath',\n                'id': 'edgepath' + edgeIndex,\n            })\n            .each(function (d) {\n                d.domNode = this\n            })\n\n        var labels = group.selectAll('.edgelabel')\n            .data(edgeD.labels).enter()\n            .append('text')\n            .attr('class', 'edgelabel')\n        labels.append('textPath')\n            .attr('xlink:href', function () {\n                return '#edgepath' + edgeIndex\n            })\n            .attr('startOffset', '50%')\n            .text(identity)\n        /* To reduce JS computation, label positioning varies by edge shape:\n            * Straight edges can use a fixed 'dy' value.\n            * Loops cannot use 'dy' since it increases letter spacing\n              as labels get farther from the path. Instead, since a loop's shape\n              is fixed, it allows a fixed translate 'transform'.\n            * Arcs are bent and their shape is not fixed, so neither 'dy'\n              nor 'transform' can be constant.\n              Fortunately the curvature is slight enough that a fixed 'dy'\n              looks good enough without resorting to dynamic translations.\n        */\n        var shape = edgeCounter.shapeForEdge(edgeD)\n        edgeD.getPath = edgePathFor(nodeRadius, shape, edgeD)\n        switch (shape) {\n            case EdgeShape.straight:\n                labels.attr('dy', labelAbove)\n                edgeD.refreshLabels = function () {\n                    // flip edge labels that are upside-down\n                    labels.attr('transform', function () {\n                        if (edgeD.target.x < edgeD.source.x) {\n                            var c = rectCenter(this.getBBox())\n                            return 'rotate(180 ' + c.x + ' ' + c.y + ')'\n                        } else {\n                            return null\n                        }\n                    })\n                }\n                break\n            case EdgeShape.arc:\n                var isFlipped\n                edgeD.refreshLabels = function () {\n                    var shouldFlip = edgeD.target.x < edgeD.source.x\n                    if (shouldFlip !== isFlipped) {\n                        edgepath.classed('reversed-arc', shouldFlip)\n                        labels.attr('dy', shouldFlip ? labelBelow : labelAbove)\n                        isFlipped = shouldFlip\n                    }\n                }\n                break\n            case EdgeShape.loop:\n                labels.attr('transform', function (d, i) {\n                    return 'translate(' + String(8 * (i + 1)) + ' ' + String(-8 * (i + 1)) + ')'\n                })\n                edgeD.refreshLabels = noop\n                break\n        }\n    })\n    var edgepaths = edgegroups.selectAll('.edgepath')\n\n    // Nodes\n    // note: nodes are added after edges so as to paint over excess edge lines\n    var nodeSelection = svg.selectAll('.node')\n        .data(nodeArray)\n        .enter()\n\n    var nodecircles = nodeSelection\n        .append('circle')\n        .attr('class', 'node')\n        .attr('r', nodeRadius)\n        .style('fill', function (d, i) {\n            if (d.color !== undefined)\n                return '#' + d.color\n            return colors(i)\n        })\n        .each(function (d) {\n            d.domNode = this\n        })\n        .on('dblclick', releasenode)\n        .call(drag)\n\n    var nodelabels = nodeSelection\n        .append('text')\n        .attr('class', 'nodelabel')\n        .attr('dy', '0.25em') /* dy doesn't work in CSS */\n        .text(function (d) {\n            return d.label\n        })\n\n    // Arrowheads\n    var svgdefs = svg.append('defs')\n    svgdefs.selectAll('marker')\n        .data(['arrowhead', 'active-arrowhead', 'reversed-arrowhead', 'reversed-active-arrowhead'])\n        .enter().append('marker')\n        .attr({\n            'id': function (d) {\n                return d\n            },\n            'viewBox': '0 -5 10 10',\n            'refX': function (d) {\n                return (d.lastIndexOf('reversed-', 0) === 0) ? 0 : 10\n            },\n            'orient': 'auto',\n            'markerWidth': 10,\n            'markerHeight': 10,\n        })\n        .append('path')\n        .attr('d', 'M 0 -5 L 10 0 L 0 5 Z')\n        .attr('transform', function (d) {\n            return (d.lastIndexOf('reversed-', 0) === 0) ? 'rotate(180 5 0)' : null\n        })\n\n    var svgCSS =\n        '.edgepath {' +\n        '  marker-end: url(#arrowhead);' +\n        '}' +\n        '.edgepath.active-edge {' +\n        '  marker-end: url(#active-arrowhead);' +\n        '}' +\n        '.edgepath.reversed-arc {' +\n        '  marker-start: url(#reversed-arrowhead);' +\n        '  marker-end: none;' +\n        '}' +\n        '.edgepath.active-edge.reversed-arc {' +\n        '  marker-start: url(#reversed-active-arrowhead);' +\n        '  marker-end: none;' +\n        '}'\n    svg.append('style').each(function () {\n        if (this.styleSheet) {\n            this.styleSheet.cssText = svgCSS\n        } else {\n            this.textContent = svgCSS\n        }\n    })\n\n    // Force Layout Update\n    force.on('tick', function () {\n        // Keep coordinates in bounds. http://bl.ocks.org/mbostock/1129492\n        // NB. Bounding can cause node centers to coincide, especially at corners.\n        nodecircles.attr({\n            cx: function (d) {\n                return d.x = limitRange(nodeRadius, w - nodeRadius, d.x)\n            },\n            cy: function (d) {\n                return d.y = limitRange(nodeRadius, h - nodeRadius, d.y)\n            },\n        })\n\n        nodelabels.attr('x', function (d) {\n            return d.x\n        })\n            .attr('y', function (d) {\n                return d.y\n            })\n\n        edgepaths.attr('d', function (d) {\n            return d.getPath()\n        })\n\n        edgegroups.each(function (d) {\n            d.refreshLabels()\n        })\n\n        // Conserve CPU when layout is fully fixed\n        if (nodeArray.every(function (d) {\n            return d.fixed\n        })) {\n            force.stop()\n        }\n    })\n    this.force = force\n    /* eslint-enable no-invalid-this */\n}\n\n// Positioning\n\n// {[key: State]: Node} -> PositionTable\nvar getPositionTable = _.mapValues(_.pick(['x', 'y', 'px', 'py', 'fixed']))\n\n// Tag nodes w/ positions. Mutates the node map.\n// PositionTable -> {[key: State]: Node} -> void\nfunction setPositionTable(posTable, stateMap) {\n    _.forEach(function (node, state) {\n        var position = posTable[state]\n        if (position !== undefined) {\n            assign(node, position)\n        }\n    }, stateMap)\n}\n\nObject.defineProperty(StateViz.prototype, 'positionTable', {\n    get: function () {\n        return getPositionTable(this.__stateMap)\n    },\n    set: function (posTable) {\n        setPositionTable(posTable, this.__stateMap)\n        // ensure that a cooled layout will update\n        this.force.resume()\n    },\n})\n\n\nmodule.exports = StateViz\n","module.exports = __webpack_public_path__ + \"state-diagram/StateViz.css\";","'use strict'\n\nvar parseDocument = require('./sharing/format').parseDocument\nvar fromPairs = require('lodash/fp').fromPairs\n\n\nfunction requireExample(name) {\n    return require('raw-loader!./examples/' + name + '.yaml')\n}\n\nvar examplePairs = [\n    'universal',\n    'multitape',\n    'repeat01',\n    'binaryIncrement',\n    'divisibleBy3',\n    'copy1s',\n    'divisibleBy3Base10',\n    'matchThreeLengths',\n    'matchBinaryStrings',\n    'palindrome',\n    'busyBeaver3',\n    'busyBeaver4',\n    'powersOfTwo',\n    'lengthMult',\n    'binaryAdd',\n    'unaryMult',\n    'binaryMult',\n].map(function (id) {\n    // parse each string into a document\n    var doc = parseDocument(requireExample(id))\n    doc.id = id\n\n    return [id, doc]\n})\nvar examples = Object.freeze(fromPairs(examplePairs))\n\n\nfunction isExampleID(docID) {\n    return {}.hasOwnProperty.call(examples, docID)\n}\n\nfunction get(docID) {\n    return isExampleID(docID) ? examples[docID] : null\n}\n\nvar list = examplePairs.map(function (pair) {\n    return pair[1]\n})\n\n\nexports.hasID = isExampleID\nexports.get = get\nexports.list = list\nexports.firsttimeDocID = 'universal'\nexports.blankTemplate = requireExample('_template')\n","'use strict';\n\nvar isBrowserIEorEdge = require('./util').isBrowserIEorEdge;\n/* global localStorage:false, window:false */\n\n///////////////////////\n// Key-Value Storage //\n///////////////////////\n\nvar canUseLocalStorage = (function () {\n  // from modernizr v3.3.1 (modernizr.com)\n  var mod = 'modernizr';\n  try {\n    localStorage.setItem(mod, mod);\n    localStorage.removeItem(mod);\n    return true;\n  } catch (e) {\n    return false;\n  }\n})();\n\n// RAM-only fallback\nvar RAMStorage = (function () {\n  var obj = {};\n  return Object.freeze({\n    get length() { return Object.keys(obj).length; },\n    key: function (n) { return (n in Object.keys(obj)) ? Object.keys(obj)[n] : null; },\n    getItem: function (key) { return {}.hasOwnProperty.call(obj, key) ? obj[key] : null; },\n    setItem: function (key, val) { obj[key] = String(val); },\n    removeItem: function (key) { delete obj[key]; },\n    clear: function () { obj = {}; }\n  });\n})();\n\nvar KeyValueStorage = (function () {\n  var s = canUseLocalStorage ? localStorage : RAMStorage;\n\n  // workaround IE/Edge firing events on its own window\n  var fromOwnWindow = isBrowserIEorEdge\n    ? function () { return window.document.hasFocus(); }\n    : function () { return false; };\n\n  return {\n    read  : s.getItem.bind(s),\n    write : s.setItem.bind(s),\n    remove: s.removeItem.bind(s),\n    // Registers a listener for StorageEvents from other tabs/windows.\n    addStorageListener: canUseLocalStorage\n      ? function (listener) {\n        window.addEventListener('storage', function (e) {\n          if (fromOwnWindow()) {\n            return;\n          }\n          if (e.storageArea === localStorage) {\n            listener(e);\n          }\n        });\n      }\n      : function () {},\n    removeStorageListener: canUseLocalStorage\n      ? window.removeEventListener.bind(window, 'storage')\n      : function () {}\n  };\n})();\n\n\nexports.canUseLocalStorage = canUseLocalStorage;\nexports.KeyValueStorage = KeyValueStorage;\n","module.exports = Promise;","'use strict'\n\nconst jsyaml = require('js-yaml')\nconst _ = require('lodash')\nconst {TMSpecError} = require('./errors.js')\nconst {transformations} = require('./transformations.js')\n\n\n\n/** @typedef {{[key: string]: ?{[key: string]: string} }} TransitionTable */\n\n/**\n * @typedef {Object} VisSpec\n * @property {string} mode\n * @property {string} dir\n * @property {string} chars\n * @property {string} color\n * */\n/** @typedef {Object<Object<VisSpec>>} VisTable */\n\n/**\n * @typedef {Object} TMSpec\n * @property {string} blank\n * @property {int} tapes\n * @property {string} 'start state'\n * @property {string} startState\n * @property {string} transform\n * @property synonyms\n * @property {TransitionTable} table\n * @property {VisTable} vis\n */\n\n/**\n * IDEA: check with flow (flowtype.org)\n * @throws {YAMLException} on YAML syntax error\n * @throws {TMSpecError} for an invalid spec\n *          (eg. no start state, transitioning to an undefined state)\n * @param {string} str\n * @param {boolean} allowTapes\n * @returns {[TMSpec, ?PositionTable]}\n */\nfunction parseSpec(str, allowTapes = false) {\n    /** @type {TMSpec|null} obj */\n    let obj = jsyaml.safeLoad(str)\n    // check for required object properties.\n    // auto-convert .blank and 'start state' to string, for convenience.\n    if (obj == null) {\n        throw new TMSpecError(\n            'The document is empty',\n            {\n                info: 'Every Turing machine requires a <code>blank</code> tape symbol,' +\n                    ' a <code>start state</code>, and a transition <code>table</code>',\n            },\n        )\n    }\n    let detailsForBlank = {\n        suggestion: \"Examples: <code>blank: ' '</code>, <code>blank: '0'</code>\",\n    }\n    if (obj.blank == null) {\n        throw new TMSpecError('No blank symbol was specified', detailsForBlank)\n    }\n    obj.blank = String(obj.blank)\n    if (obj.blank.length !== 1) {\n        throw new TMSpecError('The blank symbol must be a string of length 1', detailsForBlank)\n    }\n\n    if (allowTapes && obj.tapes !== undefined) {\n        if (!Number.isInteger(obj.tapes)) {\n            throw new TMSpecError(\n                'The number of tapes must be an integer',\n                {problemValue: typeof obj.tapes},\n            )\n        }\n        if (obj.tapes > 9) {\n            throw new TMSpecError('Why would you need more than 9 tapes?')\n        }\n    } else {\n        if (!(obj.tapes === undefined || obj.tapes === 1)) {\n            throw new TMSpecError('This Turing machine has only 1 tape')\n        }\n        obj.tapes = 0\n    }\n\n    obj.startState = obj['start state']\n    delete obj['start state']\n    if (obj.startState == null) {\n        throw new TMSpecError(\n            'No start state was specified',\n            {suggestion: 'Assign one using <code>start state: </code>'},\n        )\n    }\n\n    obj.startState = String(obj.startState)\n    // parse synonyms and transition table\n    checkTableType(obj.table) // parseSynonyms assumes a table object\n    let synonyms = parseSynonyms(obj.synonyms, obj.table, obj.tapes)\n    obj.table = parseTable(synonyms, obj.table, obj.tapes)\n    obj.vis = parseVis(obj.vis, obj.table, obj.tapes)\n    // check for references to non-existent states\n    if (!(obj.startState in obj.table)) {\n        throw new TMSpecError('The start state has to be declared in the transition table')\n    }\n    let pos_table = null\n    let transformed_code = null\n    if (obj.transform) {\n        let transform = String(obj.transform)\n        if (transformations[transform] === undefined)\n            throw new TMSpecError(\n                'No such transform',\n                {\n                    problemValue: transform,\n                    info: 'Available transforms are: ' + Object.keys(transformations).join(', '),\n                },\n            );\n        [obj, pos_table, transformed_code] = transformations[transform](obj, parseSpec)\n    }\n    return [obj, pos_table, transformed_code]\n}\n\nfunction checkTableType(val) {\n    if (val == null) {\n        throw new TMSpecError(\n            'Missing transition table',\n            {suggestion: 'Specify one using <code>table:</code>'},\n        )\n    }\n    if (typeof val !== 'object') {\n        throw new TMSpecError(\n            'Transition table has an invalid type',\n            {\n                problemValue: typeof val,\n                info: 'The transition table should be a nested mapping from states to symbols to instructions',\n            },\n        )\n    }\n}\n\n/**\n * @throws {TMSpecError}\n * @param {any} val\n * @param {TransitionTable} table\n * @param {int} tapes\n * @returns {?SynonymMap}\n */\nfunction parseSynonyms(val, table, tapes) {\n    if (val == null) {\n        return null\n    }\n    if (typeof val !== 'object') {\n        throw new TMSpecError(\n            'Synonyms table has an invalid type',\n            {\n                problemValue: typeof val,\n                info: 'Synonyms should be a mapping from string abbreviations to instructions'\n                    + ' (e.g. <code>accept: {R: accept}</code>)',\n            },\n        )\n    }\n    return _.mapValues(val, function (actionVal, key) {\n        try {\n            return parseInstruction(null, table, actionVal, tapes)\n        } catch (e) {\n            if (e instanceof TMSpecError) {\n                e.details.synonym = key\n                if (e.reason === 'Unrecognized string') {\n                    e.details.info = 'Note that a synonym cannot be defined using another synonym'\n                }\n            }\n            throw e\n        }\n    })\n}\n\n/**\n * @param {?SynonymMap} synonyms\n * @param {TransitionTable} val\n * @param {number} tapes\n * @returns {TransitionTable}\n */\nfunction parseTable(synonyms, val, tapes) {\n    return _.mapValues(val, function (stateObj, state) {\n        if (stateObj == null) {\n            // case: halting state\n            return null\n        }\n        if (typeof stateObj !== 'object') {\n            throw new TMSpecError(\n                'State entry has an invalid type',\n                {\n                    problemValue: typeof stateObj, state: state,\n                    info: 'Each state should map symbols to instructions. An empty map signifies a halting state.',\n                },\n            )\n        }\n        return _.mapValues(stateObj, function (actionVal, symbol) {\n            try {\n                return parseInstruction(synonyms, val, actionVal, tapes)\n            } catch (e) {\n                if (e instanceof TMSpecError) {\n                    e.details.state = state\n                    e.details.symbol = symbol\n                }\n                throw e\n            }\n        })\n    })\n}\n\n/**\n * omits null/undefined properties\n * @param {?string | Object<string>} symbol\n * @param {string} move\n * @param {?string} state\n * @returns {TMAction}\n */\nfunction makeInstruction(symbol, move, state) {\n    return _.omitBy(\n        {symbol: symbol, move: move, state: state},\n        function (x) {\n            return x == null\n        },\n    )\n}\n\nfunction checkTarget(table, instruct) {\n    if (instruct.state != null && !(instruct.state in table)) {\n        throw new TMSpecError('Undeclared state', {\n            problemValue: instruct.state,\n            suggestion: 'Make sure to list all states in the transition table and define their transitions (if any)',\n        })\n    }\n    return instruct\n}\n\n/**\n * @typedef {{[tape: string]: string}} TapeDict\n */\n/**\n * @typedef {Object} MTTMAction\n * @property {string|null} state\n * @property {TapeDict} move\n * @property {TapeDict} write\n */\n/**\n * @typedef {Object} STTMAction\n * @property {string} [state]\n * @property {string}  move\n * @property {string} [write]\n */\n/** @typedef {STTMAction|MTTMAction} TMAction */\n\n/**\n * @typedef {{[key: string]: TMAction}} SynonymMap\n */\n\n/**\n * @throws {TMSpecError} if the target state is undeclared (not in the table)\n * @param {?SynonymMap} synonyms\n * @param {TransitionTable} table\n * @param {string | Object} val\n * @param {int} tapes\n * @return Readonly<TMAction>\n */\nfunction parseInstruction(synonyms, table, val, tapes) {\n    return checkTarget(table, function () {\n        switch (typeof val) {\n            case 'string':\n                return parseInstructionString(synonyms, val, tapes)\n            case 'object':\n                if (tapes) {\n                    throw new TMSpecError('Multitape TM only supports string instructions')\n                }\n                return parseInstructionObject(val)\n            default:\n                throw new TMSpecError(\n                    'Invalid instruction type',\n                    {\n                        problemValue: typeof val,\n                        info: 'An instruction can be a string '\n                            + '(a direction <code>L</code>/<code>R</code> or a synonym)'\n                            + ' or a mapping (examples: <code>{R: accept}</code>, '\n                            + '<code>{write: \\' \\', L: start}</code>)',\n                    },\n                )\n        }\n    }())\n}\n\n// case: direction or synonym\n/**\n *\n * @param {?SynonymMap} synonyms\n * @param {string} val\n * @param {int} tapes\n * @returns {TMAction}\n */\nfunction parseInstructionString(synonyms, val, tapes) {\n    if (tapes) {\n        if (synonyms && synonyms[val]) {\n            return synonyms[val]\n        }\n        let state = val.match(/^([^\\d]\\w+)?( |$)/)\n        let move = Array(tapes).fill('H')\n        let write = Array(tapes)\n        if (state != null) {\n            val = val.slice(state[1].length).trim()\n            state = state[1]\n        }\n        let tape_numbers = []\n        while (val !== '') {\n            let tape = val.match(/^(\\d)([RL]?)([^ ]?)( |$)/)\n            if (tape === null) {\n                throw new TMSpecError(\n                    'Unrecognized string',\n                    {\n                        problemValue: val,\n                        info: 'An instruction can be a synonym or a state with instructions for'\n                            + ' tapes. Examples: <code>state2 1R 2R0</code>, <code>2Lx 3R</code>',\n                    },\n                )\n            }\n            val = val.slice(tape[0].length).trimLeft()\n            let tape_number = parseInt(tape[1])\n            if (tape_number === 0) {\n                throw new TMSpecError('Tape numbers start from 1', {problemValue: val})\n            }\n            if (tape_number > tapes) {\n                throw new TMSpecError(\n                    'Tape number is bigger than the number of tapes',\n                    {\n                        problemValue: val,\n                        info: `Your machine has only ${tapes} tapes`,\n                    },\n                )\n            }\n            tape_number -= 1\n            if (tape_numbers.includes(tape_number)) {\n                throw new TMSpecError(\n                    'Two instructions for tape ' + tape_number,\n                    {problemValue: val},\n                )\n            }\n            tape_numbers.push(tape_number)\n            if (tape[2] !== '')\n                move[tape_number] = tape[2]\n            if (tape[3] !== '')\n                write[tape_number] = tape[3] === '_' ? ' ' : tape[3]\n        }\n        return makeInstruction(write, move.join(''), state)\n    } else {\n        if (val === 'L') {\n            return {move: 'L'}\n        } else if (val === 'R') {\n            return {move: 'R'}\n        }\n        // note: this order prevents overriding L/R in synonyms, as that would\n        // allow inconsistent notation, e.g. 'R' and {R: ..} being different.\n        if (synonyms && synonyms[val]) {\n            return synonyms[val]\n        }\n        throw new TMSpecError(\n            'Unrecognized string',\n            {\n                problemValue: val,\n                info: 'An instruction can be a string if it\\'s a synonym or a direction',\n            },\n        )\n    }\n}\n\n// type ActionObj = {write?: any, L: ?string} | {write?: any, R: ?string}\n// case: ActionObj\nfunction parseInstructionObject(val) {\n    let symbol, move, state\n    if (val == null) {\n        throw new TMSpecError('Missing instruction')\n    }\n    // prevent typos: check for unrecognized keys\n    {\n        let badKey\n        if (!Object.keys(val).every(function (key) {\n            badKey = key\n            return key === 'L' || key === 'R' || key === 'H' || key === 'write'\n        })) {\n            throw new TMSpecError(\n                'Unrecognized key',\n                {\n                    problemValue: badKey,\n                    info: 'An instruction always has a tape movement <code>L</code> or <code>R</code>, '\n                        + 'and optionally can <code>write</code> a symbol',\n                },\n            )\n        }\n    }\n    // one L/R key is required, with optional state value\n    if ('L' in val && 'R' in val) {\n        throw new TMSpecError(\n            'Conflicting tape movements',\n            {info: 'Each instruction needs exactly one movement direction, but two were found'},\n        )\n    }\n    if ('L' in val) {\n        move = 'L'\n        state = val.L\n    } else if ('R' in val) {\n        move = 'R'\n        state = val.R\n    } else if ('H' in val) {\n        move = 'H'\n        state = val.H\n    } else {\n        throw new TMSpecError('Missing movement direction')\n    }\n    // write key is optional, but must contain a char value if present\n    if ('write' in val) {\n        let writeStr = String(val.write)\n        if (writeStr.length === 1) {\n            symbol = [writeStr]\n        } else {\n            throw new TMSpecError('Write requires a string of length 1')\n        }\n    }\n    return makeInstruction(symbol, move, state)\n}\n\n/**\n *\n * @param {VisTable} vis\n * @param {TransitionTable} table\n * @param {int} tapes_count\n * @returns {VisTable}\n */\nfunction parseVis(vis, table, tapes_count) {\n    if (tapes_count === 0)\n        tapes_count = 1\n    let res = {titles: {}, info: {}, colors: {}}\n    for (let i = 0; i < tapes_count; i++)\n        res[i] = {}\n    if (!vis)\n        return res\n\n    for (const [state, rules] of Object.entries(vis)) {\n        if (!(state in table)) {\n            throw new TMSpecError('Visualization state must be on the state table', {problemValue: state})\n        }\n        for (const [tapes, rule] of Object.entries(rules)) {\n            if (tapes === 'title') {\n                res.titles[state] = rule\n                continue\n            }\n            if (tapes === 'info') {\n                res.info[state] = rule\n                continue\n            }\n            if (tapes === 'color') {\n                res.colors[state] = String(rule)\n                continue\n            }\n\n            for (let tape of tapes.split(',')) {\n                tape = parseInt(tape) - 1\n                if (isNaN(tape)) {\n                    throw new TMSpecError('Visualization table requires comma-separated tape'\n                        + ' numbers', {problemValue: tapes, state})\n                }\n                if (tape < 0) {\n                    throw new TMSpecError('Tape numbers start from 1', {problemValue: tapes, state})\n                }\n                if (tape >= tapes_count) {\n                    throw new TMSpecError(\n                        'Tape number is bigger than the number of tapes',\n                        {\n                            problemValue: tapes,\n                            info: `Your machine has only ${tapes} tapes`,\n                        },\n                    )\n                }\n                if (rule.skip && (typeof rule.skip != 'number' || !Number.isInteger(rule.skip))) {\n                    throw new TMSpecError('\"skip\" must be an integer', {problemValue: rule.skip, state})\n                }\n                assert_in(rule.mode, 'mode', ['row', 'find'], state, tapes)\n                assert_in(rule.dir, 'dir', ['->', '<-'], state, tapes)\n                assert_in(rule.color, 'color', ['green', 'blue', 'red'], state, tapes)\n                rule.chars = String(rule.chars)\n                res[tape][state] = Object.assign({}, rule)\n            }\n        }\n    }\n    return res\n}\n\nfunction assert_in(val, name, arr, state, tapes) {\n    if (!arr.includes(val)) {\n        throw new TMSpecError(\n            `${name} has incorrect value`,\n            {\n                problemValue: val,\n                state,\n                symbol: tapes,\n                info: 'Possible values are: ' + JSON.stringify(arr),\n            },\n        )\n    }\n}\n\nexports.TMSpecError = TMSpecError\nexports.parseSpec = parseSpec\n// re-exports\nexports.YAMLException = jsyaml.YAMLException\n","module.exports = jsyaml;","'use strict'\n\n/**\n * Thrown when parsing a string that is valid as YAML but invalid\n * as a machine specification.\n *\n * Examples: unrecognized synonym, no start state defined,\n * transitioning to an undeclared state.\n *\n * A readable message is generated based on the details (if any) provided.\n * @param {string} reason  A readable error code.\n *   As an error code, this should be relatively short and not include runtime values.\n * @param {?Object} details Optional details. Possible keys:\n *                          problemValue, state, key, synonym, info, suggestion\n */\nfunction TMSpecError(reason, details = {}) {\n    this.name = 'TMSpecError'\n    this.stack = (new Error()).stack\n\n    this.reason = reason\n    this.details = details || {}\n}\n\nTMSpecError.prototype = Object.create(Error.prototype)\nTMSpecError.prototype.constructor = TMSpecError\n\n// generate a formatted description in HTML\nObject.defineProperty(TMSpecError.prototype, 'message', {\n    get: function () {\n        let header = this.reason\n        let details = this.details\n\n        function code(str) {\n            return '<code>' + str + '</code>'\n        }\n\n        function showLoc(state, symbol, synonym) {\n            if (state != null) {\n                if (symbol != null) {\n                    return ' in the transition from state ' + code(state) + ' and symbol ' + code(\n                        symbol)\n                } else {\n                    return ' for state ' + code(state)\n                }\n            } else if (synonym != null) {\n                return ' in the definition of synonym ' + code(synonym)\n            }\n            return ''\n        }\n\n        let problemValue = details.problemValue ? ' ' + code(details.problemValue) : ''\n        let location = showLoc(details.state, details.symbol, details.synonym)\n        let sentences = [\n            '<strong>' + header + problemValue + '</strong>' + location\n            , details.info, details.suggestion,\n        ]\n            .filter(_.identity)\n            .map(function (s) {\n                return s + '.'\n            })\n        if (location) {\n            sentences.splice(1, 0, '<br>')\n        }\n        return sentences.join(' ')\n    },\n    enumerable: true,\n})\n\nexports.TMSpecError = TMSpecError","module.exports = ace;","'use strict';\n\nvar KeyValueStorage = require('./storage').KeyValueStorage,\n    examples = require('./examples'),\n    util = require('./util'),\n    _ = require('lodash/fp');\n\n/**\n * Document model (storage).\n * @param {string} docID Each document ID in a key-value store should be unique.\n *                       An ID is typically a timestamp. It should not contain '.'.\n */\nfunction TMDocument(docID) {\n  var preset = examples.get(docID);\n  Object.defineProperties(this, {\n    id:     { value: docID },\n    prefix: { value: 'doc.' + docID },\n    isExample: { value: preset ? true : false }\n  });\n  // fall back to reading presets for example documents\n  if (preset) {\n    Object.defineProperties(this, {\n      sourceCode: useFallbackGet(preset, this, 'sourceCode'),\n      // names are read-only\n      positionTable: useFallbackGet(preset, this, 'positionTable'),\n      name: {\n        get: function () { return preset.name; },\n        set: function () {}, // don't err when removing (set = null)\n        enumerable: true\n      }\n    });\n  }\n}\n\nfunction useFallbackGet(preset, obj, prop) {\n  var proto = Object.getPrototypeOf(obj);\n  var desc = Object.getOwnPropertyDescriptor(proto, prop);\n  var get = desc.get;\n  desc.get = function () {\n    return util.coalesce(get.call(obj), preset[prop]);\n  };\n  return desc;\n}\n\n// internal method.\nTMDocument.prototype.path = function (path) {\n  return [this.prefix, path].join('.');\n};\n\n(function () {\n  var store = KeyValueStorage;\n  var read = store.read.bind(store);\n  var write = function (key, val) {\n    if (val != null) {\n      store.write(key, val);\n    } else {\n      store.remove(key);\n    }\n  };\n  // var remove = store.remove.bind(store);\n  function stringProp(path) {\n    return {\n      get: function () { return read(this.path(path)); },\n      set: function (val) { write(this.path(path), val); },\n      enumerable: true\n    };\n  }\n\n  var propDescriptors = {\n    sourceCode: stringProp('diagram.sourceCode'),\n    positionTable: {\n      get: function () {\n        return util.applyMaybe(parsePositionTable,\n          read(this.path('diagram.positions')));\n      },\n      set: function (val) {\n        write(this.path('diagram.positions'),\n          util.applyMaybe(stringifyPositionTable, val));\n      },\n      enumerable: true\n    },\n    editorSourceCode: stringProp('editor.sourceCode'),\n    name: stringProp('name')\n  };\n  Object.defineProperties(TMDocument.prototype, propDescriptors);\n  TMDocument.prototype.dataKeys = Object.keys(propDescriptors);\n})();\n\n// IDEA: bypass extra parse & stringify cycle for positions\nTMDocument.prototype.copyFrom = function (other) {\n  this.dataKeys.forEach(function (key) {\n    this[key] = other[key];\n  }, this);\n  return this;\n};\n\nTMDocument.prototype.delete = function () {\n  this.copyFrom({});\n};\n\n// Cross-tab/window storage sync\n\n/**\n * Checks whether a storage key is for a document's name.\n * @return {?string} The document ID if true, otherwise null.\n */\nTMDocument.IDFromNameStorageKey = function (string) {\n  var result = /^doc\\.([^.]+)\\.name$/.exec(string);\n  return result && result[1];\n};\n\n/**\n * Registers a listener for document changes caused by other tabs/windows.\n * The listener receives the document ID and the property name that changed.\n * @param {Function} listener\n */\nTMDocument.addOutsideChangeListener = function (listener) {\n  var re = /^doc\\.([^.]+)\\.(.+)$/;\n\n  KeyValueStorage.addStorageListener(function (e) {\n    var matches = re.exec(e.key);\n    if (matches) {\n      listener(matches[1], matches[2]);\n    }\n  });\n};\n\n/////////////////////////\n// Position table JSON //\n/////////////////////////\n\n// JSON -> Object\nvar parsePositionTable = JSON.parse;\n\n// PositionTable -> JSON\nvar stringifyPositionTable = _.flow(\n  _.mapValues(truncateCoords(2)),\n  JSON.stringify\n);\n\n// Truncate .x .y .px .py to 2 decimal places, to save space.\nfunction truncateCoords(decimalPlaces) {\n  var multiplier = Math.pow(10, decimalPlaces);\n  function truncate(value) {\n    return Math.round(value * multiplier)/multiplier;\n  }\n\n  return function (val) {\n    var result =  _(val).pick(['x','y','px','py']).mapValues(truncate).value();\n    result.fixed = val.fixed;\n    return result;\n  };\n}\n\nmodule.exports = TMDocument;\n","'use strict';\n\n/* eslint-env browser */\nvar CheckboxTable = require('./CheckboxTable');\nvar FileReaderPromise = require('./FileReaderPromise');\nvar format = require('./format');\nvar getGist = require('./gist').getGist;\n\nvar $ = require('jquery');\nvar _ = require('lodash/fp');\nvar d3 = require('d3');\nvar Promise = require('bluebird');  // eslint-disable-line no-shadow\n\n\nfunction decodeFormURLComponent(str) {\n  return decodeURIComponent(str.replace('+', ' '));\n}\n\n/**\n * https://url.spec.whatwg.org/#urlencoded-parsing\n */\nfunction queryParams(queryString) {\n  function decode(str) {\n    return str ? decodeFormURLComponent(str) : '';\n  }\n  var result = {};\n  queryString.split('&').forEach(function (str) {\n    var pair = str.split('=');\n    result[decode(pair[0])] = decode(pair[1]);\n  });\n  return result;\n}\n\n///////////////////\n// Import Dialog //\n///////////////////\n\n// requires an existing dialog in the DOM\nfunction ImportDialog(dialogNode) {\n  this.node = dialogNode;\n  this.titleNode = dialogNode.querySelector('.modal-header .modal-title');\n  this.bodyNode = dialogNode.querySelector('.modal-body');\n  this.footerNode = dialogNode.querySelector('.modal-footer');\n  this.cancelButtonNode = d3.select(this.footerNode).text('')\n    .append('button')\n      .attr({type: 'button', class: 'btn btn-default', 'data-dismiss': 'modal'})\n      .text('Cancel')\n    .node();\n  this.$dialog = $(dialogNode)\n    .one('hide.bs.modal', this.__onClose.bind(this));\n}\n\n// internal event handler.\nImportDialog.prototype.__onClose = function () {\n  this.onClose();\n  // use .empty to clean up $.on used in CheckboxTable\n  $(this.bodyNode).empty();\n  $(this.footerNode).empty();\n};\n\n// configurable\nImportDialog.prototype.onClose = function () {\n};\n\nImportDialog.prototype.show = function () {\n  this.$dialog.modal({backdrop: 'static', keyboard: false});\n};\n\nImportDialog.prototype.close = function () {\n  this.$dialog.modal('hide');\n};\n\nImportDialog.prototype.setBodyChildNodes = function (nodes) {\n  this.bodyNode.textContent = '';\n  this.bodyNode.appendChild(joinNodes(nodes));\n};\n\nfunction appendPanel(div, titleHTML) {\n  var panel = div.append('div')\n      .attr('class', 'panel panel-default');\n  panel.append('div')\n      .attr('class', 'panel-heading')\n    .append('h5')\n      .attr('class', 'panel-title')\n      .html(titleHTML);\n  return panel;\n}\n\nvar emptySelection = Object.freeze(d3.selectAll([]));\n\n// (D3Selection, {title: string, data: [string]}) -> void\nfunction appendListPanel(container, data) {\n  var panel = emptySelection;\n  if (data.data && data.data.length) {\n    panel = appendPanel(container, data.title);\n    panel.append('div')\n        .attr('class', 'panel-body')\n      .append('ul')\n        .attr('class', 'list-inline')\n      .selectAll('li')\n        .data(data.data)\n      .enter().append('li')\n        .text(_.identity);\n  }\n  return panel;\n}\n\n// ( D3Selection, {title: string, headers: [string],\n//  data: [[string | (D3Selection -> void)]]} ) -> void\nfunction appendTablePanel(container, data) {\n  var panel = emptySelection;\n  if (data.data && data.data.length) {\n    panel = appendPanel(container, data.title);\n    panel.append('table')\n        .attr('class', 'table')\n        .call(function (table) {\n          // headers\n          table.append('thead')\n            .append('tr').selectAll('th').data(data.headers)\n            .enter().append('th').text(_.identity);\n          // contents\n          table.append('tbody').selectAll('tr')\n              .data(data.data)\n            .enter().append('tr').selectAll('td')\n              .data(_.identity)\n            .enter().append('td').each(/* @this td */ function (d) {\n              var td = d3.select(this);\n              if (typeof d === 'function') {\n                d(td);\n              } else {\n                td.text(d);\n              }\n            });\n        });\n  }\n  return panel;\n}\n\n// NonDocumentFiles -> boolean\nvar isEmptyNonDocs = _.every(_.isEmpty);\n\n// (D3Selection, NonDocumentFiles, ?string) -> void\nfunction listNondocuments(dialogBody, nondocs, disclosureTitle) {\n  if (isEmptyNonDocs(nondocs)) {\n    return;\n  }\n  // Disclosure triangle\n  var collapseId = 'nondocument-files';\n  dialogBody.append('a')\n      .attr({\n        href: '#'+collapseId,\n        class: 'disclosure-triangle collapsed',\n        role: 'button',\n        'data-toggle': 'collapse'\n      })\n      .text(disclosureTitle ? disclosureTitle : 'Show other files');\n  var container = dialogBody.append('div')\n      .attr({\n        id: collapseId,\n        class: 'collapse'\n      });\n  // Errors by type, most important first\n  appendTablePanel(container, {\n    title: 'Unexpected error',\n    headers: ['Filename', 'Error'],\n    data: nondocs.otherError.map(function functionName(d) {\n      return [d.filename, errorString(d.error) ];\n    })\n  }).classed('panel-danger', true);\n  appendTablePanel(container, {\n    title: 'Not suitable for import',\n    headers: ['Filename', 'Reason'],\n    data: nondocs.badDoc.map(function (d) {\n      return [d.filename, d.error.message];\n    })\n  });\n  appendTablePanel(container, {\n    title: 'Not valid as YAML',\n    headers: ['Filename', 'Syntax error'],\n    data: nondocs.badYAML.map(function (d) {\n      return [d.filename,\n        function (td) { td.append('pre').text(d.error.message); } ];\n    })\n  });\n  // TODO: document largest allowed filesize; limit export likewise\n  appendListPanel(container, {\n    title: 'File is too large',\n    data: nondocs.tooLarge\n  });\n  appendListPanel(container, {\n    title: 'Different file extension (not <code>.yaml</code>/<code>.yml</code>)',\n    data: nondocs.wrongType\n  });\n}\n\n// deal with objects like DOMError (whose .toString gives \"[object FileError]\")\nfunction errorString(reason) {\n  return reason instanceof Error\n    ? String(reason)\n    : reason.message || reason.name || String(reason);\n}\n\n//////////////////////\n// Document Parsing //\n//////////////////////\n\n/* Interface for Document Parsing\n  type GistFile = {\n    filename: string,\n    size: number,\n    truncated: boolean,\n    content: string\n  };\n  type TMData = {source code: string};\n  type DocFile = {filename: string, size: number, document: TMData};\n\n  type Filename = string;\n  type ErrorTuple = {filename: Filename, error: Error | YAMLException};\n  type NonDocumentFiles = {\n    wrongType:  [Filename],\n    tooLarge:   [Filename],\n    badYAML:    [ErrorTuple],\n    badDoc:     [ErrorTuple],\n    otherError: [ErrorTuple]\n  };\n  type ParseResult = {documentFiles: [DocFile], nonDocumentFiles: NonDocumentFiles};\n */\n\n// Parse each file into a document or a categorized error.\n// Local files are read only if they have the right extension and size.\n// NB. make sure to convert FileList to an actual Array.\n// The promise resolves with ParseResult.\n// (number, [GistFile | File]) -> Promise\nfunction parseFiles(sizelimit, files) {\n  var docfiles = [];\n  var nondocs = {wrongType: [], tooLarge: [], badYAML: [], badDoc: [], otherError: []};\n\n  return Promise.each(files, function (file) {\n    var name = file.filename || file.name; // eslint-disable-line no-shadow\n    if (name.search(/\\.ya?ml$/) === -1) {\n      nondocs.wrongType.push(name);\n    } else if (file.truncated || file.size > sizelimit) {\n      nondocs.tooLarge.push(name);\n    } else {\n      return Promise.resolve(file.content != null ? file.content\n        : FileReaderPromise.readAsText(file))\n      .then(function (content) {\n        docfiles.push({\n          filename: name,\n          size: file.size,\n          document: format.parseDocument(content)\n        });\n      }).catch(function (e) {\n        var tuple = {filename: name, error: e};\n        if (e instanceof format.YAMLException) {\n          nondocs.badYAML.push(tuple);\n        } else if (e instanceof format.InvalidDocumentError) {\n          nondocs.badDoc.push(tuple);\n        } else {\n          nondocs.otherError.push(tuple);\n        }\n      });\n    }\n  }).return({documentFiles: docfiles, nonDocumentFiles: nondocs});\n}\n\n/////////////////////\n// Document Import //\n/////////////////////\n\nfunction showSizeKB(n) {\n  // example: 12.0 KB\n  return (Math.ceil(10*n/1024)/10).toFixed(1) + ' KB';\n}\n\n// {docFiles: [DocFile], nonDocumentFiles: NonDocumentFiles,\n//  dialog: ImportDialog, citeNode?: Node, importDocuments: [TMData] -> void} -> void\nfunction pickMultiple(args) {\n  var docfiles = args.documentFiles,\n      nondocs = args.nonDocumentFiles,\n      citeNode = args.citeNode,\n      dialog = args.dialog,\n      importDocuments = args.importDocuments;\n  // Dialog body\n  var dialogBody = d3.select(dialog.bodyNode).text('');\n  dialogBody.append('p').call(function (p) {\n    p.append('strong').text('Select documents to import');\n    if (citeNode) {\n      p.node().appendChild(document.createTextNode(' from '));\n      p.node().appendChild(citeNode);\n    }\n  });\n  var ctable = new CheckboxTable({\n    table: dialogBody.append('table')\n      .attr({class: 'table table-hover checkbox-table'}),\n    headers: ['Filename', 'Size'],\n    data: docfiles.map(function (doc) {\n      return [doc.filename, showSizeKB(doc.size)];\n    })\n  });\n  listNondocuments(dialogBody, nondocs);\n  // Dialog footer\n  var importButton = d3.select(dialog.footerNode).append('button')\n      .attr({type: 'button', class: 'btn btn-primary', 'data-dismiss': 'modal'})\n      .property('disabled', true)\n      .text('Import')\n      .on('click', /* @this button */ function () {\n        d3.select(this).on('click', null); // prevent double import; like .one()\n        var names = d3.set(ctable.getCheckedValues());\n        importDocuments(docfiles\n          .filter(function (file) { return names.has(file.filename); })\n          .map(_.property('document'))\n        );\n      })\n    .node();\n  ctable.onChange = function () {\n    importButton.disabled = ctable.isCheckedEmpty();\n  };\n}\n\n// {nonDocumentFiles: NonDocumentFiles, dialog: ImportDialog, citeLink?: Node} -> void\nfunction pickNone(args) {\n  var nondocs = args.nonDocumentFiles,\n      dialog = args.dialog,\n      citeLink = args.citeLink;\n\n  d3.select(dialog.bodyNode).text('').call(function (body) {\n    body.append('p').append('strong').text(!isEmptyNonDocs(nondocs)\n        ? 'None of the files are suitable for import.'\n        : 'No files were selected.');\n    if (citeLink) {\n      body.append('p').text('Requested URL: ').node().appendChild(citeLink);\n    }\n    listNondocuments(body, nondocs, 'Show details');\n  });\n  dialog.cancelButtonNode.textContent = 'Close';\n}\n\n// Intermingle text and nodes.\n// [Node | string] -> DocumentFragment\nfunction joinNodes(nodes) {\n  var result = document.createDocumentFragment();\n  nodes.forEach(function (node) {\n    if (typeof node === 'string') {\n      result.appendChild(document.createTextNode(node));\n    } else {\n      result.appendChild(node);\n    }\n  });\n  return result;\n}\n\nfunction wrapTag(tagName, node) {\n  var tag = document.createElement(tagName);\n  tag.appendChild(node);\n  return tag;\n}\n\n// Create a link with text <q>`gist description`</q> if given, otherwise gist `gistID`.\n// {gistID: string, description?: string} -> HTMLAnchorElement | HTMLQuoteElement\nfunction gistDescriptionLink(args) {\n  var link = externalLink({\n    href: 'https://gist.github.com/' + args.gistID,\n    textContent: args.description || ('gist ' + args.gistID)\n  });\n  return args.description ? wrapTag('q', link) : link;\n}\n\n// {href: string, textContent?: string} -> HTMLAnchorElement\nfunction externalLink(args) {\n  var link = document.createElement('a');\n  link.href = args.href;\n  link.target = '_blank';\n  link.textContent = args.textContent || args.href;\n  return link;\n}\n\n// The returned promise resolves/cancels when the dialog is closed:\n//  resolves if loading (before import) finished and the user cancelled anyway\n//  cancels if files were still loading and not yet displayed (eg. fetch, parse)\n// ({gistID: string, dialogNode: Node, importDocument: TMData -> void} |\n// {files: FileList, dialogNode: Node, importDocument: TMData -> void}) -> Promise\nfunction importCommon(args) {\n  var gistID = args.gistID,\n      dialogNode = args.dialogNode,\n      importDocument = args.importDocument;\n\n  var dialog = new ImportDialog(dialogNode);\n  var citeLink;\n  var citeNode;\n  // prevent accidentally exceeding quota\n  var MAX_FILESIZE = 400 * 1024;\n  // Start fetch, show dialog\n  var filesPromise = (function () {\n    if (gistID != null) {\n      dialog.titleNode.textContent = 'Import from GitHub gist';\n      citeLink = externalLink({href: 'https://gist.github.com/' + gistID});\n      dialog.setBodyChildNodes(['Retrieving ', citeLink, '']);\n      return getGist(gistID).then(function (data) {\n        citeNode = gistDescriptionLink({\n          gistID: gistID,\n          description: data.description\n        });\n        dialog.setBodyChildNodes(['Processing ', citeLink, '']);\n        return _.values(data.files);\n      });\n    } else {\n      dialog.titleNode.textContent = 'Import from files';\n      dialog.setBodyChildNodes(['Processing files']);\n      return Promise.resolve(_.toArray(args.files));\n    }\n  }());\n  dialog.show();\n  // Parse, pick, import\n  var promise = filesPromise\n  .then(parseFiles.bind(undefined, MAX_FILESIZE))\n  .then(function (parsed) {\n    var docfiles = parsed.documentFiles;\n    switch (docfiles.length) {\n      case 0:\n        pickNone({\n          nonDocumentFiles: parsed.nonDocumentFiles,\n          dialog: dialog,\n          citeLink: citeLink\n        });\n        return;\n      case 1:\n        importDocument(docfiles[0].document);\n        dialog.close();\n        return;\n      default:\n        pickMultiple({\n          documentFiles: docfiles,\n          nonDocumentFiles: parsed.nonDocumentFiles,\n          dialog: dialog,\n          citeNode: citeNode,\n          importDocuments: function importDocuments(docs) {\n            docs.concat().reverse().map(importDocument);\n          }\n        });\n    }\n  })\n  .catch(function (reason) {\n    dialog.setBodyChildNodes([messageForError(reason)]\n      .concat(citeLink ? ['Requested URL: ', citeLink] : [])\n    );\n    dialog.cancelButtonNode.textContent = 'Close';\n  });\n  var waitForDialog = new Promise(function (resolve) {\n    dialog.onClose = function () {\n      promise.cancel();\n      resolve();\n    };\n  });\n  return promise.return(waitForDialog);\n}\n\n// {gistID: string, dialogNode: Node, importDocument: TMData -> void} -> Promise\nvar importGist = importCommon;\n\n// {files: FileList, dialogNode: Node, importDocument: TMData -> void} -> Promise\nvar importLocalFiles = importCommon;\n\nfunction createElementHTML(tagName, innerHTML) {\n  var element = document.createElement(tagName);\n  element.innerHTML = innerHTML;\n  return element;\n}\n\n// ({xhr: jqXHR} | Error) -> Node\nfunction messageForError(reason) {\n  var xhr = reason.xhr;\n  if (xhr) {\n    // case: couldn't fetch\n    return createElementHTML('p', (function () {\n      switch (reason.status) {\n        case 'abort':\n          return [''];\n        case 'timeout':\n          return [\n            '<strong>The request timed out.</strong>',\n            'You can check your connection and try again.'\n          ];\n        default:\n        // case: HTTP error\n          if (xhr.status === 404) {\n            return [\n              '<strong>No GitHub gist exists with that ID.</strong>',\n              'Its possible the ID is incorrect, or the gist was deleted.'\n            ];\n          } else if (xhr.status === 0) {\n            return ['GitHub could not be reached. Your Internet connection may be offline.'];\n          } else {\n            return [\n              'The import failed because of a <strong>connection error</strong>.',\n              'HTTP status code: ' + xhr.status + ' ' + xhr.statusText\n            ];\n          }\n      }\n    }()).join('<br>'));\n  } else {\n    // case: other error\n    var pre = document.createElement('pre');\n    pre.textContent = errorString(reason);\n    return joinNodes([\n      createElementHTML('p', 'An unexpected error occurred:'), pre]);\n  }\n}\n\n// Import a gist via ?import-gist=gistID and remove the query string from the URL.\n// Call this once the DOM is ready (document.readyState === 'interactive').\n// {dialogNode: Node, importDocument: TMData -> void} -> void\nfunction runImport(args) {\n  function removeQuery() {\n    try {\n      history.replaceState(null, null, location.pathname);\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  var params = queryParams(location.search.substring(1));\n  var gistID = params['import-gist'];\n  if (gistID) {\n    importGist(_.assign({gistID: gistID}, args))\n    .finally(removeQuery);\n  }\n}\n\nexports.importGist = importGist;\nexports.importLocalFiles = importLocalFiles;\nexports.runImport = runImport;\n","'use strict';\n\nvar $ = require('jquery');\nvar Promise = require('bluebird'); // eslint-disable-line no-shadow\n\nPromise.config({\n  cancellation: true\n});\n\n// On success, 'resolve' is called with the response data.\n// On failure, 'reject' is called with {xhr: jqXHR, status: string, error: string}.\n// To abort the request, use .cancel (from bluebird). Neither is called in that case.\n// jqXHR -> Promise\nfunction promisifyAjax(xhr) {\n  return new Promise(function (resolve, reject, onCancel) {\n    xhr.then(resolve, function (jqXHR, textStatus, errorThrown) {\n      reject({xhr: jqXHR, status: textStatus, error: errorThrown});\n    });\n    onCancel && onCancel(function () {\n      try { xhr.abort(); } catch (e) {/* */}\n    });\n  });\n}\n\n// GistID -> Promise\n// @see promisifyAjax\nfunction getGist(gistID) {\n  return promisifyAjax($.ajax({\n    url: 'https://api.github.com/gists/' + gistID,\n    type: 'GET',\n    dataType: 'json',\n    accepts: 'application/vnd.github.v3+json' // specify API version for stability\n  }));\n}\n\n// https://developer.github.com/v3/gists/#create-a-gist\n// @see promisifyAjax\n// {files: {[filename: string]: {content: string}},\n//  description?: string, public?: boolean} -> Promise\nfunction createGist(payload) {\n  // return Promise.delay(1000, {id: 'offlinetesting'});\n  return promisifyAjax($.ajax({\n    url: 'https://api.github.com/gists',\n    type: 'POST',\n    data: JSON.stringify(payload),\n    // headers: {Authorization: 'token DEVTOKEN'},\n    dataType: 'json', // response datatype\n    accepts: 'application/vnd.github.v3+json' // specify API version for stability\n  }));\n}\n\nexports.getGist = getGist;\nexports.createGist = createGist;\n","// main entry point for index.html.\n// important: make sure to coordinate variables and elements between the HTML and JS\n'use strict'\n\n/* eslint-env browser */\nvar TMDocumentController = require('./TMDocumentController'),\n    DocumentMenu = require('./DocumentMenu'),\n    examples = require('./examples'),\n    toDocFragment = require('./util').toDocFragment\nvar ace = require('ace-builds/src-min-noconflict')\nvar $ = require('jquery') // for Bootstrap modal dialog events\n\n// load up front so going offline doesn't break anything\n// (for snippet placeholders, used by \"New blank document\")\nace.config.loadModule('ace/ext/language_tools')\n\nfunction getId(id) {\n    return document.getElementById(id)\n}\n\nfunction addAlertPane(type, html) {\n    getId('diagram-column').insertAdjacentHTML(\n        'afterbegin',\n        '<div class=\"alert alert-' + type + ' alert-dismissible\" role=\"alert\">' +\n        '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\"></span></button>' +\n        html +\n        '</div>',\n    )\n}\n\n\n//////////////////////////\n// Compatibility Checks //\n//////////////////////////\n\n(function () {\n    // Warn when falling back to RAM-only storage\n    // NB. This mainly covers local storage errors and Safari's Private Browsing.\n    if (!require('./storage').canUseLocalStorage) {\n        addAlertPane('info', '<p>Local storage is unavailable. ' +\n            'Your browser could be in Private Browsing mode, or it might not support <a href=\"http://caniuse.com/#feat=namevalue-storage\" target=\"_blank\">local storage</a>.</p>' +\n            '<strong>Any changes will be lost after leaving the webpage.</strong>')\n    }\n\n    /*\n    Warn for IE 10 and under, which misbehave and lack certain features.\n    Examples:\n       IE 9 and under don't support .classList.\n       IE 10's \"storage event is fired even on the originating document where it occurred.\"\n        http://caniuse.com/#feat=namevalue-storage\n    */\n\n    // Detect IE 10 and under (http://stackoverflow.com/a/16135889)\n    var isIEUnder11 = new Function('/*@cc_on return @_jscript_version; @*/')() < 11\n    if (isIEUnder11) {\n        addAlertPane(\n            'warning',\n            '<p><strong>Your <a href=\"http://whatbrowser.org\" target=\"_blank\">web browser</a> is out of date</strong> and does not support some features used by this program.<br>' +\n            '<em>The page may not work correctly, and data may be lost.</em></p>' +\n            'Please update your browser, or use another browser such as <a href=\"http://www.google.com/chrome/browser/\" target=\"_blank\">Chrome</a> or <a href=\"http://getfirefox.com\" target=\"_blank\">Firefox</a>.',\n        )\n    }\n\n    // Warn about iOS local storage volatility\n    $(function () {\n        // Detect iOS (http://stackoverflow.com/a/9039885)\n        var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream\n        if (isIOS) {\n            getId('misc-tips-list').insertAdjacentHTML(\n                'afterbegin',\n                '<li><strong class=\"text-warning\">Important note for iOS</strong>: ' +\n                'iOS saves browser local storage in the cache folder, which is <strong>not backed up</strong>, and is ' +\n                '<q cite=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Browser_compatibility\"><strong>subject to occasional clean up</strong>, ' +\n                'at the behest of the OS, typically if space is short.</q></li>',\n            )\n        }\n    })\n}())\n\n\n/////////////////////\n// Import & Export //\n/////////////////////\n\nfunction importDocument(obj) {\n    // duplicate data into the menu, then open it.\n    menu.duplicate(obj, {select: true, type: 'open'})\n}\n\n$(function () {\n    // Enable buttons now that handlers are ready\n    $('.tm-needsready').prop('disabled', false)\n\n    // Run import from URL query (if any)\n    var importArgs = {\n        dialogNode: getId('importDialog'),\n        importDocument: importDocument,\n    }\n    require('./sharing/import').runImport(importArgs)\n    // Init import dialog\n    var $importPanel = $('#importPanel')\n    $importPanel.one('show.bs.modal', function () {\n        require('./sharing/import-panel').init({\n            $dialog: $importPanel,\n            gistIDForm: getId('gistIDForm'),\n            importArgs: importArgs,\n        })\n    })\n    // Init export dialog\n    var exportPanel = getId('exportPanel')\n    require('./sharing/export-panel').init({\n        $dialog: $(exportPanel),\n        getCurrentDocument: function () {\n            controller.save() // IMPORTANT: save changes, otherwise data model is out of date\n            return menu.currentDocument\n        },\n        getIsSynced: controller.getIsSynced.bind(controller),\n        gistContainer: getId('shareGistContainer'),\n        downloadContainer: getId('exportDownloadContainer'),\n        copyContentsButton: getId('copyContentsButton'),\n        textarea: exportPanel.querySelector('textarea'),\n    })\n})\n\n\n///////////////////\n// Document List //\n///////////////////\n\nvar menu = (function () {\n    var select = document.getElementById('tm-doc-menu')\n    // Group: Documents\n    var docGroup = document.createElement('optgroup')\n    docGroup.label = 'Documents'\n    select.appendChild(docGroup)\n    // Group: Examples\n    var exampleGroup = document.createElement('optgroup')\n    exampleGroup.label = 'Examples'\n    exampleGroup.appendChild(toDocFragment(examples.list.map(\n        DocumentMenu.prototype.optionFromDocument)))\n    select.appendChild(exampleGroup)\n\n    return new DocumentMenu({\n        menu: select,\n        group: docGroup,\n        storagePrefix: 'tm.docs',\n        firsttimeDocID: examples.firsttimeDocID,\n    })\n})();\n\n\n/////////////////\n// \"Edit\" Menu //\n/////////////////\n\n(function () {\n    menu.onChange = function (doc, opts) {\n        switch (opts && opts.type) {\n            case 'duplicate':\n                controller.setBackingDocument(doc)\n                break\n            case 'delete':\n                controller.forceLoadDocument(doc)\n                break\n            default:\n                controller.openDocument(doc)\n        }\n        refreshEditMenu()\n    }\n\n    // Refresh the \"Edit\" menu items depending on document vs. example.\n    var refreshEditMenu = (function () {\n        var renameLink = document.querySelector('[data-target=\"#renameDialog\"]')\n        var deleteLink = document.querySelector('[data-target=\"#deleteDialog\"]')\n        var wasExample\n\n        function renameExample() {\n            // duplicate, then rename the duplicate.\n            // how it works: switch to duplicate document ->\n            //   refreshEditMenu() enables rename dialog -> event bubbles up -> dialog opens.\n            // this might be the simplest way; Event.stopPropagation leaves the dropdown hanging.\n            duplicateDocument()\n        }\n\n        return function () {\n            var isExample = menu.currentDocument.isExample\n            if (wasExample !== isExample) {\n                if (!isExample) {\n                    renameLink.textContent = 'Rename'\n                    renameLink.removeEventListener('click', renameExample)\n                    renameLink.setAttribute('data-toggle', 'modal')\n                    deleteLink.textContent = 'Delete'\n                    deleteLink.setAttribute('data-target', '#deleteDialog')\n                } else {\n                    renameLink.textContent = 'Rename a copy'\n                    renameLink.addEventListener('click', renameExample)\n                    renameLink.removeAttribute('data-toggle')\n                    deleteLink.textContent = 'Reset this example'\n                    deleteLink.setAttribute('data-target', '#resetExampleDialog')\n                }\n                wasExample = isExample\n            }\n        }\n    }())\n    refreshEditMenu()\n\n    // only swap out the storage backing; don't affect views or undo history\n    function duplicateDocument() {\n        controller.save()\n        menu.duplicate(menu.currentDocument, {select: true})\n    }\n\n    function newBlankDocument() {\n        menu.newDocument({select: true})\n        // load up starter template\n        if (controller.editor.insertSnippet) { // async loaded\n            controller.editor.insertSnippet(examples.blankTemplate)\n            controller.loadEditorSource()\n        }\n    }\n\n    var $renameDialog = $(getId('renameDialog'));\n    [\n        {id: 'tm-doc-action-duplicate', callback: duplicateDocument},\n        {id: 'tm-doc-action-newblank', callback: newBlankDocument},\n    ].forEach(function (item) {\n        document.getElementById(item.id).addEventListener('click', function (e) {\n            e.preventDefault()\n            item.callback(e)\n\n            $renameDialog.modal({keyboard: false})\n                .one('hidden.bs.modal', function () {\n                    controller.editor.focus()\n                })\n        })\n    })\n}());\n\n\n/////////////\n// Dialogs //\n/////////////\n\n(function () {\n    // Rename\n    var $renameDialog = $(getId('renameDialog'))\n    var renameBox = getId('renameDialogInput')\n    $renameDialog\n        .on('show.bs.modal', function () {\n            renameBox.value = menu.currentOption.text\n        })\n        .on('shown.bs.modal', function () {\n            renameBox.select()\n        })\n        // NB. remember data-keyboard=\"false\" on the triggering element,\n        // to prevent closing with Esc and causing a save.\n        // remark: an exception thrown on 'hide' prevents the dialog from closing,\n        // so save during 'hidden' instead.\n        .on('hidden.bs.modal', function () {\n            var newName = renameBox.value\n            if (menu.currentOption.text !== newName) {\n                menu.rename(newName)\n            }\n            renameBox.value = ''\n        })\n    document.getElementById('renameDialogForm').addEventListener('submit', function (e) {\n        e.preventDefault()\n        $renameDialog.modal('hide')\n    })\n\n    // Delete\n    function deleteDocument() {\n        menu.delete()\n    }\n\n    document.getElementById('tm-doc-action-delete').addEventListener('click', deleteDocument)\n\n    // Reset Example\n    function discardReset() {\n        menu.delete()\n        // load manually since example stays and selection doesn't change\n        controller.forceLoadDocument(menu.currentDocument)\n    }\n\n    function saveReset() {\n        menu.duplicate(menu.currentDocument, {select: false})\n        discardReset()\n    }\n\n    document.getElementById('tm-doc-action-resetdiscard').addEventListener('click', discardReset)\n    document.getElementById('tm-doc-action-resetsave').addEventListener('click', saveReset)\n}())\n\n////////////////\n// Controller //\n////////////////\n\nvar controller = (function () {\n    function getButton(container, type) {\n        return container.querySelector('button.tm-' + type)\n    }\n\n    var editor = document.getElementById('editor-container')\n    // button containers\n    var sim = document.getElementById('controls-container')\n    var ed = editor.parentNode\n\n    return new TMDocumentController({\n        simulator: document.getElementById('machine-container'),\n        editorAlerts: document.getElementById('editor-alerts-container'),\n        editor: editor,\n        transformed_code: document.getElementById('transformed-code-container'),\n    }, {\n        simulator: {\n            run: getButton(sim, 'run'),\n            step: getButton(sim, 'step'),\n            speed: getButton(sim, 'speed'),\n            reset: getButton(sim, 'reset'),\n        },\n        editor: {\n            load: getButton(ed, 'editor-load'),\n            revert: getButton(ed, 'editor-revert'),\n        },\n    }, menu.currentDocument)\n}())\n\ncontroller.editor.setTheme('ace/theme/chrome')\ncontroller.editor.commands.addCommand({\n    name: 'save',\n    bindKey: {mac: 'Cmd-S', win: 'Ctrl-S'},\n    exec: function () {\n        controller.loadEditorSource()\n    },\n})\ncontroller.editor.session.setUseWrapMode(true)\n$(function () {\n    try {\n        require('./kbdshortcuts').main(\n            controller.editor.commands,\n            getId('kbdShortcutTable'),\n        )\n    } catch (e) {\n        /* */\n    }\n})\n\nwindow.addEventListener('beforeunload', function (ev) {\n    try {\n        controller.save()\n        menu.saveCurrentDocID()\n    } catch (error) {\n        addAlertPane(\n            'warning',\n            '<h4>The current document could not be saved.</h4>' +\n            '<p>Its likely that the <a href=\"https://en.wikipedia.org/wiki/Web_storage#Storage_size\" target=\"_blank\">local storage quota</a> was exceeded. ' +\n            'Try downloading a copy of this document, then deleting other documents to make space.</p>',\n        )\n        return (ev || window.event).returnValue =\n            'There is not enough space left to save the current document.'\n    }\n})\n\n// Keep the current document in sync across tabs/windows\nwindow.addEventListener('blur', function () {\n    // One tab saves the data...\n    controller.save()\n});\n(function () {\n    // ...and the other tab loads it.\n    var isReloading = false\n    require('./TMDocument').addOutsideChangeListener(function (docID, prop) {\n        if (docID === controller.getDocument().id && prop !== 'name' && !isReloading) {\n            // Batch together property changes into one reload\n            isReloading = true\n            setTimeout(function () {\n                isReloading = false\n                // Preserve undo history\n                controller.forceLoadDocument(controller.getDocument(), true)\n\n            }, 100)\n        }\n    })\n}())\n\n// For interaction/debugging\nexports.controller = controller\n","'use strict'\nvar TMSimulator = require('./TMSimulator'),\n    parser = require('./parser'),\n    util = require('./util'),\n    ace = require('ace-builds/src-min-noconflict'),\n    d3 = require('d3')\nvar TMSpecError = parser.TMSpecError\nvar YAMLException = parser.YAMLException\nvar UndoManager = ace.require('ace/undomanager').UndoManager\n\n/**\n * For editing and displaying a TMDocument.\n * The controller coordinates the interactions between\n *   1. simulator\n *   2. code editor\n *   3. storage\n *\n * All container and button params are required.\n * @param {Object} containers\n *   Empty containers to use (contents will likely be replaced).\n * @param {HTMLDivElement} containers.simulator\n * @param {HTMLDivElement} containers.editorAlerts\n * @param {HTMLDivElement} containers.editor\n * @param {HTMLDivElement} containers.transformed_code\n * @param {Object} buttons Buttons to use.\n * @param {HTMLButtonElement} buttons.simulator.run\n * @param {HTMLButtonElement} buttons.simulator.step\n * @param {HTMLButtonElement} buttons.simulator.reset\n * @param {HTMLButtonElement} buttons.editor.load For loading the editor source\n * @param {HTMLButtonElement} buttons.editor.revert For reverting the editor source\n * @param {TMDocument} document The document to load from and save to.\n */\nfunction TMDocumentController(containers, buttons, document) {\n    this.simulator = new TMSimulator(containers.simulator, buttons.simulator)\n\n    // Set up ace editor //\n    var editor = ace.edit(containers.editor)\n    editor.session.setOptions({\n        mode: 'ace/mode/yaml',\n        tabSize: 2,\n        useSoftTabs: true,\n    })\n    editor.setOptions({\n        minLines: 15,\n        maxLines: 50,\n    })\n    // suppress warning about\n    // \"Automatically scrolling cursor into view after selection change\"\n    editor.$blockScrolling = Infinity\n\n    var transformed_code = ace.edit(containers.transformed_code)\n    transformed_code.session.setOptions({\n        mode: 'ace/mode/yaml',\n        tabSize: 2,\n        useSoftTabs: true,\n    })\n    transformed_code.setOptions({\n        minLines: 15,\n        maxLines: 50,\n    })\n    // suppress warning about\n    // \"Automatically scrolling cursor into view after selection change\"\n    transformed_code.$blockScrolling = Infinity\n    transformed_code.setReadOnly(true)\n\n    var editorButtons = buttons.editor\n    var self = this\n    editorButtons.load\n        .addEventListener('click', function () {\n            self.loadEditorSource()\n            // save whenever \"Load\" is pressed\n            self.save()\n            self.editor.focus()\n        })\n    editorButtons.revert\n        .addEventListener('click', function () {\n            self.revertEditorSource()\n            self.editor.focus()\n        })\n\n    Object.defineProperties(this, {\n        __document: {\n            value: {editor: {}}, // dummy document that gets replaced\n            writable: true,\n        },\n        buttons: {value: buttons},\n        containers: {value: containers},\n        editor: {value: editor, enumerable: true},\n        transformed_code: {value: transformed_code, enumerable: true},\n    })\n    this.openDocument(document)\n}\n\nTMDocumentController.prototype.getDocument = function () {\n    return this.__document\n}\n\n// set the backing document, without saving/loading or affecting the views.\nTMDocumentController.prototype.setBackingDocument = function (doc) {\n    this.__document = doc\n}\n\n// save the current document, then open another one.\n// does nothing if the document ID is the same.\nTMDocumentController.prototype.openDocument = function (doc) {\n    if (this.getDocument().id === doc.id) {\n        return\n    } // same document\n    this.save()\n    return this.forceLoadDocument(doc)\n}\n\n// (low-level) load the document. current data is discarded without saving.\n// this can be used to switch from a deleted document or reload a document.\nTMDocumentController.prototype.forceLoadDocument = function (doc, keepUndoHistory) {\n    this.setBackingDocument(doc)\n    var diagramSource = doc.sourceCode\n    var editorSource = doc.editorSourceCode\n    // init //\n    this.simulator.clear()\n    this.setEditorValue(editorSource == null ? diagramSource : editorSource)\n    // prevent undo-ing to the previous document. note: .reset() doesn't work\n    if (!keepUndoHistory) {\n        this.editor.session.setUndoManager(new UndoManager())\n    }\n\n    if (editorSource == null) {\n        // case: synced: load straight from editor.\n        this.loadEditorSource()\n    } else {\n        // case: not synced: editor has separate contents.\n        this.isSynced = false\n        try {\n            this.simulator.sourceCode = diagramSource\n            this.simulator.positionTable = doc.positionTable\n        } catch (e) {\n            this.showCorruptDiagramAlert(true)\n        }\n    }\n}\n\nTMDocumentController.prototype.save = function () {\n    var doc = this.getDocument()\n    if (this.hasValidDiagram) {\n        // sidenote: deleting first can allow saving when space would otherwise be full\n        doc.editorSourceCode = this.isSynced ? undefined : this.editor.getValue()\n        doc.sourceCode = this.simulator.sourceCode\n        doc.positionTable = this.simulator.positionTable\n    } else {\n        if (doc.editorSourceCode == null) {\n            // case 1: editor was synced with the diagram.\n            //  only edit doc.sourceCode until it's fixed;\n            //  don't worsen the problem to case 2.\n            doc.sourceCode = this.editor.getValue()\n        } else {\n            // case 2: editor has separate contents.\n            //  this is more confusing, as there are two \"source code\" values to contend with.\n            doc.editorSourceCode = this.editor.getValue()\n        }\n    }\n}\n\n/**\n * Set the editor contents.\n *  Converts null to '', since editor.setValue(null) crashes.\n *  Clears the editor alerts.\n * @param {?string} str\n */\nTMDocumentController.prototype.setEditorValue = function (str) {\n    this.editor.setValue(util.coalesce(str, ''), -1 /* put cursor at start */)\n    this.setAlertErrors([])\n}\n\n/////////////////////////\n// Error/Alert Display //\n/////////////////////////\n\nfunction aceAnnotationFromYAMLException(e) {\n    return {\n        row: e.mark.line,\n        column: e.mark.column,\n        text: 'Not valid YAML (possibly caused by a typo):\\n' + e.message,\n        type: 'error',\n    }\n}\n\nTMDocumentController.prototype.setAlertErrors = function (errors) {\n    var self = this\n    var alerts = d3.select(self.containers.editorAlerts).selectAll('.alert')\n        .data(errors, function (e) {\n            return String(e)\n        }) // key by error description\n\n    alerts.exit().remove()\n\n    alerts.enter()\n        .append('div')\n        .attr('class', 'alert alert-danger')\n        .attr('role', 'alert')\n        .each(/** @this div */ function (e) {\n            var div = d3.select(this)\n            if (e instanceof YAMLException) {\n                var annot = aceAnnotationFromYAMLException(e)\n                var lineNum = annot.row + 1 // annotation lines start at 0; editor starts at 1\n                var column = annot.column\n                div.append('strong')\n                    .text('Syntax error on ')\n                    .append('a')\n                    .text('line ' + lineNum)\n                    .on('click', function () {\n                        self.editor.gotoLine(lineNum, column, true)\n                        self.editor.focus()\n                        // prevent scrolling, especially href=\"#\" scrolling to the top\n                        d3.event.preventDefault()\n                    })\n                    .attr('href', '#' + self.containers.editor.id)\n                div.append('br')\n                // aside: text nodes aren't elements so they need to be wrapped (e.g. in span)\n                // https://github.com/mbostock/d3/issues/94\n                div.append('span').text('Possible reason: ' + e.reason)\n            } else if (e instanceof TMSpecError) {\n                div.html(e.message)\n            } else {\n                div.html('<strong>Unexpected error</strong>: ' + e)\n            }\n        })\n    self.editor.session.setAnnotations(\n        errors\n            .map(function (e) {\n                return (e instanceof YAMLException) ? aceAnnotationFromYAMLException(e) : null\n            })\n            .filter(function (x) {\n                return x\n            }),\n    )\n}\n\n\n//////////////////////////////\n// Syncing diagram & editor //\n//////////////////////////////\n\n// Sync Status\n\n// This method can be overridden as necessary.\n// The default implementation toggles Bootstrap 3 classes.\nTMDocumentController.prototype.setLoadButtonSuccess = function (didSucceed) {\n    d3.select(this.buttons.editor.load)\n        .classed({\n            'btn-success': didSucceed,\n            'btn-primary': !didSucceed,\n        })\n}\n\n// internal. whether the editor and diagram source code are in sync, and the diagram is valid.\n// Updates \"Load machine\" button display.\n// for future reference: .isSynced cannot be moved to TMDocument because it requires knowledge from\n// the simulator.\nObject.defineProperty(TMDocumentController.prototype, 'isSynced', {\n    set: function (isSynced) {\n        isSynced = Boolean(isSynced)\n        if (this.__isSynced !== isSynced) {\n            this.__isSynced = isSynced\n            this.setLoadButtonSuccess(isSynced)\n            if (isSynced) {\n                // changes cause desync\n                var onChange = function () {\n                    this.isSynced = false\n                    this.editor.removeListener('change', onChange)\n                }.bind(this)\n                this.editor.on('change', onChange)\n            }\n        }\n    },\n    get: function () {\n        return this.__isSynced\n    },\n})\n\n// public API for isSynced\nTMDocumentController.prototype.getIsSynced = function () {\n    return Boolean(this.isSynced)\n}\n\n// Load & Revert\n\n// internal. used to detect when an imported document is corrupted.\nObject.defineProperty(TMDocumentController.prototype, 'hasValidDiagram', {\n    get: function () {\n        return Boolean(this.simulator.sourceCode)\n    },\n})\n\n/**\n * Show/hide the notice that the diagram's source code is invalid;\n * use this when the editor has contents of its own (so it can't display the diagram's source).\n *\n * This happens for imported documents that were corrupted.\n * It can also happen if the value in storage is tampered with.\n * @param  {boolean} show true to display immediately, false to hide.\n */\nTMDocumentController.prototype.showCorruptDiagramAlert = function (show) {\n    function enquote(s) {\n        return '<q>' + s + '</q>'\n    }\n\n    var div = d3.select(this.simulator.container)\n    if (show) {\n        var revertName = this.buttons.editor.revert.textContent.trim()\n        div.html('')\n            .append('div')\n            .attr('class', 'alert alert-danger')\n            .html('<h4>This imported document has an error</h4>' +\n                [\n                    'The diagram was not valid and could not be displayed.'\n                    ,\n                    'You can either load a new diagram from the editor, or attempt to recover this one'\n                    ,\n                    'using ' + enquote(revertName) + ' (which will replace the current editor contents).',\n                ].join('<br>'),\n            )\n    } else {\n        div.selectAll('.alert').remove()\n    }\n}\n\n// Sync from editor to diagram\nTMDocumentController.prototype.loadEditorSource = function () {\n    // load to diagram, and report any errors\n    var errors = []\n\n    try {\n        var isNewDiagram = !this.hasValidDiagram\n        this.simulator.sourceCode = this.editor.getValue()\n        if (isNewDiagram) {\n            // loaded new, or recovery succeeded => close error notice, restore positions\n            this.showCorruptDiagramAlert(false)\n            this.simulator.positionTable = this.getDocument().positionTable\n        }\n\n        if (this.simulator.transformed_code === null) {\n            this.transformed_code.container.classList.add('hidden')\n        } else {\n            this.transformed_code.container.classList.remove('hidden')\n            this.transformed_code.setValue(this.simulator.transformed_code, -1 /* put cursor at start */)\n        }\n        // .toJSON() is the only known way to preserve the cursor/selection(s)\n        // this.__loadedEditorSelection = this.editor.session.selection.toJSON();\n    } catch (e) {\n        errors = [e]\n    }\n    this.isSynced = (errors.length === 0)\n    this.setAlertErrors(errors)\n}\n\n// Sync from diagram to editor\nTMDocumentController.prototype.revertEditorSource = function () {\n    this.setEditorValue(this.hasValidDiagram\n        ? this.simulator.sourceCode\n        : this.getDocument().sourceCode)\n\n    if (this.hasValidDiagram) {\n        this.isSynced = true\n    } else {\n        // show errors when reverting to a corrupted diagram\n        this.loadEditorSource()\n    }\n    // if (this.__loadedEditorSelection) {\n    //   this.editor.session.selection.fromJSON(this.__loadedEditorSelection);\n    // }\n}\n\nmodule.exports = TMDocumentController\n","'use strict'\n\nconst {parseSpec} = require('./parser')\nconst TMViz = require('./TMViz')\nconst {watchInit} = require('./watch')\nconst values = require('lodash').values\n\n/**\n * Turing machine simulator component.\n *\n * Contains a state diagram, tape diagram, and button controls.\n * @param {[type]} container [description]\n * @param {[type]} buttons   [description]\n */\nfunction TMSimulator(container, buttons) {\n    this.container = container\n    this.buttons = buttons\n    this.transformed_code = null\n\n    const self = this\n    buttons.step\n        .addEventListener('click', function () {\n            self.machine.isRunning = false\n            self.machine.step() // each step click corresponds to 1 machine step\n        })\n    buttons.run\n        .addEventListener('click', function () {\n            self.machine.isRunning = !self.machine.isRunning\n        })\n    buttons.speed\n        .addEventListener('click', function () {\n            if (!self.machine)\n                return\n            const speeds = [1000, 500, 500/1.5, 500/2, 500/3]\n            let i = speeds.indexOf(self.machine.animationDuration)\n            i = (i + 1) % speeds.length\n            let speed = self.machine.animationDuration = speeds[i]\n            buttons.speed.lastChild.textContent = `x${500/speed}`\n        })\n    buttons.reset\n        .addEventListener('click', function () {\n            self.machine.reset()\n        })\n    buttons.all = values(buttons)\n\n    this.clear()\n}\n\nTMSimulator.prototype.clear = function () {\n    this.sourceCode = null\n}\n\nObject.defineProperties(TMSimulator.prototype, {\n    /**\n     * The machine's source code.\n     *  Setting a new source code will attempt to persist the state node positions.\n     *  To set a new machine, first call .clear(), then set the source code.\n     */\n    sourceCode: {\n        get: function () {\n            return this.__sourceCode\n        },\n        // throws if sourceCode has errors\n        set: function (sourceCode) {\n            if (this.machine) {\n                this.machine.isRunning = false // important\n                this.machine.stateviz.force.stop()\n            }\n            if (sourceCode == null) {\n                // clear display\n                this.machine = null\n                this.container.innerHTML = ''\n            } else {\n                // parse & check, then set\n                let [spec, overridePosTable, transformed_code] = parseSpec(sourceCode, true)\n                this.transformed_code = transformed_code\n                if (this.machine) {\n                    // case: update\n                    // copy & restore positions, clear & load contents\n                    let posTable = this.machine.positionTable\n                    this.clear()\n                    this.machine = new TMViz(this.container, spec, overridePosTable || posTable)\n                } else {\n                    // case: load new\n                    this.machine = new TMViz(this.container, spec, overridePosTable)\n                }\n            }\n            this.__sourceCode = sourceCode\n        },\n        enumerable: true,\n    },\n    positionTable: {\n        get: function () {\n            return this.machine && this.machine.positionTable\n        },\n        set: function (posTable) {\n            if (this.machine && posTable) {\n                this.machine.positionTable = posTable\n            }\n        },\n        enumerable: true,\n    },\n    machine: {\n        get: function () {\n            return this.__machine\n        },\n        set: function (machine) {\n            this.__machine = machine\n            this.rebindButtons()\n        },\n    },\n})\n\n/////////////\n// Buttons //\n/////////////\n\n/**\n * The innerHTML for the \"Run\" button.\n * The default value can be overridden.\n * @type {string}\n */\nTMSimulator.prototype.htmlForRunButton =\n    '<span class=\"glyphicon glyphicon-play\" aria-hidden=\"true\"></span><br>Run'\nTMSimulator.prototype.htmlForPauseButton =\n    '<span class=\"glyphicon glyphicon-pause\" aria-hidden=\"true\"></span><br>Pause'\n\n// bind: .disabled for Step and Run, and .innerHTML (Run/Pause) for Run\nfunction rebindStepRun(stepButton, runButton, runHTML, pauseHTML, machine) {\n    function onHaltedChange(isHalted) {\n        stepButton.disabled = isHalted\n        runButton.disabled = isHalted\n    }\n\n    function onRunningChange(isRunning) {\n        runButton.innerHTML = isRunning ? pauseHTML : runHTML\n    }\n\n    watchInit(machine, 'isHalted', function (prop, oldval, isHalted) {\n        onHaltedChange(isHalted)\n        return isHalted\n    })\n    watchInit(machine, 'isRunning', function (prop, oldval, isRunning) {\n        onRunningChange(isRunning)\n        return isRunning\n    })\n}\n\n// internal method.\nTMSimulator.prototype.rebindButtons = function () {\n    var buttons = this.buttons\n    var enable = (this.machine != null)\n    if (enable) {\n        rebindStepRun(buttons.step, buttons.run,\n            this.htmlForRunButton, this.htmlForPauseButton, this.machine,\n        )\n    }\n    buttons.all.forEach(function (b) {\n        b.disabled = !enable\n    })\n}\n\nmodule.exports = TMSimulator\n","'use strict'\n\nconst {TMSpecError} = require('./errors.js')\nconst examples = require('./examples')\n\n\nfunction unique_symbols_states(spec) {\n\n    let symbols = []\n    let states = []\n    for (const from_state in spec.table) {\n        if (!states.includes(from_state))\n            states.push(from_state)\n        // if (spec.table[from_state] === null)\n        //     final_states.push(from_state)\n        for (const [comma_symbols, action] of Object.entries(spec.table[from_state] || {})) {\n            for (const symbol of parseSymbolKey(comma_symbols)) {\n                if (!symbols.includes(symbol))\n                    symbols.push(symbol)\n\n                if (action.state && !states.includes(action.state))\n                    states.push(action.state)\n                if (action.symbol && !symbols.includes(action.symbol[0]))\n                    symbols.push(action.symbol[0])\n            }\n        }\n    }\n    return [symbols, states]\n}\n\n\n/**\n * @param {TMSpec} spec\n * @returns {[TMSpec, PositionTable, string]}\n */\nfunction universal_transform(spec, parseSpec) {\n    if (spec.tapes !== 0)\n        throw new TMSpecError('For universal transform tapes must be 1')\n\n    let {sourceCode: universal_source, positionTable} = examples.get('universal');\n\n    let [uni] = parseSpec(universal_source, true)\n\n    let [symbols, states] = unique_symbols_states(spec)\n    let final_states = []\n    for (const from_state in spec.table) {\n        if (spec.table[from_state] === null)\n            final_states.push(from_state)\n    }\n    symbols.sort()\n\n    symbols = unary(symbols, spec.blank, '1')\n    states = unary(states, spec.startState, '2')\n    let move = {'R': '3', 'L': '33', 'H': '333', null: '333', undefined: '333'}\n\n    let instructions = '>'\n    let state_tape = '>' + states[spec.startState]\n    let data_tape\n\n    for (const from_state in spec.table) {\n        for (const [comma_symbols, action] of Object.entries(spec.table[from_state] || {})) {\n            for (const symbol of parseSymbolKey(comma_symbols)) {\n                instructions += symbols[symbol]\n                instructions += states[from_state]\n                instructions += symbols[action.symbol && action.symbol[0] || symbol]\n                instructions += states[action.state || from_state]\n                if (final_states.includes(action.state))\n                    instructions += '3333'\n                else\n                    instructions += move[action.move]\n            }\n        }\n    }\n    data_tape = Array.prototype.map.call(spec.input, symbol => symbols[symbol]).join(';')\n    data_tape = '>;' + data_tape + ';'\n\n    uni.input = [\n        instructions,\n        state_tape,\n        data_tape,\n    ]\n\n    const unary_cmp = (a, b) => a[1].length - b[1].length\n    let max_state_len = Math.max(...Object.keys(states).map(x => x.length))\n    universal_source = universal_source.split('\\n')\n    let input_index = universal_source.findIndex(s => s.startsWith('input:'))\n    universal_source.splice(\n        input_index + 1,\n        3,\n        ...uni.input.map(x => `  - '${x}'`),\n        ...Object.entries(symbols).sort(unary_cmp).map(([sym, code]) => `    # ${sym.replace(' ', '')} = ${code}\\r`),\n        '    #\\r',\n        ...Object.entries(states).sort(unary_cmp).map(([state, code]) => `    # ${state.padStart(max_state_len)} = ${code}\\r`),\n    )\n    universal_source = universal_source.join('\\n')\n\n    return [uni, positionTable, universal_source]\n}\n\nfunction* flatten_spec(spec) {\n    for (const from_state in spec.table) {\n        for (const [comma_symbols, action] of Object.entries(spec.table[from_state] || {})) {\n            for (const symbol of parseSymbolKey(comma_symbols)) {\n                yield [from_state, symbol, action]\n            }\n        }\n    }\n}\n\nfunction parseSymbolKey(key) {\n    return key.split(',').reduce(function (acc, x) {\n        if (x === '' && acc[acc.length - 1] === '') {\n            acc[acc.length - 1] = ','\n        } else {\n            acc.push(x)\n        }\n        return acc\n    }, [])\n}\n\nfunction unary(arr, first, code) {\n    let res = {[first]: code}\n    arr.splice(arr.indexOf(first), 1)\n    for (const elem of arr) {\n        code += code[0]\n        res[elem] = code\n    }\n    return res\n}\n\n\n/**\n * @param {TMSpec} spec\n * @returns {[TMSpec, PositionTable, string]}\n */\nfunction shennon2_transform(spec, parseSpec) {\n    // let symbols = {\n    //     [spec.blank]: 0,\n    //     '>': 1,\n    // }\n    let [symbols, states] = unique_symbols_states(spec)\n\n    if (symbols.length <= 2)\n        throw new TMSpecError(\"It seems like you have too few symbols to apply Shennon's second\"\n            + \" theorem\")\n\n    symbols.sort()\n    if (symbols.includes('')) {\n        symbols.splice(symbols.indexOf(''), 1)\n        symbols.unshift('')\n    }\n    if (symbols.includes(spec.blank)) {\n        symbols.splice(symbols.indexOf(spec.blank), 1)\n        symbols.unshift(spec.blank)\n    }\n    let n = 0\n    let size = Math.ceil(Math.log2(symbols.length))\n    let codes = {}\n    for (const symbol of symbols) {\n        codes[symbol] = n.toString(2).padStart(size, '0')\n        n += 1\n    }\n    symbols = codes\n\n    let input = Array.prototype.map.call(spec.input, s => symbols[s]).join('')\n\n    let instructions = []\n    let res = {}\n\n    function add(from_state, symbol, to_state, write, move) {\n        if (res[from_state] === undefined)\n            res[from_state] = {}\n        if (res[from_state][symbol] === undefined) {\n            res[from_state][symbol] = {symbol: write, move: move, state: to_state}\n            instructions.push([from_state, symbol, write, move, to_state])\n        }\n        // assume that if res[from_state][symbol] exists, it has the same instructions\n    }\n\n    for (const from_state in spec.table) {\n        if (spec.table[from_state] === null)\n            res[from_state] = null\n    }\n\n    for (const [from_state, raw_symbol, action] of flatten_spec(spec)) {\n        // f\"{c[0]}.{bef[0]}->{bef[0]}.R.{c[0]}_{bef[0]}\"\n        let symbol = symbols[raw_symbol]\n        let {symbol: raw_write, state: to_state, move} = action\n        to_state = to_state || from_state\n        raw_write = raw_write || raw_symbol\n        let write = symbols[raw_write]\n\n        add(from_state, symbol[0], `${from_state}_${symbol[0]}`, symbol[0], 'R')\n\n        for (let i = 1; i < size - 1; ++i) {\n            add(\n                `${from_state}_${symbol.slice(0, i)}`, symbol[i],\n                `${from_state}_${symbol.slice(0, i+1)}`, symbol[i],\n                'R',\n            )\n        }\n        add(\n            `${from_state}_${symbol.slice(0, -1)}`, symbol[symbol.length-1],\n            `${from_state}_${symbol}`, symbol[symbol.length-1],\n            'H',\n        )\n        add(\n            `${from_state}_${symbol}`, symbol[symbol.length-1],\n            `${to_state}_${move}_${write}`, symbol[symbol.length-1],\n            'H',\n        )\n\n        for (let i = size - 1; i > 0; --i) {\n            add(\n                `${to_state}_${move}_${write.slice(0, i + 1)}`, symbol[i],\n                `${to_state}_${move}_${write.slice(0, i)}`, write[i],\n                'L',\n            )\n        }\n        add(\n            `${to_state}_${move}_${write[0]}`, symbol[0],\n            `${to_state}_${move}`, write[0],\n            'H',\n        )\n\n        if (move === 'R') {\n            add(\n                `${to_state}_${move}`, write[0],\n                `${to_state}_${move}_move_${size}`, write[0],\n                'H',\n            )\n            for (let i = size; i > 1; --i) {\n                add(\n                    `${to_state}_${move}_move_${i}`, write[size - i],\n                    `${to_state}_${move}_move_${i - 1}`, write[size - i],\n                    'R',\n                )\n            }\n            add(\n                `${to_state}_${move}_move_${1}`, write[size - 1],\n                `${to_state}`, write[size - 1],\n                'R',\n            )\n        } else if (move === 'H') {\n            add(\n                `${to_state}_${move}`, write[0],\n                `${to_state}`, write[0],\n                'H',\n            )\n        } else if (move === 'L') {\n            add(\n                `${to_state}_${move}`, write[0],\n                `${to_state}_${move}_move_${size}`, write[0],\n                'H',\n            )\n            add(\n                `${to_state}_${move}_move_${size}`, write[0],\n                `${to_state}_${move}_move_${size-1}`, write[0],\n                'L',\n            )\n            for (let i = size - 1; i > 1; --i) {\n                add(\n                    `${to_state}_${move}_move_${i}`, 0,\n                    `${to_state}_${move}_move_${i-1}`, 0,\n                    'L',\n                )\n                add(\n                    `${to_state}_${move}_move_${i}`, 1,\n                    `${to_state}_${move}_move_${i-1}`, 1,\n                    'L',\n                )\n            }\n            add(`${to_state}_${move}_move_1`, 0, `${to_state}`, 0, 'L')\n            add(`${to_state}_${move}_move_1`, 1, `${to_state}`, 1, 'L')\n        }\n        if (instructions[instructions.length - 1] !== null)\n            instructions.push(null)\n    }\n\n    let shennon = {\n        input: input,\n        tapes: 0,\n        blank: ' ',\n        startState: spec.startState,\n        table: res,\n        vis: {titles: {}, info: {}, colors: {}, 0: {}},\n    }\n\n    const binary_cmp = (a, b) => parseInt(a[1].length, 2) - parseInt(b[1].length, 2)\n    let code = Object.entries(symbols).sort(binary_cmp).map(([sym, c]) => `# ${sym.replace(' ', '')} = ${c}\\r`).join('\\n')\n        + '\\r\\n'\n    let max_state_len = Math.max(...instructions.map(x => x ? x[0].length : 0))\n    code += instructions.map(x => !x ? '' :`${x[0].padEnd(max_state_len)} ${x[1]} -> ${x[2]} ${x[3]} ${x[4]}`).join('\\n')\n\n    return [shennon, null, code]\n}\n\n\nfunction shennon2_0_transform(spec, parseSpec) {\n    let [res, pos, code] = shennon2_transform(spec, parseSpec)\n    res.blank = '0'\n    return [res, pos, code]\n}\n\n\nexports.transformations = {\n    'universal': universal_transform,\n    'shennon2': shennon2_transform,\n    'shennon2_0': shennon2_0_transform,\n}\n\n","var map = {\n\t\"./_template.yaml\": 31,\n\t\"./binaryAdd.yaml\": 32,\n\t\"./binaryIncrement.yaml\": 33,\n\t\"./binaryMult.yaml\": 34,\n\t\"./busyBeaver3.yaml\": 35,\n\t\"./busyBeaver4.yaml\": 36,\n\t\"./copy1s.yaml\": 37,\n\t\"./divisibleBy3.yaml\": 38,\n\t\"./divisibleBy3Base10.yaml\": 39,\n\t\"./lengthMult.yaml\": 40,\n\t\"./matchBinaryStrings.yaml\": 41,\n\t\"./matchThreeLengths.yaml\": 42,\n\t\"./multitape.yaml\": 43,\n\t\"./palindrome.yaml\": 44,\n\t\"./powersOfTwo.yaml\": 45,\n\t\"./repeat01.yaml\": 46,\n\t\"./unaryMult.yaml\": 47,\n\t\"./universal.yaml\": 48\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 30;","module.exports = \"input: '${2}'\\nblank: '${3: }'\\nstart state: ${4:start}\\ntable:\\n  ${4}:\\n    ${5}\\n\"","module.exports = \"name: binary addition\\nsource code: |\\n  # Adds two binary numbers together.\\n\\n  # Format: Given input a+b where a and b are binary numbers,\\n  # leaves c b on the tape, where c = a+b.\\n  # Example: '11+1' => '100 1'.\\n  input: '1011+11001'\\n  blank: ' '\\n  start state: right\\n  table:\\n    # Start at the second number's rightmost digit.\\n    right:\\n      [0,1,+]: R\\n      ' ': {L: read}\\n\\n    # Add each digit from right to left:\\n    # read the current digit of the second number,\\n    read:\\n      0: {write: c, L: have0}\\n      1: {write: c, L: have1}\\n      +: {write: ' ', L: rewrite}\\n    # and add it to the next place of the first number,\\n    # marking the place (using O or I) as already added.\\n    have0: {[0,1]: L, +: {L: add0}}\\n    have1: {[0,1]: L, +: {L: add1}}\\n    add0:\\n      [0,' ']: {write: O, R: back0}\\n      1      : {write: I, R: back0}\\n      [O,I]  : L\\n    add1:\\n      [0,' ']: {write: I, R: back1}\\n      1      : {write: O, L: carry}\\n      [O,I]  : L\\n    carry:\\n      [0,' ']: {write: 1, R: back1}\\n      1      : {write: 0, L}\\n    # Then, restore the current digit, and repeat with the next digit.\\n    back0:\\n      [0,1,O,I,+]: R\\n      c: {write: 0, L: read}\\n    back1:\\n      [0,1,O,I,+]: R\\n      c: {write: 1, L: read}\\n\\n    # Finish: rewrite place markers back to 0s and 1s.\\n    rewrite:\\n      O: {write: 0, L}\\n      I: {write: 1, L}\\n      [0,1]: L\\n      ' ': {R: done}\\n    done:\\n\\n\\n  # Exercise:\\n\\n  #  Generate the Fibonacci sequence in binary, listed from right to left:\\n  #   ...1101 1000 101 11 10 1 1 0\\n  #   Hint: prefix the current number with a +, copy the previous number\\n  #   and place it left of the +, run the adder, and repeat.\\n  #   Example: '1 0' => '+1 0' => '0+1 0' => '1 1 0' => '+1 1 0' => ...\\npositions:\\n  right:   {x: 300, y: 130}\\n  rewrite: {x: 500, y: 130}\\n  done:    {x: 620, y: 130}\\n\\n  back0:  {x: 250, y: 250}\\n  read:   {x: 400, y: 250}\\n  back1:  {x: 550, y: 250}\\n  carry:  {x: 650, y: 250}\\n\\n  add0:   {x: 150, y: 400}\\n  have0:  {x: 300, y: 400}\\n  have1:  {x: 500, y: 400}\\n  add1:   {x: 650, y: 400}\\n\"","module.exports = \"name: binary increment\\nsource code: |\\n  # Adds 1 to a binary number.\\n  input: '1011'\\n  blank: ' '\\n  start state: right\\n  table:\\n    # scan to the rightmost digit\\n    right:\\n      [1,0]: R\\n      ' '  : {L: carry}\\n    # then carry the 1\\n    carry:\\n      1      : {write: 0, L}\\n      [0,' ']: {write: 1, L: done}\\n    done:\\n\\n\\n  # Exercises:\\n\\n  #  Modify the machine to always halt on the leftmost digit\\n  #   (regardless of the number's length).\\n  #   Hint: add a state between carry and done.\\n\\n  #  Make a machine that adds 2 instead of 1.\\n  #   Hint: 2 is '10' in binary, so the last digit is unaffected.\\n  #   Alternative hint: chain together two copies of the machine from\\n  #   the first exercise (renaming the states of the second copy).\\n\\n  #  Make a machine to subtract 1.\\n  #   To simplify things, assume the input is always greater than 0.\\npositions:\\n  right: {x: 230, y: 250}\\n  carry: {x: 400, y: 250}\\n  done: {x: 570, y: 250}\\n\"","module.exports = \"name: binary multiplication\\nsource code: |\\n  # Multiplies two binary numbers together.\\n\\n  # Examples: '11*11' => '1001', '111*110' => '101010'.\\n  input: '11*101' # 3*5 = 15 (1111 in binary)\\n  blank: ' '\\n  start state: start\\n  table:\\n    # Prefix the input with a '+', and go to the rightmost digit.\\n    start:\\n      [0,1]: {L: init}\\n    init:\\n      ' ': {write: '+', R: right}\\n    right:\\n      [0,1,'*']: R\\n      ' ': {L: readB}\\n\\n    # Read and erase the last digit of the multiplier.\\n    # If it's 1, add the current multiplicand.\\n    # In any case, double the multiplicand afterwards.\\n    readB:\\n      0: {write: ' ', L: doubleL}\\n      1: {write: ' ', L: addA}\\n    addA:\\n      [0,1]: L\\n      '*': {L: read} # enter adder\\n    # Double the multiplicand by appending a 0.\\n    doubleL:\\n      [0,1]: L\\n      '*': {write: 0, R: shift}\\n    double: # return from adder\\n      [0,1,+]: R\\n      '*': {write: 0, R: shift}\\n    # Make room by shifting the multiplier right 1 cell.\\n    shift:\\n      0: {write: '*', R: shift0}\\n      1: {write: '*', R: shift1}\\n      ' ': {L: tidy} # base case: multiplier = 0\\n    shift0:\\n      0:   {R: shift0}\\n      1:   {write: 0, R: shift1}\\n      ' ': {write: 0, R: right}\\n    shift1:\\n      0:   {write: 1, R: shift0}\\n      1:   {R: shift1}\\n      ' ': {write: 1, R: right}\\n\\n    tidy:\\n      [0,1]: {write: ' ', L}\\n      +: {write: ' ', L: done}\\n    done:\\n\\n  # This is the 'binary addition' machine almost verbatim.\\n  # It's adjusted to keep the '+'\\n  # and to lead to another state instead of halting.\\n    read:\\n      0: {write: c, L: have0}\\n      1: {write: c, L: have1}\\n      +: {L: rewrite} # keep the +\\n    have0: {[0,1]: L, +: {L: add0}}\\n    have1: {[0,1]: L, +: {L: add1}}\\n    add0:\\n      [0,' ']: {write: O, R: back0}\\n      1      : {write: I, R: back0}\\n      [O,I]  : L\\n    add1:\\n      [0,' ']: {write: I, R: back1}\\n      1      : {write: O, L: carry}\\n      [O,I]  : L\\n    carry:\\n      [0,' ']: {write: 1, R: back1}\\n      1      : {write: 0, L}\\n    back0:\\n      [0,1,O,I,+]: R\\n      c: {write: 0, L: read}\\n    back1:\\n      [0,1,O,I,+]: R\\n      c: {write: 1, L: read}\\n    rewrite:\\n      O: {write: 0, L}\\n      I: {write: 1, L}\\n      [0,1]: L\\n      ' ': {R: double} # when done, go to the 'double' state\\n\\n\\n  # Remark:\\n  # We can view the machine as expressing a recursive function:\\n\\n  #   multiply(a, b) = mult(0, a, b)\\n\\n  #   mult(acc, a, 0     ) = acc\\n  #   mult(acc, a, 2k + 0) = mult(acc    , 2a, k)   where k  0\\n  #   mult(acc, a, 2k + 1) = mult(acc + a, 2a, k)\\n\\n  # where a, b, and k are natural numbers.\\n\\n  # Each reduction maintains the invariant\\n  #   mult(acc, a, b) = acc + a * b\\n  # Note that mult's third argument (b) is always decreasing,\\n  # so mult is guaranteed to halt.\\n  # Eventually b reaches 0 and the result is simply the accumulator.\\npositions:\\n  start:  {x: 80 , y: 70}\\n  init:   {x: 190, y: 70}\\n  tidy:   {x: 730, y: 70}\\n  done:   {x: 730, y: 180}\\n\\n  right:  {x: 300, y: 115}\\n  shift:  {x: 600, y: 115}\\n  shift1: {x: 450, y: 70}\\n  shift0: {x: 450, y: 160}\\n\\n  readB:  {x: 300, y: 215}\\n  addA:   {x: 160, y: 215}\\n  doubleL: {x: 550, y: 215}\\n\\n  rewrite: {x: 363, y: 300}\\n  double: {x: 650, y: 300}\\n\\n  back0:  {x: 160, y: 370}\\n  read:   {x: 300, y: 370}\\n  back1:  {x: 440, y: 370}\\n  carry:  {x: 540, y: 370}\\n\\n  add0:   {x:  60, y: 470}\\n  have0:  {x: 200, y: 470}\\n  have1:  {x: 400, y: 470}\\n  add1:   {x: 540, y: 470}\\n\"","module.exports = \"name: 3-state busy beaver\\nsource code: |\\n  # A 3-state 2-symbol busy beaver for most non-blank symbols.\\n  # It takes 13 steps and leaves 6 non-blank symbols on the tape.\\n\\n  # What's a \\\"busy beaver\\\"?\\n  #   Suppose every possible Turing machine with n states and k symbols\\n  #   (for instance, 3 states and 2 symbols) were started on\\n  #   a blank tape with no input.\\n  #   Some of the machines would never halt. Out of the ones that do halt,\\n  #   a machine that leaves the most non-blank symbols on the tape\\n  #   is called a busy beaver.\\n  blank: '0'\\n  start state: A\\n  table:\\n    A:\\n      0: {write: 1, R: B}\\n      1: {L: C}\\n    B:\\n      0: {write: 1, L: A}\\n      1: R\\n    C:\\n      0: {write: 1, L: B}\\n      1: {R: H}\\n    H:\\n\\n  # An alternative criterion is halting after the most steps.\\n  # This busy beaver takes the most steps (21) but only prints 5 1's:\\n    # A:\\n    #   0: {write: 1, R: B}\\n    #   1: {R: H}\\n    # B:\\n    #   0: {write: 1, L: B}\\n    #   1: {write: 0, R: C}\\n    # C:\\n    #   0: {write: 1, L}\\n    #   1: {L: A}\\n    # H:\\n\\n\\n  # Exercise:\\n\\n  #  Consider Turing machines that have n states and k symbols.\\n  #   Instead of a missing instruction, halting is denoted by\\n  #   a transition to a special \\\"halt\\\" state (for a total of n+1 states).\\n  #   How many different transition functions are possible?\\n\\n  #   Hint: Each instruction writes a symbol, moves left or right,\\n  #   and goes to a state.\\n  #   There is one instruction per combination of non-halt state & symbol.\\n\\n\\n\\n  #   Answer: (2k(n+1))^(nk)\\npositions:\\n  A: {x: 320, y: 296.188}\\n  B: {x: 400, y: 157.624}\\n  C: {x: 480, y: 296.188}\\n  H: {x: 400, y: 376.188}\\n\"","module.exports = \"name: 4-state busy beaver\\nsource code: |\\n  # A 4-state 2-symbol busy beaver\\n  # that halts after 107 steps, leaving 13 1's on the tape.\\n  # It takes the most steps *and* prints the most 1's.\\n  blank: 0\\n  start state: A\\n  table:\\n    A: {0: {write: 1, R: B}, 1:           {L: B}}\\n    B: {0: {write: 1, L: A}, 1: {write: 0, L: C}}\\n    C: {0: {write: 1, R: H}, 1:           {L: D}}\\n    D: {0: {write: 1, R   }, 1: {write: 0, R: A}}\\n    H:\\n\\n\\n  # Finding a busy beaver requires considering every n-state k-symbol\\n  # machine and proving either that it halts with no more non-blank symbols\\n  # or that it never halts at all.\\n\\n  # Even with strategies to reduce the search space\\n  # including normalization, accelerated simulation, and automated proofs\\n  # there are still machines that show surprising complexity\\n  # and require individual analysis.\\n\\n  # This 4-state busy beaver was proven by Allen Brady in 1983.\\n  # Busy beavers for 5 states and above are as yet unknown.\\n  # At the time of writing, the current 5-state 2-symbol contender\\n  # takes 47,176,870 steps to halt, and the 6-state contender\\n  # takes over 7.4 * 10^36534 steps\\n  # (http://www.logique.jussieu.fr/~michel/bbc.html).\\n  # \\\"Given that 5-state 2-symbol halting Turing machines can compute\\n  # Collatz-like congruential functions, it may be very hard to find\\n  # [the next busy beaver]\\\" (https://oeis.org/A060843).\\n\\n\\n  # An entertaining read on busy beavers and their profoundness:\\n\\n  #  \\\"Who Can Name the Bigger Number?\\\"\\n  #   http://www.scottaaronson.com/writings/bignumbers.html\\npositions:\\n  # square with side length 160\\n  A: {x: 320, y: 170}\\n  B: {x: 480, y: 170}\\n\\n  C: {x: 480, y: 330}\\n  D: {x: 320, y: 330}\\n  H: {x: 620, y: 330}\\n\"","module.exports = \"name: copy 1s\\nsource code: |\\n  # Copies a string of consecutive 1s.\\n  input: '111'\\n  blank: 0\\n  start state: each\\n  table:\\n    # mark the current 1 by erasing it\\n    each:\\n      0: {R: H}\\n      1: {write: 0, R: sep}\\n    # skip to the separator\\n    sep:\\n      0: {R: add}\\n      1: R\\n    # skip to the end of the copy and write a 1\\n    add:\\n      0: {write: 1, L: sepL}\\n      1: R\\n    # return to the separator\\n    sepL:\\n      0: {L: next}\\n      1: L\\n    # return to the erased 1, restore it, and then advance to the next 1\\n    next:\\n      0: {write: 1, R: each}\\n      1: L\\n    H:\\n\\n\\n  # Exercises:\\n\\n  #  Edit the machine to copy the string indefinitely,\\n  #   i.e. given the input '11', produce 11011011011...\\n  #   Hint: this can be done by modifying only one transition.\\n\\n  #  Make a machine to output the endless sequence 1011011101111011111...\\npositions:\\n  each: {x: 400   , y: 100}\\n  sep:  {x: 400.01, y: 250}\\n  add:  {x: 400.02, y: 400}\\n  sepL: {x: 250   , y: 250}\\n  next: {x: 250.01, y: 100}\\n  H:    {x: 550   , y: 100}\\n\"","module.exports = \"name: divisible by 3\\nsource code: |\\n  # Checks if a binary number is divisible by 3.\\n  input: '1001' # try '1111' (15), '10100' (20), '111001' (57)\\n  blank: ' '\\n  # How it works:\\n\\n  # Consider reading a binary number, say 10011 (19),\\n  # from left to right one digit at a time.\\n  # Each time a digit is read, the new value equals the new digit\\n  # plus the old value shifted left one place (multiplied by 2).\\n\\n  # Digits  Value\\n  # -------------\\n  #         0\\n  # 1       1\\n  # 10      2\\n  # 100     4\\n  # 1001    9\\n  # 10011   19\\n\\n  # Now instead of tracking the entire number, just track the remainder.\\n  # It works the same way.\\n  start state: q0\\n  table:\\n    q0:\\n      0: R       # 2*0 + 0 = 0\\n      1: {R: q1} # 2*0 + 1 = 1\\n      ' ': {R: accept}\\n    q1:\\n      0: {R: q2} # 2*1 + 0 = 2\\n      1: {R: q0} # 2*1 + 1 = 3\\n    q2:\\n      0: {R: q1} # 2*2 + 0 = 4\\n      1: {R: q2} # 2*2 + 1 = 5\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Modify the machine to check if n-1 is divisible by 3,\\n  #   where n is the input. That is, accept the binary of 1, 4, 7, 10, ...\\n  #   Hint: this can be done without modifying the tape (no 'write').\\n\\n  #  Round the number up to the nearest multiple of 3.\\n  #   Hint: do one pass right to find the remainder, then another pass left\\n  #   to add. See the 'binary increment' example for how to add.\\n\\n  #  Round the number down to the nearest multiple of 3.\\npositions:\\n  q0: {x: 230, y: 250}\\n  q1: {x: 400, y: 250}\\n  q2: {x: 570, y: 250}\\n  accept: {x: 230.01, y: 380}\\n\"","module.exports = \"name: divisible by 3 (base 10)\\nsource code: |\\n  # Checks if a base 10 number is divisible by 3.\\n  input: 4728 # try 42, 57, 1337, 5328, 7521, 314159265\\n  blank: ' '\\n  # This uses the same idea as the base 2 version.\\n  #\\n  # To make things more interesting, we derive the step relation:\\n  # Let x be the number left of the tape head,\\n  #     d the digit under the head, and\\n  #     x' the number up to and including the head.\\n  # Then\\n  #   x' = 10x + d .\\n  # Notice 10  1 (mod 3). Therefore\\n  #   x'  x + d (mod 3) .\\n  # Each step simply adds the new digit's remainder mod 3.\\n  start state: q0\\n  table:\\n    q0:\\n      [0,3,6,9]: R     # 0 + 0  0 (mod 3)\\n      [1,4,7]: {R: q1} # 0 + 1  1\\n      [2,5,8]: {R: q2} # 0 + 2  2\\n      ' ': {R: accept}\\n    q1:\\n      [0,3,6,9]: R     # 1 + 0  1\\n      [1,4,7]: {R: q2} # 1 + 1  2\\n      [2,5,8]: {R: q0} # 1 + 2  0\\n    q2:\\n      [0,3,6,9]: R     # 2 + 0  2\\n      [1,4,7]: {R: q0} # 2 + 1  0\\n      [2,5,8]: {R: q1} # 2 + 2  1\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Check for divisibility by 5.\\n  #   Hint: only 2 states (besides accept) are required.\\n\\n  #  Check for divisibility by 4.\\n  #   Hint: use 4 states (besides accept).\\npositions:\\n  # centered equilateral triangle with side length 250\\n  q0: {x: 275, y: 322.1688}\\n  q1: {x: 400, y: 105.6624}\\n  q2: {x: 525, y: 322.1688}\\n  accept: {x: 275.01, y: 430}\\n\"","module.exports = \"name: multiplied lengths\\nsource code: |\\n  # Decides the language { a^(i)b^(j)c^(k) | i*j = k and i,j,k  1 }.\\n  # (a's followed by b's then c's,\\n  # where the number of a's multiplied by the number of b's\\n  # equals the number of c's.)\\n  input: aabbbcccccc # try abc, b, aabcbc, aabcc, aabbbbcccccccc\\n  blank: ' '\\n  start state: start\\n\\n  table:\\n    # Check for the form a^(i)b^(j)c^(k) where i,j,k  1.\\n    start:  {        a: {R: a+}}\\n    a+:     {a: R,   b: {R: b+}}\\n    b+:     {b: R,   c: {R: c+}}\\n    c+:     {c: R, ' ': {L: left}}\\n    left:\\n      [a,b,c]: L\\n      ' ': {R: eachA}\\n    # Then check that i*j = k.\\n    #   The approach is two nested loops:\\n    #   For each 'a':\\n    #     For each 'b':\\n    #       Mark one 'c'\\n    #   At the end, check that all c's are marked.\\n    eachA:\\n      a: {write: ' ', R: eachB}\\n      b: {R: scan}\\n    eachB:\\n      a: R\\n      b: {write: B, R: markC}\\n      C: {L: nextA}\\n    markC:\\n      [b,C]: R\\n      c: {write: C, L: nextB}\\n    nextB:\\n      [b,C]: L\\n      B: {R: eachB}\\n    nextA:\\n      a: L\\n      B: {write: b, L}\\n      ' ': {R: eachA}\\n\\n    scan:\\n      [b,C]: R\\n      ' ': {R: accept}\\n    accept:\\npositions:\\n  start:  {x: 180, y: 40}\\n  a+:     {x: 180, y: 180}\\n  b+:     {x: 180, y: 320}\\n  c+:     {x: 180, y: 460}\\n  left:   {x: 290, y: 320}\\n\\n  accept: {x: 400, y: 40}\\n  eachA:  {x: 400, y: 180}\\n  eachB:  {x: 400, y: 320}\\n  markC:  {x: 400, y: 460}\\n\\n  scan:   {x: 560, y: 180}\\n  nextA:  {x: 560, y: 320}\\n  nextB:  {x: 560, y: 460}\\n\"","module.exports = \"name: equal strings\\nsource code: |\\n  # Decides the language { w#w | w  {0,1}* }\\n  # (two equal binary strings separated by '#')\\n  input: '01001#01001' # try '#', '1#10', '10#1', '10#10'\\n  blank: ' '\\n  # Two strings are equal if they are both the empty string,\\n  # or they start with the same symbol and are equal thereafter.\\n  start state: start\\n  table:\\n    start:\\n      # Inductive case: start with the same symbol.\\n      0: {write: ' ', R: have0}\\n      1: {write: ' ', R: have1}\\n      # Base case: empty string.\\n      '#': {R: check}\\n    have0:\\n      [0,1]: R\\n      '#': {R: match0}\\n    have1:\\n      [0,1]: R\\n      '#': {R: match1}\\n    match0:\\n      x: R\\n      0: {write: x, L: back}\\n    match1:\\n      x: R\\n      1: {write: x, L: back}\\n    back:\\n      [0,1,'#',x]: L\\n      ' ': {R: start}\\n    check:\\n      x: R\\n      ' ': {R: accept}\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Accept if the second string is the bitwise complement\\n  #   (1s and 0s swapped) of the first, e.g. accept '1101#0010'.\\n\\n  #  Check that a binary string has the same number of 0s and 1s;\\n  #   eg., accept '001110' but reject '10010'.\\n\\n  #  Check if two strings are different.\\n  #   Example: accept '00#001' and '0101#0111', but reject '1001#1001'.\\npositions:\\n  accept: {x: 80 , y: 250}\\n  check:  {x: 190, y: 250}\\n  # regular hexagon with side length 150\\n  start:  {x: 300, y: 250}\\n  back:   {x: 600, y: 250}\\n  have1:  {x: 375, y: 120.10}\\n  match1: {x: 525, y: 120.10}\\n  have0:  {x: 375, y: 379.90}\\n  match0: {x: 525, y: 379.90}\\n\"","module.exports = \"name: three equal lengths\\nsource code: |\\n  # Decides the language { abc | n  1 }, that is,\\n  # accepts a's followed by b's then c's of the same length.\\n  input: aabbcc # try bac, aabc, aabcc, aabcbc\\n  blank: ' '\\n  # Mark the first a, b, and c on each pass (by capitalizing them).\\n  # All a's must precede all b's, which must precede all c's.\\n  # When there are no more a's,\\n  # all input symbols should have been marked.\\n  start state: qA\\n  table:\\n    qA:\\n      a: {write: A, R: qB}\\n      B: {R: scan}\\n    qB:\\n      [a,B]: R\\n      b: {write: B, R: qC}\\n    qC:\\n      [b,C]: R\\n      c: {write: C, L: back}\\n    back:\\n      [a,B,b,C]: L\\n      A: {R: qA}\\n    scan:\\n      [B,C]: R\\n      ' ': {R: accept}\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Suppose a ledger starts from 0 and gains one dollar for each +\\n  #   and loses one for each -. Reading left to right,\\n  #   check that the account never goes into the negative.\\n  #   Examples: accept '+-++' and '++-+--', reject '-++' and '++---+'.\\n\\n  #  Check parentheses for proper nesting,\\n  #   e.g. accept '()(()()())' but reject '(()))(' and '(()('.\\npositions:\\n  qA: {x: 240, y: 250}\\n  qB: {x: 400, y: 250}\\n  qC: {x: 560, y: 250}\\n  back:   {x: 400, y: 370}\\n  scan:   {x: 320, y: 150}\\n  accept: {x: 480, y: 150}\\n\"","module.exports = \"name: multitape\\nsource code: |\\n  # Adds 1 to a binary number. Prints which bits changed on the second tape\\n  input:\\n    - '1011'\\n    - '0000'\\n  tapes: 2\\n  blank: ' '\\n  start state: right\\n  table:\\n    # scan to the rightmost digit\\n    right:\\n      10,00: 1R 2R\\n      '  ' : carry 1L 2L\\n    # then carry the 1\\n    carry:\\n      10      : 1L0 2L1\\n      '00,  ' : done 1L1 2L1\\n    done:\\n\\npositions:\\n  right: {x: 230, y: 250}\\n  carry: {x: 400, y: 250}\\n  done: {x: 570, y: 250}\\n\"","module.exports = \"name: palindrome\\nsource code: |\\n  # Accepts palindromes made of the symbols 'a' and 'b'\\n  input: 'abba' # try a, ab, bb, babab\\n  blank: ' '\\n  start state: start\\n  synonyms:\\n    accept: {R: accept}\\n    reject: {R: reject}\\n  # A palindrome is either the empty string, a single symbol,\\n  # or a (shorter) palindrome with the same symbol added to both ends.\\n  table:\\n    start:\\n      a: {write: ' ', R: haveA}\\n      b: {write: ' ', R: haveB}\\n      ' ': accept # empty string\\n    haveA:\\n      [a,b]: R\\n      ' ': {L: matchA}\\n    haveB:\\n      [a,b]: R\\n      ' ': {L: matchB}\\n    matchA:\\n      a: {write: ' ', L: back} # same symbol at both ends\\n      b: reject\\n      ' ': accept # single symbol\\n    matchB:\\n      a: reject\\n      b: {write: ' ', L: back} # same symbol at both ends\\n      ' ': accept # single symbol\\n    back:\\n      [a,b]: L\\n      ' ': {R: start}\\n    accept:\\n    reject:\\n\\n\\n  # Exercise:\\n\\n  #  Modify the machine to include 'c' in the symbol alphabet,\\n  #   so it also works for strings like 'cabbac'.\\npositions:\\n  haveA:  {x: 240, y: 185}\\n  start:  {x: 400, y: 185}\\n  haveB:  {x: 560, y: 185}\\n\\n  matchA: {x: 240, y: 315}\\n  back:   {x: 400, y: 315}\\n  matchB: {x: 560, y: 315}\\n\\n  accept: {x: 400, y: 55}\\n  reject: {x: 400, y: 445}\\n\"","module.exports = \"name: powers of two\\nsource code: |\\n  # Matches strings of 0s whose length is a power of two.\\n\\n  # This example comes from the textbook\\n  #   \\\"Introduction to the Theory of Computation\\\" (3rd edition, 2012)\\n  #   by Michael Sipser\\n  # The states have been renamed (from q1, q2, etc.)\\n  # to make it easier to understand.\\n  input: '0000' # try '0', '000', '00000000'\\n  blank: ' '\\n  start state: zero\\n  synonyms:\\n    accept: {R: accept}\\n    reject: {R: reject}\\n  # The idea: divide the length by 2 repeatedly until it reaches 1.\\n\\n  # To do this, cross off every other 0, one pass at a time.\\n  # If any pass reads an odd number of 0s (a remainder), reject right away.\\n  # Otherwise if every pass halves the length cleanly,\\n  # the length must be a power of two (1*2^n for n  0).\\n\\n  # Note that since the first 0 is never crossed off, we can simply\\n  # erase it on the first pass and start the count from 1 from then on.\\n  table:\\n    zero:\\n      0  : {write: ' ', R: one}\\n      ' ': reject\\n    # Base case: accept length of 1 = 2^0.\\n    one:\\n      0  : {write: x, R: even}\\n      ' ': accept\\n      x  : R\\n    # Inductive case: divide by 2 and check for no remainder.\\n    even:\\n      0  : {R: odd}\\n      ' ': {L: back} # return for another pass\\n      x  : R\\n    odd: # odd and > 1\\n      0  : {write: x, R: even}\\n      ' ': reject # odd number of 0s on this pass\\n      x  : R\\n    back:\\n      ' ': {R: one}\\n      [0,x]: L\\n    accept:\\n    reject:\\npositions:\\n  zero:   {x: 200, y: 200}\\n  one:    {x: 400, y: 200}\\n  even:   {x: 600, y: 200}\\n\\n  odd:    {x: 600, y: 385}\\n  back:   {x: 500, y: 125}\\n  accept: {x: 400, y: 300}\\n  reject: {x: 200, y: 385}\\n\"","module.exports = \"name: repeat 0 1\\nsource code: |\\n  # This is the first example machine given by Alan Turing in his 1936 paper\\n  #   \\\"On Computable Numbers, with an Application to\\n  #    the Entscheidungsproblem\\\".\\n  # It simply writes the endless sequence 0 1 0 1 0 1...\\n  blank: ' '\\n  start state: b\\n  table:\\n    b:\\n      ' ': {write: 0, R: c}\\n    c:\\n      ' ':           {R: e}\\n    e:\\n      ' ': {write: 1, R: f}\\n    f:\\n      ' ':           {R: b}\\n\\n\\n  # (Turing uses the convention of leaving a gap after each output cell,\\n  # reserving it for marking the cell. For instance, on a tape that\\n  # contains '0 1x0 0 1 1y1y0y', x marks the leftmost 1 and y marks 110.)\\npositions:\\n  b: {x: 300, y: 200, fixed: false}\\n  c: {x: 450, y: 150, fixed: false}\\n  e: {x: 500, y: 300, fixed: false}\\n  f: {x: 350, y: 350, fixed: false}\\n\"","module.exports = \"name: unary multiplication\\nsource code: |\\n  # Multiplies together two unary numbers separated by a '*'.\\n  # (Unary is like tallying. Here '||*|||' means 2 times 3.)\\n  input: '||*|||' # try '*', '|*|||', '||||*||'\\n  blank: ' '\\n\\n  # The idea:\\n  #   multiply(0, b) = 0\\n  #   multiply(a, b) = b + multiply(a-1, b)   when a > 0\\n  start state: eachA\\n  table:\\n    # For each 1 in a, add a copy of b.\\n    eachA:\\n      '|': {write: ' ', R: toB}  # Inductive case: a > 0.\\n      '*': {R: skip}             # Base case:      a = 0.\\n    toB:\\n      '|': R\\n      '*': {R: eachB} # enter copier\\n    nextA: # return from copier\\n      ' ': {write: '|', R: eachA}\\n      ['|','*']: L\\n\\n    skip:\\n      '|': R\\n      ' ': {R: done}\\n    done:\\n\\n    # This is the 'copy 1s' machine, with ' ' as 0 and '|' as 1.\\n    eachB:\\n      ' ': {L: nextA}\\n      '|': {write: ' ', R: sep}\\n    sep:\\n      ' ': {R: add}\\n      '|': R\\n    add:\\n      ' ': {write: '|', L: sepL}\\n      '|': R\\n    sepL:\\n      ' ': {L: nextB}\\n      '|': L\\n    nextB:\\n      ' ': {write: '|', R: eachB}\\n      '|': L\\n\\npositions:\\n  eachA:  {x: 400, y:  50}\\n  toB:    {x: 400, y: 150}\\n  eachB:  {x: 400, y: 250}\\n  sep:   {x: 400, y: 350}\\n  add:   {x: 400, y: 450}\\n\\n  sepL:  {x: 280, y: 350}\\n  nextB:  {x: 280, y: 250}\\n\\n  nextA:  {x: 280, y: 90}\\n  skip:   {x: 520, y: 90}\\n  done:   {x: 520, y: 190}\\n\"","module.exports = \"name: Universal TM\\nsource code: \\\"#       \\\\r\\\\n#     ,   \\\\r\\\\n#   \\\\r\\\\n#        1   ,\\\\r\\\\n#  -  2,   R, L  H -  3, 33  333\\\\r\\\\n# .\\\\r\\\\n#      3333,   ,\\\\r\\\\n# ,    - \\\\r\\\\n#      '>'.\\\\r\\\\n#       ,\\\\r\\\\n#     ,\\\\r\\\\n#   -     .\\\\r\\\\n#         ,   \\\\r\\\\n#  ';'\\\\r\\\\n# \\\\r\\\\n#       :\\\\r\\\\n#     S1 a -> b S2 R/L/H\\\\r\\\\n#     :\\\\r\\\\n#   -     :\\\\r\\\\n#         a S1 b S2 R/L/H\\\\r\\\\n#   -  S2 -  ,   R, L  H  3333\\\\r\\\\n#   -         ,\\\\r\\\\n#   -      \\\\r\\\\n#        \\\\r\\\\n# \\\\r\\\\n#      , \\\\r\\\\n#  ,    -  \\\\r\\\\n#     (       )\\\\r\\\\n# \\\\r\\\\n# \\\\r\\\\n#       :\\\\r\\\\n#   -   :\\\\r\\\\n#       -        \\\\r\\\\n#       -        2 \\\\r\\\\n#       -          \\\\r\\\\n#               \\\\r\\\\n#   -     :\\\\r\\\\n#       -       ,\\\\r\\\\n#              .\\\\r\\\\n#                 \\\\r\\\\n#             \\\\r\\\\n#   -      \\\\r\\\\n#   -       \\\\r\\\\n#       -          \\\\r\\\\n#             \\\\r\\\\n#\\\\r\\\\ninput:\\\\r\\\\n  - '>112211223111122111122312212223311222111123333111122211222331222111123333'\\\\r\\\\n  - '>22'\\\\r\\\\n  - '>;11;1111;11;1111;1111;'\\\\r\\\\ntapes: 3\\\\r\\\\nblank: ' '\\\\r\\\\nstart state: start\\\\r\\\\ntable:\\\\r\\\\n  error:\\\\r\\\\n  end:\\\\r\\\\n  start:\\\\r\\\\n    '>>>': 1R 2R 3R   #  \\\\r\\\\n    '>>;': 1R 2R      #   \\\\r\\\\n    12;: match 3R     #    1    \\\\r\\\\n  match: #    \\\\r\\\\n    121: 1R 3R       \\\\r\\\\n    221,12;: skip1 3L #  \\\\r\\\\n    22;: found1\\\\r\\\\n  skip1: #     ,\\\\r\\\\n         #    2      \\\\r\\\\n    221: 1R 2L 3L\\\\r\\\\n    121: 1R 2L 3L\\\\r\\\\n    321:    2L 3L\\\\r\\\\n    2>1: 1R    3L\\\\r\\\\n    1>1: 1R    3L\\\\r\\\\n    3>1:       3L\\\\r\\\\n    22;: 1R 2L\\\\r\\\\n    12;: 1R 2L\\\\r\\\\n    32;:    2L\\\\r\\\\n    2>;: 1R\\\\r\\\\n    1>;: 1R\\\\r\\\\n    3>;: skip2\\\\r\\\\n  skip2: #        \\\\r\\\\n    3>;: 1R\\\\r\\\\n    1>;: match 2R 3R\\\\r\\\\n    \\\\r\\\\n  found1: #  ,   \\\\r\\\\n    22;:       3L\\\\r\\\\n    221: 1R 2R\\\\r\\\\n    121: skip1     #  \\\\r\\\\n    2 1: skip1  2L #  \\\\r\\\\n    1 1: found2 2L #  \\\\r\\\\n  found2: #  ,\\\\r\\\\n          #    2      \\\\r\\\\n    121: 2L 3L\\\\r\\\\n    12;: 2L\\\\r\\\\n    1>1:    3L\\\\r\\\\n    1>;: write1 3R\\\\r\\\\n  write1: #  \\\\r\\\\n    1>1: 1R 3R  #  \\\\r\\\\n    1>;: extend #  \\\\r\\\\n    2>1: shrink #  \\\\r\\\\n    2>;: write2 #  \\\\r\\\\n  write2:\\\\r\\\\n    2>;:    2R 3L # setup\\\\r\\\\n    221: 1R 2R    #   \\\\r\\\\n    2 1: 1R 2R2   #  \\\\r\\\\n    321:    2R_   #  \\\\r\\\\n    3 1: right 1R\\\\r\\\\n    \\\\r\\\\n  right: #    \\\\r\\\\n    1 1,  1: goright # '3',  \\\\r\\\\n    3 1: left 1R     # '33'\\\\r\\\\n  left:\\\\r\\\\n    1 1,  1: goleft  # '33',  \\\\r\\\\n    3 1: hold 1R     # '333', \\\\r\\\\n  hold:\\\\r\\\\n    1 1,  1: gohold  # '333', \\\\r\\\\n    3 1: end       # '3333',  \\\\r\\\\n  goright:\\\\r\\\\n    1 1: 3R        #    \\\\r\\\\n    1 ;: append 3R\\\\r\\\\n  append: #  '1;'  \\\\r\\\\n    '1 1': back 3L     #   \\\\r\\\\n    '1  ': append2 3R1 #  '1'\\\\r\\\\n  append2:\\\\r\\\\n    '1  ': gohold 3L;  #  ';',    \\\\r\\\\n  goleft:\\\\r\\\\n    1 1: 3L        #    \\\\r\\\\n    1 ;: gohold 3L #    \\\\r\\\\n  gohold:\\\\r\\\\n    1 1: 3L    #   \\\\r\\\\n    1 >: error #   goleft   >\\\\r\\\\n    1 ;: back  # \\\\r\\\\n  \\\\r\\\\n    \\\\r\\\\n  back:          #  1  2  \\\\r\\\\n    '> ;':    2L\\\\r\\\\n    '  ;': 1L 2L\\\\r\\\\n    '1 ;': 1L 2L\\\\r\\\\n    '2 ;': 1L 2L\\\\r\\\\n    '3 ;': 1L 2L\\\\r\\\\n    '>2;':    2L\\\\r\\\\n    '12;': 1L 2L\\\\r\\\\n    '22;': 1L 2L\\\\r\\\\n    '32;': 1L 2L\\\\r\\\\n    '1>;': 1L\\\\r\\\\n    '2>;': 1L\\\\r\\\\n    '3>;': 1L\\\\r\\\\n    '>>;': start\\\\r\\\\n    \\\\r\\\\n  extend:  #  \\\\r\\\\n    1>;:    2R  #   2 \\\\r\\\\n    12;:    2R\\\\r\\\\n    1 ;: 1R 2R  #       \\\\r\\\\n    1 1: 1R 2R  # \\\\r\\\\n    2 ;:    2R; 3R  #   2 \\\\r\\\\n    2 1:    2R1 3R\\\\r\\\\n    '1  ': 1R 3R\\\\r\\\\n    '2  ': extb 2L 3L\\\\r\\\\n  extb:  #      2 \\\\r\\\\n    '2  ': 2L 3L\\\\r\\\\n    '211': 2L 3L\\\\r\\\\n    '2;;': 2L 3L\\\\r\\\\n    '2 1': 2L    #   2     \\\\r\\\\n    '221': extc 2R 3R\\\\r\\\\n  extc:  #   2    3    2\\\\r\\\\n    '2; ': 2R_ 3R;\\\\r\\\\n    '2;1': 2R_ 3R;\\\\r\\\\n    '2;;': 2R_ 3R;\\\\r\\\\n    '21 ': 2R_ 3R1\\\\r\\\\n    '211': 2R_ 3R1\\\\r\\\\n    '21;': 2R_ 3R1\\\\r\\\\n    '2 1': 2R  3R1\\\\r\\\\n    '2 ;': 2R  3R1\\\\r\\\\n    '2  ': extcb 2L 3L\\\\r\\\\n  extcb:  #      3     2\\\\r\\\\n    2 1: 2L 3L\\\\r\\\\n    2 ;: 2L 3L\\\\r\\\\n    221: 2L 3R\\\\r\\\\n    22;: 2L \\\\r\\\\n    2>1:    3R\\\\r\\\\n    2>;: write2\\\\r\\\\n    \\\\r\\\\n  shrink:  #  \\\\r\\\\n    2>1:     3R2  #  2    \\\\r\\\\n    2>;: 2R     #     \\\\r\\\\n    22;: 2R\\\\r\\\\n    2 1: 2R1 3R #   2 \\\\r\\\\n    2 ;: 2R; 3R\\\\r\\\\n    '2  ': shrb 2L 3L\\\\r\\\\n  shrb:  #  \\\\r\\\\n    211: 2L 3L  #    '2'  2 \\\\r\\\\n    2;;: 2L 3L\\\\r\\\\n    222: 3L     #    3 \\\\r\\\\n    221: shrc 2R 3R\\\\r\\\\n  shrc:  #   2    3    2\\\\r\\\\n    2;1: 2R_ 3R;\\\\r\\\\n    2;2: 2R_ 3R;\\\\r\\\\n    2;;: 2R_ 3R;\\\\r\\\\n    211: 2R_ 3R1\\\\r\\\\n    212: 2R_ 3R1\\\\r\\\\n    21;: 2R_ 3R1\\\\r\\\\n    2 1: 2R  3R_\\\\r\\\\n    2 2: 2R  3R_\\\\r\\\\n    2 ;: 2R  3R_\\\\r\\\\n    '2  ': shrcb 2L 3L\\\\r\\\\n  shrcb:  #      3     2\\\\r\\\\n    '2  ': 2L 3L\\\\r\\\\n    '2 1': 2L 3L\\\\r\\\\n    '2 ;': 2L 3L\\\\r\\\\n    221: 2L 3R\\\\r\\\\n    22;: 2L\\\\r\\\\n    2>1:    3R\\\\r\\\\n    2>;: write2\\\\r\\\\n\\\\r\\\\n\\\\r\\\\nvis:\\\\r\\\\n  error:\\\\r\\\\n    color: FF4040\\\\r\\\\n  start:\\\\r\\\\n    color: 2CA02C\\\\r\\\\n  match:\\\\r\\\\n    color: 2CA02C\\\\r\\\\n    1,3:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 1\\\\r\\\\n      color: green\\\\r\\\\n  skip1:\\\\r\\\\n    color: FF7F0E\\\\r\\\\n    1:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 3\\\\r\\\\n      color: red\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: '>'\\\\r\\\\n      color: red\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: ;\\\\r\\\\n      color: red\\\\r\\\\n  skip2:\\\\r\\\\n    color: FF7F0E\\\\r\\\\n    1:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 1\\\\r\\\\n      color: red\\\\r\\\\n  found1:\\\\r\\\\n    color: 2CA02C\\\\r\\\\n    1,2:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 2\\\\r\\\\n      color: green\\\\r\\\\n  found2:\\\\r\\\\n    color: 2CA02C\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: '>'\\\\r\\\\n      color: blue\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: ;\\\\r\\\\n      color: blue\\\\r\\\\n  write1:\\\\r\\\\n    color: 17BECF\\\\r\\\\n    1,3:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 1\\\\r\\\\n      color: green\\\\r\\\\n  write2:\\\\r\\\\n    color: 17BECF\\\\r\\\\n    1,2:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 2\\\\r\\\\n      color: green\\\\r\\\\n  right:\\\\r\\\\n    color: 1F77B4\\\\r\\\\n    1:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: 3\\\\r\\\\n      color: green\\\\r\\\\n  left:\\\\r\\\\n    color: 1F77B4\\\\r\\\\n    1:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: 3\\\\r\\\\n      color: green\\\\r\\\\n  hold:\\\\r\\\\n    color: 1F77B4\\\\r\\\\n    1:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: 3\\\\r\\\\n      color: green\\\\r\\\\n  goright:\\\\r\\\\n    color: 17BECF\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: ;\\\\r\\\\n      color: blue\\\\r\\\\n  goleft:\\\\r\\\\n    color: 17BECF\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: ;\\\\r\\\\n      color: blue\\\\r\\\\n      skip: 1\\\\r\\\\n  gohold:\\\\r\\\\n    color: 17BECF\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: ;\\\\r\\\\n      color: blue\\\\r\\\\n  append:\\\\r\\\\n    color: BCBD22\\\\r\\\\n  append2:\\\\r\\\\n    color: BCBD22\\\\r\\\\n  end:\\\\r\\\\n    color: 7F7F7F\\\\r\\\\n      \\\\r\\\\n  back:\\\\r\\\\n    color: FF7F0E\\\\r\\\\n    1,2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: '>'\\\\r\\\\n      color: blue\\\\r\\\\n    \\\\r\\\\n  extend:\\\\r\\\\n    color: 9467BD\\\\r\\\\n    1:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 1\\\\r\\\\n      color: red\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: ' '\\\\r\\\\n      color: red\\\\r\\\\n  extb:\\\\r\\\\n    color: 9467BD\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: 2\\\\r\\\\n      color: blue\\\\r\\\\n  extc:\\\\r\\\\n    color: 9467BD\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: ' '\\\\r\\\\n      color: red\\\\r\\\\n  extcb:\\\\r\\\\n    color: 9467BD\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: '>'\\\\r\\\\n      color: blue\\\\r\\\\n    \\\\r\\\\n  shrink:\\\\r\\\\n    color: E377C2\\\\r\\\\n    1:\\\\r\\\\n      mode: row\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: 1\\\\r\\\\n      color: red\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: ' '\\\\r\\\\n      color: red\\\\r\\\\n  shrb:\\\\r\\\\n    color: E377C2\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: 2\\\\r\\\\n      color: blue\\\\r\\\\n  shrc:\\\\r\\\\n    color: E377C2\\\\r\\\\n    3:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: ->\\\\r\\\\n      chars: ' '\\\\r\\\\n      color: red\\\\r\\\\n  shrcb:\\\\r\\\\n    color: E377C2\\\\r\\\\n    2:\\\\r\\\\n      mode: find\\\\r\\\\n      dir: <-\\\\r\\\\n      chars: '>'\\\\r\\\\n      color: blue\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\"\\npositions:\\n  error: {x: 420, y: 34.64}\\n  end: {x: 500, y: 34.64}\\n  start: {x: 300, y: 103.92}\\n  match: {x: 260, y: 173.21}\\n  skip1: {x: 180, y: 173.21}\\n  skip2: {x: 220, y: 103.92}\\n  found1: {x: 220, y: 242.49}\\n  found2: {x: 260, y: 311.77}\\n  write1: {x: 300, y: 381.05}\\n  write2: {x: 620, y: 381.05}\\n  right: {x: 620, y: 242.49}\\n  left: {x: 580, y: 173.21}\\n  hold: {x: 540, y: 103.92}\\n  goright: {x: 540, y: 242.49}\\n  append: {x: 460, y: 242.49}\\n  append2: {x: 420, y: 173.21}\\n  goleft: {x: 500, y: 173.21}\\n  gohold: {x: 460, y: 103.92}\\n  back: {x: 380, y: 103.92}\\n  extend: {x: 340, y: 450.33}\\n  extb: {x: 420, y: 450.33}\\n  extc: {x: 500, y: 450.33}\\n  extcb: {x: 580, y: 450.33}\\n  shrink: {x: 340, y: 311.77}\\n  shrb: {x: 420, y: 311.77}\\n  shrc: {x: 500, y: 311.77}\\n  shrcb: {x: 580, y: 311.77}\\n\"","'use strict';\n\n/* global document */\nvar KeyValueStorage = require('./storage').KeyValueStorage;\nvar TMDocument = require('./TMDocument');\nvar d3 = require('d3');\nvar defaults = require('lodash/fp').defaults; // NB. 2nd arg takes precedence\n\n/**\n * Document menu controller.\n *\n * The view is fully determined by a 3-tuple: ([ID], ID -> Name, currentID).\n * @constructor\n * @param {Object}  args                  argument object\n * @param {HTMLSelectElement}\n *                  args.menu\n * @param {?Node}  [args.group=args.menu] Node to add documents to.\n * @param {string}  args.storagePrefix\n * @param {?(TMDocument -> HTMLOptionElement)}\n *                  args.makeOption       Customize rendering for each document entry.\n * @param {?string} args.firsttimeDocID   Document to open on the first visit.\n */\nfunction DocumentMenu(args) {\n  var menu = args.menu,\n      group = args.group || menu,\n      storagePrefix = args.storagePrefix,\n      firsttimeDocID = args.firsttimeDocID;\n\n  if (!menu) {\n    throw new TypeError('DocumentMenu: missing parameter: menu element');\n  } else if (!storagePrefix) {\n    throw new TypeError('DocumentMenu: missing parameter: storage prefix');\n  }\n  if (args.makeOption) {\n    this.optionFromDocument = args.makeOption;\n  }\n  this.menu = menu;\n  this.group = group;\n  this.group.innerHTML = '';\n  this.__storagePrefix = storagePrefix;\n\n  // Load document entries (non-examples)\n  this.doclist = new DocumentList(storagePrefix + '.list');\n  this.render();\n  // Re-open last-opened document\n  this.selectDocID(this.getSavedCurrentDocID() || firsttimeDocID);\n\n  // Listen for selection changes\n  var self = this;\n  this.menu.addEventListener('change', function () {\n    self.onChange(self.currentDocument, {type: 'open'});\n  });\n\n  // Listen for storage changes in other tabs/windows\n  KeyValueStorage.addStorageListener(function (e) {\n    var docID;\n    var option, newOption;\n\n    if (e.key === self.doclist.storageKey) {\n      // case: [ID] list changed\n      self.doclist.readList();\n      self.render();\n    } else if ( (docID = TMDocument.IDFromNameStorageKey(e.key)) ) {\n      // case: single document renamed: (ID -> Name) changed\n      option = self.findOptionByDocID(docID);\n      if (option) {\n        // replace the whole <option>, to be consistent with .optionFromDocument\n        option.parentNode.replaceChild(\n          newOption = self.optionFromDocument(new TMDocument(docID)),\n          option\n        );\n        newOption.selected = option.selected;\n        d3.select(newOption).datum( d3.select(option).datum() );\n      }\n    }\n  });\n}\n\nObject.defineProperties(DocumentMenu.prototype, {\n  currentOption: {\n    get: function () {\n      return this.menu.options[this.menu.selectedIndex];\n    },\n    enumerable: true\n  },\n  currentDocument: {\n    get: function () {\n      var opt = this.currentOption;\n      return opt ? new TMDocument(opt.value) : null;\n    },\n    enumerable: true\n  }\n});\n\nDocumentMenu.prototype.render = function () {\n  var currentDocID = this.currentOption ? this.currentOption.value : null;\n\n  var option = d3.select(this.group).selectAll('option')\n    .data(this.doclist.list, function (entry) { return entry.id; });\n\n  option.exit().remove();\n\n  var self = this;\n  option.enter().insert(function (entry) {\n    return self.optionFromDocument(new TMDocument(entry.id));\n  });\n\n  // If current document was deleted, switch to another document\n  if (this.currentOption.value !== currentDocID) {\n    // fallback 1: saved current docID\n    if (!this.selectDocID(this.getSavedCurrentDocID(), {type: 'delete'})) {\n      // fallback 2: whatever is now selected\n      this.onChange(this.currentDocument, {type: 'delete'});\n    }\n  }\n};\n\n// Returns the <option> whose 'value' attribute is docID.\nDocumentMenu.prototype.findOptionByDocID = function (docID) {\n  return this.menu.querySelector('option[value=\"' + docID.replace(/\"/g, '\\\\\"') + '\"]');\n};\n\n// Selects (switches the active item to) the given docID. Returns true on success.\nDocumentMenu.prototype.selectDocID = function (docID, opts) {\n  try {\n    this.findOptionByDocID(docID).selected = true;\n  } catch (e) {\n    return false;\n  }\n  this.onChange(this.currentDocument, opts);\n  return true;\n};\n\n// Saves the current (selected) docID to storage.\nDocumentMenu.prototype.saveCurrentDocID = function () {\n  var docID = this.currentOption && this.currentOption.value;\n  if (docID) {\n    KeyValueStorage.write(this.__storagePrefix + '.currentDocID', docID);\n  }\n};\n\n// Returns the saved current docID, otherwise null.\nDocumentMenu.prototype.getSavedCurrentDocID = function () {\n  return KeyValueStorage.read(this.__storagePrefix + '.currentDocID');\n};\n\n// Configurable methods\n\nDocumentMenu.prototype.optionFromDocument = function (doc) {\n  var option = document.createElement('option');\n  option.value = doc.id;\n  option.text = doc.name || 'untitled';\n  return option;\n};\n\n// Called when the current document ID changes\n// through user action (<select>) or this class's API.\n// The callback receives the new value of .currentDocument,\n// along with the options object (whose .type\n// is 'duplicate', 'delete', or 'open').\nDocumentMenu.prototype.onChange = function () {\n};\n\n// Internal Helpers\n\n// prepend then select\nDocumentMenu.prototype.__prepend = function (doc, opts) {\n  var option = this.optionFromDocument(doc);\n  this.group.insertBefore(option, this.group.firstChild);\n  if (opts && opts.select) {\n    this.menu.selectedIndex = option.index;\n    this.onChange(doc, opts);\n  }\n  return doc;\n};\n\n// Methods not about Current Document\n\nDocumentMenu.prototype.newDocument = function (opts) {\n  return this.__prepend(this.doclist.newDocument(), defaults({type: 'open'}, opts));\n};\n\n// Methods about Current Document\n\nDocumentMenu.prototype.duplicate = function (doc, opts) {\n  return this.__prepend(this.doclist.duplicate(doc), defaults({type: 'duplicate'}, opts));\n};\n\nDocumentMenu.prototype.rename = function (name) {\n  this.currentDocument.name = name;\n  this.currentOption.text = name;\n};\n\n// required invariant: one option is always selected.\n// returns true if the current entry was removed from the list.\nDocumentMenu.prototype.delete = function (opts) {\n  this.currentDocument.delete();\n  var index = this.menu.selectedIndex;\n  var didDeleteEntry = this.doclist.deleteIndex(index);\n  if (didDeleteEntry) {\n    this.currentOption.remove();\n    this.menu.selectedIndex = index;\n    this.onChange(this.currentDocument, defaults({type: 'delete'}, opts));\n  }\n  return didDeleteEntry;\n};\n\n/////////////////////\n// Document List   //\n// (model/storage) //\n/////////////////////\n\n\n// for custom documents.\nfunction DocumentList(storageKey) {\n  this.storageKey = storageKey;\n  this.readList();\n}\n\n// () -> string\nDocumentList.newID = function () {\n  return String(Date.now());\n};\n\n// internal methods.\nDocumentList.prototype.add = function (docID) {\n  this.__list.unshift({id: docID});\n  this.writeList();\n};\nDocumentList.prototype.readList = function () {\n  this.__list = JSON.parse(KeyValueStorage.read(this.storageKey)) || [];\n};\nDocumentList.prototype.writeList = function () {\n  KeyValueStorage.write(this.storageKey, JSON.stringify(this.__list));\n};\n\nDocumentList.prototype.newDocument = function () {\n  var newID = DocumentList.newID();\n  this.add(newID);\n  return new TMDocument(newID);\n};\n\nDocumentList.prototype.duplicate = function (doc) {\n  return this.newDocument().copyFrom(doc);\n};\n\n/**\n * Behaves like list.splice(index, 1).\n * @param  {number} index index of the element to delete\n * @return {boolean} true if an element was removed, false otherwise (index out of bounds)\n */\nDocumentList.prototype.deleteIndex = function (index) {\n  var deleted = this.__list.splice(index, 1);\n  this.writeList();\n  return (deleted.length > 0);\n};\n\nObject.defineProperties(DocumentList.prototype, {\n  list: {\n    get: function () { return this.__list; },\n    enumerable: true\n  }\n});\n\nmodule.exports = DocumentMenu;\n","'use strict';\n\n// var d3 = require('d3');\nvar $ = require('jquery'); // for event delegation\n\nfunction identity(x) { return x; }\nfunction head(array) { return array[0]; }\n\n/**\n * A <table> that includes a checkbox in front of each row,\n * and a header checkbox to (de)select all rows.\n * @param {D3Selection<HTMLTableElement>} args.table empty table to use\n * @param {[string]}    [args.headers] column headers\n * @param {[[string]]}  [args.data]    table data\n */\nfunction CheckboxTable(args) {\n  this.table = args.table;\n  this.headerRow = this.table.append('thead').append('tr');\n  this.tbody = this.table.append('tbody');\n  // header checkbox (selects/deselects all checkboxes)\n  var self = this;\n  this.headerCheckbox = this.headerRow\n    .append('th')\n      .attr('class', 'checkbox-cell')\n    .append('input')\n      .attr('type', 'checkbox')\n      .on('click', /* @this checkbox */ function () {\n        self.getCheckboxes().property('checked', this.checked);\n        self.onChange();\n      });\n  $(this.tbody.node()).on('click', 'tr', /* @this tr */ function (e) {\n    // treat whole <tr> as click zone\n    if (e.target.tagName !== 'INPUT') {\n      var box = this.querySelector('input[type=\"checkbox\"]');\n      box.checked = !box.checked;\n    }\n    // update header checkbox\n    self.refresh();\n    self.onChange();\n  });\n  // content\n  args.headers && this.setHeaders(args.headers);\n  args.data && this.setData(args.data);\n}\n\n/**\n * Set the column headers.\n * @param {[string]} headers\n */\nCheckboxTable.prototype.setHeaders = function (headers) {\n  var th = this.headerRow\n    .selectAll('th:not(.checkbox-cell)')\n      .data(headers);\n  th.exit().remove();\n  th.enter().append('th');\n  th.text(identity);\n};\n\n/**\n * Set the table body data.\n *\n * Each row begins with a checkbox whose .value is the first cell.\n * Rows are keyed by the first cell when updating data.\n * @param {[[string]]} data\n * @return this\n */\nCheckboxTable.prototype.setData = function (data) {\n  var tr = this.tbody.selectAll('tr')\n      .data(data, head);\n  tr.exit().remove();\n  tr.enter()\n    .append('tr')\n  // checkbox at the start of each row\n    .append('td')\n      .attr('class', 'checkbox-cell')\n    .append('input')\n      .attr({\n        type: 'checkbox',\n        value: head\n      });\n  tr.order();\n  // row cells\n  var td = tr.selectAll('td:not(.checkbox-cell)')\n      .data(identity);\n  td.exit().remove();\n  td.enter().append('td');\n  td.text(identity);\n\n  return this;\n};\n\nCheckboxTable.prototype.getCheckboxes = function () {\n  return this.tbody.selectAll('input[type=\"checkbox\"]');\n};\n\nCheckboxTable.prototype.getCheckedValues = function () {\n  return this.tbody.selectAll('input[type=\"checkbox\"]:checked')[0]\n    .map(function (x) { return x.value; });\n};\n\nCheckboxTable.prototype.isCheckedEmpty = function () {\n  var headerBox = this.headerCheckbox.node();\n  return !(headerBox.checked || headerBox.indeterminate);\n};\n\n/**\n * Refresh the header checkbox (called after a row checkbox is toggled).\n */\nCheckboxTable.prototype.refresh = function () {\n  var headerBox = this.headerCheckbox.node();\n  var boxes = this.getCheckboxes();\n\n  var total = boxes.size();\n  var checked = boxes.filter(':checked').size();\n  if (checked === 0) {\n    headerBox.checked = false;\n  } else if (checked === total) {\n    headerBox.checked = true;\n  }\n  headerBox.indeterminate = (0 < checked && checked < total);\n};\n\n// configurable. called after a click toggles a row or header checkbox.\nCheckboxTable.prototype.onChange = function () {\n};\n\nmodule.exports = CheckboxTable;\n","'use strict';\n\n/* global FileReader:false */\nvar Promise = require('bluebird'); // eslint-disable-line no-shadow\n\n// arguments are forwarded to FileReader.readAsText\n// (Blob, ?encoding) -> Promise\nfunction readAsText() {\n  var args = arguments;\n  return new Promise(function (resolve, reject, onCancel) {\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      resolve(reader.result);\n    });\n    reader.addEventListener('error', function () {\n      reject(reader.error);\n    });\n    onCancel && onCancel(function () {\n      try { reader.abort(); } catch (e) {/* */}\n    });\n\n    reader.readAsText.apply(reader, args);\n  });\n}\n\nexports.readAsText = readAsText;\n","'use strict';\n\n/* global document: false */\nvar docimport = require('./import');\nvar format = require('./format');\nvar _ = require('lodash/fp');\nvar d3 = require('d3');\n\n// Init the import panel and attach event handlers\n// {$dialog: jQuery, gistIDForm: HTMLFormElement, importArgs: Object} -> void\nfunction init(args) {\n  var $dialog = args.$dialog,\n      gistIDForm = args.gistIDForm,\n      importArgs = args.importArgs;\n\n  function hideDialog() {\n    $dialog.modal('hide');\n    // Workaround needed for opening another modal before a modal is done hiding.\n    // Without this, the <body> scrolls instead of the modal:\n    // modal2.show locks body scroll => modal1.hidden unlocks body scroll\n    // while modal2 is still open.\n    var nextDialog = importArgs.dialogNode;\n    $dialog.one('hidden.bs.modal', function () {\n      if (nextDialog.classList.contains('in')) {\n        document.body.classList.add('modal-open');\n      }\n    });\n  }\n\n  // Panel: From GitHub gist\n  gistIDForm.addEventListener('submit', function (e) {\n    e.preventDefault();\n    hideDialog();\n\n    var gistID = gistIDForm.querySelector('input[type=\"text\"]').value;\n    docimport.importGist(_.assign({gistID: gistID}, importArgs));\n  });\n\n  // Panel: From files\n  (function () {\n    // TODO: factor out element IDs and containers into interface\n    var panelBody = document.querySelector('#importFilesPanel > .panel-body');\n    // <input type=\"file\">\n    var fileInput = panelBody.querySelector('input[type=\"file\"]');\n    var importFilesButton = document.getElementById('importFilesButton');\n    importFilesButton.addEventListener('click', function () {\n      hideDialog();\n      docimport.importLocalFiles(_.assign({files: fileInput.files}, importArgs));\n    });\n    // <textarea>\n    var textarea = panelBody.querySelector('textarea');\n    var importContentsButton = document.getElementById('importContentsButton');\n    importContentsButton.parentNode.style.position = 'relative';\n    importContentsButton.addEventListener('click', function (e) {\n      if (importDocumentContents(\n        { containers: {status: e.target.parentNode, details: panelBody },\n          importDocument: importArgs.importDocument },\n        textarea.value\n      )) {\n        textarea.select();\n      }\n    });\n  }());\n}\n\n///////////////////////////////\n// Import from pasted string //\n///////////////////////////////\n\n// () -> HTMLButtonElement\nfunction createCloseIcon() {\n  return d3.select(document.createElement('button'))\n      .attr({class: 'close', 'aria-label': 'Close'})\n      .html('<span aria-hidden=\"true\">&times;</span>')\n    .node();\n}\n\n// Show import outcome (success/failure) and error (if any)\n// ({status: HTMLElement, details: HTMLElement}, ?Error) -> void\nfunction showImportContentOutcome(containers, error) {\n  var statusContainer = d3.select(containers.status),\n      detailsContainer = d3.select(containers.details);\n  statusContainer.selectAll('[role=\"alert\"]').remove();\n  detailsContainer.selectAll('.alert').remove();\n  var status = statusContainer.append('span')\n      .attr({role: 'alert'})\n      .style({\n        position: 'absolute', left: 0, width: '40%', // center between left and button\n        top: '50%', transform: 'translateY(-60%)' // center vertically\n      });\n\n  // () -> string\n  function showErrorDetails() {\n    var details = detailsContainer.append('div')\n        .attr({role: 'alert', class: 'alert alert-danger'})\n        .style('margin-top', '1em');\n    details.append(createCloseIcon)\n        .attr('data-dismiss', 'alert')\n        .on('click', function () {\n          status.remove(); // dismiss details => also dismiss status\n        });\n    if (error instanceof format.YAMLException) {\n      details.append('h4').text('Not valid YAML'); // only \".alert h4\" has margin-top: 0\n      details.append('pre').text(error.message);\n    } else if (error instanceof format.InvalidDocumentError) {\n      details.append('span')\n          .text(error.message.replace(/\\.?$/, '.')); // add period if missing\n    } else {\n      details.append('h4').text('Unexpected error');\n      details.append('pre').text(String(error));\n      return 'Import failed';\n    }\n    return 'Not a valid document';\n  }\n\n  if (error) {\n    var statusSummary = showErrorDetails();\n    status.attr({class: 'text-danger'})\n        .html('<span class=\"glyphicon glyphicon-exclamation-sign\" aria-hidden=\"true\"></span> '\n                + statusSummary);\n  } else {\n    status.attr({class: 'text-success'})\n        .html('<span class=\"glyphicon glyphicon-ok\" aria-hidden=\"true\"></span> '\n                + 'Import succeeded')\n      .transition()\n        .delay(2500)\n        .duration(2000)\n        .style('opacity', 0)\n        .remove();\n  }\n}\n\n// returns true if import succeeded\nfunction importDocumentContents(opts, content) {\n  var containers = opts.containers,\n      importDocument = opts.importDocument;\n\n  var error = (function () {\n    try {\n      importDocument(format.parseDocument(content));\n    } catch (e) {\n      return e;\n    }\n  }());\n  showImportContentOutcome(containers, error);\n  return (error == null);\n}\n\nexports.init = init;\n","'use strict';\n\n/* eslint-env browser */\nvar format = require('./format');\nvar createGist = require('./gist').createGist;\nvar Clipboard = require('clipboard');\nvar $ = require('jquery'); // for bootstrap tooltip\n\n// https://github.com/Modernizr/Modernizr/blob/master/feature-detects/a/download.js\nvar canUseDownloadAttribute =\n  !window.externalHost && 'download' in document.createElement('a');\n\n// can copy to clipboard programmatically?\nvar canUseCopyCommand = (function () {\n  try {\n    return document.queryCommandSupported('copy');\n  } catch (e) {\n    return false;\n  }\n}());\n\n// Add event handlers to select an HTMLInputElement's text on focus.\nfunction addSelectOnFocus(element) {\n  element.addEventListener('focus', function selectAll(e) {\n    e.target.select();\n  });\n  // Safari workaround\n  element.addEventListener('mouseup', function (e) {\n    e.preventDefault();\n  });\n}\n\n// Show a one-time tooltip.\n// NB. an existing title attribute overrides the tooltip options.\nfunction showTransientTooltip($element, options) {\n  $element.tooltip(options)\n    .tooltip('show')\n    .one('hidden.bs.tooltip', function () {\n      $element.tooltip('destroy');\n    });\n}\n\nfunction showCopiedTooltip(element) {\n  showTransientTooltip($(element), {title: 'Copied!', placement: 'bottom'});\n}\n\n\n///////////////////////\n// Share with GitHub //\n///////////////////////\n\n/**\n * Generate a new gist and display a shareable link.\n * @param  {HTMLElement} container  Container to use for displaying the link.\n * @param  {HTMLButtonElement} button\n * @param  {string} filename\n * @param  {string} contents  The file contents.\n * @return {Promise}          Cancellable promise to create the gist.\n */\nfunction generateGist(container, button, filename, contents) {\n  var oldButtonText = button.textContent;\n  button.textContent = 'Loading';\n  button.disabled = true;\n\n  var payload = {\n    files: {},\n    description: 'Turing machine for http://turingmachine.io',\n    public: true\n  };\n  payload.files[filename] = {content: contents};\n\n  return createGist(payload).then(function (response) {\n    // Show link on success\n    var id = response.id;\n    showGeneratedGist(container, 'http://turingmachine.io/?import-gist=' + id);\n  }).catch(function (reason) {\n    // Alert error on failure\n    var message = (function () {\n      var xhr = reason.xhr;\n      try {\n        return 'Response from GitHub: ' + xhr.responseJSON.message + '';\n      } catch (e) {\n        if (xhr.status > 0) {\n          return 'HTTP status code: ' + xhr.status + ' ' + xhr.statusText;\n        } else {\n          return 'GitHub could not be reached.\\nYour Internet connection may be offline.';\n        }\n      }\n    }());\n    alert('Could not create new gist.\\n\\n' + message);\n\n    button.disabled = false;\n    button.textContent = oldButtonText;\n  });\n}\n\nfunction showGeneratedGist(container, url) {\n  container.innerHTML =\n    '<input id=\"sharedPermalink\" type=\"url\" class=\"form-control\" readonly>' +\n    '<button type=\"button\" class=\"btn btn-default\" data-clipboard-target=\"#sharedPermalink\">' +\n    '<span class=\"glyphicon glyphicon-copy\" aria-hidden=\"true\"></span>' +\n    '</button>';\n  var urlInput = container.querySelector('input');\n  urlInput.value = url;\n  urlInput.size = url.length + 2;\n  addSelectOnFocus(urlInput);\n  urlInput.focus();\n}\n\nfunction createGenerateGistButton(container) {\n  container.innerHTML =\n  '<button type=\"button\" class=\"btn btn-default\">Create permalink</button>' +\n  '<p class=\"help-block\">This will create and link to a new' +\n    ' <a href=\"https://help.github.com/articles/creating-gists/#creating-an-anonymous-gist\"' +\n    ' target=\"_blank\">read-only</a> GitHub gist.' +\n  '</p>';\n  return container.querySelector('button');\n}\n\n\n///////////////////\n// Download file //\n///////////////////\n\n// Create a link button if canUseDownloadAttribute, otherwise a link with instructions.\nfunction createDownloadLink(filename, contents) {\n  var link = document.createElement('a');\n  link.href = 'data:text/x-yaml;charset=utf-8,' + encodeURIComponent(contents);\n  link.target = '_blank';\n  link.download = filename;\n\n  if (canUseDownloadAttribute) {\n    link.textContent = 'Download document';\n    link.className = 'btn btn-primary';\n    return link;\n  } else {\n    link.textContent = 'Right-click here and choose Save target as or Download Linked File As';\n    var p = document.createElement('p');\n    p.innerHTML = ', <br>then name the file to end with <code>.yaml</code>';\n    p.insertBefore(link, p.firstChild);\n    return p;\n  }\n}\n\n\n////////////\n// Common //\n////////////\n\nfunction init(args) {\n  var $dialog = args.$dialog,\n      getCurrentDocument = args.getCurrentDocument,\n      getIsSynced = args.getIsSynced,\n      gistContainer = args.gistContainer,\n      downloadContainer = args.downloadContainer,\n      textarea = args.textarea;\n\n  if (canUseDownloadAttribute) {\n    $dialog.addClass('download-attr');\n  }\n  if (!canUseCopyCommand) {\n    $dialog.addClass('no-copycommand');\n  }\n  gistContainer.className = 'form-group form-inline';\n  addSelectOnFocus(textarea);\n\n  function setupDialog() {\n    var doc = getCurrentDocument();\n    var filename = doc.name + '.yaml';\n    var contents = format.stringifyDocument(doc);\n    var gistPromise;\n\n    // warn about unsynced changes\n    var $alert;\n    if (!getIsSynced()) {\n      $alert = $(\n        '<div class=\"alert alert-warning\" role=\"alert\">' +\n        'The code editor has <strong>unsynced changes</strong> and might not correspond with the diagram.<br>' +\n        'Click <q>Load machine</q> to try to sync them. Otherwise, two sets of code will be exported.' +\n        '</div>'\n      ).prependTo($dialog.find('.modal-body'));\n    }\n\n    createGenerateGistButton(gistContainer).addEventListener('click', function (e) {\n      gistPromise = generateGist(gistContainer, e.target, filename, contents);\n    });\n\n    // \"Download document\" button link\n    downloadContainer.appendChild(createDownloadLink(filename, contents));\n    // <textarea> for document contents\n    textarea.value = contents;\n\n    var clipboard = new Clipboard('[data-clipboard-target]');\n    clipboard.on('success', function (e) {\n      showCopiedTooltip(e.trigger);\n      e.clearSelection();\n    });\n\n    // return cleanup function\n    return function () {\n      if (gistPromise) {\n        try { gistPromise.cancel(); } catch (e) {/* */}\n      }\n      if ($alert) { $alert.remove(); }\n      gistContainer.textContent = '';\n      downloadContainer.textContent = '';\n      textarea.value = '';\n      clipboard.destroy();\n    };\n  }\n\n  $dialog.on('show.bs.modal', function () {\n    var cleanup = setupDialog();\n    $dialog.one('hidden.bs.modal', cleanup);\n  });\n  $dialog.on('shown.bs.modal', function () {\n    // workaround \"Copy to clipboard\" .focus() scrolling down to <textarea>\n    // note: doesn't work when <textarea> is completely out of view\n    textarea.setSelectionRange(0,0);\n  });\n}\n\nexports.init = init;\n","module.exports = Clipboard;","'use strict';\n/**\n * Displays a table of keyboard shortcuts.\n */\n\nvar d3 = require('d3');\n\nfunction identity(x) { return x; }\n\n/**\n * Renders a table, using three layers of list nesting: tbody, tr, td.\n * @param  {[ [[HTML]] ]}     data\n * @param  {HTMLTableElement} table\n * @return {D3Selection}            D3 selection of the <tbody> elements\n */\nfunction renderTable(data, table) {\n  var tbody = d3.select(table).selectAll('tbody')\n      .data(data)\n    .enter().append('tbody');\n\n  var tr = tbody.selectAll('tr')\n      .data(identity)\n    .enter().append('tr');\n\n  tr.selectAll('td')\n      .data(identity)\n    .enter().append('td')\n      .html(identity);\n\n  return tbody;\n}\n\n\n// type Key = string;\n// type KeyList = [Key];\n\n// Key -> Key\nfunction abbreviateKey(key) {\n  switch (key) {\n    case 'Command': return 'Cmd';\n    case 'Option':  return 'Opt';\n    case 'Up':      return '';\n    case 'Down':    return '';\n    case 'Left':    return '';\n    case 'Right':   return '';\n    default:        return key;\n  }\n}\n\n// KeyList -> HTML\nfunction keylistToHTML(keys) {\n  return keys.map(function (key) {\n    return '<kbd>' + key + '</kbd>';\n  }).join('-');\n}\n\n// Commands -> String -> KeyList\nfunction createGetKeylist(commands) {\n  var platform = commands.platform;\n  // workaround: some ace keybindings for Mac use Alt instead of Option\n  var altToOption = platform !== 'mac' ? identity : function (key) {\n    return (key === 'Alt') ? 'Option' : key;\n  };\n\n  return function getKeylist(name) {\n    return commands.commands[name].bindKey[platform].split('-').map(altToOption);\n  };\n}\n\n\n// Fills a <table> with some default keyboard shortcuts.\nfunction main(commands, table) {\n  var getKeylist = createGetKeylist(commands);\n\n  return renderTable(entries.map(function (group) {\n    return group.map(function (d) {\n      return [\n        keylistToHTML(getKeylist(d.name).map(abbreviateKey)),\n        d.desc\n      ];\n    });\n  }), table);\n}\n\nvar entries = [\n  [\n    { name: 'save', desc: 'Load machine<br> <small>Save changes and load the machine.</small>' }\n  ], [\n    { name: 'togglecomment', desc: 'Toggle comment' },\n    { name: 'indent', desc: 'Indent selection' },\n    { name: 'outdent', desc: 'Unindent selection' }\n  ], [\n    { name: 'movelinesup', desc: 'Move line up' },\n    { name: 'movelinesdown', desc: 'Move line down' },\n    { name: 'duplicateSelection', desc: 'Duplicate line/selection' }\n  ], [\n    { name: 'selectMoreAfter', desc: 'Add next occurrence to selection<br> <small>Like a quick find. Useful for renaming things.</small>' },\n    { name: 'find', desc: 'Find' },\n    { name: 'replace', desc: 'Find and Replace' }\n  ]\n];\n\n\nexports.main = main;\n"],"sourceRoot":""}