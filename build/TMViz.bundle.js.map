{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/external \"d3\"","webpack://[name]/external \"_\"","webpack://[name]/external \"lodash\"","webpack://[name]/./src/util.js","webpack://[name]/./src/TuringMachine.js","webpack://[name]/./src/watch.js","webpack://[name]/./src/TMViz.js","webpack://[name]/./src/tape/TapeViz.js","webpack://[name]/./src/tape/Tape.js","webpack://[name]/./src/tape/tape.css","webpack://[name]/./src/state-diagram/StateGraph.js","webpack://[name]/./src/state-diagram/StateViz.js","webpack://[name]/./src/state-diagram/StateViz.css"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","d3","_","lodash","isBrowserIEorEdge","Boolean","document","documentMode","window","StyleMedia","nonNull","Error","String","coalesce","a","b","applyMaybe","f","x","getFirst","xs","length","val","toDocFragment","array","result","createDocumentFragment","forEach","appendChild","TuringMachine","transition","startState","tapes","this","state","move","tape","direction","headRight","headLeft","TypeError","toString","map","join","step","instruct","nextInstruction","write","symbol","defineProperties","reduce","acc","read","isHalted","watch","thisArg","prop","handler","desc","getOwnPropertyDescriptor","undefined","configurable","writable","set","accessors","newval","watchInit","TapeViz","StateGraph","StateViz","pulseEdge","edge","select","domNode","classed","style","duration","each","addTapes","div","spec","number","push","addTape","append","attr","blank","input","split","TMViz","posTable","graph","table","stateviz","getVertexMap","getEdges","positionTable","edgeAnimation","stepInterval","self","machine","animationCallback","tuple","getInstructionAndEdge","instruction","animatedTransition","isRunning","oldstate","newstate","getVertex","__parentDiv","__spec","reset","remove","Tape","initTapeCells","selection","datum","text","cellWidth","cellHeight","positionCells","offset","repositionWrapper","wrapper","svg","lookaround","width","height","selectAll","data","readRange","enter","moveHead","exit","wOffset","cOffset","constructor","childNodes","readOffset","insert","before","after","slice","reverse","last","pop","isEmpty","start","end","range","deriveGraph","mapValues","transitions","label","allEdges","vertex","stateTransitions","cache","symbolKey","symbols","target","tap","source","labels","edgeTo","action","rightSide","visibleSpace","labelFor","normalize","edges","defaults","derived","__graph","__edges","assign","addV","array1","array2","subtractV","normV","Math","sqrt","y","normSqV","vectorFromLengthAngle","angle","cos","sin","EdgeCounter","e","index","numEdgesFromTo","src","EdgeShape","freeze","loop","arc","straight","edgePathFor","nodeRadius","shape","loopEndOffset","loopArc","PI","p1","p2","radius","atan2","sep","scalar","multiplyV","identity","noop","limitRange","min","max","shapeForEdge","appendSVGTo","hwRatio","position","top","left","container","nodes","linkArray","w","h","colors","scale","category10","nodeArray","Array","values","__stateMap","force","layout","links","size","linkDistance","charge","theta","gravity","drag","on","fixed","edgeCounter","edgegroups","labelAbove","labelBelow","edgeD","edgeIndex","group","edgepath","getPath","refreshLabels","svgrect","getBBox","isFlipped","shouldFlip","edgepaths","nodeSelection","nodecircles","resume","nodelabels","lastIndexOf","svgCSS","styleSheet","cssText","textContent","cx","cy","every","stop","getPositionTable","pick","stateMap","node","setPositionTable"],"mappings":"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","file":"TMViz.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/build/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 24);\n","module.exports = d3;","module.exports = _;","module.exports = lodash;","'use strict';\n// misc. utilities\n\n//////////////////////////////////\n// Utilities for null/undefined //\n//////////////////////////////////\n\n// Assert non-null.\n// Return the value if it is not null or undefined; otherwise, throw an error.\nfunction nonNull(value) {\n  if (value == null) {\n    throw new Error('expected a non-null defined value, but got: ' + String(value));\n  }\n  return value;\n}\n\n// Null coalescing: iff the first argument is null or undefined, return the second.\nfunction coalesce(a, b) {\n  return (a != null) ? a : b;\n}\n\n// Apply a function to a value if non-null, otherwise return the value.\n// (Monadic bind for maybe (option) type.)\n// ((a -> b), ?a) -> ?b\nfunction applyMaybe(f, x) {\n  return (x != null) ? f(x) : x;\n}\n\n// Returns the first function result that is not null or undefined.\n// Otherwise, returns undefined.\n// ((a -> ?b), [a]) -> ?b\nfunction getFirst(f, xs) {\n  for (var i = 0; i < xs.length; ++i) {\n    var val = f(xs[i]);\n    if (val != null) {\n      return val;\n    }\n  }\n}\n\n/////////\n// DOM //\n/////////\n\n/* global document */\n\n/**\n * Concat an array of DOM Nodes into a DocumentFragment.\n * @param  {[Node]} array\n * @return {DocumentFragment}\n */\nfunction toDocFragment(array) {\n  var result = document.createDocumentFragment();\n  array.forEach(result.appendChild.bind(result));\n  return result;\n}\n\n///////////////////////\n// IE/Edge detection //\n///////////////////////\n\n// http://stackoverflow.com/a/9851769\nvar isBrowserIEorEdge = /*@cc_on!@*/false\n  || Boolean(document.documentMode) || Boolean(window.StyleMedia); // eslint-disable-line\n\n\nexports.nonNull = nonNull;\nexports.coalesce = coalesce;\nexports.applyMaybe = applyMaybe;\nexports.getFirst = getFirst;\n\nexports.toDocFragment = toDocFragment;\n\nexports.isBrowserIEorEdge = isBrowserIEorEdge;\n","'use strict'\n\n/**\n * Construct a Turing machine.\n * @param {(state, symbol) -> ?{state: state, symbol: symbol, move: direction}} transition\n *   A transition function that, given *only* the current state and symbol,\n *   returns an object with the following properties: symbol, move, and state.\n *   Returning null/undefined halts the machine (no transition defined).\n * @param {state} startState  The state to start in.\n * @param         tapes        The tape to use.\n */\nfunction TuringMachine(transition, startState, tapes) {\n    this.transition = transition\n    this.state = startState\n    this.tapes = tapes\n}\n\nTuringMachine.prototype.toString = function () {\n    return String(this.state) + '\\n' + this.tapes.map(String).join('\\n')\n}\n\n/**\n * Step to the next configuration according to the transition function.\n * @return {boolean} true if successful (the transition is defined),\n *   false otherwise (machine halted)\n */\nTuringMachine.prototype.step = function () {\n    let instruct = this.nextInstruction\n    if (instruct == null) {\n        return false\n    }\n    for (let i = 0; i < this.tapes.length; i++) {\n        this.tapes[i].write(instruct.symbol[i])\n        move(this.tapes[i], instruct.move[i])\n    }\n    this.state = instruct.state\n\n    return true\n}\n\nObject.defineProperties(TuringMachine.prototype, {\n    nextInstruction: {\n        get: function () {\n            return this.transition(this.state,\n                this.tapes.reduce((acc, tape) => acc + tape.read(), ''))\n        },\n        enumerable: true,\n    },\n    isHalted: {\n        get: function () {\n            return this.nextInstruction == null\n        },\n        enumerable: true,\n    },\n})\n\n// Allows for both notational conventions of moving the head or moving the tape\nfunction move(tape, direction) {\n    switch (direction) {\n        case 'R':\n            tape.headRight()\n            break\n        case 'L':\n            tape.headLeft()\n            break\n        case 'H':\n            break\n        default:\n            throw new TypeError('not a valid tape movement: ' + String(direction))\n    }\n}\n\nexports.TuringMachine = TuringMachine\n","'use strict';\n/**\n * Lightweight property assignment watching by overriding getters/setters.\n * Intended as a bridge between plain JS properties and other libraries.\n *\n * Inspired by https://gist.github.com/eligrey/384583, which works for\n * data properties only, this works for both data and accessor properties.\n *\n * 2015-11-21\n * @author Andy Li\n */\n\n/**\n * Watches a property for assignment by overriding it with a getter & setter\n * on top of the previous value or accessors.\n *\n * The handler can intercept assignments by returning a different value.\n * Watching an unwritable/unsettable property does nothing, but trying to watch\n * a non-existent or non-configurable property fails fast with TypeError.\n * @param  {!Object} thisArg The object that contains the property.\n * @param  {String}  prop    The name of the property to watch.\n * @param            handler The function to call when the property is\n *   assigned to. Important: this function intercepts assignment;\n *   its return value is set as the new value.\n * @throws {TypeError} if object is null or does not have the property\n * @throws {TypeError} if thisArg.prop is non-configurable\n * @return {?Object}         The previous property descriptor, or null if the\n *   property is not writable/settable.\n */\nfunction watch(thisArg, prop, handler) {\n  var desc = Object.getOwnPropertyDescriptor(thisArg, prop);\n  // check pre-conditions: existent, configurable, writable/settable\n  if (desc === undefined) {\n    throw new TypeError('Cannot watch nonexistent property \\''+prop+'\\'');\n  } else if (!desc.configurable) {\n    throw new TypeError('Cannot watch non-configurable property \\''+prop+'\\'');\n  } else if (!desc.writable && desc.set === undefined) {\n    return; // no-op since property can't change without reconfiguration\n  }\n\n  var accessors = (function () {\n    if (desc.set) {\n      // case: .get/.set\n      return {\n        get: desc.get,\n        set: function (newval) {\n          return desc.set.call(thisArg, handler.call(thisArg, prop, thisArg[prop], newval));\n        }\n      };\n    } else {\n      // case: .value\n      var val = desc.value;\n      return {\n        get: function () {\n          return val;\n        },\n        set: function (newval) {\n          return val = handler.call(thisArg, prop, val, newval);\n        }\n      };\n    }\n  })();\n  Object.defineProperty(thisArg, prop, accessors);\n\n  return desc;\n}\n\n/**\n * {@link watch} that, if successful, also calls the handler once with\n *   the current value (by setting it).\n * @see watch\n */\nfunction watchInit(thisArg, prop, handler) {\n  var value = thisArg[prop];\n  var desc = watch(thisArg, prop, handler);\n  if (desc) { thisArg[prop] = value; }\n  return desc;\n}\n\nif (typeof exports === 'object') {\n  exports.watch = watch;\n  exports.watchInit = watchInit;\n}\n","'use strict'\n/**\n * Turing machine visualization component.\n *\n * â€¢ Adds running and reset on top of the base Turing machine.\n * â€¢ Displays an animated state diagram and tape diagram.\n * Does not include UI elements for controlling the machine.\n *\n * @module\n */\n\nconst TuringMachine = require('./TuringMachine').TuringMachine\nconst TapeViz = require('./tape/TapeViz')\nconst StateGraph = require('./state-diagram/StateGraph')\nconst StateViz = require('./state-diagram/StateViz')\nconst watchInit = require('./watch').watchInit\nconst d3 = require('d3')\n\n/**\n * Create an animated transition function.\n * @param  {StateGraph} graph\n * @param  {LayoutEdge -> any} animationCallback\n * @return {(string, string) -> Instruction} Created transition function.\n */\nfunction animatedTransition(graph, animationCallback) {\n    return function (state, symbol) {\n        let tuple = graph.getInstructionAndEdge(state, symbol)\n        if (tuple == null) {\n            return null\n        }\n\n        animationCallback(tuple.edge)\n        return tuple.instruction\n    }\n}\n\n/**\n * Default edge animation callback.\n * @param  {{domNode: Node}} edge\n * @return {D3Transition} The animation. Use this for transition chaining.\n */\nfunction pulseEdge(edge) {\n    var edgepath = d3.select(edge.domNode)\n    return edgepath\n        .classed('active-edge', true)\n        .transition()\n        .style('stroke-width', '3px')\n        .transition()\n        .style('stroke-width', '1px')\n        .transition()\n        .duration(0)\n        .each('start', /* @this edge */ function () {\n            d3.select(this).classed('active-edge', false)\n        })\n        .style('stroke', null)\n        .style('stroke-width', null)\n}\n\nfunction addTapes(div, spec) {\n    let number = spec.tapes === 0 ? 1 : spec.tapes\n    let tapes = []\n    for (let i = 0; i < number; i++) {\n        tapes.push(addTape(div, spec, i))\n    }\n    return tapes\n}\n\nfunction addTape(div, spec, i) {\n    return new TapeViz(div.append('svg').attr('class', 'tm-tape'), 9,\n        spec.blank, spec.input && spec.input[i] ? String(spec.input[i]).split('') : [],\n    )\n}\n\n/**\n * Construct a new state and tape visualization inside a &lt;div&gt;.\n * @constructor\n * @param {HTMLDivElement} div        div to take over and use.\n * @param                  spec       machine specification\n * @param {PositionTable} [posTable]  position table for the state nodes\n */\nfunction TMViz(div, spec, posTable) {\n    div = d3.select(div)\n    let graph = new StateGraph(spec.table)\n    this.stateviz = new StateViz(\n        div,\n        graph.getVertexMap(),\n        graph.getEdges(),\n    )\n    if (posTable !== undefined) {\n        this.positionTable = posTable\n    }\n\n    this.edgeAnimation = pulseEdge\n    this.stepInterval = 100\n\n    const self = this\n\n    // We hook into the animation callback to know when to start the next step (when running).\n    function animateAndContinue(edge) {\n        let transition = self.edgeAnimation(edge)\n        if (self.isRunning) {\n            transition.transition().duration(self.stepInterval).each('end', function () {\n                // stop if machine was paused during the animation\n                if (self.isRunning) {\n                    self.step()\n                }\n            })\n        }\n    }\n\n    this.machine = new TuringMachine(\n        animatedTransition(graph, animateAndContinue),\n        spec.startState,\n        addTapes(div, spec),\n    )\n    // intercept and animate when the state is set\n    watchInit(this.machine, 'state', function (prop, oldstate, newstate) {\n        d3.select(graph.getVertex(oldstate).domNode).classed('current-state', false)\n        d3.select(graph.getVertex(newstate).domNode).classed('current-state', true)\n        return newstate\n    })\n\n    // Sidenote: each \"Step\" click evaluates the transition function once.\n    // Therefore, detecting halting always requires its own step (for consistency).\n    this.isHalted = false\n\n    let isRunning = false\n    /**\n     * Set isRunning to true to run the machine, and false to stop it.\n     */\n    Object.defineProperty(this, 'isRunning', {\n        configurable: true,\n        get: function () {\n            return isRunning\n        },\n        set: function (value) {\n            if (isRunning !== value) {\n                isRunning = value\n                if (isRunning) {\n                    this.step()\n                }\n            }\n        },\n    })\n\n    this.__parentDiv = div\n    this.__spec = spec\n}\n\n/**\n * Step the machine immediately and interrupt any animations.\n */\nTMViz.prototype.step = function () {\n    if (!this.machine.step()) {\n        this.isRunning = false\n        this.isHalted = true\n    }\n}\n\n/**\n * Reset the Turing machine to its starting configuration.\n */\nTMViz.prototype.reset = function () {\n    this.isRunning = false\n    this.isHalted = false\n    this.machine.state = this.__spec.startState\n    for (const tape of this.machine.tapes) {\n        tape.domNode.remove()\n    }\n    this.machine.tapes = addTapes(this.__parentDiv, this.__spec)\n}\n\nObject.defineProperty(TMViz.prototype, 'positionTable', {\n    get: function () {\n        return this.stateviz.positionTable\n    },\n    set: function (posTable) {\n        this.stateviz.positionTable = posTable\n    },\n})\n\nmodule.exports = TMViz\n","'use strict';\nvar Tape = require('./Tape.js'),\n    d3   = require('d3');\nrequire('./tape.css');\n\nvar cellWidth = 50;\nvar cellHeight = 50;\n\nfunction initTapeCells(selection) {\n  selection.attr('class', 'tape-cell');\n  selection.append('rect')\n      // the box outline is purely visual, so remove its data binding\n      .datum(null)\n      .attr({'width': cellWidth,\n             'height': cellHeight});\n  selection.append('text')\n      .text(function (d) { return d; })\n      .attr({'x': cellWidth/2, 'y': cellHeight/2 + 8});\n  return selection;\n}\n\nfunction positionCells(selection, offset) {\n  offset = (offset == null) ? 0 : offset;\n  selection.attr('transform', function (d, i) {\n    return 'translate(' + (-cellWidth+10 + cellWidth*(i+offset)) + ')';\n  });\n  return selection;\n}\n\nfunction repositionWrapper(wrapper) {\n  wrapper.attr('transform', 'translate(0 10)')\n    .transition()\n      .duration(0)\n    .select('.exiting')\n      .remove();\n}\n\n// Tape visualization centered around the tape head.\nfunction TapeViz(svg, lookaround, blank, input) {\n  Tape.call(this, blank, input);\n\n  Object.defineProperty(this, 'lookaround', {\n    value: lookaround,\n    writable: false,\n    enumerable: true\n  });\n  Object.defineProperty(this, 'domNode', {\n    value: svg,\n    writable: false,\n    enumerable: true\n  });\n\n  // width is before + head + after, trimming 2 off to show cut-off tape ends\n  var width  = cellWidth * (lookaround+1+lookaround-2) + 2*10;\n  var height = cellHeight + 2*10;\n  svg.attr({\n    'width': '95%',\n    'viewBox': [0, 0, width, height].join(' ')\n  });\n\n  this.wrapper = svg.append('g')\n      .attr('class', 'wrapper')\n      .call(repositionWrapper);\n\n  svg.append('rect')\n      .attr({'id': 'tape-head',\n             'width': (1+1/5) * cellWidth,\n             'height': (1+1/5) * cellHeight,\n             'x': -cellWidth+10/2 + cellWidth*lookaround,\n             'y': 10/2\n           });\n\n  this.wrapper.selectAll('.tape-cell')\n      .data(this.readRange(-lookaround, lookaround))\n    .enter()\n    .append('g')\n      .call(initTapeCells)\n      .call(positionCells)\n  ;\n}\n\nTapeViz.prototype = Object.create(Tape.prototype);\nTapeViz.prototype.constructor = TapeViz;\n\n// IDEA: chain headLeft/Right to wait for write()?\nTapeViz.prototype.write = function (symbol) {\n  // don't animate if symbol stays the same\n  if (Tape.prototype.read.call(this) === symbol) {\n    return;\n  }\n  Tape.prototype.write.call(this, symbol);\n\n  // remove leftover .exiting in case animation was interrupted\n  this.wrapper.selectAll('.exiting').remove();\n\n  d3.select(this.wrapper[0][0].childNodes[this.lookaround])\n      .datum(symbol)\n    .select('text')\n      .attr('fill-opacity', '1')\n      .attr('stroke-opacity', '1')\n    .transition()\n      .attr('fill-opacity', '0.4')\n      .attr('stroke-opacity', '0.1')\n    .transition()\n      .text(function (d) { return d; })\n      .attr('fill-opacity', '1')\n      .attr('stroke-opacity', '1')\n    .transition()\n      .duration(0)\n      .attr('fill-opacity', null)\n      .attr('stroke-opacity', null)\n    ;\n};\n\nfunction moveHead(wrapper, enter, exit, wOffset, cOffset) {\n  // add to one end\n  enter.call(initTapeCells);\n  // remove from the other end\n  exit.classed('exiting', true);\n  // translate cells forward, and the wrapper backwards\n  wrapper.selectAll('.tape-cell')\n      .call(positionCells, cOffset);\n  wrapper\n      .attr('transform', 'translate(' + (wOffset*cellWidth).toString() + ' 10)')\n    // animate wrapper returning to neutral position\n    .transition()\n      .call(repositionWrapper);\n}\n\nTapeViz.prototype.headRight = function () {\n  Tape.prototype.headRight.call(this);\n  // remove leftover .exiting in case animation was interrupted.\n  // Important: call-by-value evaluates the selection argument(s) of 'moveHead' before\n  // before entering the function, so exiting nodes have to be removed beforehand.\n  this.wrapper.selectAll('.exiting').remove();\n  moveHead(this.wrapper,\n    // add to right end\n    this.wrapper.append('g')\n        .datum(this.readOffset(this.lookaround)),\n    // remove from left end\n    this.wrapper.select('.tape-cell'),\n    1, -1);\n};\n\nTapeViz.prototype.headLeft = function () {\n  Tape.prototype.headLeft.call(this);\n  this.wrapper.selectAll('.exiting').remove();\n  moveHead(this.wrapper,\n    this.wrapper.insert('g', ':first-child')\n        .datum(this.readOffset(-this.lookaround)),\n    this.wrapper.select('.wrapper > .tape-cell:last-of-type'),\n    -1, 0);\n};\n\nmodule.exports = TapeViz;\n","'use strict'\nvar _ = require('lodash/fp')\n\n// Bidirectional infinite tape\nfunction Tape(blank, input) {\n    Object.defineProperty(this, 'blank', {\n        value: blank,\n        writable: false,\n        enumerable: true,\n    })\n    // zipper data structure\n    // INVARIANTS: tape.before can be empty, tape.after must be nonempty.\n    // before: cells before the head (in order; left to right).\n    // after:  cells after and including the head (in reverse; right to left).\n    this.tape = {\n        before: [],\n        after: (input == null || input.length == 0) ? [blank] : input.slice().reverse(),\n        toString: function () {\n            return this.before.join('') + 'ðŸ”Ž' + this.after.slice().reverse().join('')\n        },\n    }\n}\n\n// Read the value at the tape head.\nTape.prototype.read = function () {\n    return _.last(this.tape.after)\n}\nTape.prototype.write = function (symbol) {\n    this.tape.after[this.tape.after.length - 1] = symbol\n}\n\nTape.prototype.headRight = function () {\n    var before = this.tape.before,\n        after = this.tape.after\n    before.push(after.pop())\n    if (_.isEmpty(after)) {\n        after.push(this.blank)\n    }\n}\nTape.prototype.headLeft = function () {\n    var before = this.tape.before,\n        after = this.tape.after\n    if (_.isEmpty(before)) {\n        before.push(this.blank)\n    }\n    after.push(before.pop())\n}\n\nTape.prototype.toString = function () {\n    return this.tape.toString()\n}\n\n// for tape visualization. not part of TM definition.\n// Read the value at an offset from the tape head.\n// 0 is the tape head. + is to the right, - to the left.\nTape.prototype.readOffset = function (i) {\n    var tape = this.tape\n    if (i >= 0) {\n        // right side: offset [0..length-1] â†¦ array index [length-1..0]\n        return (i <= tape.after.length - 1) ? tape.after[tape.after.length - 1 - i] : this.blank\n    } else {\n        // left side: offset [-1..-length] â†¦ array index [length-1..0]\n        return (i >= -tape.before.length) ? tape.before[tape.before.length + i] : this.blank\n    }\n}\n\n// for tape visualization.\n// Read the values from an offset range (inclusive of start and end).\nTape.prototype.readRange = function (start, end) {\n    return _.range(start, end + 1).map(function (i) {\n        return this.readOffset(i)\n    }, this)\n}\n\nmodule.exports = Tape\n","module.exports = __webpack_public_path__ + \"tape/tape.css\";","'use strict'\n\nvar _ = require('lodash')\n\n\n/* Interface\n  type TransitionTable = {\n    [state: string]: ?{\n      [symbol: string]: Instruction\n    }\n  };\n  type Instruction = { state?: string, symbol?: string };\n\n  type DiagramGraph = {\n    [state: string]: {\n      label: string,\n      transitions: ?{\n        [symbol: string]: {\n          instruction: Instruction,\n          edge: LayoutEdge\n        }\n      }\n    }\n  };\n  type LayoutEdge = { source: Object, target: Object, labels: [string] }\n */\n\n/**\n * Use a transition table to derive the graph (vertices & edges) for a D3 diagram.\n * Edges with the same source and target are combined.\n * NB. In addition to single symbols, comma-separated symbols are supported.\n * e.g. symbol string '0,1,,,I' -> symbols [0,1,',','I'].\n */\n// TransitionTable -> DiagramGraph\nfunction deriveGraph(table) {\n    // We need two passes, since edges may point at vertices yet to be created.\n    // 1. Create all the vertices.\n    var graph = _.mapValues(table, function (transitions, state) {\n        return {\n            label: state,\n            transitions: transitions,\n        }\n    })\n    // 2. Create the edges, which can now point at any vertex object.\n    var allEdges = []\n    _.forEach(graph, function (vertex, state) {\n\n        vertex.transitions = vertex.transitions && (function () {\n            let stateTransitions = {}\n\n            // Combine edges with the same source and target\n            let cache = {}\n\n            function edgeTo(target, label) {\n                let edge = cache[target] ||\n                    _.tap(cache[target] = { // WHAT THE FUCK?\n                        source: vertex,\n                        target: graph[target],\n                        labels: [],\n                    }, allEdges.push.bind(allEdges))\n                edge.labels.push(label)\n                return edge\n            }\n\n            // Create symbol -> instruction object map\n            _.forEach(vertex.transitions, function (instruct, symbolKey) {\n                // Handle comma-separated symbols.\n                // Recreate array by splitting on ','. Treat 2 consecutive ',' as , ','.\n                let symbols = symbolKey.split(',').reduce(function (acc, x) {\n                    if (x === '' && acc[acc.length - 1] === '') {\n                        acc[acc.length - 1] = ','\n                    } else {\n                        acc.push(x)\n                    }\n                    return acc\n                }, [])\n                let target = instruct.state != null ? instruct.state : state\n                let edge = edgeTo(target, labelFor(symbols, instruct))\n\n                symbols.forEach(function (symbol) {\n                    stateTransitions[symbol] = {\n                        // Normalize for execution, but display the less-cluttered original.\n                        instruction: normalize(state, symbol, instruct),\n                        edge: edge,\n                    }\n                })\n            })\n\n            return stateTransitions\n        }())\n\n    })\n\n    return {graph: graph, edges: allEdges}\n}\n\n// Normalize an instruction to include an explicit state and symbol.\n// e.g. {symbol: '1'} normalizes to {state: 'q0', symbol: '1'} when in state q0.\nfunction normalize(state, symbol, instruction) {\n    symbol = symbol.split('')\n    if (instruction.symbol) {\n        for (let i = 0; i < symbol.length; i++) {\n            if (instruction.symbol[i])\n                symbol[i] = instruction.symbol[i]\n        }\n    }\n    return _.defaults({symbol: symbol.join('')}, instruction, {state: state})\n}\n\nfunction labelFor(symbols, action) {\n    var rightSide = ((action.symbol == null) ? '' : (visibleSpace(String(action.symbol)) + ','))\n        + String(action.move)\n    return symbols.map(visibleSpace).join(',') + 'â†’' + rightSide\n}\n\n// replace ' ' with 'â£'.\nfunction visibleSpace(c) {\n    return (c === ' ') ? 'â£' : c\n}\n\n\n/**\n * Aids rendering and animating a transition table in D3.\n *\n * â€¢ Generates the vertices and edges (\"nodes\" and \"links\") for a D3 diagram.\n * â€¢ Provides mapping of each state to its vertex and each transition to its edge.\n * @param {TransitionTable} table\n */\nfunction StateGraph(table) {\n    var derived = deriveGraph(table)\n    Object.defineProperties(this, {\n        __graph: {value: derived.graph},\n        __edges: {value: derived.edges},\n    })\n}\n\n/**\n * D3 layout \"nodes\".\n */\n// StateGraph.prototype.getVertices = function () {\n//   return _.values(this.__graph);\n// };\n\n/**\n * Returns the mapping from states to vertices (D3 layout \"nodes\").\n * @return { {[state: string]: Object} }\n */\nStateGraph.prototype.getVertexMap = function () {\n    return this.__graph\n}\n\n/**\n * D3 layout \"links\".\n */\nStateGraph.prototype.getEdges = function () {\n    return this.__edges\n}\n\n/**\n * Look up a state's corresponding D3 \"node\".\n */\nStateGraph.prototype.getVertex = function (state) {\n    return this.__graph[state]\n}\n\nStateGraph.prototype.getInstructionAndEdge = function (state, symbol) {\n    var vertex = this.__graph[state]\n    if (vertex === undefined) {\n        throw new Error('not a valid state: ' + String(state))\n    }\n\n    return vertex.transitions && vertex.transitions[symbol]\n}\n\n\nmodule.exports = StateGraph\n","'use strict';\n\nvar isBrowserIEorEdge = require('../util').isBrowserIEorEdge;\nvar d3 = require('d3');\nvar _ = require('lodash/fp');\nvar assign = require('lodash').assign; // need mutable assign()\n\n// *** Arrays as vectors ***\n\n// Add vectors.\n// Note: dimensions are not checked. Missing dimensions become NaN.\nfunction addV(array1, array2) {\n  return array1.map(function (x, i) { return x + array2[i]; });\n}\n\nfunction negateV(array) {\n  return array.map(function (x) { return -x; });\n}\n\nfunction subtractV(array1, array2) {\n  return addV(array1, negateV(array2));\n}\n\n// Scale the vector by a scalar.\nfunction multiplyV(array, scalar) {\n  return array.map(function (x) { return scalar*x; });\n}\n\n// Vector norm, squared\nfunction normSqV(array) {\n  function sq(x) { return x*x; }\n  function add(x, y) { return x + y; }\n  return array.map(sq).reduce(add, 0);\n}\n\n// Vector norm\nfunction normV(array) { return Math.sqrt(normSqV(array)); }\n\n// Return a copy of the vector rescaled as a unit vector (norm = 1).\nfunction unitV(array) {\n  var n = normV(array);\n  return array.map(function (x) { return x / n; });\n}\n\n// *** 2D Vectors ***\nfunction angleV(array) {\n  var x = array[0], y = array[1];\n  return Math.atan2(y, x);\n}\n\nfunction vectorFromLengthAngle(length, angle) {\n  return [Math.cos(angle) * length, Math.sin(angle) * length];\n}\n\n// *** Utilities ***\n\n// Count the directed edges that start at a given node and end at another.\n// Important: each node must have a unique .index property.\n// Example usage:\n// var counts = new EdgeCounter(edges);\n// var edgesFrom2To5 = counts.numEdgesFromTo(2,5);\n// var edgesFrom5to2 = counts.numEdgesFromTo(5,2);\nfunction EdgeCounter(edges) {\n  edges.forEach(function (e) {\n    var key = e.source.index +','+ e.target.index;\n    this[key] = (this[key] || 0) + 1;\n  }, this);\n}\n\nEdgeCounter.prototype.numEdgesFromTo = function (src, target) {\n  return this[String(src)+','+String(target)] || 0;\n};\n\nvar EdgeShape = Object.freeze({\n  loop: {},     // self-loop: a->a\n  arc: {},      // curved arc: a->b when b->a exists\n  straight: {}  // straight edge: a->b when b->a does not exist\n});\n\nEdgeCounter.prototype.shapeForEdge = function (e) {\n  if (e.target.index === e.source.index) {\n    return EdgeShape.loop;\n  } else if (this.numEdgesFromTo(e.target.index, e.source.index)) {\n    // has returning edge => arc\n    return EdgeShape.arc;\n  } else {\n    return EdgeShape.straight;\n  }\n};\n\n// create a function that will compute an edge's SVG 'd' attribute.\nfunction edgePathFor(nodeRadius, shape, d) {\n  // case: self-loop\n  var loopEndOffset, loopArc;\n  if (shape === EdgeShape.loop) {\n    // start at the top (90Â°), end slightly above the right (15Â°)\n    loopEndOffset = vectorFromLengthAngle(nodeRadius, -15 * Math.PI/180);\n    loopArc = ' a 19,27 45 1,1 ' + loopEndOffset[0] + ',' + (loopEndOffset[1]+nodeRadius);\n    return function () {\n      var x1 = d.source.x,\n          y1 = d.source.y;\n      return 'M ' + x1 + ',' + (y1-nodeRadius) + loopArc;\n    };\n  }\n  // case: between nodes\n  if (shape === EdgeShape.arc) {\n    // sub-case: arc\n    return function () {\n      // note: p1 & p2 have to be delayed, to access x/y at the time of the call\n      var p1 = [d.source.x, d.source.y];\n      var p2 = [d.target.x, d.target.y];\n      var offset = subtractV(p2, p1);\n      var radius = 6/5*normV(offset);\n      // Note: SVG's y-axis is flipped, so vector angles are negative\n      // relative to standard coordinates (as used in Math.atan2).\n      // Proof: angle(r <cos Ï´, -sin Ï´>) = angle(r <cos -Ï´, sin -Ï´>) = -Ï´.\n      var angle = angleV(offset);\n      var sep = -Math.PI/2/2; // 90Â° separation, half on each side\n      var source = addV(p1, vectorFromLengthAngle(nodeRadius, angle+sep));\n      var target = addV(p2, vectorFromLengthAngle(nodeRadius, angle+Math.PI-sep));\n      // IDEA: consider http://www.w3.org/TR/SVG/paths.html#PathDataCubicBezierCommands\n      return (p1[0] <= p2[0])\n        ? 'M '+source[0]+' '+source[1]+' A '+radius+' '+radius+' 0 0,1 '+target[0]+' '+target[1]\n        : 'M '+target[0]+' '+target[1]+' A '+radius+' '+radius+' 0 0,0 '+source[0]+' '+source[1];\n    };\n  } else if (shape === EdgeShape.straight) {\n    return function () {\n      // sub-case: straight line\n      var p1 = [d.source.x, d.source.y];\n      var p2 = [d.target.x, d.target.y];\n      var offset = subtractV(p2, p1);\n      // avoid spurious errors when bounding causes node centers to coincide\n      if (offset[0] === 0 && offset[1] === 0) { return null; }\n\n      var target = subtractV(p2, multiplyV(unitV(offset), nodeRadius));\n      return 'M '+p1[0]+' '+p1[1]+' L '+ target[0] +' '+ target[1];\n    };\n  }\n}\n\nfunction rectCenter(svgrect) {\n  return {x: svgrect.x + svgrect.width/2,\n          y: svgrect.y + svgrect.height/2};\n}\n\nfunction identity(x) { return x; }\nfunction noop() {}\n\nfunction limitRange(min, max, value) {\n  return Math.max(min, Math.min(value, max));\n}\n\n// IE padding hack so that SVG resizes properly.\n// This works across browsers but we only need it for IE.\nvar appendSVGTo = !isBrowserIEorEdge\n  ? function (div) { return div.append('svg'); }\n  : function (div, hwRatio) {\n    return div\n      .append('div')\n        .style({\n          width: '100%',\n          height: '0',\n          'padding-bottom': (100 * hwRatio) + '%',\n          position: 'relative'\n        })\n      .append('svg')\n        .style({\n          position: 'absolute',\n          top: '0',\n          left: '0'\n        });\n  };\n\n// *** D3 diagram ***\nrequire('./StateViz.css');\n\n// type LayoutNode = {label: string};\n// type StateMap = {[state: string]: LayoutNode};\n\n/**\n * Create a state diagram inside an SVG.\n * Each vertex/edge (node/link) object is also annotated with @.domNode@\n * corresponding to its SVG element.\n *\n * Note: currently, element IDs (e.g. for textPath) will collide if multiple\n * diagrams are on the same document (HTML page).\n * @param  {D3Selection}      container     Container to add the SVG to.\n * @param  {[LayoutNode] | StateMap} nodes  Parameter to D3's force.nodes.\n *   Important: passing a StateMap is recommended when using setPositionTable.\n *   Passing an array will key the state nodes by array index.\n * @param  {[LayoutEdge]}     linkArray     Parameter to D3's force.links.\n */\nfunction StateViz(container, nodes, linkArray) {\n  /* References:\n    [Sticky Force Layout](http://bl.ocks.org/mbostock/3750558) demonstrates\n    drag to position and double-click to release.\n\n    [Graph with labeled edges](http://bl.ocks.org/jhb/5955887) demonstrates\n    arrow edges with auto-rotated labels.\n  */\n\n  /* eslint-disable no-invalid-this */ // eslint is not familiar with D3\n  var w = 800;\n  var h = 500;\n  var linkDistance = 140;\n  var nodeRadius = 20;\n\n  var colors = d3.scale.category10();\n\n  var svg = appendSVGTo(container, h/w);\n  svg.attr({\n    'viewBox': [0, 0, w, h].join(' '),\n    'version': '1.1',\n    ':xmlns': 'http://www.w3.org/2000/svg',\n    ':xmlns:xlink': 'http://www.w3.org/1999/xlink'\n  });\n\n  // Force Layout\n\n  // drag event handlers\n  function dragstart(d) {\n    d.fixed = true;\n    svg.transition()\n      .style('box-shadow', 'inset 0 0 1px gold');\n  }\n  function dragend() {\n    svg.transition()\n      .style('box-shadow', null);\n  }\n  function releasenode(d) {\n    d.fixed = false;\n    force.resume();\n  }\n\n  // set up force layout\n  var nodeArray = nodes instanceof Array ? nodes : _.values(nodes);\n  this.__stateMap = nodes;\n\n  var force = d3.layout.force()\n      .nodes(nodeArray)\n      .links(linkArray)\n      .size([w,h])\n      .linkDistance([linkDistance])\n      .charge([-500])\n      .theta(0.1)\n      .gravity(0.05)\n      .start();\n\n  var drag = force.drag()\n      .on('dragstart', dragstart)\n      .on('dragend', dragend);\n\n  // Edges\n  var edgeCounter = new EdgeCounter(linkArray);\n\n  var edgeselection = svg.selectAll('.edgepath')\n    .data(linkArray)\n    .enter();\n\n  var edgegroups = edgeselection.append('g');\n\n  var labelAbove = function (d, i) { return String(-1.1*(i+1)) + 'em'; };\n  var labelBelow = function (d, i) { return String(0.6+ 1.1*(i+1)) + 'em'; };\n\n  edgegroups.each(function (edgeD, edgeIndex) {\n    var group = d3.select(this);\n    var edgepath = group\n      .append('path')\n        .attr({'class': 'edgepath',\n               'id': 'edgepath'+edgeIndex })\n        .each(function (d) { d.domNode = this; });\n\n    var labels = group.selectAll('.edgelabel')\n      .data(edgeD.labels).enter()\n      .append('text')\n        .attr('class', 'edgelabel');\n    labels.append('textPath')\n        .attr('xlink:href', function () { return '#edgepath'+edgeIndex; })\n        .attr('startOffset', '50%')\n        .text(identity);\n    /* To reduce JS computation, label positioning varies by edge shape:\n        * Straight edges can use a fixed 'dy' value.\n        * Loops cannot use 'dy' since it increases letter spacing\n          as labels get farther from the path. Instead, since a loop's shape\n          is fixed, it allows a fixed translate 'transform'.\n        * Arcs are bent and their shape is not fixed, so neither 'dy'\n          nor 'transform' can be constant.\n          Fortunately the curvature is slight enough that a fixed 'dy'\n          looks good enough without resorting to dynamic translations.\n    */\n    var shape = edgeCounter.shapeForEdge(edgeD);\n    edgeD.getPath = edgePathFor(nodeRadius, shape, edgeD);\n    switch (shape) {\n      case EdgeShape.straight:\n        labels.attr('dy', labelAbove);\n        edgeD.refreshLabels = function () {\n          // flip edge labels that are upside-down\n          labels.attr('transform', function () {\n            if (edgeD.target.x < edgeD.source.x) {\n              var c = rectCenter(this.getBBox());\n              return 'rotate(180 '+c.x+' '+c.y+')';\n            } else {\n              return null;\n            }\n          });\n        };\n        break;\n      case EdgeShape.arc:\n        var isFlipped;\n        edgeD.refreshLabels = function () {\n          var shouldFlip = edgeD.target.x < edgeD.source.x;\n          if (shouldFlip !== isFlipped) {\n            edgepath.classed('reversed-arc', shouldFlip);\n            labels.attr('dy', shouldFlip ? labelBelow : labelAbove);\n            isFlipped = shouldFlip;\n          }\n        };\n        break;\n      case EdgeShape.loop:\n        labels.attr('transform', function (d, i) {\n          return 'translate(' + String(8*(i+1)) + ' ' + String(-8*(i+1)) + ')';\n        });\n        edgeD.refreshLabels = noop;\n        break;\n    }\n  });\n  var edgepaths = edgegroups.selectAll('.edgepath');\n\n  // Nodes\n  // note: nodes are added after edges so as to paint over excess edge lines\n  var nodeSelection = svg.selectAll('.node')\n    .data(nodeArray)\n    .enter();\n\n  var nodecircles = nodeSelection\n    .append('circle')\n      .attr('class', 'node')\n      .attr('r', nodeRadius)\n      .style('fill', function (d,i) { return colors(i); })\n      .each(function (d) { d.domNode = this; })\n      .on('dblclick', releasenode)\n      .call(drag);\n\n  var nodelabels = nodeSelection\n   .append('text')\n     .attr('class', 'nodelabel')\n     .attr('dy', '0.25em') /* dy doesn't work in CSS */\n     .text(function (d) { return d.label; });\n\n  // Arrowheads\n  var svgdefs = svg.append('defs');\n  svgdefs.selectAll('marker')\n      .data(['arrowhead', 'active-arrowhead', 'reversed-arrowhead', 'reversed-active-arrowhead'])\n    .enter().append('marker')\n      .attr({'id': function (d) { return d; },\n             'viewBox':'0 -5 10 10',\n             'refX': function (d) {\n               return (d.lastIndexOf('reversed-', 0) === 0) ? 0 : 10;\n             },\n             'orient':'auto',\n             'markerWidth':10,\n             'markerHeight':10\n            })\n    .append('path')\n      .attr('d', 'M 0 -5 L 10 0 L 0 5 Z')\n      .attr('transform', function (d) {\n        return (d.lastIndexOf('reversed-', 0) === 0) ? 'rotate(180 5 0)' : null;\n      });\n\n  var svgCSS =\n    '.edgepath {' +\n    '  marker-end: url(#arrowhead);' +\n    '}' +\n    '.edgepath.active-edge {' +\n    '  marker-end: url(#active-arrowhead);' +\n    '}' +\n    '.edgepath.reversed-arc {' +\n    '  marker-start: url(#reversed-arrowhead);' +\n    '  marker-end: none;' +\n    '}' +\n    '.edgepath.active-edge.reversed-arc {' +\n    '  marker-start: url(#reversed-active-arrowhead);' +\n    '  marker-end: none;' +\n    '}';\n  svg.append('style').each(function () {\n    if (this.styleSheet) {\n      this.styleSheet.cssText = svgCSS;\n    } else {\n      this.textContent = svgCSS;\n    }\n  });\n\n  // Force Layout Update\n  force.on('tick', function () {\n    // Keep coordinates in bounds. http://bl.ocks.org/mbostock/1129492\n    // NB. Bounding can cause node centers to coincide, especially at corners.\n    nodecircles.attr({cx: function (d) { return d.x = limitRange(nodeRadius, w - nodeRadius, d.x); },\n                      cy: function (d) { return d.y = limitRange(nodeRadius, h - nodeRadius, d.y); }\n    });\n\n    nodelabels.attr('x', function (d) { return d.x; })\n              .attr('y', function (d) { return d.y; });\n\n    edgepaths.attr('d', function (d) { return d.getPath(); });\n\n    edgegroups.each(function (d) { d.refreshLabels(); });\n\n    // Conserve CPU when layout is fully fixed\n    if (nodeArray.every(function (d) { return d.fixed; })) {\n      force.stop();\n    }\n  });\n  this.force = force;\n  /* eslint-enable no-invalid-this */\n}\n\n// Positioning\n\n// {[key: State]: Node} -> PositionTable\nvar getPositionTable = _.mapValues(_.pick(['x', 'y', 'px', 'py', 'fixed']));\n\n// Tag nodes w/ positions. Mutates the node map.\n// PositionTable -> {[key: State]: Node} -> void\nfunction setPositionTable(posTable, stateMap) {\n  _.forEach(function (node, state) {\n    var position = posTable[state];\n    if (position !== undefined) {\n      assign(node, position);\n    }\n  }, stateMap);\n}\n\nObject.defineProperty(StateViz.prototype, 'positionTable', {\n  get: function () { return getPositionTable(this.__stateMap); },\n  set: function (posTable) {\n    setPositionTable(posTable, this.__stateMap);\n    // ensure that a cooled layout will update\n    this.force.resume();\n  }\n});\n\n\nmodule.exports = StateViz;\n","module.exports = __webpack_public_path__ + \"state-diagram/StateViz.css\";"],"sourceRoot":""}